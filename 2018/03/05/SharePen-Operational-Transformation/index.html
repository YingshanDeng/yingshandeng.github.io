<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Operational Transformation," />





  <link rel="alternate" href="/atom.xml" title="Deng's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.0.2" />






<meta name="description" content="å½“å¤šç”¨æˆ·ååŒç¼–è¾‘åŒä¸€ç¯‡æ–‡æ¡£ï¼Œç”±äºæ²¡æœ‰é”çš„æœºåˆ¶ï¼Œä¾¿ä¼šå‡ºç°å†…å®¹å†²çªï¼Œè¿™æ—¶å°±éœ€è¦ä¸€å®šçš„ç®—æ³•æ¥è‡ªåŠ¨è§£å†³å†²çªï¼Œä½¿æ‰€æœ‰å¯¹æ–‡æ¡£çš„ä¿®æ”¹åŒæ­¥åï¼Œæ¯ä¸ªååŒç¼–è¾‘çš„ç”¨æˆ·çœ‹åˆ°çš„æ–‡æ¡£å†…å®¹æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚è€Œ Operational Transformation (ç®€ç§° OT) ç®—æ³•å°±æ˜¯è§£å†³ååŒé—®é¢˜çš„é€šç”¨ç®—æ³•ï¼Œæ”¯æŒå„ç±»ååŒç¼–è¾‘å¼•ç”¨ï¼Œä¾‹å¦‚æ–‡æ¡£ï¼Œè¡¨æ ¼ï¼Œæ¼”ç¤ºï¼Œä»£ç ç¼–è¾‘ç­‰ã€‚å…¶æœ€æ—©å‘è¡¨äº 1989 å¹´ï¼Œåå›  Google çš„åœ¨çº¿åä½œäº§å“">
<meta name="keywords" content="Operational Transformation">
<meta property="og:type" content="article">
<meta property="og:title" content="SharedPen ä¹‹ Operational Transformation">
<meta property="og:url" content="http://objcer.com/2018/03/05/SharePen-Operational-Transformation/index.html">
<meta property="og:site_name" content="Deng&#39;s Blog">
<meta property="og:description" content="å½“å¤šç”¨æˆ·ååŒç¼–è¾‘åŒä¸€ç¯‡æ–‡æ¡£ï¼Œç”±äºæ²¡æœ‰é”çš„æœºåˆ¶ï¼Œä¾¿ä¼šå‡ºç°å†…å®¹å†²çªï¼Œè¿™æ—¶å°±éœ€è¦ä¸€å®šçš„ç®—æ³•æ¥è‡ªåŠ¨è§£å†³å†²çªï¼Œä½¿æ‰€æœ‰å¯¹æ–‡æ¡£çš„ä¿®æ”¹åŒæ­¥åï¼Œæ¯ä¸ªååŒç¼–è¾‘çš„ç”¨æˆ·çœ‹åˆ°çš„æ–‡æ¡£å†…å®¹æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚è€Œ Operational Transformation (ç®€ç§° OT) ç®—æ³•å°±æ˜¯è§£å†³ååŒé—®é¢˜çš„é€šç”¨ç®—æ³•ï¼Œæ”¯æŒå„ç±»ååŒç¼–è¾‘å¼•ç”¨ï¼Œä¾‹å¦‚æ–‡æ¡£ï¼Œè¡¨æ ¼ï¼Œæ¼”ç¤ºï¼Œä»£ç ç¼–è¾‘ç­‰ã€‚å…¶æœ€æ—©å‘è¡¨äº 1989 å¹´ï¼Œåå›  Google çš„åœ¨çº¿åä½œäº§å“">
<meta property="og:image" content="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/SharedPen-Operational%20Transformation.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/EB6D28DA-FACE-4B68-BB71-1A7E8ABFFDEE.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/36EAED8F-D0E3-48F4-AAC9-9FC7AE2EFC88.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/4CA49A74-0941-4E5E-A7E5-78410D96D148.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/49EEDFD9-F635-4F55-8DCA-C165E4813AC6.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/EE6A20BC-A5EA-4BA4-B7F8-566310464A8D.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/AC60F950-D30A-44BC-AB0C-19719EA41C5B.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/7F6B6005-8F23-4294-A94C-196EFE124E8A.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/781C4BCD-1D5C-4AD2-9173-B8CF6CD5C016.png">
<meta property="og:updated_time" content="2020-03-01T13:08:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SharedPen ä¹‹ Operational Transformation">
<meta name="twitter:description" content="å½“å¤šç”¨æˆ·ååŒç¼–è¾‘åŒä¸€ç¯‡æ–‡æ¡£ï¼Œç”±äºæ²¡æœ‰é”çš„æœºåˆ¶ï¼Œä¾¿ä¼šå‡ºç°å†…å®¹å†²çªï¼Œè¿™æ—¶å°±éœ€è¦ä¸€å®šçš„ç®—æ³•æ¥è‡ªåŠ¨è§£å†³å†²çªï¼Œä½¿æ‰€æœ‰å¯¹æ–‡æ¡£çš„ä¿®æ”¹åŒæ­¥åï¼Œæ¯ä¸ªååŒç¼–è¾‘çš„ç”¨æˆ·çœ‹åˆ°çš„æ–‡æ¡£å†…å®¹æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚è€Œ Operational Transformation (ç®€ç§° OT) ç®—æ³•å°±æ˜¯è§£å†³ååŒé—®é¢˜çš„é€šç”¨ç®—æ³•ï¼Œæ”¯æŒå„ç±»ååŒç¼–è¾‘å¼•ç”¨ï¼Œä¾‹å¦‚æ–‡æ¡£ï¼Œè¡¨æ ¼ï¼Œæ¼”ç¤ºï¼Œä»£ç ç¼–è¾‘ç­‰ã€‚å…¶æœ€æ—©å‘è¡¨äº 1989 å¹´ï¼Œåå›  Google çš„åœ¨çº¿åä½œäº§å“">
<meta name="twitter:image" content="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/SharedPen-Operational%20Transformation.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    }
  };
</script>




  <link rel="canonical" href="http://objcer.com/2018/03/05/SharePen-Operational-Transformation/"/>


  <title> SharedPen ä¹‹ Operational Transformation | Deng's Blog </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Deng's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Work Smart, Enjoy Life!</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                SharedPen ä¹‹ Operational Transformation
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2018-03-05T23:25:30+08:00" content="2018-03-05">
              2018-03-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SharedPen/" itemprop="url" rel="index">
                    <span itemprop="name">SharedPen</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/03/05/SharePen-Operational-Transformation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/03/05/SharePen-Operational-Transformation/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/03/05/SharePen-Operational-Transformation/" class="leancloud_visitors" data-flag-title="SharedPen ä¹‹ Operational Transformation">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/SharedPen-Operational%20Transformation.png" alt=""></p>
<p>å½“å¤šç”¨æˆ·ååŒç¼–è¾‘åŒä¸€ç¯‡æ–‡æ¡£ï¼Œç”±äºæ²¡æœ‰é”çš„æœºåˆ¶ï¼Œä¾¿ä¼šå‡ºç°å†…å®¹å†²çªï¼Œè¿™æ—¶å°±éœ€è¦ä¸€å®šçš„ç®—æ³•æ¥è‡ªåŠ¨è§£å†³å†²çªï¼Œä½¿æ‰€æœ‰å¯¹æ–‡æ¡£çš„ä¿®æ”¹åŒæ­¥åï¼Œæ¯ä¸ªååŒç¼–è¾‘çš„ç”¨æˆ·çœ‹åˆ°çš„æ–‡æ¡£å†…å®¹æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚è€Œ Operational Transformation (ç®€ç§° OT) ç®—æ³•å°±æ˜¯è§£å†³ååŒé—®é¢˜çš„é€šç”¨ç®—æ³•ï¼Œæ”¯æŒå„ç±»ååŒç¼–è¾‘å¼•ç”¨ï¼Œä¾‹å¦‚æ–‡æ¡£ï¼Œè¡¨æ ¼ï¼Œæ¼”ç¤ºï¼Œä»£ç ç¼–è¾‘ç­‰ã€‚å…¶æœ€æ—©å‘è¡¨äº 1989 å¹´ï¼Œåå›  Google çš„åœ¨çº¿åä½œäº§å“ Google Waveï¼ŒGoogle Docs çš„åº”ç”¨è€Œæˆç†Ÿæµè¡Œã€‚</p>
<blockquote>
<p>å…³äº Google Wave: <a href="http://www.ifanr.com/675122" target="_blank" rel="external">Google Waveï¼Œå€¼å¾—çºªå¿µçš„ä¼Ÿå¤§å¤±è´¥</a></p>
</blockquote>
<p>GitHub ä¸Šå¼€æºé¡¹ç›® <a href="https://github.com/Operational-Transformation/ot.js" target="_blank" rel="external">ot.js</a> å·²ç»å¯¹ OT ç®—æ³•è¿›è¡Œ JavaScript è¯­è¨€å®ç°ã€‚æœ¬æ–‡å°†å¯¹ OT ç®—æ³•è¿›è¡Œä»‹ç» ğŸ‘‰</p>
<blockquote>
<p><strong>â—ï¸æ³¨æ„:</strong> ot.js åº“åªæ˜¯é’ˆå¯¹çº¯æ–‡æœ¬ååŒç¼–è¾‘çš„ OT ç®—æ³•å®ç°ï¼›SharedPen ä½¿ç”¨äº†è¿™ä¸ªåº“ï¼Œä½†æ˜¯ SharedPen æ”¯æŒå¯Œæ–‡æœ¬ç¼–è¾‘ï¼Œæ‰€ä»¥éœ€è¦å¯¹ ot.js åº“è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ”¯æŒå¯Œæ–‡æœ¬æ–‡æ¡£ç¼–è¾‘çš„ååŒã€‚</p>
</blockquote>
<a id="more"></a>
<h2 id="OT-Explained"><a href="#OT-Explained" class="headerlink" title="OT Explained"></a>OT Explained</h2><p>ä¸ºäº†æ–¹ä¾¿è§£é‡Šï¼Œä»¥ä¸‹å†…å®¹åŸºäº ot.js è¿™ä¸ªåº“åº”ç”¨äº<strong>çº¯æ–‡æœ¬</strong>ååŒç¼–è¾‘å¯¹ OT ç®—æ³•è¿›è¡Œä»‹ç»ã€‚</p>
<h3 id="Operations"><a href="#Operations" class="headerlink" title="Operations"></a>Operations</h3><ul>
<li><strong>Operation(æ“ä½œ) è¡¨ç¤ºå¯¹æ–‡æ¡£çš„ä¿®æ”¹</strong><br>ä¾‹å¦‚æ’å…¥æ–‡æœ¬ï¼Œåˆ é™¤æ–‡æœ¬è¿™äº›éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª <code>operation</code>ã€‚å¦‚åŒæˆ‘ä»¬ Git æ“ä½œä¸­ï¼Œä¸¤ä¸ª commit ä¹‹é—´çš„ diff</li>
<li><strong>ä¸€ä¸ª Operation(æ“ä½œ) åŒ…å«å¤šä¸ª action(è¡Œä¸º)</strong><br>å…±æœ‰ä¸‰ç§ action: insert, delete, retain</li>
</ul>
<h3 id="Actions-insert-delete-retain"><a href="#Actions-insert-delete-retain" class="headerlink" title="Actions(insert, delete, retain)"></a>Actions(insert, delete, retain)</h3><blockquote>
<p>When you apply an operation to a string, an invisible cursor begins traversing the string from left to right. The insert and delete components mutate the string at the current position of the cursor while the retain component simply advances the position of the cursor by the specified number of characters.</p>
</blockquote>
<p>å°† operation åº”ç”¨åˆ°å­—ç¬¦ä¸²æ—¶ï¼Œæœ‰ä¸€ä¸ªéšå½¢çš„å…‰æ ‡ä½äºå­—ç¬¦ä¸²èµ·ç‚¹ï¼Œ<code>retain</code> ç”¨äºç§»åŠ¨å…‰æ ‡ï¼Œ<code>insert</code> å’Œ <code>delete</code> åœ¨å…‰æ ‡æ‰€åœ¨ä½ç½®å¯¹å­—ç¬¦ä¸²è¿›è¡Œå­—ç¬¦æ’å…¥å’Œåˆ é™¤ï¼Œoperation åº”ç”¨å®Œåï¼Œå…‰æ ‡å¿…é¡»å¤„äºå­—ç¬¦ä¸²çš„æœ«ç«¯ï¼ˆè¿™ä¿è¯äº†åº”ç”¨ operation çš„æ­£ç¡®æ€§ï¼‰ã€‚</p>
<h3 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h3><figure class="highlight pony"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> operation = <span class="function"><span class="keyword">new</span> <span class="title">ot</span>.<span class="title">Operation</span>()</span></div><div class="line">  .<span class="title">retain</span>(<span class="number">11</span>)</div><div class="line">  .<span class="title">insert</span>(" dolor");</div><div class="line"></div><div class="line"><span class="title">operation</span>.<span class="title">apply</span>("lorem ipsum"); <span class="comment">// =&gt; "lorem ipsum dolor"</span></div></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/EB6D28DA-FACE-4B68-BB71-1A7E8ABFFDEE.png" alt=""></p>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œoperation åŒ…å«ä¸¤ä¸ª action: <code>retain(11)</code> å’Œ <code>insert(&quot; dolor&quot;)</code>ï¼Œé¡ºåºæ‰§è¡Œè¿™ä¸¤ä¸ª actionï¼Œå…‰æ ‡ä»å·¦å¾€å³ç§»åŠ¨ 11 ä¸ªå­—ç¬¦ï¼Œç„¶ååœ¨å…‰æ ‡å½“å‰ä½ç½®æ’å…¥å­—ç¬¦ <code>&quot; dolor&quot;</code>ï¼Œå…‰æ ‡æœ€ç»ˆåˆ°è¾¾å­—ç¬¦ä¸²æœ«ç«¯ï¼Œoperation åº”ç”¨å®Œæˆã€‚</p>
<p>æˆ‘ä»¬å†å°† operation åº”ç”¨åˆ°å­—ç¬¦ä¸² <code>&quot;lorem ipsum amet&quot;</code> ä¸­ï¼Œå‘ç°ä¼šæŠ¥é”™ï¼<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">operation</span><span class="selector-class">.apply</span>(<span class="string">"lorem ipsum amet"</span>); <span class="comment">// throws an error</span></div></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯å› ä¸º operation åº”ç”¨å®Œåï¼Œéšå½¢çš„å…‰æ ‡å¹¶ä¸å¤„äºå­—ç¬¦ä¸²æœ«ç«¯ï¼Œæ‰€ä»¥æŠ¥é”™ï¼›è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿç®€å•ï¼Œå¢åŠ ä¸€ä¸ª <code>retain</code> è¡Œä¸ºå°†å…‰æ ‡ç§»åŠ¨åˆ°å­—ç¬¦ä¸²æœ«ç«¯ã€‚<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">operation.retain(<span class="number">5</span>).<span class="built_in">apply</span>(<span class="string">"lorem ipsum amet"</span>); // =&gt; <span class="string">"lorem ipsum dolor amet"</span></div></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/36EAED8F-D0E3-48F4-AAC9-9FC7AE2EFC88.png" alt=""></p>
<h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> operation = <span class="built_in">new</span> ot.Operation() // create <span class="built_in">new</span> operation</div><div class="line">  .<span class="built_in">delete</span>(<span class="string">"lorem "</span>)</div><div class="line">  .retain(<span class="number">5</span>);</div><div class="line">operation.<span class="built_in">apply</span>(<span class="string">"lorem ipsum"</span>); // =&gt; <span class="string">"ipsum"</span></div></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/4CA49A74-0941-4E5E-A7E5-78410D96D148.png" alt=""></p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œoperation åŒ…å«ä¸¤ä¸ª action: <code>delete(&quot;lorem &quot;)</code> å’Œ <code>retain(5)</code>ï¼Œé¡ºåºæ‰§è¡Œè¿™ä¸¤ä¸ª actionï¼Œå…ˆåˆ é™¤å­—ç¬¦ <code>&quot;lorem &quot;</code>ï¼Œç„¶åå…‰æ ‡å†ä»å·¦å¾€å³ç§»åŠ¨ 5 ä¸ªå­—ç¬¦æ°å¥½åˆ°è¾¾å­—ç¬¦ä¸²æœ«ç«¯ï¼Œoperation åº”ç”¨å®Œæˆã€‚</p>
<p>åœ¨ä¸¥è°¨çš„ OT ç®—æ³•å®ç°ä¸­ï¼Œ<code>delete</code> åˆ é™¤å­—ç¬¦æ˜¯è¦ä¸¥æ ¼åŒ¹é…çš„ã€‚<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">operation</span><span class="selector-class">.apply</span>(<span class="string">"trolo ipsum"</span>); <span class="comment">// åˆ é™¤å­—ç¬¦ä¸åŒ¹é…ï¼Œthrows an error</span></div></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯åœ¨å®é™…çš„ç®—æ³•å®ç°ä¸­ï¼Œå¾ˆå¤šæ˜¯æ ¹æ®åˆ é™¤å­—ç¬¦çš„é•¿åº¦æ¥è¿›è¡Œåˆ é™¤ï¼Œä¾‹å¦‚ ot.js åº“å°±æ˜¯è¿™æ ·å¤„ç†ï¼Œåœ¨å®é™…ååŒæ–‡æœ¬ç¼–è¾‘å™¨åº”ç”¨ä¸­ä¹ŸåŸºæœ¬æ»¡è¶³è¦æ±‚äº†ï¼Œæ— éœ€å†å¯¹åˆ é™¤å­—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿæé«˜äº†å¤„ç†æ•ˆç‡ã€‚</p>
<h3 id="æ“ä½œåˆå¹¶-compose"><a href="#æ“ä½œåˆå¹¶-compose" class="headerlink" title="æ“ä½œåˆå¹¶(compose)"></a>æ“ä½œåˆå¹¶(compose)</h3><p>å‰é¢æåˆ°ï¼š<strong>ä¸€ä¸ª Operation(æ“ä½œ) åŒ…å«å¤šä¸ª action(è¡Œä¸º)</strong>ï¼Œè¿™æ ·æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ï¼š<strong>å¤šä¸ª operation èƒ½åˆå¹¶ (compose) æˆä¸€ä¸ª</strong>ã€‚</p>
<blockquote>
<p><strong><em>apply(apply(S, A), B) = apply(S, compose(A, B))</em></strong><br>å¤šä¸ª operation ä¾æ¬¡åº”ç”¨ç­‰ä»·äºï¼Œå…ˆå°†å¤šä¸ª operation åˆå¹¶æˆä¸€ä¸ªï¼Œç„¶åå†è¿›è¡Œåº”ç”¨</p>
</blockquote>
<p>ä¾‹å¦‚æœ‰ä¸¤ä¸ª operation è¦åº”ç”¨åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸Šï¼Œæ­£å¸¸çš„åšæ³•æ˜¯è¿™ä¸¤ä¸ª operation ä¾æ¬¡è¿›è¡Œåº”ç”¨ï¼›ç°åœ¨æˆ‘ä»¬å¯ä»¥å…ˆå¯¹ä¸¤ä¸ª operation è¿›è¡Œåˆå¹¶æˆä¸€ä¸ª operationï¼Œç„¶åå†è¿›è¡Œåº”ç”¨ã€‚<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Define two consecutive operations</span></div><div class="line"><span class="keyword">var</span> operation0 = <span class="keyword">new</span> <span class="type">ot</span>.Operation()</div><div class="line">  .retain(<span class="number">11</span>)</div><div class="line">  .insert(<span class="string">" dolor"</span>);</div><div class="line"><span class="keyword">var</span> operation1 = <span class="keyword">new</span> <span class="type">ot</span>.Operation()</div><div class="line">  .delete(<span class="string">"lorem "</span>)</div><div class="line">  .retain(<span class="number">11</span>);</div><div class="line"></div><div class="line"><span class="comment">// Our input string</span></div><div class="line"><span class="keyword">var</span> str0 = <span class="string">"lorem ipsum"</span>;</div></pre></td></tr></table></figure></p>
<p>ä¾æ¬¡åº”ç”¨è¿™ä¸¤ä¸ª operationï¼š<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Apply operations one after another</span></div><div class="line">var str<span class="number">1</span> = operatio<span class="symbol">n0</span>.apply<span class="comment">(str0)</span>; <span class="comment">// "lorem ipsum dolor"</span></div><div class="line">var str<span class="number">2</span>a = operatio<span class="symbol">n1</span>.apply<span class="comment">(str1)</span>; <span class="comment">// "ipsum dolor"</span></div></pre></td></tr></table></figure></p>
<p>å…ˆå°†ä¸¤ä¸ª operation åˆå¹¶æˆä¸€ä¸ªï¼Œç„¶åå†åº”ç”¨è¿™ä¸ª operationï¼š<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// Combine operations <span class="keyword">and</span> <span class="built_in">apply</span> the combined operation</div><div class="line"><span class="built_in">var</span> combinedOperation = operation0.compose(operation1);</div><div class="line"><span class="built_in">var</span> str2b = combinedOperation.<span class="built_in">apply</span>(str0); // <span class="string">"ipsum dolor"</span></div></pre></td></tr></table></figure></p>
<h3 id="æ“ä½œè½¬æ¢-transform"><a href="#æ“ä½œè½¬æ¢-transform" class="headerlink" title="æ“ä½œè½¬æ¢(transform)"></a>æ“ä½œè½¬æ¢(transform)</h3><p>OT ç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯è¿™ä¸ª <code>transform</code> è½¬æ¢ç®—æ³•ï¼ŒOT çš„æ€è·¯æ˜¯å°†ç¼–è¾‘è½¬æ¢æˆæ“ä½œ (operation)ï¼Œå½“å¤šäººååŒæ“ä½œæ—¶ï¼Œå°±éœ€è¦å¯¹è¿™äº›æ“ä½œè¿›è¡Œè½¬æ¢ï¼Œä½¿å¾—æœ€ç»ˆæ–‡æ¡£çš„å†…å®¹ä¸€è‡´ã€‚</p>
<p>ä¾‹å¦‚ï¼šæ–‡æ¡£å†…å®¹æ˜¯ï¼šâ€™goâ€™ï¼Œä¸¤ä¸ªç”¨æˆ·åŒæ—¶åœ¨å­—ç¬¦ä¸²æœ«å°¾æ‰§è¡Œå­—ç¬¦æ’å…¥ï¼š<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">var</span> str = <span class="string">'go'</span></div></pre></td></tr></table></figure></p>
<p>Client-A:<br><figure class="highlight pony"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> opA = <span class="function"><span class="keyword">new</span> <span class="title">ot</span>.<span class="title">Operation</span>()</span></div><div class="line">  .<span class="title">retain</span>(<span class="number">2</span>)</div><div class="line">  .<span class="title">insert</span>("a");</div><div class="line"></div><div class="line"><span class="title">opA</span>.<span class="title">apply</span>(str) <span class="comment">// =&gt; goa</span></div></pre></td></tr></table></figure></p>
<p>Client-B:<br><figure class="highlight pony"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> opB = <span class="function"><span class="keyword">new</span> <span class="title">ot</span>.<span class="title">Operation</span>()</span></div><div class="line">  .<span class="title">retain</span>(<span class="number">2</span>)</div><div class="line">  .<span class="title">insert</span>("t");</div><div class="line"><span class="title">opB</span>.<span class="title">apply</span>(str) <span class="comment">// =&gt; got</span></div></pre></td></tr></table></figure></p>
<p>ç”¨æˆ·å¯¹æ–‡æ¡£çš„æ’å…¥æ“ä½œä¼šç«‹å³åº”ç”¨åˆ°æœ¬åœ°æ–‡æ¡£å‰¯æœ¬ï¼Œç„¶åå°†æ“ä½œ <code>opA</code> å’Œ <code>opB</code> ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼›æœåŠ¡å™¨å…ˆåæ¥æ”¶åˆ°è¿™ä¸¤ä¸ªæ“ä½œï¼Œç„¶åå¯¹æœåŠ¡ç«¯çš„è¿™ä»½æ–‡æ¡£è¿›è¡Œåº”ç”¨ï¼Œå‡è®¾ä»¥å…ˆ <code>opA</code> å <code>opB</code> çš„é¡ºåºï¼Œåº”ç”¨ <code>opA</code> åï¼Œå­—ç¬¦ä¸²å˜æˆ <code>goa</code>ï¼Œé•¿åº¦å˜æˆ 3ï¼›ç„¶ååº”ç”¨ <code>opB</code>ï¼Œéšå½¢çš„å…‰æ ‡æœªåˆ°å­—ç¬¦ä¸²æœ«ç«¯ï¼Œæ‰§è¡Œä¼šæŠ›å‡ºé”™è¯¯ã€‚<br>æ­¤å¤–ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šå°† <code>opA</code> å‘é€ç»™ Client-Bï¼Œ<code>opB</code> å‘é€ç»™ Client-Aï¼Œç”±äºæ­¤æ—¶å­—ç¬¦ä¸²éƒ½é•¿åº¦éƒ½å˜æˆ 3ï¼Œåº”ç”¨è¿‡ç¨‹ä¸­éšå½¢çš„å…‰æ ‡æœªåˆ°å­—ç¬¦ä¸²æœ«ç«¯ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚ä½†å³ä½¿èƒ½åº”ç”¨æˆæœï¼Œç»“æœä¹Ÿæ˜¯ï¼š</p>
<ul>
<li>Client-A: â€˜goaâ€™ + (retain(2); insert(â€˜tâ€™)) = â€˜gotaâ€™</li>
<li>Client-B: â€˜gotâ€™ + (retain(2); insert(â€˜aâ€™)) = â€˜goatâ€™</li>
</ul>
<p>ä¸¤ä¸ªç”¨æˆ·å¾—åˆ°çš„æ–‡æ¡£å†…å®¹ä¹Ÿä¸ä¸€è‡´äº†ï¼Œè¿™ç§æƒ…å†µä¸‹å°±éœ€è¦ <code>transform</code> æ“ä½œè½¬æ¢äº†ã€‚<br><img src="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/49EEDFD9-F635-4F55-8DCA-C165E4813AC6.png" alt=""></p>
<p>â‘  å¦‚ä¸Šå›¾å·¦ï¼Œ<code>a</code> è¡¨ç¤ºå®¢æˆ·ç«¯çš„ operationï¼Œ<code>b</code> è¡¨ç¤ºæœåŠ¡ç«¯çš„ operationï¼ŒäºŒè€…ç›¸äº¤çš„é¡¶ç‚¹è¡¨ç¤ºæ–‡æ¡£çŠ¶æ€ç›¸åŒï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯¹æ–‡æ¡£åˆ†åˆ«åº”ç”¨æ“ä½œ <code>a</code> å’Œ <code>b</code>ï¼Œè¿™æ—¶ä¸¤è¾¹çš„æ–‡æ¡£å†…å®¹éƒ½å‘ç”Ÿå˜åŒ–ï¼Œä¸”ä¸ä¸€è‡´ï¼›ä¸ºäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ–‡æ¡£è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ <code>a</code> å’Œ <code>b</code> è¿›è¡Œæ“ä½œè½¬æ¢ <code>transfrom(a, b) =&gt; (a&#39;, b&#39;)</code> å¾—åˆ°ä¸¤ä¸ªè¡ç”Ÿçš„æ“ä½œ <code>a&#39;</code> å’Œ <code>b&#39;</code>ã€‚<br>â‘¡ å¦‚ä¸Šå›¾å³ï¼Œ<code>a&#39;</code> åœ¨æœåŠ¡ç«¯åº”ç”¨ï¼Œ<code>b&#39;</code> åœ¨å®¢æˆ·ç«¯åº”ç”¨ï¼Œæœ€ç»ˆæ–‡æ¡£å†…å®¹è¾¾åˆ°ä¸€è‡´ã€‚</p>
<p>ä¸Šé¢è¿™ç§é—®é¢˜ç§°ä¹‹ä¸ºï¼š<strong>one-step diamond problem</strong>ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶å¯¹æ–‡æ¡£æ‰§è¡Œä¸€ä¸ª operationï¼Œä»ä¸Šæ–¹é¡¶ç‚¹åˆ†è£‚å¼€ä¸¤æ¡è¾¹ï¼Œç›¸å½“äº diamond å›¾å½¢çš„ä¸Šæ–¹ä¸¤è¾¹ï¼ˆ<code>a</code>, <code>b</code>ï¼‰ï¼Œé€šè¿‡ OT ç®—æ³•çš„ <code>transform</code> æ–¹æ³•å¾—åˆ°ä¸¤ä¸ªè¡ç”Ÿçš„ operationï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åˆ†åˆ«æ‰§è¡Œè¿™ä¸¤ä¸ªè¡ç”Ÿçš„ operationï¼Œç›¸å½“äº diamond å›¾å½¢çš„ä¸‹æ–¹ä¸¤è¾¹ï¼ˆ<code>a&#39;</code>, <code>b&#39;</code>ï¼‰ï¼Œè¿™æ ·ä»ä¸Šæ–¹é¡¶ç‚¹åˆ†è£‚å¼€çš„ä¸¤è¾¹åˆæ±‡åˆåˆ°ä¸‹é¡¶ç‚¹ï¼Œæ„æˆä¸€ä¸ªå®Œæ•´çš„ diamond å›¾å½¢ã€‚diamond å›¾å½¢çš„ä¸Šä¸‹ä¸¤ä¸ªé¡¶ç‚¹è¡¨ç¤ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ–‡æ¡£å†…å®¹å¤„äºç›¸åŒçŠ¶æ€ã€‚</p>
<p><img src="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/EE6A20BC-A5EA-4BA4-B7F8-566310464A8D.png" alt=""></p>
<p>æ‰€ä»¥è¿™ä¸ªä¾‹å­çš„æ­£ç¡®è§£æ³•æ˜¯ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">var transformedPair</span> = ot.Operation.transform(opA, opB);</div><div class="line"><span class="attribute">var opAPrime</span> = transformedPair[0];</div><div class="line"><span class="attribute">var opBPrime</span> = transformedPair[1];</div><div class="line"></div><div class="line"><span class="attribute">var strABPrime</span> = opAPrime.apply(strB);</div><div class="line"><span class="attribute">var strBAPrime</span> = opBPrime.apply(strA);</div></pre></td></tr></table></figure></p>
<h3 id="operation-çš„é€†å‘æ“ä½œ"><a href="#operation-çš„é€†å‘æ“ä½œ" class="headerlink" title="operation çš„é€†å‘æ“ä½œ"></a>operation çš„é€†å‘æ“ä½œ</h3><blockquote>
<p>The inverse of an operation is the operation that reverts the effects of the operation</p>
</blockquote>
<p>ä¾‹å¦‚ä¸€ä¸ª opration åŒ…å« <code>insert(&quot;hello &quot;); retain(6);</code> è¿™ä¸¤ä¸ª actionï¼›é‚£ä¹ˆè¿™ä¸ª operation çš„é€†å‘æ“ä½œå°±æ˜¯ <code>delete(&quot;hello &quot;); retain(6);</code><br>ä¸€ä¸ª operation çš„é€†å‘ä¸»è¦ç”¨äº Undo/Redoï¼Œåœ¨æ–‡æ¡£ç¼–è¾‘ä¸­æ‰§è¡Œäº†ä¸€ä¸ª operationï¼Œé‚£ä¹ˆéœ€è¦å°†å…¶é€†å‘æ“ä½œæ¨å…¥ undo/redo æ ˆä¸­ï¼Œåœ¨æ’¤é”€/å›æ’¤æ—¶ï¼Œå¼¹å‡ºæ ˆé¡¶ operation æ‰§è¡Œã€‚</p>
<blockquote>
<p>undo/redo å…¥æ ˆçš„æ•°æ®é™¤äº†å½“å‰æ“ä½œçš„ inverse operationï¼Œè¿˜åŒ…æ‹¬äº†é€‰åŒºä¿¡æ¯<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// inverseOperation inverse operation</span></div><div class="line"><span class="comment">// Metadata: selection</span></div><div class="line"><span class="function"><span class="title">WrappedOperation</span><span class="params">(inverseOperation, Metadata)</span></span></div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="C-S-æ¨¡å¼"><a href="#C-S-æ¨¡å¼" class="headerlink" title="C/S æ¨¡å¼"></a>C/S æ¨¡å¼</h2><p>ç»å¤§å¤šæ•°çš„ååŒåº”ç”¨éƒ½æ˜¯ Client/Server(C/S) æ¨¡å¼ï¼Œä¸‹é¢æˆ‘ä»¬å°†åˆ†æ OT ç®—æ³•åœ¨ C/S æ¨¡å¼ä¸‹çš„å¤„ç†è¿‡ç¨‹ã€‚</p>
<h3 id="compound-OT"><a href="#compound-OT" class="headerlink" title="compound OT"></a>compound OT</h3><p>ä¸Šä¸€èŠ‚ä¸­ä»‹ç»äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å„æœ‰ä¸€ä¸ªæ“ä½œçš„æƒ…å†µï¼Œé€šè¿‡ <code>transform</code> æ“ä½œå˜æ¢ï¼Œå°†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ–‡æ¡£å†…å®¹æ”¶æ•›åˆ°ç›¸åŒçŠ¶æ€ï¼›ä½†æ˜¯åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œä¸å¯èƒ½ä»…ä»…åªæœ‰ä¸€ä¸ªæ“ä½œï¼Œè€Œæ˜¯æœ‰å¤šä¸ªæ“ä½œï¼Œå‡è®¾å®¢æˆ·ç«¯æœ‰ä¸¤ä¸ªæ“ä½œï¼ŒæœåŠ¡ç«¯åªæœ‰ä¸€ä¸ªæ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/AC60F950-D30A-44BC-AB0C-19719EA41C5B.png" alt=""></p>
<p>æ­¤æ—¶éœ€è¦æ„å»ºä¸¤ä¸ª diamond å›¾å½¢æ‰èƒ½ä½¿å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ–‡æ¡£æ”¶æ•›åˆ°ç›¸åŒçš„çŠ¶æ€ã€‚</p>
<p><img src="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/7F6B6005-8F23-4294-A94C-196EFE124E8A.png" alt=""><br>å¦‚ä¸Šå›¾å®¢æˆ·ç«¯æœ‰ä¸‰ä¸ªæ“ä½œï¼ŒæœåŠ¡ç«¯æœ‰ä¸€ä¸ªæ“ä½œçš„æ—¶å€™ï¼Œéœ€è¦æ„å»ºä¸‰ä¸ª diamond å›¾å½¢èƒ½å°†ä¸¤ç«¯æ–‡æ¡£å†…å®¹æ”¶æ•›åˆ°ç›¸åŒçŠ¶æ€ï¼›ç”±æ­¤æˆ‘ä»¬å¯ä»¥ç±»æ¨å‡ºï¼Œå½“ä¸¤ç«¯æ“ä½œæ•°å‡ºç°å¤šå¯¹ä¸€ <code>N:1</code> æˆ–è€…ä¸€å¯¹å¤š <code>1:N</code> çš„å…³ç³»æ—¶ï¼Œå¯ä»¥é€’å½’æ„å»º diamond å›¾å½¢æ¥ä½¿å¾—ä¸¤ç«¯å†…å®¹æœ€ç»ˆæ”¶æ•›åˆ°ç›¸åŒçŠ¶æ€ã€‚<br>å‡è®¾å·²çŸ¥å®¢æˆ·ç«¯æœ‰ä¸€ä¸ªæ“ä½œ <code>clientOp</code>ï¼ŒæœåŠ¡ç«¯æœ‰å¤šä¸ªæ“ä½œ <code>serverOps</code> ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç ï¼Œè®¡ç®—å‡ºå®¢æˆ·ç«¯çš„æ“ä½œç»è¿‡å˜æ¢ï¼Œåœ¨æœåŠ¡ç«¯åº”ç”¨çš„æ“ä½œ <code>clientOpPrime</code>ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> clientOp</div><div class="line"><span class="keyword">var</span> serverOps = []</div><div class="line"><span class="keyword">var</span> clientOpPrime = clientOp</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; serverOps.length; i++) &#123;</div><div class="line">  clientOpPrime = transform(clientOpPrime, serverOps[i])[<span class="number">0</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å½“ç„¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ“ä½œæ•°ä¹Ÿæœ‰å¯èƒ½å‡ºç°å¤šå¯¹å¤š <code>N:M</code> çš„å…³ç³»ï¼Œé‚£ä¹ˆåšæ³•æ˜¯å°† <code>N:M</code> çš„å…³ç³»æ‹†åˆ†æˆå¤šä¸ª <code>N:1</code> æˆ–è€… <code>1:N</code> çš„å…³ç³»æ¥è§£å†³ã€‚<br><img src="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/781C4BCD-1D5C-4AD2-9173-B8CF6CD5C016.png" alt=""></p>
<h3 id="revision-ç‰ˆæœ¬å·"><a href="#revision-ç‰ˆæœ¬å·" class="headerlink" title="revision(ç‰ˆæœ¬å·)"></a>revision(ç‰ˆæœ¬å·)</h3><ul>
<li>æ–‡æ¡£ä¸€æ¬¡ç¼–è¾‘å‰åçš„å·®å¼‚ (diff) å³ä¸ºä¸€ä¸ª operation æ“ä½œ</li>
<li>æ¯ä¸€ä¸ªæ“ä½œå¯¹åº”ä¸€æ¬¡ç‰ˆæœ¬å·é¡ºåºé€’å¢</li>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å„è‡ªç»´æŒä¸€ä¸ªç‰ˆæœ¬å·<ul>
<li>å®¢æˆ·ç«¯è¿›è¡Œä¸€æ¬¡ç¼–è¾‘äº§ç”Ÿä¸€ä¸ª operation æˆ–è€…ä»æœåŠ¡ç«¯æ¥æ”¶åˆ°ä¸€ä¸ª operationï¼Œå®¢æˆ·ç«¯ç‰ˆæœ¬å·éƒ½ä¼šé€’å¢ä¸€</li>
<li>æœåŠ¡ç«¯ä½œä¸ºå®¢æˆ·ç«¯å¹¶å‘ç¼–è¾‘æ“ä½œä¸²è¡ŒåŒ–çš„åœ°ç‚¹ï¼Œé™¤äº†ä¿å­˜æ–‡æ¡£å†…å®¹ï¼Œè¿˜ä¼šå°†å®¢æˆ·ç«¯å‘è¿‡æ¥çš„ operation ä¿å­˜åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œè¿™ä¸ªæ•°ç»„ä¹Ÿå°±æ˜¯æ–‡æ¡£ç¼–è¾‘çš„å†å²è®°å½•ã€‚æœåŠ¡ç«¯æ¯æ¥æ”¶åˆ°ä¸€ä¸ªæ“ä½œï¼ŒæœåŠ¡ç«¯ç‰ˆæœ¬å·ä¼šé€’å¢ä¸€</li>
<li><strong>å®¢æˆ·ç«¯ç‰ˆæœ¬å·å§‹ç»ˆå°äºç­‰äºæœåŠ¡ç«¯ç‰ˆæœ¬å·</strong></li>
</ul>
</li>
</ul>
<h3 id="C-S-ç›´æ¥çš„äº¤äº’"><a href="#C-S-ç›´æ¥çš„äº¤äº’" class="headerlink" title="C/S ç›´æ¥çš„äº¤äº’"></a>C/S ç›´æ¥çš„äº¤äº’</h3><ul>
<li>å®¢æˆ·ç«¯å°†ä¸€æ¬¡ç¼–è¾‘æ“ä½œï¼ˆä¾‹å¦‚è¾“å…¥/åˆ é™¤å­—ç¬¦ï¼Œè®¾ç½®æ–‡æœ¬æ ·å¼ç­‰ï¼‰å°è£…æˆä¸€ä¸ª operationï¼Œé€šè¿‡ socket å°†å½“å‰å®¢æˆ·ç«¯ç‰ˆæœ¬å· revision å’Œç¼–è¾‘æ“ä½œ operation å‘é€åˆ°æœåŠ¡ç«¯</li>
<li>æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ä¿¡æ¯ <code>(revision, operation)</code> åï¼Œæ‰§è¡Œå¦‚ä¸‹å¤„ç†å‡½æ•°<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">receiveOperation (revision, operation) &#123;</div><div class="line">  <span class="comment">// â‘  revision check</span></div><div class="line">  <span class="keyword">if</span> (revision &lt; <span class="number">0</span> || <span class="keyword">this</span>.operations.length &lt; revision) &#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'operation revision not in history'</span>)</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// â‘¡ Find all operations that the client didn't know of when it sent the</span></div><div class="line">  <span class="comment">// operation ...</span></div><div class="line">  <span class="keyword">var</span> concurrentOperations = <span class="keyword">this</span>.operations.slice(revision)</div><div class="line"></div><div class="line">  <span class="comment">// ... and transform the operation against all these operations ...</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; concurrentOperations.length; i++) &#123;</div><div class="line">    operation = WrappedOperation.transform(operation, concurrentOperations[i])[<span class="number">0</span>]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// â‘¢ ... and apply that on the document.</span></div><div class="line">  <span class="keyword">this</span>.document = operation.apply(<span class="keyword">this</span>.document)</div><div class="line">  <span class="comment">// Store operation in history.</span></div><div class="line">  <span class="keyword">this</span>.operations.push(operation)</div><div class="line"></div><div class="line">  <span class="comment">// It's the caller's responsibility to send the operation to all connected</span></div><div class="line">  <span class="comment">// clients and an acknowledgement to the creator.</span></div><div class="line">  <span class="keyword">return</span> operation</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>ğŸ‘‰ å‰–æä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼š</p>
<ul>
<li><strong>æ³¨é‡Šâ‘ </strong>ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç‰ˆæœ¬å·å¤§å°æ¯”è¾ƒï¼Œç¡®ä¿<em>å®¢æˆ·ç«¯ç‰ˆæœ¬å·å§‹ç»ˆå°äºç­‰äºæœåŠ¡ç«¯ç‰ˆæœ¬å·</em>ï¼Œå¦åˆ™æŠ¥é”™</li>
<li><strong>æ³¨é‡Šâ‘¡</strong>ï¼šå®¢æˆ·ç«¯æ“ä½œå’ŒæœåŠ¡ç«¯æ“ä½œé€’å½’æ‰§è¡Œ <code>transform</code> æ“ä½œå˜æ¢</li>
<li><strong>æ³¨é‡Šâ‘¢</strong>ï¼šå°†<em>æ³¨é‡Šâ‘¡</em>ç»“æœåº”ç”¨åˆ°å½“å‰æ–‡æ¡£ï¼Œå¹¶ä¿å­˜åˆ°å†å²æ“ä½œæ•°ç»„ä¸­</li>
<li>æœ€åï¼Œå°† <code>receiveOperation (revision, operation)</code> è¿™ä¸ªå‡½æ•°è¿”å›çš„ <code>operation</code> å‘é€ç»™å…¶ä»–ååŒç¼–è¾‘çš„å®¢æˆ·ç«¯</li>
</ul>
<h3 id="UNDO-REDO"><a href="#UNDO-REDO" class="headerlink" title="UNDO/REDO"></a>UNDO/REDO</h3><p>å®¢æˆ·ç«¯ä»æœåŠ¡ç«¯æ¥æ”¶åˆ°ä¸€ä¸ª <code>operation</code> åï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸ª <code>operation</code> å¯¹ UNDO/REDO æ ˆä¸­çš„æ‰€æœ‰æ“ä½œè¿›è¡Œ <code>transform</code> å˜æ¢<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">transform (operation) &#123;</div><div class="line">  <span class="keyword">this</span>.undoStack = <span class="keyword">this</span>._transformStack(<span class="keyword">this</span>.undoStack, operation)</div><div class="line">  <span class="keyword">this</span>.redoStack = <span class="keyword">this</span>._transformStack(<span class="keyword">this</span>.redoStack, operation)</div><div class="line">&#125;</div><div class="line">_transformStack (stack, operation) &#123;</div><div class="line">  <span class="keyword">var</span> newStack = []</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = stack.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">    <span class="keyword">var</span> pair = WrappedOperation.transform(stack[i], operation)</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> pair[<span class="number">0</span>].isNoop !== <span class="string">'function'</span> || !pair[<span class="number">0</span>].isNoop()) &#123;</div><div class="line">      newStack.push(pair[<span class="number">0</span>])</div><div class="line">    &#125;</div><div class="line">    operation = pair[<span class="number">1</span>]</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> newStack.reverse()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="OT-å¯Œæ–‡æœ¬æ”¯æŒ"><a href="#OT-å¯Œæ–‡æœ¬æ”¯æŒ" class="headerlink" title="OT å¯Œæ–‡æœ¬æ”¯æŒ"></a>OT å¯Œæ–‡æœ¬æ”¯æŒ</h2><p>å…³äºæ‰©å±• ot.js æ”¯æŒå¯Œæ–‡æœ¬å±æ€§ï¼Œå¯ä»¥å‚è€ƒæ–‡ä»¶ <a href="">TextAction.js</a> å’Œ <a href="">TextOperation.js</a>ï¼Œæ­¤å¤„ä¸å±•å¼€ä»‹ç»ï¼ˆåé¢å†å†™æ–‡ç« å¯¹æ­¤ä»‹ç»ï¼‰</p>
<p>å‰é¢æåˆ°æœåŠ¡ç«¯ä¿å­˜äº†ä¸¤å¥—æ•°æ®ï¼š</p>
<ul>
<li>æ–‡æ¡£å†…å®¹ï¼Œè¿™æ˜¯ä¸€æ®µçº¯æ–‡æœ¬å­—ç¬¦ä¸²</li>
<li>æ–‡æ¡£ç¼–è¾‘å†å²è®°å½•ï¼Œè¿™æ˜¯ä¸€ä¸ªä¿å­˜ operation çš„æ•°ç»„</li>
</ul>
<p>æ³¨æ„åˆ°æ–‡æ¡£å†…å®¹æ˜¯çº¯æ–‡æœ¬ï¼Œå¹¶ä¸åŒ…å«å¯Œæ–‡æœ¬ä¿¡æ¯ã€‚å®¢æˆ·ç«¯æ‰“å¼€æ–‡æ¡£æ—¶ï¼Œéœ€è¦å°†æ–‡æ¡£å†å²è®°å½•ä¸­æ‰€æœ‰çš„ operation åˆå¹¶æˆä¸€ä¸ª operationï¼ˆåˆå¹¶é€»è¾‘å¯æ”¾åœ¨æœåŠ¡ç«¯å¤„ç†ï¼Œå°†åˆå¹¶åçš„ operation å‘ç»™å®¢æˆ·ç«¯ï¼‰ï¼Œç„¶åå¯¹æ–‡æ¡£å†…å®¹æ‰§è¡Œè¿™ä¸ª operationï¼Œè¿™æ ·æ‰ä¼šè®©æ–‡æ¡£æ˜¾ç¤ºå‡ºå¯Œæ–‡æœ¬æ ·å¼ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">initClientContent () &#123;</div><div class="line">  <span class="comment">// init the editor content with historyOps</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.historyOps &amp;&amp; <span class="keyword">this</span>.historyOps.length) &#123;</div><div class="line">    <span class="keyword">var</span> _ops = <span class="keyword">this</span>.historyOps.map(<span class="function"><span class="params">wrappedOp</span> =&gt;</span> wrappedOp.wrapped)</div><div class="line">    <span class="keyword">var</span> initialTextOp = <span class="keyword">new</span> TextOperation()</div><div class="line"></div><div class="line">    _ops.forEach(<span class="function">(<span class="params">op</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">var</span> _textOp = TextOperation.fromJSON(op)</div><div class="line">      initialTextOp = initialTextOp.compose(_textOp)</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.applyOperation(initialTextOp)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://github.com/Operational-Transformation/ot.js" target="_blank" rel="external">Operational-Transformation/ot.js</a><br><a href="http://operational-transformation.github.io/index.html" target="_blank" rel="external">Operational Transformation</a><br><a href="http://www.codecommit.com/blog/java/understanding-and-applying-operational-transformation" target="_blank" rel="external">Understanding and Applying Operational Transformation</a><br><a href="http://blog.csdn.net/pheecian10/article/details/78496854" target="_blank" rel="external">Operational Transformationç®—æ³•å›¾è§£</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Operational-Transformation/" rel="tag">#Operational Transformation</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/02/27/SharedPen-AnnotationList/" rel="next" title="SharedPen ä¹‹ AnnotationList">
                <i class="fa fa-chevron-left"></i> SharedPen ä¹‹ AnnotationList
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/05/SharedPen-IntervalTree-Optimization/" rel="prev" title="SharedPen ä¹‹åŒºé—´æ ‘ä¼˜åŒ–">
                SharedPen ä¹‹åŒºé—´æ ‘ä¼˜åŒ– <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://raw.githubusercontent.com/yingshandeng/image-host/master/data/avatar.jpg"
               alt="å°é‚“" />
          <p class="site-author-name" itemprop="name">å°é‚“</p>
          <p class="site-description motion-element" itemprop="description">Hello World</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">59</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">80</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yingshandeng" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/objcer" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2249439934" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#OT-Explained"><span class="nav-number">1.</span> <span class="nav-text">OT Explained</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Operations"><span class="nav-number">1.1.</span> <span class="nav-text">Operations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Actions-insert-delete-retain"><span class="nav-number">1.2.</span> <span class="nav-text">Actions(insert, delete, retain)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ’å…¥"><span class="nav-number">1.3.</span> <span class="nav-text">æ’å…¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ é™¤"><span class="nav-number">1.4.</span> <span class="nav-text">åˆ é™¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ“ä½œåˆå¹¶-compose"><span class="nav-number">1.5.</span> <span class="nav-text">æ“ä½œåˆå¹¶(compose)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ“ä½œè½¬æ¢-transform"><span class="nav-number">1.6.</span> <span class="nav-text">æ“ä½œè½¬æ¢(transform)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#operation-çš„é€†å‘æ“ä½œ"><span class="nav-number">1.7.</span> <span class="nav-text">operation çš„é€†å‘æ“ä½œ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-S-æ¨¡å¼"><span class="nav-number">2.</span> <span class="nav-text">C/S æ¨¡å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#compound-OT"><span class="nav-number">2.1.</span> <span class="nav-text">compound OT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#revision-ç‰ˆæœ¬å·"><span class="nav-number">2.2.</span> <span class="nav-text">revision(ç‰ˆæœ¬å·)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-S-ç›´æ¥çš„äº¤äº’"><span class="nav-number">2.3.</span> <span class="nav-text">C/S ç›´æ¥çš„äº¤äº’</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UNDO-REDO"><span class="nav-number">2.4.</span> <span class="nav-text">UNDO/REDO</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OT-å¯Œæ–‡æœ¬æ”¯æŒ"><span class="nav-number">3.</span> <span class="nav-text">OT å¯Œæ–‡æœ¬æ”¯æŒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‚è€ƒé“¾æ¥"><span class="nav-number">4.</span> <span class="nav-text">å‚è€ƒé“¾æ¥</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å°é‚“</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'objcer';
      var disqus_identifier = '2018/03/05/SharePen-Operational-Transformation/';
      var disqus_title = "SharedPen ä¹‹ Operational Transformation";
      var disqus_url = 'http://objcer.com/2018/03/05/SharePen-Operational-Transformation/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      
    </script>
  




  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("UaIz9QT8AVdqAXxUgypgPsTN-gzGzoHsz", "ONQFdHGRNex5wb5Aa64623Dw");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
