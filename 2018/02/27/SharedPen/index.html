<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="å¯Œæ–‡æœ¬,å®æ—¶ååŒç¼–è¾‘å™¨," />





  <link rel="alternate" href="/atom.xml" title="Deng's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.0.2" />






<meta name="description" content="2017 å¹´æœ«ï¼Œå…¬å¸ç»„ç»‡äº† WPS é»‘å®¢é©¬æ‹‰æ¾æ¯”èµ›å·²æ­£å¼å¼€èµ›ï¼Œæ¯”èµ›çš„ä¸»é¢˜æ˜¯ï¼šåˆ©ç”¨ WPS å®¢æˆ·ç«¯ã€äº‘ï¼ŒåŠå…¶å®ƒç¬¬ä¸‰æ–¹å¼€æ”¾æœåŠ¡ï¼Œé’ˆå¯¹æ–‡æ¡£çš„æŸ¥çœ‹ ã€åˆ›ä½œ ï¼Œä»¥åŠå·¥ä½œã€å­¦ä¹ ä¸­çš„å›¢é˜Ÿåˆ†äº«ã€åˆä½œç­‰ï¼Œæ¥æ„æƒ³å¹¶å®ç° WPS äº§å“åˆ›æ–°ç‚¹ã€‚å†²ç€ä¸»é¢˜å®½æ³›ï¼Œå¼€å‘æ—¶é—´é•¿ï¼Œä¸”ä¸€ç­‰å¥– 1 ä¸‡çš„å¥–é‡‘ ğŸ¤‘ï¼Œæ¯«ä¸çŠ¹è±«çš„æŠ¥åäº†ã€‚ç»è¿‡ä¸€ä¸ªå¤šæœˆçš„å¼€å‘ï¼ŒSharedPen å¯Œæ–‡æœ¬å®æ—¶ååŒç¼–è¾‘å™¨åŸºæœ¬åŠŸèƒ½å¼€å‘å®Œæˆï¼Œæœ€ç»ˆåœ¨è¯„å®¡ä¸­ä¹Ÿå¦‚æ„¿è·å¾—ä¸€ç­‰">
<meta name="keywords" content="å¯Œæ–‡æœ¬,å®æ—¶ååŒç¼–è¾‘å™¨">
<meta property="og:type" content="article">
<meta property="og:title" content="SharedPen å¯Œæ–‡æœ¬å®æ—¶ååŒç¼–è¾‘å™¨">
<meta property="og:url" content="http://objcer.com/2018/02/27/SharedPen/index.html">
<meta property="og:site_name" content="Deng&#39;s Blog">
<meta property="og:description" content="2017 å¹´æœ«ï¼Œå…¬å¸ç»„ç»‡äº† WPS é»‘å®¢é©¬æ‹‰æ¾æ¯”èµ›å·²æ­£å¼å¼€èµ›ï¼Œæ¯”èµ›çš„ä¸»é¢˜æ˜¯ï¼šåˆ©ç”¨ WPS å®¢æˆ·ç«¯ã€äº‘ï¼ŒåŠå…¶å®ƒç¬¬ä¸‰æ–¹å¼€æ”¾æœåŠ¡ï¼Œé’ˆå¯¹æ–‡æ¡£çš„æŸ¥çœ‹ ã€åˆ›ä½œ ï¼Œä»¥åŠå·¥ä½œã€å­¦ä¹ ä¸­çš„å›¢é˜Ÿåˆ†äº«ã€åˆä½œç­‰ï¼Œæ¥æ„æƒ³å¹¶å®ç° WPS äº§å“åˆ›æ–°ç‚¹ã€‚å†²ç€ä¸»é¢˜å®½æ³›ï¼Œå¼€å‘æ—¶é—´é•¿ï¼Œä¸”ä¸€ç­‰å¥– 1 ä¸‡çš„å¥–é‡‘ ğŸ¤‘ï¼Œæ¯«ä¸çŠ¹è±«çš„æŠ¥åäº†ã€‚ç»è¿‡ä¸€ä¸ªå¤šæœˆçš„å¼€å‘ï¼ŒSharedPen å¯Œæ–‡æœ¬å®æ—¶ååŒç¼–è¾‘å™¨åŸºæœ¬åŠŸèƒ½å¼€å‘å®Œæˆï¼Œæœ€ç»ˆåœ¨è¯„å®¡ä¸­ä¹Ÿå¦‚æ„¿è·å¾—ä¸€ç­‰">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/SharedPen-Main.png">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/real-time-portals-fa6fa303e261b1679024081d6229c9f9.png">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/sharedpen.png">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/codemirror-change-insert.png">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/codemirror-change-delete.png">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/sharedpen-peer-to-peer.png?t=1">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/sharedpen-client-server.png">
<meta property="og:updated_time" content="2018-02-27T14:48:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SharedPen å¯Œæ–‡æœ¬å®æ—¶ååŒç¼–è¾‘å™¨">
<meta name="twitter:description" content="2017 å¹´æœ«ï¼Œå…¬å¸ç»„ç»‡äº† WPS é»‘å®¢é©¬æ‹‰æ¾æ¯”èµ›å·²æ­£å¼å¼€èµ›ï¼Œæ¯”èµ›çš„ä¸»é¢˜æ˜¯ï¼šåˆ©ç”¨ WPS å®¢æˆ·ç«¯ã€äº‘ï¼ŒåŠå…¶å®ƒç¬¬ä¸‰æ–¹å¼€æ”¾æœåŠ¡ï¼Œé’ˆå¯¹æ–‡æ¡£çš„æŸ¥çœ‹ ã€åˆ›ä½œ ï¼Œä»¥åŠå·¥ä½œã€å­¦ä¹ ä¸­çš„å›¢é˜Ÿåˆ†äº«ã€åˆä½œç­‰ï¼Œæ¥æ„æƒ³å¹¶å®ç° WPS äº§å“åˆ›æ–°ç‚¹ã€‚å†²ç€ä¸»é¢˜å®½æ³›ï¼Œå¼€å‘æ—¶é—´é•¿ï¼Œä¸”ä¸€ç­‰å¥– 1 ä¸‡çš„å¥–é‡‘ ğŸ¤‘ï¼Œæ¯«ä¸çŠ¹è±«çš„æŠ¥åäº†ã€‚ç»è¿‡ä¸€ä¸ªå¤šæœˆçš„å¼€å‘ï¼ŒSharedPen å¯Œæ–‡æœ¬å®æ—¶ååŒç¼–è¾‘å™¨åŸºæœ¬åŠŸèƒ½å¼€å‘å®Œæˆï¼Œæœ€ç»ˆåœ¨è¯„å®¡ä¸­ä¹Ÿå¦‚æ„¿è·å¾—ä¸€ç­‰">
<meta name="twitter:image" content="http://7vikhl.com1.z0.glb.clouddn.com/SharedPen-Main.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    }
  };
</script>




  <link rel="canonical" href="http://objcer.com/2018/02/27/SharedPen/"/>


  <title> SharedPen å¯Œæ–‡æœ¬å®æ—¶ååŒç¼–è¾‘å™¨ | Deng's Blog </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Deng's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Work Smart, Enjoy Life!</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                SharedPen å¯Œæ–‡æœ¬å®æ—¶ååŒç¼–è¾‘å™¨
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2018-02-27T22:39:33+08:00" content="2018-02-27">
              2018-02-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SharedPen/" itemprop="url" rel="index">
                    <span itemprop="name">SharedPen</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/02/27/SharedPen/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/02/27/SharedPen/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/02/27/SharedPen/" class="leancloud_visitors" data-flag-title="SharedPen å¯Œæ–‡æœ¬å®æ—¶ååŒç¼–è¾‘å™¨">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://7vikhl.com1.z0.glb.clouddn.com/SharedPen-Main.png" alt=""></p>
<p>2017 å¹´æœ«ï¼Œå…¬å¸ç»„ç»‡äº† WPS é»‘å®¢é©¬æ‹‰æ¾æ¯”èµ›å·²æ­£å¼å¼€èµ›ï¼Œæ¯”èµ›çš„ä¸»é¢˜æ˜¯ï¼šåˆ©ç”¨ WPS å®¢æˆ·ç«¯ã€äº‘ï¼ŒåŠå…¶å®ƒç¬¬ä¸‰æ–¹å¼€æ”¾æœåŠ¡ï¼Œé’ˆå¯¹æ–‡æ¡£çš„æŸ¥çœ‹ ã€åˆ›ä½œ ï¼Œä»¥åŠå·¥ä½œã€å­¦ä¹ ä¸­çš„å›¢é˜Ÿåˆ†äº«ã€åˆä½œç­‰ï¼Œæ¥æ„æƒ³å¹¶å®ç° WPS äº§å“åˆ›æ–°ç‚¹ã€‚å†²ç€ä¸»é¢˜å®½æ³›ï¼Œå¼€å‘æ—¶é—´é•¿ï¼Œä¸”ä¸€ç­‰å¥– 1 ä¸‡çš„å¥–é‡‘ ğŸ¤‘ï¼Œæ¯«ä¸çŠ¹è±«çš„æŠ¥åäº†ã€‚ç»è¿‡ä¸€ä¸ªå¤šæœˆçš„å¼€å‘ï¼ŒSharedPen å¯Œæ–‡æœ¬å®æ—¶ååŒç¼–è¾‘å™¨åŸºæœ¬åŠŸèƒ½å¼€å‘å®Œæˆï¼Œæœ€ç»ˆåœ¨è¯„å®¡ä¸­ä¹Ÿå¦‚æ„¿è·å¾—ä¸€ç­‰å¥– ğŸ‘<br>SharedPen ç›®å‰ä»å¤„äºå¼€å‘é˜¶æ®µï¼Œæ¬¢è¿æ„Ÿå…´è¶£çš„æœ‹å‹ä¸æˆ‘è”ç³»ä¸€èµ·äº¤æµï¼Œé¡¹ç›®åœ°å€ï¼š<a href="https://github.com/YingshanDeng/SharedPen" target="_blank" rel="external">GitHub: YingshanDeng/SharedPen</a>ã€‚æœ¬æ–‡å°†å¯¹ SharedPen æ•´ä½“æ¶æ„è¿›è¡Œä»‹ç»ï¼Œåç»­ä¼šæœ‰ç³»åˆ—æ–‡ç« ä»‹ç»å…¶ä¸­å…·ä½“çš„æŠ€æœ¯å®ç°ç»†èŠ‚(æ•¬è¯·æœŸå¾… ğŸ)ã€‚</p>
<a id="more"></a>
<h2 id="å…³äºååŒç¼–è¾‘å™¨"><a href="#å…³äºååŒç¼–è¾‘å™¨" class="headerlink" title="å…³äºååŒç¼–è¾‘å™¨"></a>å…³äºååŒç¼–è¾‘å™¨</h2><p>ååŒç¼–è¾‘ä¹Ÿå°±æ˜¯å¤šä¸ªäººå¯¹ä¸€ä»½æ–‡æ¡£è¿›è¡Œç¼–è¾‘ï¼Œæ¯ä¸ªåä½œè¿™éƒ½æœ‰è‡ªå·±çš„è¾“å…¥å…‰æ ‡ï¼Œå¹¶å¯ä»¥å¯ä»¥è‡ªç”±åœ°å’Œå…¶ä»–åä½œè€…ä¸€èµ·è¾“å…¥ã€‚å¯¹äº web-based çš„ååŒç¼–è¾‘å™¨ï¼Œç›®å‰æœ‰å¾ˆå¤šæˆç†Ÿçš„äº§å“ã€‚åƒæˆ‘å¾ˆå–œæ¬¢ç”¨çš„: <a href="https://www.google.com/docs/about/" target="_blank" rel="external">Google Docs</a>ï¼Œå›½å†…çš„: <a href="https://shimo.im/" target="_blank" rel="external">çŸ³å¢¨æ–‡æ¡£</a>ã€‚</p>
<p>å¦ä¸€ä¸ªå€¼å¾—ä»‹ç»çš„æ˜¯ <a href="https://teletype.atom.io/" target="_blank" rel="external">Teletype</a>ï¼Œè¿™æ˜¯åœ¨æ—§é‡‘å±±ä¸¾åŠçš„ 2017 QCon å¤§ä¼šä¸Šï¼ŒGitHub å‘å¸ƒçš„ Atom å®æ—¶åä½œæ’ä»¶ï¼ŒTeletype å¯ä»¥è®©ä¸¤åå¼€å‘è€…è½»æ¾çš„åä½œç¼–å†™ä»£ç ï¼Œç”±äº Atom æ˜¯åŸºäº <a href="https://electronjs.org/" target="_blank" rel="external">Electron</a> æ„å»ºçš„åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶çœ‹ä½œæ˜¯ web-based ååŒç¼–è¾‘å™¨ã€‚</p>
<p><strong>ååŒç¼–è¾‘çš„å…³é”®æ˜¯è¦è§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜</strong>ï¼Œä¸åŒçš„åä½œè€…ä¿®æ”¹ä»–ä»¬è‡ªå·±çš„æ–‡æ¡£å‰¯æœ¬ï¼Œæœ¬åœ°çš„ç¼–è¾‘ä¼šç«‹åˆ»åº”ç”¨åˆ°æœ¬åœ°å‰¯æœ¬ï¼Œä¹‹åä¼šä¼ è¾“ç»™å…¶ä»–åä½œè€…ï¼Œè¿™ä¼šå¯¼è‡´ä¸åŒçš„å‰¯æœ¬å¯èƒ½ä¼šä»¥ä¸åŒçš„é¡ºåºåº”ç”¨å„ç§ä¿®æ”¹ï¼Œåº”è¯¥æœ‰ç®—æ³•æ¥ç¡®ä¿åœ¨ååŒç¼–è¾‘ä¹‹åï¼Œæ‰€æœ‰å‰¯æœ¬æœ€ç»ˆçš„å†…å®¹æ˜¯ä¸€è‡´çš„ã€‚</p>
<h2 id="æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ"><a href="#æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ"></a>æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ</h2><p>é¦–å…ˆä»‹ç»ä¸€ä¸‹åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå³è¿è¡Œåœ¨å¤šç‰©ç†è®¡ç®—æœºä¸Šçš„ç³»ç»Ÿã€‚è¿™ä¸ªæ˜¯äººç±»ç›®å‰å®é™…å¯è¡Œçš„æ„å»ºè¶…å¤§è§„æ¨¡ç³»ç»Ÿçš„å”¯äºŒåŠæ³•ä¹‹ä¸€ï¼ˆå¦ä¸€ç§å°±æ˜¯æ„å»ºè¶…çº§è®¡ç®—æœºï¼‰ã€‚æ„å»ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„éš¾ç‚¹åœ¨äºï¼šè®©åˆ†å¸ƒå¼ç³»ç»Ÿè¿ä½œèµ·æ¥æ­£ç¡®æ€§ä¸å•æœºç¨‹åºå®Œå…¨æ— äºŒã€‚è€ŒååŒç¼–è¾‘å™¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¤šç«¯çš„åä½œè€…ä¿®æ”¹æ–‡æ¡£ï¼Œè€Œæœ€ç»ˆæ–‡æ¡£å†…å®¹è¦æ”¶æ•›åˆ°ç›¸åŒçš„çŠ¶æ€<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/real-time-portals-fa6fa303e261b1679024081d6229c9f9.png" alt=""></p>
<p>ç›®å‰æ¥è¯´ï¼Œè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸»æµçš„æœ‰ä¸¤å¤§æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>Conflict-free replicated data type</strong> (CRDT)</li>
<li><strong>Operational transformation</strong> (OT)</li>
</ul>
<h3 id="Conflict-free-replicated-data-type"><a href="#Conflict-free-replicated-data-type" class="headerlink" title="Conflict-free replicated data type"></a>Conflict-free replicated data type</h3><p>Conflict-free replicated data typeï¼Œç®€ç§°ä¸º CRDTï¼Œç›´è¯‘çš„è¯å³æ˜¯ï¼šæ— å†²çªå¯å¤åˆ¶æ•°æ®ç±»å‹ã€‚</p>
<blockquote>
<p>Wikipedia ä»‹ç»: <a href="https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type" target="_blank" rel="external">Conflict-free replicated data type</a><br>In distributed computing, a conflict-free replicated data type (CRDT) is a <strong>data structure</strong> which can be replicated across multiple computers in a network, where the replicas can be updated independently and concurrently without coordination between the replicas, and where it is always mathematically possible to resolve inconsistencies which might result.</p>
</blockquote>
<p>ç®€å•çš„ç†è§£ï¼šCRDT å°±æ˜¯è¿™æ ·ä¸€äº›é€‚åº”äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ä»¥ä¿æŒæœ€ç»ˆä¸€è‡´æ€§çš„<strong>æ•°æ®ç»“æ„</strong>çš„ç»Ÿç§°ã€‚GitHub å¼€æºçš„ Teletype ååŒç¼–è¾‘æ’ä»¶ï¼Œä½¿ç”¨çš„å°±æ˜¯ CRDT ç®—æ³•ã€‚GitHub ä¸ºæ­¤å¼€å‘çš„ CRDT æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº“ï¼Œæœ‰å…´è¶£å¯å‰å¾€ GitHub å…·ä½“äº†è§£ã€‚</p>
<blockquote>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/atom/teletype-crdt" target="_blank" rel="external">atom/teletype-crdt</a> String-wise sequence CRDT powering peer-to-peer collaborative editing in Teletype for Atom.</p>
</blockquote>
<h3 id="Operational-transformation"><a href="#Operational-transformation" class="headerlink" title="Operational transformation"></a>Operational transformation</h3><p>Operational transformationï¼Œç®€ç§° OTï¼Œç›´è¯‘çš„è¯å³æ˜¯ï¼šæ“ä½œè½¬æ¢<br>OT å®ƒèµ·æºäº 1989 å¹´å‘è¡¨çš„ä¸€ç¯‡<a href="https://dl.acm.org/citation.cfm?doid=67544.66963" target="_blank" rel="external">ç ”ç©¶è®ºæ–‡</a>ï¼Œè¿›è¿‡å¤šå¹´çš„å‘å±•ï¼Œç°åœ¨å·²ç»æ˜¯éå¸¸æˆç†Ÿçš„ä¸€è‡´æ€§è§£å†³ç®—æ³•ï¼Œå¾ˆå¤šååŒç¼–è¾‘å™¨éƒ½é‡‡ç”¨æ­¤ç®—æ³•ä½œä¸ºååŒè§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„ Google Docsã€‚</p>
<blockquote>
<p>Wikipedia ä»‹ç»: <a href="https://en.wikipedia.org/wiki/Operational_transformation" target="_blank" rel="external">Operational transformation</a><br>Operational transformation (OT) is a technology for supporting a range of collaboration functionalities in advanced collaborative software systems. OT was originally invented for consistency maintenance and concurrency control in collaborative editing of plain text documents. Two decades of research has extended its capabilities and expanded its applications to include group undo, locking, conflict resolution, operation notification and compression, group-awareness, HTML/XML and tree-structured document editing, collaborative office productivity tools, application-sharing, and collaborative computer-aided media design tools (see OTFAQ). In 2009 OT was adopted as a core technique behind the collaboration features in Apache Wave and Google Docs.</p>
</blockquote>
<p><strong>SharedPen ä¹Ÿæ˜¯é‡‡ç”¨ OT ä½œä¸ºååŒç¼–è¾‘è§£å†³æ–¹æ¡ˆ</strong>ï¼Œä½¿ç”¨äº† <a href="https://github.com/Operational-Transformation/ot.js" target="_blank" rel="external">ot.js</a> åº“ï¼ŒOT ç®—æ³•å°†æœ‰å¦ä¸€ç¯‡æ–‡ç« å•ç‹¬ä»‹ç»ï¼Œæ•¬è¯·æœŸå¾… ğŸ˜‹</p>
<h2 id="å¯Œæ–‡æœ¬ç¼–è¾‘å™¨"><a href="#å¯Œæ–‡æœ¬ç¼–è¾‘å™¨" class="headerlink" title="å¯Œæ–‡æœ¬ç¼–è¾‘å™¨"></a>å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</h2><p>SharedPen æ˜¯åŸºäº web ç«¯çš„æ‰€è§å³æ‰€å¾— (WYSIWYG) ç¼–è¾‘å™¨ã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/sharedpen.png" alt=""></p>
<p>åœ¨ ot.js åº“ä¸­ï¼Œä½¿ç”¨ <a href="https://codemirror.net/" target="_blank" rel="external">CodeMirror</a> ä½œä¸ºæ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒCodeMirror æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„ç¼–è¾‘å™¨ï¼Œå¤šç”¨äºä»£ç ç¼–è¾‘å™¨ï¼Œè­¬å¦‚åœ¨ Chrome æµè§ˆå™¨çš„è°ƒè¯•å™¨ä¸­ï¼Œå°±ä½¿ç”¨ CodeMirror ä½œä¸ºä»£ç ç¼–è¾‘å™¨ã€‚ot.js åº“åŸºäº CodeMirror å®ç°äº†ä¸€ä¸ªç®€å•çš„çº¯æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œdemo å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/YingshanDeng/ot.js-demo" target="_blank" rel="external">GitHub: ot.js-demo</a></p>
<p>CodeMirror ç¼–è¾‘å™¨å…·æœ‰ä¸°å¯Œå‹å¥½çš„ API æ¥å£ï¼š</p>
<ul>
<li><strong>åæ ‡ç³»ç»Ÿ</strong><br>CodeMirror ä¸­ä»¥è¡Œä¸ºå•ä½ï¼Œé€šè¿‡ <code>{line, ch}</code> ç¬¬å‡ è¡Œçš„ç¬¬å‡ ä¸ªå­—ç¬¦å¯ä»¥å‡†ç¡®ä¸ºæ¯ä¸€ä¸ªå­—ç¬¦å®šä½ <code>pos</code>ï¼ŒåŒæ—¶æ¯ä¸€ä¸ªå­—ç¬¦éƒ½æœ‰ä¸€ä¸ªå…¨å±€ç´¢å¼• <code>index</code>ï¼Œé€šè¿‡ <code>doc.posFromIndex</code> å’Œ <code>doc.indexFromPos</code> ä¸¤ä¸ªè¾…åŠ©æ–¹æ³•å¯ä»¥å¯¹äºŒè€…è¿›è¡Œè½¬æ¢</li>
<li><strong>ä¸°å¯Œçš„äº‹ä»¶å›è°ƒ: <code>change</code>, <code>beforeChange</code>, <code>cursorActivity</code>â€¦</strong><br>å…¶ä¸­ç¼–è¾‘äº‹ä»¶ <code>change</code> çš„å›è°ƒå‚æ•°ä¿¡æ¯éå¸¸ä¸°å¯Œï¼Œä¾¿äºæˆ‘ä»¬å°†å…¶è½¬æ¢æˆ OT ç®—æ³•ä¸­çš„ operation<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/codemirror-change-insert.png" alt=""><br><img src="http://7vikhl.com1.z0.glb.clouddn.com/codemirror-change-delete.png" alt=""></li>
<li><strong><code>markText</code> å¯Œæ–‡æœ¬æ”¯æŒ API</strong><br>æ³¨æ„åˆ° CodeMirror å…¶å®å¹¶ä¸æ”¯æŒå¯Œæ–‡æœ¬ç¼–è¾‘ï¼Œä½†æ˜¯å¾—ç›Šäº API <code>markText</code> å¯ä»¥åŠ¨æ€ä¸ºæŒ‡å®šèŒƒå›´çš„æ–‡æœ¬è®¾ç½®ä¸€ä¸ª CSS classï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªèº«å®ç°ä¸ºå…¶å¢åŠ å¯Œæ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ï¼Œè¿™éƒ¨åˆ†å†…å®¹åœ¨æ–‡ç« ï¼šğŸ‘‰ <a href="https://objcer.com/2018/02/27/SharedPen-AnnotationList/">SharedPen ä¹‹ AnnotationList</a> ä¸­å°†è¿›è¡Œè¯¦ç»†ä»‹ç»</li>
</ul>
<h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><table>
<thead>
<tr>
<th></th>
<th>æ¶æ„</th>
<th>Server ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Google Docsï¼ŒçŸ³å¢¨æ–‡æ¡£</td>
<td>C/S æ¨¡å¼</td>
<td>è´Ÿè´£è½¬å‘å¤šç«¯æ“ä½œå’Œæ•°æ®æŒä¹…åŒ–å­˜å‚¨</td>
</tr>
<tr>
<td>Teletype(AtomååŒç¼–è¾‘æ’ä»¶)</td>
<td>Peer-to-Peer æ¨¡å¼</td>
<td>è¾…åŠ©å»ºç«‹è¿æ¥(æ¡æ‰‹)</td>
</tr>
</tbody>
</table>
<h3 id="Peer-to-Peer-æ¨¡å¼"><a href="#Peer-to-Peer-æ¨¡å¼" class="headerlink" title="Peer-to-Peer æ¨¡å¼"></a>Peer-to-Peer æ¨¡å¼</h3><p>Atom ååŒç¼–è¾‘æ’ä»¶ Teletypeï¼Œé‡‡ç”¨ Peer-to-Peer æ¨¡å¼ï¼Œé€šè¿‡ WebRTC åŠ å¯†å¤šç«¯ä¹‹é—´çš„é€šä¿¡ã€‚é™¤äº†æœ€åˆçš„æ¡æ‰‹ä¾èµ–äº GitHub çš„æœåŠ¡å™¨ä¹‹å¤–ï¼Œæ‰€æœ‰çš„ä¼ è¾“éƒ½æ˜¯ç‚¹å¯¹ç‚¹çš„ï¼ˆä¸éœ€è¦è®¿é—® GitHub æœåŠ¡å™¨ï¼‰ã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/sharedpen-peer-to-peer.png?t=1" alt=""></p>
<h3 id="C-S-æ¨¡å¼"><a href="#C-S-æ¨¡å¼" class="headerlink" title="C/S æ¨¡å¼"></a>C/S æ¨¡å¼</h3><p>åƒ Google Docsï¼ŒçŸ³å¢¨æ–‡æ¡£éƒ½æ˜¯é‡‡ç”¨ C/S æ¨¡å¼ä½œä¸ºå‰åç«¯æ¶æ„ï¼ŒSharedPen ä¹Ÿæ˜¯é‡‡ç”¨è¿™ç§æ¶æ„æ¨¡å¼ï¼Œå‰åç«¯å»ºç«‹ socket è¿æ¥ï¼Œç›¸äº’å®æ—¶å‘é€ operation æ“ä½œï¼ŒæœåŠ¡ç«¯ä¸­è¿˜å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/sharedpen-client-server.png" alt=""></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="http://liyu1981.github.io/what-is-CRDT/" target="_blank" rel="external">è°ˆè°ˆCRDT</a><br><a href="http://www.jdon.com/artichect/crdt.html" target="_blank" rel="external">åˆ†å¸ƒå¼CRDTæ¨¡å‹</a><br><a href="https://drive.googleblog.com/2010/05/whats-different-about-new-google-docs.html" target="_blank" rel="external">Whatâ€™s different about the new Google Docs?</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/å¯Œæ–‡æœ¬/" rel="tag">#å¯Œæ–‡æœ¬</a>
          
            <a href="/tags/å®æ—¶ååŒç¼–è¾‘å™¨/" rel="tag">#å®æ—¶ååŒç¼–è¾‘å™¨</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/02/27/SharedPen-AnnotationList/" rel="next" title="SharedPen ä¹‹ AnnotationList">
                <i class="fa fa-chevron-left"></i> SharedPen ä¹‹ AnnotationList
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7vikhl.com1.z0.glb.clouddn.com/avatar.jpg"
               alt="å°é‚“" />
          <p class="site-author-name" itemprop="name">å°é‚“</p>
          <p class="site-description motion-element" itemprop="description">Hello World</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">55</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">76</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yingshandeng" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/objcer" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2249439934" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å…³äºååŒç¼–è¾‘å™¨"><span class="nav-number">1.</span> <span class="nav-text">å…³äºååŒç¼–è¾‘å™¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ"><span class="nav-number">2.</span> <span class="nav-text">æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Conflict-free-replicated-data-type"><span class="nav-number">2.1.</span> <span class="nav-text">Conflict-free replicated data type</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Operational-transformation"><span class="nav-number">2.2.</span> <span class="nav-text">Operational transformation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¯Œæ–‡æœ¬ç¼–è¾‘å™¨"><span class="nav-number">3.</span> <span class="nav-text">å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ¶æ„"><span class="nav-number">4.</span> <span class="nav-text">æ¶æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Peer-to-Peer-æ¨¡å¼"><span class="nav-number">4.1.</span> <span class="nav-text">Peer-to-Peer æ¨¡å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-S-æ¨¡å¼"><span class="nav-number">4.2.</span> <span class="nav-text">C/S æ¨¡å¼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‚è€ƒé“¾æ¥"><span class="nav-number">5.</span> <span class="nav-text">å‚è€ƒé“¾æ¥</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å°é‚“</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'objcer';
      var disqus_identifier = '2018/02/27/SharedPen/';
      var disqus_title = "SharedPen å¯Œæ–‡æœ¬å®æ—¶ååŒç¼–è¾‘å™¨";
      var disqus_url = 'http://objcer.com/2018/02/27/SharedPen/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      
    </script>
  




  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("UaIz9QT8AVdqAXxUgypgPsTN-gzGzoHsz", "ONQFdHGRNex5wb5Aa64623Dw");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
