<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Cordova Hot Code Push," />





  <link rel="alternate" href="/atom.xml" title="Deng's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.0.2" />






<meta name="description" content="åŸºäº Cordova æ¡†æ¶èƒ½å°†ç½‘é¡µåº”ç”¨ (js, html, css, å›¾ç‰‡ç­‰) æ‰“åŒ…æˆ Appã€‚å½“ App åœ¨åº”ç”¨å•†åº—ä¸Šæ¶åï¼Œå¦‚ä½•å¿«é€Ÿæ›´æ–°æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚ğŸ¤–  æœ¬åœ°æ‰“åŒ…æ–°ç‰ˆæœ¬ App å‘å¸ƒåˆ°åº”ç”¨å•†åº—ï¼Œä½†è¿™ä¸­å‘å¸ƒæµç¨‹è€—è´¹æ—¶é—´ï¼Œå°¤å…¶æ˜¯ Apple Store åº”ç”¨åŠ è½½ç½‘ç»œèµ„æºï¼Œè¿™æ · App å±•ç¤ºçš„å†…å®¹å°±å¯ä»¥ä¿è¯æ˜¯æœ€æ–°çš„ï¼Œä½†å½“åº”ç”¨æ–­ç½‘æ—¶ï¼Œåº”ç”¨å°±æ— æ³•æ­£å¸¸ä½¿ç”¨  æˆ‘ä»¬èƒ½æƒ³çš„è¿™ä¸¤ç§æ–¹å¼éƒ½å­˜åœ¨çš„å¾ˆå¤§">
<meta name="keywords" content="Cordova Hot Code Push">
<meta property="og:type" content="article">
<meta property="og:title" content="Cordova ä»£ç çƒ­æ›´æ–°">
<meta property="og:url" content="http://objcer.com/2017/06/18/cordova-hot-code-push/index.html">
<meta property="og:site_name" content="Deng&#39;s Blog">
<meta property="og:description" content="åŸºäº Cordova æ¡†æ¶èƒ½å°†ç½‘é¡µåº”ç”¨ (js, html, css, å›¾ç‰‡ç­‰) æ‰“åŒ…æˆ Appã€‚å½“ App åœ¨åº”ç”¨å•†åº—ä¸Šæ¶åï¼Œå¦‚ä½•å¿«é€Ÿæ›´æ–°æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚ğŸ¤–  æœ¬åœ°æ‰“åŒ…æ–°ç‰ˆæœ¬ App å‘å¸ƒåˆ°åº”ç”¨å•†åº—ï¼Œä½†è¿™ä¸­å‘å¸ƒæµç¨‹è€—è´¹æ—¶é—´ï¼Œå°¤å…¶æ˜¯ Apple Store åº”ç”¨åŠ è½½ç½‘ç»œèµ„æºï¼Œè¿™æ · App å±•ç¤ºçš„å†…å®¹å°±å¯ä»¥ä¿è¯æ˜¯æœ€æ–°çš„ï¼Œä½†å½“åº”ç”¨æ–­ç½‘æ—¶ï¼Œåº”ç”¨å°±æ— æ³•æ­£å¸¸ä½¿ç”¨  æˆ‘ä»¬èƒ½æƒ³çš„è¿™ä¸¤ç§æ–¹å¼éƒ½å­˜åœ¨çš„å¾ˆå¤§">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/app-store.png">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/update-workflow.png">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/chcp-external-folder.png">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/3CA8CB1D-C26D-4F98-951C-DBE94650CA5D.png">
<meta property="og:image" content="http://7vikhl.com1.z0.glb.clouddn.com/926064F1-2CF2-4871-90B6-791BA0059C13.png">
<meta property="og:updated_time" content="2017-06-17T16:32:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cordova ä»£ç çƒ­æ›´æ–°">
<meta name="twitter:description" content="åŸºäº Cordova æ¡†æ¶èƒ½å°†ç½‘é¡µåº”ç”¨ (js, html, css, å›¾ç‰‡ç­‰) æ‰“åŒ…æˆ Appã€‚å½“ App åœ¨åº”ç”¨å•†åº—ä¸Šæ¶åï¼Œå¦‚ä½•å¿«é€Ÿæ›´æ–°æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚ğŸ¤–  æœ¬åœ°æ‰“åŒ…æ–°ç‰ˆæœ¬ App å‘å¸ƒåˆ°åº”ç”¨å•†åº—ï¼Œä½†è¿™ä¸­å‘å¸ƒæµç¨‹è€—è´¹æ—¶é—´ï¼Œå°¤å…¶æ˜¯ Apple Store åº”ç”¨åŠ è½½ç½‘ç»œèµ„æºï¼Œè¿™æ · App å±•ç¤ºçš„å†…å®¹å°±å¯ä»¥ä¿è¯æ˜¯æœ€æ–°çš„ï¼Œä½†å½“åº”ç”¨æ–­ç½‘æ—¶ï¼Œåº”ç”¨å°±æ— æ³•æ­£å¸¸ä½¿ç”¨  æˆ‘ä»¬èƒ½æƒ³çš„è¿™ä¸¤ç§æ–¹å¼éƒ½å­˜åœ¨çš„å¾ˆå¤§">
<meta name="twitter:image" content="http://7vikhl.com1.z0.glb.clouddn.com/app-store.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    }
  };
</script>




  <link rel="canonical" href="http://objcer.com/2017/06/18/cordova-hot-code-push/"/>


  <title> Cordova ä»£ç çƒ­æ›´æ–° | Deng's Blog </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Deng's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Work Smart, Enjoy Life!</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Cordova ä»£ç çƒ­æ›´æ–°
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2017-06-18T00:30:29+08:00" content="2017-06-18">
              2017-06-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Cordova/" itemprop="url" rel="index">
                    <span itemprop="name">Cordova</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/18/cordova-hot-code-push/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/06/18/cordova-hot-code-push/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/06/18/cordova-hot-code-push/" class="leancloud_visitors" data-flag-title="Cordova ä»£ç çƒ­æ›´æ–°">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://7vikhl.com1.z0.glb.clouddn.com/app-store.png" alt=""></p>
<p>åŸºäº Cordova æ¡†æ¶èƒ½å°†ç½‘é¡µåº”ç”¨ (js, html, css, å›¾ç‰‡ç­‰) æ‰“åŒ…æˆ Appã€‚å½“ App åœ¨åº”ç”¨å•†åº—ä¸Šæ¶åï¼Œå¦‚ä½•å¿«é€Ÿæ›´æ–°æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚ğŸ¤–</p>
<ul>
<li>æœ¬åœ°æ‰“åŒ…æ–°ç‰ˆæœ¬ App å‘å¸ƒåˆ°åº”ç”¨å•†åº—ï¼Œä½†è¿™ä¸­å‘å¸ƒæµç¨‹è€—è´¹æ—¶é—´ï¼Œå°¤å…¶æ˜¯ Apple Store</li>
<li>åº”ç”¨åŠ è½½ç½‘ç»œèµ„æºï¼Œè¿™æ · App å±•ç¤ºçš„å†…å®¹å°±å¯ä»¥ä¿è¯æ˜¯æœ€æ–°çš„ï¼Œä½†å½“åº”ç”¨æ–­ç½‘æ—¶ï¼Œåº”ç”¨å°±æ— æ³•æ­£å¸¸ä½¿ç”¨</li>
</ul>
<p>æˆ‘ä»¬èƒ½æƒ³çš„è¿™ä¸¤ç§æ–¹å¼éƒ½å­˜åœ¨çš„å¾ˆå¤§çš„å¼Šç«¯ï¼Œä¸é€‚åˆå®é™…åº”ç”¨ï¼</p>
<a id="more"></a>
<h2 id="æ’ä»¶-Cordova-Hot-Code-Push-CHCP"><a href="#æ’ä»¶-Cordova-Hot-Code-Push-CHCP" class="headerlink" title="æ’ä»¶ Cordova Hot Code Push (CHCP)"></a>æ’ä»¶ Cordova Hot Code Push (CHCP)</h2><p>æ’ä»¶ <strong><a href="https://github.com/nordnet/cordova-hot-code-push" target="_blank" rel="external">Cordova Hot Code Push</a></strong> æ­£æ˜¯é’ˆå¯¹ Cordava åº”ç”¨å¦‚ä½•å¿«é€Ÿæ›´æ–°é—®é¢˜è€Œæä¾›çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è‡ªåŠ¨æ›´æ–° web ç›¸å…³çš„é™æ€æ–‡ä»¶ã€‚</p>
<blockquote>
<p>è¯¥æ’ä»¶æä¾›äº†è¯¦ç»†çš„ wiki æ–‡æ¡£ï¼Œè¯·å‚è€ƒï¼š<a href="https://github.com/nordnet/cordova-hot-code-push/wiki" target="_blank" rel="external">wiki æ–‡æ¡£</a></p>
</blockquote>
<h2 id="App-Store-æ”¯æŒä¹ˆ"><a href="#App-Store-æ”¯æŒä¹ˆ" class="headerlink" title="App Store æ”¯æŒä¹ˆ"></a>App Store æ”¯æŒä¹ˆ</h2><blockquote>
<p>è¿‘æ—¥ï¼Œè‹¹æœApp Storeå®¡æ ¸å›¢é˜Ÿå‘ä¸€äº›å¼€å‘è€…ä¸‹æœ€åé€šç‰’ï¼š2017å¹´6æœˆ12æ—¥ä¹‹å‰ç§»é™¤æ‰€æœ‰çƒ­æ›´æ–°ç›¸å…³ä»£ç ã€æ¡†æ¶æˆ–SDKï¼Œå¹¶é‡æ–°æäº¤ç‰ˆæœ¬ã€‚å¦‚æœä¸ä½œè°ƒæ•´ï¼ŒAppå¯èƒ½ä¼šä»App Storeä¸‹æ¶ã€‚</p>
</blockquote>
<p>è‹¹æœåº”ç”¨å•†åº—å·²ç»ç¦æ­¢ä½¿ç”¨ç±»ä¼¼ JSPatch ç­‰çƒ­ä¿®å¤çš„æ¡†æ¶æˆ–è€…SDKï¼Œé‚£ä¹ˆè¿™ä¸ªæ’ä»¶æä¾›çš„ä»£ç çƒ­æ›´æ–°åŠŸèƒ½æ˜¯å¦è¿æ³•è¿™ä¸€è§„å®šå‘¢? ğŸ¤”<br>ğŸ“Œ ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼æ­¤æ’ä»¶æä¾›çš„ä»£ç çƒ­æ›´æ–°æ˜¯ web é™æ€æ–‡ä»¶ï¼Œè‹¹æœæ˜¯å…è®¸è¿™ä¸€åšæ³•çš„ã€‚ä½†æœ‰ä¸¤ç‚¹å€¼å¾—æ³¨æ„ï¼š</p>
<ul>
<li>â‘  ä¸èƒ½æ˜æ˜¾å‘ŠçŸ¥ç”¨æˆ·æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦æ›´æ–°åˆ°æœ€æ–°ä»£ç ã€‚è¿™ä¸€åšæ³•ä¼šä½¿ç”¨æˆ·äº§ç”Ÿå›°æƒ‘ï¼Œè¿™ç§æ›´æ–°æ–¹å¼å’Œé€šè¿‡ App Store æ›´æ–°æœ‰ä½•åŒºåˆ«ã€‚æ‰€ä»¥æ­£ç¡®çš„åšæ³•æ˜¯ï¼Œåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¸‹è½½å’Œå®‰è£…çƒ­æ›´æ–°ä»£ç ï¼›æˆ–è€…åœ¨æŸä¸ªæ—¶æœºä¸‹è½½çƒ­æ›´æ–°ä»£ç ï¼Œåœ¨åº”ç”¨ä¸‹æ¬¡æ‰“å¼€æ—¶è¿›è¡Œå®‰è£…</li>
<li>â‘¡ å¦‚æœé€šè¿‡æ­¤æ’ä»¶è¿›è¡Œä»£ç çƒ­æ›´æ–°åï¼Œåº”ç”¨åŠŸèƒ½å‘ç”Ÿå·¨å¤§å˜åŒ–ï¼Œè­¬å¦‚åŸæ¥æ˜¯ä¸€ä¸ªè®¡ç®—å™¨åº”ç”¨ï¼Œä»£ç çƒ­æ›´æ–°åï¼Œå˜æˆäº†ä¸€ä¸ªéŸ³ä¹æ’­æ”¾å™¨ï¼Œè¿™ç§æ¬ºéª—ç”¨æˆ·çš„åšæ³•ä¹Ÿæ˜¯ä¼šè¢«è‹¹æœæ‹’ç»çš„</li>
</ul>
<h2 id="æ·»åŠ æ’ä»¶åˆ°é¡¹ç›®ä¸­"><a href="#æ·»åŠ æ’ä»¶åˆ°é¡¹ç›®ä¸­" class="headerlink" title="æ·»åŠ æ’ä»¶åˆ°é¡¹ç›®ä¸­"></a>æ·»åŠ æ’ä»¶åˆ°é¡¹ç›®ä¸­</h2><p>1ã€ä¸‹è½½æ’ä»¶<br><em>è¦æ±‚ Cordova ç‰ˆæœ¬ 5.0+</em><br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">cordova</span> plugin <span class="keyword">add </span>cordova-hot-<span class="meta">code</span>-<span class="keyword">push-plugin </span>--save</div></pre></td></tr></table></figure></p>
<p>2ã€ä¸‹è½½æ’ä»¶çš„å‘½ä»¤è¡Œå·¥å…· <a href="https://github.com/nordnet/cordova-hot-code-push-cli" target="_blank" rel="external">cordova-hot-code-push-cli</a><br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g cordova-hot-code-<span class="keyword">push</span>-<span class="keyword">cli</span></div></pre></td></tr></table></figure></p>
<p>è¯¥å‘½ä»¤è¡Œå·¥å…·å¯å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶ <code>chcp.json</code> å’Œ <code>chcp.manifest</code>ï¼ŒåŒæ—¶è¿˜æä¾›äº†ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼Œè¯¦ç»†å¯å‚è€ƒå…¶ READMEã€‚</p>
<p>3ã€ä¸‹è½½æ’ä»¶åï¼Œæ‰§è¡Œ <code>cordova platform add ios</code> æ—¶å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Error: </span>Cannot find module 'xml2js/lib/processors'</div></pre></td></tr></table></figure></p>
<p>å‚è€ƒ <a href="https://github.com/nordnet/cordova-hot-code-push/issues/35" target="_blank" rel="external">xml2js is not installed</a> è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼š<code>npm install xml2js</code></p>
<h2 id="çƒ­æ›´æ–°ç›¸å…³é…ç½®"><a href="#çƒ­æ›´æ–°ç›¸å…³é…ç½®" class="headerlink" title="çƒ­æ›´æ–°ç›¸å…³é…ç½®"></a>çƒ­æ›´æ–°ç›¸å…³é…ç½®</h2><p>Cordova Hot Code Push ä¸‹è½½å®‰è£…åˆ°é¡¹ç›®ä¸­åï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œç›¸å…³çš„é…ç½®æ‰èƒ½è®©å…¶å·¥ä½œã€‚</p>
<h3 id="æ’ä»¶é…ç½®"><a href="#æ’ä»¶é…ç½®" class="headerlink" title="æ’ä»¶é…ç½®"></a>æ’ä»¶é…ç½®</h3><p>Cordova Hot Code Push çƒ­æ›´æ–°æ’ä»¶éœ€è¦ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼š</p>
<ul>
<li><strong>Application configï¼š</strong><code>chcp.json</code> åŒ…å«å‘å¸ƒç›¸å…³ä¿¡æ¯ï¼šçƒ­æ›´æ–°ä»£ç ç‰ˆæœ¬å·ï¼Œåº”ç”¨ native side ç‰ˆæœ¬å·ç­‰ç­‰</li>
<li><strong>Content manifestï¼š</strong><code>chcp.manifest</code> åŒ…å«é¡¹ç›®çƒ­æ›´æ–°ä»£ç (é™æ€)æ–‡ä»¶ä¿¡æ¯ï¼šæ–‡ä»¶åå’Œæ–‡ä»¶å“ˆå¸Œå€¼</li>
</ul>
<p>è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶å¯¹äºæ’ä»¶çš„è¿è¡Œç¼ºä¸€ä¸å¯ï¼Œå‰è€…æè¿°äº†çƒ­æ›´æ–°ä»£ç çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œåè€…æä¾›äº†çƒ­æ›´æ–°ä»£ç æ–‡ä»¶çš„å˜æ›´ä¿¡æ¯ã€‚å€ŸåŠ© <code>cordova-hot-code-push-cli</code> è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·å¯ä»¥è¾…åŠ©æˆ‘ä»¬åˆ›å»ºè¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶ã€‚</p>
<h4 id="Application-config"><a href="#Application-config" class="headerlink" title="Application config"></a>Application config</h4><blockquote>
<p><a href="https://github.com/nordnet/cordova-hot-code-push/wiki/Application-config" target="_blank" rel="external">Application config</a> holds information about the current release of the web project.</p>
</blockquote>
<p><code>chcp.json</code> ç½®äº <code>www</code> ç›®å½•æ ¹ç›®å½•ï¼Œä¾‹å­å¦‚ä¸‹ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"wps-*****"</span>,</div><div class="line">  <span class="attr">"content_url"</span>: <span class="string">"https://kss.ksyun.com/*****/*****/"</span>,</div><div class="line">  <span class="attr">"ios_identifier"</span>: <span class="string">"326CN*****"</span>,</div><div class="line">  <span class="attr">"android_identifier"</span>: <span class="string">"com.**********.*****.*****.*****.*****"</span>,</div><div class="line">  <span class="attr">"update"</span>: <span class="string">"resume"</span>,</div><div class="line">  <span class="attr">"release"</span>: <span class="string">"2017.06.07-16.30.20"</span>,</div><div class="line">  <span class="attr">"min_native_interface"</span>: <span class="number">1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>1ã€é…ç½®é¡¹<br>â‘  <code>name</code> é¡¹ç›®åç§°<br>â‘¡ <code>content_url</code> web é¡¹ç›®æ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šçš„å­˜å‚¨è·¯å¾„ï¼ˆå³ www ç›®å½•åœ¨äº‘å­˜å‚¨ä¸­çš„ç›®å½•è·¯å¾„ï¼‰ï¼Œçƒ­æ›´æ–°æ’ä»¶å°†æ­¤ URL ä½œä¸º base urlï¼Œç”¨äºä¸‹è½½é…ç½®æ–‡ä»¶å’Œé¡¹ç›®æ›´æ–°æ–‡ä»¶ï¼ˆå¿…éœ€çš„é…ç½®é¡¹ï¼‰<br>â‘¢ <code>release</code> æè¿° web é¡¹ç›®ç‰ˆæœ¬å·ï¼Œæ¯ä¸€æ¬¡å‘å¸ƒçš„ç‰ˆæœ¬å·å¿…é¡»å”¯ä¸€ï¼ˆé»˜è®¤ä½¿ç”¨æ—¶é—´æˆ³ï¼Œæ ¼å¼ä¸ºï¼šyyyy.MM.dd-HH.mm.ssï¼‰ï¼Œæ’ä»¶æ˜¯<strong>å°†ç‰ˆæœ¬å·è¿›è¡Œå­—ç¬¦ä¸²ç›¸ç­‰æ¯”è¾ƒ</strong>æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–°ç‰ˆæœ¬ï¼ˆå¿…éœ€çš„é…ç½®é¡¹ï¼‰<br>â‘£ <code>min_native_interface</code></p>
<blockquote>
<p>Minimum version of the native side that is required to run this web content</p>
</blockquote>
<ul>
<li>cordova é¡¹ç›®ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†ï¼šweb content å’Œ native sideã€‚å‰è€…æ˜¯ç½‘é¡µå†…å®¹ï¼Œåè€…æ˜¯ cordova æ’ä»¶ï¼Œä¸ºç½‘é¡µæä¾›åŸç”Ÿ API æ”¯æŒï¼Œweb content çš„è¿è¡Œæ˜¯åŸºäº native sideã€‚</li>
<li>è¯¥é…ç½®é¡¹æŒ‡æ˜ web content è¿è¡Œæ—¶ native side çš„æœ€ä½ç‰ˆæœ¬ã€‚åœ¨ native side ä»£ç æœ‰å˜æ›´åï¼ˆcordova æ’ä»¶æ–°å¢/åˆ é™¤ï¼Œnative side ç‰ˆæœ¬å·æ›´æ–°ï¼‰ï¼Œä¸ºäº†ç¡®ä¿ web content èƒ½æ­£å¸¸è¿è¡Œï¼Œéœ€è¦æ›´æ–° <code>min_native_interface</code> çš„å€¼</li>
</ul>
<p>åœ¨åº”ç”¨ <code>config.xml</code> é…ç½®ä¸­å¯ä»¥å®šä¹‰äº† native side çš„ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">chcp</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">native-interface</span> <span class="attr">version</span>=<span class="string">"5"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">chcp</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>ä¾‹å¦‚å½“å‰é¡¹ç›® native side çš„ç‰ˆæœ¬å·æ˜¯5ï¼š</p>
<ul>
<li>å¦‚æœæœåŠ¡å™¨ä¸Šé…ç½®æ–‡ä»¶ <code>chcp.json</code> ä¸­çš„ <code>min_native_interface</code> å€¼ä¸º 5ï¼Œé‚£ä¹ˆç¬¦åˆè¦æ±‚ï¼Œçƒ­æ›´æ–°åçš„ web content èƒ½å¤Ÿåœ¨æ­£å¸¸è¿è¡Œ</li>
<li>å¦‚æœæœåŠ¡å™¨ä¸Šé…ç½®æ–‡ä»¶ <code>chcp.json</code> ä¸­çš„ <code>min_native_interface</code> å€¼ä¸º 10ï¼Œé«˜äº <code>config.xml</code> æ–‡ä»¶ä¸­ <code>&lt;native-interface /&gt;</code>ï¼Œé‚£ä¹ˆçƒ­æ›´æ–°å°†æ— æ³•æ­£å¸¸è¿›è¡Œã€‚æ­¤æ—¶ï¼Œæ’ä»¶ä¼šæç¤ºé”™è¯¯ <code>chcp_updateLoadFailed</code>ï¼Œæç¤ºåº”ç”¨éœ€è¦æ›´æ–°å‡çº§</li>
</ul>
<p>â‘¤ <code>update</code> ä½•æ—¶è§¦å‘è¿›è¡Œå®‰è£…ï¼ˆinstallï¼‰ä»£ç çƒ­æ›´æ–°<br>ä»£ç çƒ­æ›´æ–°æ¶‰åŠä¸¤ä¸ªä¸»è¦è¿‡ç¨‹ï¼šfetch update å’Œ install updateã€‚å‰è€…è·å–çƒ­æ›´æ–°å˜æ›´æ–‡ä»¶ï¼Œåè€…å°†è·å–åˆ°çš„æ›´æ–°æ–‡ä»¶å®‰è£…åˆ° App ä¸­ç”Ÿæ•ˆã€‚æ­¤å­—æ®µæ˜¯é’ˆå¯¹åè€…ï¼Œä½•æ—¶ install updateï¼Œå¯é€‰å€¼ï¼š</p>
<ul>
<li><code>start</code>ï¼šåº”ç”¨å¯åŠ¨ï¼Œé»˜è®¤é¡¹ï¼ˆinstall update when application is launchedï¼‰</li>
<li><code>resume</code>ï¼šåº”ç”¨ä»åå°æ¢å¤ï¼ˆinstall the update when application is resumed from background stateï¼‰</li>
<li><code>now</code>ï¼šä¸‹è½½æ›´æ–°åç«‹å³æ‰§è¡Œï¼ˆinstall update as soon as it has been downloadedï¼‰</li>
</ul>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ç¦ç”¨è‡ªåŠ¨ install updateï¼Œæ‰‹åŠ¨è°ƒç”¨ç›¸å…³ API è¿›è¡Œ install<br>â‘¥ <code>android_identifier</code> / <code>ios_identifier</code></p>
<ul>
<li><code>android_identifier</code>: Package name of the Android version of the application</li>
<li><code>ios_identifier</code>: Identification number of the application<br>ç”¨äºè·³è½¬åˆ° Google Play Store æˆ–è€… App Store è¯¥åº”ç”¨é¡µé¢</li>
</ul>
<p>2ã€å¦‚ä½•ç”Ÿæˆè¯¥æ–‡ä»¶ï¼š</p>
<ul>
<li>åœ¨ cordova é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ <code>cordova-hcp init</code> ï¼Œä¼šé€šè¿‡å‘½ä»¤è¡Œäº¤äº’çš„æ–¹å¼ï¼Œæç¤ºè¾“å…¥é…ç½®æœ‰å…³ä¿¡æ¯ï¼Œåˆ›å»ºè¯¥æ–‡ä»¶ï¼Œä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªé»˜è®¤ Application config æ–‡ä»¶ <code>cordova-hcp.json</code></li>
<li>ç„¶ååœ¨æ¯æ¬¡åº”ç”¨æ‰“åŒ…æ—¶ï¼Œå†æ‰§è¡Œ <code>cordova-hcp build</code> å³å¯åœ¨ web é¡¹ç›® <code>www</code> æ ¹ç›®å½•ç”Ÿæˆä¸€ä¸ª <code>chcp.json</code> æ–‡ä»¶ã€‚</li>
</ul>
<h4 id="Content-manifest"><a href="#Content-manifest" class="headerlink" title="Content manifest"></a>Content manifest</h4><blockquote>
<p>Content manifest describes the state of the files inside your web project.</p>
</blockquote>
<p>é€šè¿‡æ‰§è¡Œ <code>cordova-hcp build</code> åœ¨ <code>www</code> æ ¹ç›®å½•è‡ªåŠ¨ç”Ÿæˆ <code>chcp.manifest</code> æ–‡ä»¶<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"file"</span>: <span class="string">"import.html"</span>,</div><div class="line">    <span class="attr">"hash"</span>: <span class="string">"fc9301d4bd7381ba6033aa51884ed2dd"</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"file"</span>: <span class="string">"index.html"</span>,</div><div class="line">    <span class="attr">"hash"</span>: <span class="string">"f73630f62a531ab6c41cd067eb4f9b07"</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"file"</span>: <span class="string">"lib/lib.min.js"</span>,</div><div class="line">    <span class="attr">"hash"</span>: <span class="string">"6ecb0251f4c54f80586d9059dfc61de8"</span></div><div class="line">  &#125;,</div><div class="line">  ...</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p><code>chcp.manifest</code> æ–‡ä»¶ä¸­åŒ…å«çš„æ˜¯ web content é™æ€æ–‡ä»¶ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªé¡¹éƒ½åŒ…æ‹¬ä¸¤ä¸ªå­—æ®µï¼š</p>
<ul>
<li><code>file</code>: ç›¸å¯¹äº <code>www</code> ç›®å½•çš„æ–‡ä»¶è·¯å¾„</li>
<li><code>hash</code>: æ–‡ä»¶çš„ MD5 å“ˆå¸Œå€¼ï¼Œç”¨äºåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å‘ç”Ÿå˜æ›´</li>
</ul>
<p>åŸºäº <code>chcp.manifest</code> æ–‡ä»¶</p>
<ul>
<li>åœ¨ fetch update é˜¶æ®µï¼Œä»æœåŠ¡å™¨ä¸Šè·å–æ–°å¢ã€ä¿®æ”¹æ–‡ä»¶</li>
<li>åœ¨ install update é˜¶æ®µï¼Œç§»é™¤è¢«åˆ é™¤æ–‡ä»¶</li>
</ul>
<h3 id="Cordova-config-xml-é…ç½®"><a href="#Cordova-config-xml-é…ç½®" class="headerlink" title="Cordova config.xml é…ç½®"></a>Cordova <code>config.xml</code> é…ç½®</h3><p>Cordova é¡¹ç›®çš„ <code>config.xml</code> æ–‡ä»¶ç”¨äºè®¾ç½®é¡¹ç›®é…ç½®é€‰é¡¹ï¼ŒCordova Hot Code Push çƒ­æ›´æ–°æ’ä»¶çš„é…ç½®é¡¹ä¹Ÿéœ€è¦åœ¨è¯¥æ–‡ä»¶ä¸­è¿›è¡Œç›¸åº”çš„é…ç½®ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">chcp</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">config-file</span> <span class="attr">url</span>=<span class="string">"https://kss.ksyun.com/********/chcp.json"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">auto-download</span> <span class="attr">enabled</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">auto-install</span> <span class="attr">enabled</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">native-interface</span> <span class="attr">version</span>=<span class="string">"1"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">chcp</span>&gt;</span></div></pre></td></tr></table></figure></p>
<ul>
<li><code>config-file</code>ï¼šé…ç½®æ–‡ä»¶ <code>chcp.json</code> ä»æœåŠ¡å™¨ä¸ŠåŠ è½½çš„è·¯å¾„ï¼ˆå¿…é¡»çš„é…ç½®é¡¹ï¼‰</li>
<li><code>auto-download</code>ï¼šæ˜¯å¦è‡ªåŠ¨ä¸‹è½½çƒ­æ›´æ–°ä»£ç ï¼Œé»˜è®¤æ˜¯ true</li>
<li><code>auto-install</code>ï¼šæ˜¯å¦è‡ªåŠ¨å®‰è£…çƒ­æ›´æ–°ä»£ç ï¼Œé»˜è®¤æ˜¯ true</li>
<li><code>native-interface</code>ï¼šå½“å‰ native side çš„ç‰ˆæœ¬å·</li>
</ul>
<p>å¯ä»¥ç¦ç”¨è‡ªåŠ¨ä¸‹è½½ï¼Œå®‰è£…çƒ­æ›´æ–°ä»£ç ï¼Œé€šè¿‡æ‰‹åŠ¨è°ƒç”¨æ‰§è¡Œã€‚</p>
<h2 id="ä»£ç çƒ­æ›´æ–°åŸç†"><a href="#ä»£ç çƒ­æ›´æ–°åŸç†" class="headerlink" title="ä»£ç çƒ­æ›´æ–°åŸç†"></a>ä»£ç çƒ­æ›´æ–°åŸç†</h2><h3 id="çƒ­æ›´æ–°æµç¨‹"><a href="#çƒ­æ›´æ–°æµç¨‹" class="headerlink" title="çƒ­æ›´æ–°æµç¨‹"></a>çƒ­æ›´æ–°æµç¨‹</h3><p><img src="http://7vikhl.com1.z0.glb.clouddn.com/update-workflow.png" alt=""></p>
<ul>
<li>â‘  åº”ç”¨å¯åŠ¨</li>
<li>â‘¡ çƒ­æ›´æ–°æ’ä»¶åˆå§‹åŒ–ï¼Œå¹¶åœ¨åå°åŠ è½½æ›´æ–°æ¨¡å— (update loader)</li>
<li>â‘¢ æ›´æ–°æ¨¡å— (update loader) ä» Cordova é¡¹ç›®é…ç½® <code>config.xml</code> æ–‡ä»¶ä¸­è·å– <code>config-file</code> ï¼ˆçƒ­æ›´æ–°æ’ä»¶é…ç½®æ–‡ä»¶ <code>chcp.json</code> çš„åŠ è½½è·¯å¾„ï¼‰ï¼Œç„¶ååŠ è½½é…ç½®æ–‡ä»¶ <code>chcp.json</code>ï¼Œè·å–å…¶ä¸­çš„ <code>release</code> ç‰ˆæœ¬å·ï¼Œå¯¹æ¯”å½“å‰çš„ç‰ˆæœ¬å·ï¼Œè‹¥äºŒè€…ä¸åŒï¼Œè¯´æ˜æœ‰æ–°ç‰ˆæœ¬ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥</li>
<li>â‘£ æ›´æ–°æ¨¡å— (update loader) ä» <code>chcp.json</code> é…ç½®æ–‡ä»¶ä¸­è·å– <code>content_url</code> ä½œä¸º base urlï¼Œç„¶ååŠ è½½ <code>chcp.manifest</code> æ–‡ä»¶ï¼Œæˆ–è€…æ–°ç‰ˆæœ¬æ–‡ä»¶å˜æ›´ä¿¡æ¯</li>
<li>â‘¤ æ›´æ–°æ¨¡å— (update loader) æ ¹æ® <code>content_url</code> ä½œä¸º base urlï¼Œä¸‹è½½æ‰€æœ‰å˜æ›´ã€æ–°å¢æ–‡ä»¶</li>
<li>â‘¥ å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œ æ›´æ–°æ¨¡å— (update loader) å‘é€é€šçŸ¥ï¼Œè¯¥æ›´æ–°å·²å‡†å¤‡å¥½è¿›è¡Œå®‰è£…</li>
<li>â‘¦ å®‰è£…æ›´æ–°ï¼Œåº”ç”¨é‡å®šå‘åˆ°æ–°ç‰ˆæœ¬é¡µé¢</li>
</ul>
<h3 id="Cordova-web-project-å­˜å‚¨ä¸æ›´æ–°"><a href="#Cordova-web-project-å­˜å‚¨ä¸æ›´æ–°" class="headerlink" title="Cordova web project å­˜å‚¨ä¸æ›´æ–°"></a>Cordova web project å­˜å‚¨ä¸æ›´æ–°</h3><p>Cordova é¡¹ç›®ä¸­éƒ½åŒ…å«ä¸€ä¸ª <code>www</code> ç›®å½•ï¼Œå­˜å‚¨ç½‘é¡µé™æ€æ–‡ä»¶ï¼ŒCordova æ‰“åŒ…ç§»åŠ¨åº”ç”¨æ—¶ï¼Œä¼šå°†å…¶æ‹·è´åˆ°å„è‡ªçš„é¡¹ç›®ç›®å½•ï¼ŒåŒæ—¶ä¼šè¢«æ‰“åŒ…åˆ°åº”ç”¨ä¸­ã€‚</p>
<ul>
<li>Android: platforms/android/assets/www.</li>
<li>iOS: platforms/ios/www.</li>
</ul>
<p><code>www</code> ç›®å½•æ‰“åŒ…åˆ°åº”ç”¨ä¸­ä¹‹åï¼Œæˆ‘ä»¬å°±æ²¡åŠæ³•å¯¹å…¶è¿›è¡Œæ›´æ–°äº†ï¼Œå› ä¸ºåªæœ‰å¯è¯»æƒé™ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œåœ¨åº”ç”¨ç¬¬ä¸€æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œä»åº”ç”¨ bundle ä¸­åŠ è½½ç½‘é¡µå†…å®¹çš„åŒæ—¶ï¼Œå°† <code>www</code> ç›®å½•æ‹·è´åˆ°å¤–éƒ¨ç›®å½•ä¸­ï¼Œåœ¨åç»­åº”ç”¨å¯åŠ¨æ—¶ï¼Œéƒ½ä»è¿™ä¸ªå¤–éƒ¨å­˜å‚¨çš„é™æ€æ–‡ä»¶ä¸­åŠ è½½æ–‡ä»¶ï¼Œè€Œå¯¹äºå¤–éƒ¨çš„è¿™ä¸ªå­˜å‚¨ç›®å½•ï¼Œæˆ‘ä»¬å°±æœ‰è¯»å†™æƒé™ï¼Œè¿™æ ·å°±ä¸ºæˆ‘ä»¬åŠ¨æ€æ›´æ–°ç½‘é¡µä»£ç æä¾›äº†å¯èƒ½ã€‚</p>
<p>åœ¨ safari è°ƒè¯•é¡µé¢æ‰§è¡Œ <code>cordova.file.applicationStorageDirectory</code> å¯ä»¥å¾—åˆ°åº”ç”¨çš„å­˜å‚¨è·¯å¾„ï¼Œç‚¹å‡»å¯ä»¥æ‰“å¼€ Finder ç›®å½•ã€‚<br>ä» <code>Library/Application Support</code> ç›®å½•ä¸‹å°±å¯ä»¥æ‰¾åˆ°å­˜å‚¨ web content çš„å¤–éƒ¨ç›®å½•ã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/chcp-external-folder.png" alt=""><br><img src="http://7vikhl.com1.z0.glb.clouddn.com/3CA8CB1D-C26D-4F98-951C-DBE94650CA5D.png" alt=""></p>
<p>Cordova Hot Code Push æ’ä»¶ä¸ºæ¯ä¸€ä¸ªç‰ˆæœ¬å†…å®¹éƒ½åˆ›å»ºäº†ä¸€ä¸ªå¯¹åº”çš„ç›®å½•ï¼Œä»¥é…ç½®æ–‡ä»¶ <code>chcp.json</code> ä¸­ <code>release</code> å­—æ®µå€¼ä¸ºç›®å½•åï¼Œå­˜æ”¾ä¸åŒç‰ˆæœ¬ <code>www</code> ç›®å½•ä¸­çš„é™æ€æ–‡ä»¶ï¼Œè¿™ç§å¤„ç†æ–¹å¼çš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li>é¿å…äº†æ–‡ä»¶ç¼“å­˜é—®é¢˜ã€‚ä¾‹å¦‚ iOS UIWebView ç¼“å­˜ css æ–‡ä»¶ï¼Œå³ä½¿åˆ·æ–°é¡µé¢ï¼Œä¹Ÿä¸ä¼šæ¸…é™¤ç¼“å­˜ï¼Œé™¤éé‡å¯åº”ç”¨æ‰èƒ½å¼ºåˆ¶æ¸…é™¤ç¼“å­˜ã€‚ä¸åŒç‰ˆæœ¬ç½®äºä¸åŒçš„ç›®å½•ï¼Œç”±äºåŠ è½½è·¯å¾„ä¸åŒï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³æ–‡ä»¶çš„ç¼“å­˜é—®é¢˜</li>
<li>é¿å…åœ¨æ›´æ–°ä»£ç æ–‡ä»¶æ—¶ï¼Œå’Œå½“å‰å·²æœ‰æ–‡ä»¶å‡ºç°å†²çª</li>
<li>æ–¹ä¾¿å›æ»šåˆ°å‰ä¸€ä¸ªç‰ˆæœ¬</li>
</ul>
<p>ğŸ¤– ä¸‹é¢äº†è§£ä¸€ä¸‹ï¼Œè·å–æ›´æ–°å†…å®¹å’Œå®‰è£…æ›´æ–°å†…å®¹æ—¶éƒ½å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<p><strong>1ã€è·å–æ›´æ–°å†…å®¹</strong></p>
<ul>
<li>æ ¹æ® <code>release</code> ç‰ˆæœ¬å·ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•</li>
<li>åœ¨æ–°ç›®å½•ä¸­ï¼Œåˆ›å»º <code>update</code> ç›®å½•ï¼Œæ ¹æ® <code>chcp.manifest</code> æ–‡ä»¶ï¼Œå°†æ‰€æœ‰å˜æ›´ã€æ–°å¢æ–‡ä»¶ä¸‹è½½åˆ°è¯¥ç›®å½•ä¸­</li>
<li>æ–°ç‰ˆæœ¬å¯¹åº”çš„ <code>chcp.json</code> å’Œ <code>chcp.manifest</code> æ–‡ä»¶ä¹Ÿä¼šç½®äº <code>update</code> ç›®å½•ä¸­</li>
</ul>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/926064F1-2CF2-4871-90B6-791BA0059C13.png" alt=""></p>
<p><strong>2ã€å®‰è£…æ›´æ–°å†…å®¹</strong></p>
<ul>
<li>å°†å½“å‰ç‰ˆæœ¬å¯¹åº”ç›®å½•ä¸‹çš„ <code>www</code> ç›®å½•æ‹·è´åˆ°æ–°ç‰ˆæœ¬å¯¹åº”çš„ç›®å½•ä¸‹</li>
<li>åœ¨æ–°ç‰ˆæœ¬å¯¹åº”ç›®å½•ä¸‹ï¼Œå°† <code>update</code> ç›®å½•ä¸­å˜æ›´ã€æ–°å¢æ–‡ä»¶æ‹·è´åˆ° <code>www</code> ç›®å½•ä¸­ï¼ŒåŒæ—¶æ ¹æ® <code>chcp.manifest</code> ç§»é™¤è¢«åˆ é™¤æ–‡ä»¶</li>
<li>ç§»é™¤ <code>update</code> ç›®å½•</li>
<li>åº”ç”¨é‡å®šå‘åˆ°æ–°ç‰ˆæœ¬ç›®å½•ä¸‹åŠ è½½ç½‘é¡µå†…å®¹</li>
</ul>
<h2 id="æ’ä»¶-JS-æ¥å£"><a href="#æ’ä»¶-JS-æ¥å£" class="headerlink" title="æ’ä»¶ JS æ¥å£"></a>æ’ä»¶ JS æ¥å£</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCordova Hot Code Push (CHCP) æ’ä»¶ä¸éœ€è¦é¢å¤–çš„ä»£ç ï¼Œå°±å¯ä»¥è‡ªåŠ¨æ‰§è¡Œ <code>checking-&gt;downloading-&gt;installation</code> è¿™ä¸ªæ›´æ–°å¾ªç¯ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å…¶æä¾›çš„æ¥å£æ¥æ§åˆ¶è¿™æ›´æ–°æµç¨‹ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›® <code>config.xml</code> æ–‡ä»¶ä¸­é…ç½® <code>auto-download</code> å’Œ <code>auto-install</code> ä¸º <code>false</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">chcp</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">config-file</span> <span class="attr">url</span>=<span class="string">"https://kss.ksyun.com/******/chcp.json"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">auto-download</span> <span class="attr">enabled</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">auto-install</span> <span class="attr">enabled</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">native-interface</span> <span class="attr">version</span>=<span class="string">"1"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">chcp</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="äº‹ä»¶ç›‘å¬"><a href="#äº‹ä»¶ç›‘å¬" class="headerlink" title="äº‹ä»¶ç›‘å¬"></a>äº‹ä»¶ç›‘å¬</h3><p>Cordova Hot Code Push æ’ä»¶æä¾›äº†ä¸€ç³»åˆ—äº‹ä»¶ç›‘å¬ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹ä¸åŒæƒ…å†µè¿›è¡Œä¸åŒçš„å¤„ç†ã€‚ä¾‹å¦‚ï¼š<code>chcp_updateInstalled</code> äº‹ä»¶ï¼Œå½“æ›´æ–°å®‰è£…å®Œæˆæ—¶ä¼šå‘å‡ºè¿™ä¸ªé€šçŸ¥ï¼›<code>chcp_updateInstallFailed</code> äº‹ä»¶ï¼Œå½“æ›´æ–°å®‰è£…å¤±è´¥æ—¶å‘å‡ºè¿™ä¸ªé€šçŸ¥ï¼Œç­‰ç­‰ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦åœ¨ <code>deviceready</code> äº‹ä»¶å›è°ƒåï¼Œæ‰è¿›è¡Œ CHCP æ’ä»¶çš„äº‹ä»¶ç›‘å¬æ³¨å†Œã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> app = &#123;</div><div class="line"></div><div class="line">  <span class="comment">// Application Constructor</span></div><div class="line">  initialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.bindEvents();</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="comment">// Bind any events that are required.</span></div><div class="line">  <span class="comment">// Usually you should subscribe on 'deviceready' event to know, when you can start calling cordova modules</span></div><div class="line">  bindEvents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">'deviceready'</span>, <span class="keyword">this</span>.onDeviceReady, <span class="literal">false</span>);</div><div class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">'chcp_updateIsReadyToInstall'</span>, <span class="keyword">this</span>.onUpdateReady, <span class="literal">false</span>);</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="comment">// deviceready Event Handler</span></div><div class="line">  onDeviceReady: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Device is ready for work'</span>);</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="comment">// chcp_updateIsReadyToInstall Event Handler</span></div><div class="line">  onUpdateReady: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Update is ready for installation'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">app.initialize();</div></pre></td></tr></table></figure></p>
<p>è¯¦ç»†äº‹ä»¶ç›‘å¬åˆ—è¡¨å‚è€ƒæ–‡æ¡£ï¼š<a href="https://github.com/nordnet/cordova-hot-code-push/wiki/Listen-for-update-events" target="_blank" rel="external">Listen for update events</a></p>
<h3 id="è·å–-å®‰è£…æ›´æ–°"><a href="#è·å–-å®‰è£…æ›´æ–°" class="headerlink" title="è·å–/å®‰è£…æ›´æ–°"></a>è·å–/å®‰è£…æ›´æ–°</h3><p>â‘  fetch update <code>chcp.fetchUpdate</code><br>è°ƒç”¨ API ä»æœåŠ¡å™¨ä¸­è·å–æ›´æ–°<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchUpdate</span><span class="params">(cb)</span></span> &#123;</div><div class="line">    var options = &#123;</div><div class="line">        <span class="string">'config-file'</span>: <span class="string">'https://kss.ksyun.com/******/chcp.json'</span></div><div class="line">    &#125;;</div><div class="line">    chcp.fetchUpdate(updateCallback, options);</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">updateCallback</span><span class="params">(error, data)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">error</span>) &#123;</div><div class="line">            console.<span class="built_in">log</span>(<span class="string">'--fetchUpdate error--'</span>, <span class="built_in">error</span>.code, <span class="built_in">error</span>.description);</div><div class="line">        &#125;</div><div class="line">        console.<span class="built_in">log</span>(<span class="string">'--fetchUpdate--'</span>, data, data.<span class="built_in">config</span>);</div><div class="line">        cb &amp;&amp; cb(<span class="built_in">error</span>, data);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>â‘¡ install update <code>chcp.installUpdate</code><br>è°ƒç”¨ API å®‰è£…æ›´æ–°<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">installUpdate</span><span class="params">(cb)</span></span> &#123;</div><div class="line">    chcp.installUpdate(installationCallback);</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">installationCallback</span><span class="params">(error)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">error</span>) &#123;</div><div class="line">            console.<span class="built_in">log</span>(<span class="string">'Failed to install the update with error code: '</span> + <span class="built_in">error</span>.code);</div><div class="line">            console.<span class="built_in">log</span>(<span class="built_in">error</span>.description);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            console.<span class="built_in">log</span>(<span class="string">'Update installed!'</span>);</div><div class="line">        &#125;</div><div class="line">        cb &amp;&amp; cb(<span class="built_in">error</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨å®‰è£…æ›´æ–°ä¹‹å‰ï¼Œè¿˜éœ€è¦æ£€æµ‹æ˜¯å¦æœ‰æ›´æ–°å¯ç”¨äºå®‰è£…<br><code>chcp.isUpdateAvailableForInstallation</code><br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkIsUpdateAvailableForInstallation</span><span class="params">(cb)</span></span> &#123;</div><div class="line">    chcp.isUpdateAvailableForInstallation(callbackMethod);</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callbackMethod</span><span class="params">(error, data)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">error</span>) &#123;</div><div class="line">            console.<span class="built_in">log</span>(<span class="string">'No update was loaded =&gt; nothing to install'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            console.<span class="built_in">log</span>(<span class="string">'Current content version: '</span> + data.currentVersion);</div><div class="line">            console.<span class="built_in">log</span>(<span class="string">'Ready to be installed:'</span> + data.readyToInstallVersion);</div><div class="line">        &#125;</div><div class="line">        cb &amp;&amp; cb(<span class="built_in">error</span>, data);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="è·å–ç‰ˆæœ¬ä¿¡æ¯"><a href="#è·å–ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="è·å–ç‰ˆæœ¬ä¿¡æ¯"></a>è·å–ç‰ˆæœ¬ä¿¡æ¯</h3><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">function getVersionInfo(cb) &#123;</div><div class="line">    chcp.getVersionInfo((err, <span class="built_in">data</span>) =&gt; &#123;</div><div class="line">        console.<span class="keyword">log</span>(<span class="string">'Current web version: '</span> + <span class="built_in">data</span>.currentWebVersion);</div><div class="line">        console.<span class="keyword">log</span>(<span class="string">'Previous web version: '</span> + <span class="built_in">data</span>.previousWebVersion);</div><div class="line">        console.<span class="keyword">log</span>(<span class="string">'Loaded and ready for installation web version: '</span> + <span class="built_in">data</span>.readyToInstallWebVersion);</div><div class="line">        console.<span class="keyword">log</span>(<span class="string">'Application version name: '</span> + <span class="built_in">data</span>.appVersion);</div><div class="line">        console.<span class="keyword">log</span>(<span class="string">'Application build version: '</span> + <span class="built_in">data</span>.buildVersion);</div><div class="line"></div><div class="line">        cb &amp;&amp; cb(err, <span class="built_in">data</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="é”™è¯¯ä»£ç "><a href="#é”™è¯¯ä»£ç " class="headerlink" title="é”™è¯¯ä»£ç "></a>é”™è¯¯ä»£ç </h3><p>åœ¨ä¸‹è½½ï¼Œå®‰è£…æ›´æ–°è¿‡ç¨‹ä¸­éƒ½æœ‰å¯èƒ½å‡ºç°é”™è¯¯ï¼Œè¯¦ç»†çš„é”™è¯¯ä»£ç å‚è€ƒï¼š<a href="https://github.com/nordnet/cordova-hot-code-push/wiki/Error-codes" target="_blank" rel="external">Error codes</a></p>
<h2 id="è¯·æ±‚åˆ°åº”ç”¨å•†åº—è¿›è¡Œ-APP-å‡çº§"><a href="#è¯·æ±‚åˆ°åº”ç”¨å•†åº—è¿›è¡Œ-APP-å‡çº§" class="headerlink" title="è¯·æ±‚åˆ°åº”ç”¨å•†åº—è¿›è¡Œ APP å‡çº§"></a>è¯·æ±‚åˆ°åº”ç”¨å•†åº—è¿›è¡Œ APP å‡çº§</h2><p>æ’ä»¶é…ç½®æ–‡ä»¶ <code>chcp.json</code> ä¸­ <code>min_native_interface</code> é€‰é¡¹æ˜¯ç½‘é¡µå†…å®¹æ‰§è¡Œæ—¶è¦æ±‚ native side æœ€ä½ç‰ˆæœ¬å·ã€‚æ¯ä¸€æ¬¡çƒ­æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šå»æ£€æŸ¥è¿™ä¸ªé€»è¾‘ï¼Œåˆ¤æ–­å½“å‰ native side çš„ç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚å¦‚æœå½“å‰ APP ä¸­çš„ native side ç‰ˆæœ¬å·ä½äº <code>chcp.json</code> ä¸­ <code>min_native_interface</code> çš„é€‰é¡¹å€¼ï¼Œé‚£ä¹ˆæ‰§è¡Œçƒ­æ›´æ–°å°±ä¼šæç¤ºé”™è¯¯ï¼š<code>chcp.error.APPLICATION_BUILD_VERSION_TOO_LOW</code>ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åº”å½“æç¤ºç”¨æˆ·å‰å¾€åº”ç”¨å•†åº—å¯¹ APP è¿›è¡Œå‡çº§ã€‚</p>
<p>æ°å½“çš„å¤„ç†æ–¹å¼æ˜¯ï¼Œåœ¨å‡ºç° <code>chcp.error.APPLICATION_BUILD_VERSION_TOO_LOW</code> é”™è¯¯æ—¶ï¼Œå¼¹æ¡†æç¤ºç”¨æˆ·å‰å¾€åº”ç”¨å•†åº—è¿›è¡Œå‡çº§ï¼Œå¼¹æ¡†æœ‰ä¸¤ä¸ªæŒ‰é”®ï¼šä¸€ä¸ªç‚¹å‡»åè·³è½¬åˆ°åº”ç”¨å•†åº—è¯¥ APP å¯¹åº”ä¸‹è½½é¡µé¢ï¼›å¦ä¸€ä¸ªç‚¹å‡»åå…³é—­å¼¹æ¡†ã€‚æ’ä»¶ä¹Ÿæä¾›äº† API å¤„ç†è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬åªéœ€ï¼š</p>
<ul>
<li>åœ¨ <code>chcp.json</code> é…ç½®æ–‡ä»¶ä¸­è®¾ç½® <code>android_identifier</code> å’Œ <code>ios_identifier</code></li>
<li>è°ƒç”¨ <code>chcp.requestApplicationUpdate</code> æ–¹æ³•</li>
</ul>
<p>ç›‘å¬ <code>chcp_updateLoadFailed</code> äº‹ä»¶ï¼Œåˆ¤æ–­é”™è¯¯ä»£ç ä¸º <code>chcp.error.APPLICATION_BUILD_VERSION_TOO_LOW</code> æ—¶ï¼Œè°ƒç”¨ <code>chcp.requestApplicationUpdate</code> æ–¹æ³•ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> app = &#123;</div><div class="line"></div><div class="line">  <span class="comment">// Application Constructor</span></div><div class="line">  initialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.bindEvents();</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="comment">// Bind any events that are required.</span></div><div class="line">  <span class="comment">// Usually you should subscribe on 'deviceready' event to know, when you can start calling cordova modules</span></div><div class="line">  bindEvents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">'deviceready'</span>, <span class="keyword">this</span>.onDeviceReady, <span class="literal">false</span>);</div><div class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">'chcp_updateLoadFailed'</span>, <span class="keyword">this</span>.onUpdateLoadError, <span class="literal">false</span>);</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="comment">// deviceready Event Handler</span></div><div class="line">  onDeviceReady: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">onUpdateLoadError</span>: <span class="function"><span class="keyword">function</span>(<span class="params">eventData</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> error = eventData.detail.error;</div><div class="line">    <span class="keyword">if</span> (error &amp;&amp; error.code == chcp.error.APPLICATION_BUILD_VERSION_TOO_LOW) &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'Native side update required'</span>);</div><div class="line">        <span class="keyword">var</span> dialogMessage = <span class="string">'New version of the application is available on the store. Please, update.'</span>;</div><div class="line">        chcp.requestApplicationUpdate(dialogMessage, <span class="keyword">this</span>.userWentToStoreCallback, <span class="keyword">this</span>.userDeclinedRedirectCallback);</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">userWentToStoreCallback</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// user went to the store from the dialog</span></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">userDeclinedRedirectCallback</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// User didn't want to leave the app.</span></div><div class="line">    <span class="comment">// Maybe he will update later.</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">app.initialize();</div></pre></td></tr></table></figure></p>
<h2 id="Usage-Limitations"><a href="#Usage-Limitations" class="headerlink" title="Usage Limitations"></a><a href="https://github.com/nordnet/cordova-hot-code-push/wiki/Usage-Limitations" target="_blank" rel="external">Usage Limitations</a></h2><p><strong>1ã€Donâ€™t rename/delete/move your index page</strong><br>Cordova é¡¹ç›® <code>config.xml</code> æ–‡ä»¶ä¸­éƒ½ä¼šå®šä¹‰ä¸€ä¸ªå…¥å£é¡µé¢ <code>index.html</code>ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">content</span> <span class="attr">src</span>=<span class="string">"index.html"</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<p>åº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šåŠ è½½ <code>index.html</code> é¡µé¢ä½œä¸ºå…¥å£ï¼Œåœ¨ä»£ç çƒ­æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œè¿™æ˜¯å”¯ä¸€ä¸èƒ½åˆ é™¤ï¼Œç§»åŠ¨å’Œé‡å‘½åçš„æ–‡ä»¶ï¼Œå¦åˆ™ï¼Œä»£ç çƒ­æ›´æ–°åï¼Œåº”ç”¨å°±æ— æ³•æ­£å¸¸åŠ è½½åˆ° <code>index.html</code> å…¥å£é¡µé¢ï¼Œæ‰€ä»¥ä¼šå‡ºé”™ã€‚</p>
<p>è¯šç„¶ï¼Œå¦‚æœä½ éœ€è¦é‡å‘½åï¼Œæˆ–è€…ä¿®æ”¹å…¶å­˜å‚¨è·¯å¾„ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ <code>config.xml</code> æ–‡ä»¶ä¸­ä¿®æ”¹ <code>content</code> é…ç½®ã€‚</p>
<p><strong>2ã€Do not clean pluginâ€™s inner preferences with cordova-plugin-nativestorage</strong><br>cordova-plugin-nativestorage æ’ä»¶æä¾›äº†è¯»å†™æœ¬åœ°å­˜å‚¨æ•°æ®çš„èƒ½åŠ›ï¼Œä¾‹å¦‚åœ¨ iOS ä¸­å¯¹åº”çš„æœ¬åœ°å­˜å‚¨æ˜¯ <code>NSUserDefault</code>ï¼ŒCHCP çƒ­æ›´æ–°æ’ä»¶åœ¨å…¶ä¸­å­˜å‚¨äº†ä¸€äº›å±æ€§ã€‚</p>
<p>è°ƒç”¨ cordova-plugin-nativestorage æ’ä»¶ä¸­çš„ <code>NativeStorage.clear()</code> æ–¹æ³•ä¼šæ¸…é™¤æœ¬åœ°å­˜å‚¨æ•°æ®ï¼Œè¿™å°±ä¼šå½±å“åˆ° CHCP æ’ä»¶çš„æ­£å¸¸è¿è¡Œï¼Œå¯¼è‡´ä¸‹ä¸€æ¬¡åº”ç”¨å¯åŠ¨æ—¶åŠ è½½çš„æ˜¯åº”ç”¨ bundle ä¸­ <code>www</code> ç›®å½•ä¸­çš„ç½‘é¡µå†…å®¹ï¼Œè€Œéå¤–éƒ¨ç›®å½•å­˜å‚¨çš„å½“å‰ç‰ˆæœ¬ç½‘é¡µå†…å®¹ã€‚</p>
<h2 id="å°†-www-ç›®å½•æ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆ–è€…äº‘å­˜å‚¨ç›®å½•"><a href="#å°†-www-ç›®å½•æ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆ–è€…äº‘å­˜å‚¨ç›®å½•" class="headerlink" title="å°† www ç›®å½•æ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆ–è€…äº‘å­˜å‚¨ç›®å½•"></a>å°† <code>www</code> ç›®å½•æ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆ–è€…äº‘å­˜å‚¨ç›®å½•</h2><p>æ–°ç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œéƒ½éœ€è¦æ‰§è¡Œå¦‚ä¸‹å¤„ç†ï¼š</p>
<ul>
<li>å¯¹ <code>www</code> ç›®å½•ä¸‹çš„é™æ€æ–‡ä»¶è¿›è¡Œæ‰“åŒ…ï¼ŒåŒ…æ‹¬ä»£ç å‹ç¼©ï¼Œåˆå¹¶ç­‰ç­‰</li>
<li>æ‰§è¡Œ <code>cordova-hcp build</code> ç”Ÿæˆ <code>chcp.json</code> å’Œ <code>chcp.manifest</code> æ–‡ä»¶</li>
<li>å°† <code>www</code> ç›®å½•ä¸‹çš„é™æ€æ–‡ä»¶ä¸Šä¼ è‡³æœåŠ¡å™¨æˆ–è€…äº‘å­˜å‚¨ç›®å½•</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Cordova-Hot-Code-Push/" rel="tag">#Cordova Hot Code Push</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/06/04/The-Difference-Between-URLs-and-URIs/" rel="next" title="URI, URL, URN çš„åŒºåˆ«">
                <i class="fa fa-chevron-left"></i> URI, URL, URN çš„åŒºåˆ«
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/19/one-pixel-border/" rel="prev" title="é«˜æ¸…å±ä¸€åƒç´ è¾¹æ¡†é—®é¢˜">
                é«˜æ¸…å±ä¸€åƒç´ è¾¹æ¡†é—®é¢˜ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7vikhl.com1.z0.glb.clouddn.com/avatar.jpg"
               alt="å°é‚“" />
          <p class="site-author-name" itemprop="name">å°é‚“</p>
          <p class="site-description motion-element" itemprop="description">Hello World</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">51</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">72</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yingshandeng" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/objcer" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2249439934" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ’ä»¶-Cordova-Hot-Code-Push-CHCP"><span class="nav-number">1.</span> <span class="nav-text">æ’ä»¶ Cordova Hot Code Push (CHCP)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#App-Store-æ”¯æŒä¹ˆ"><span class="nav-number">2.</span> <span class="nav-text">App Store æ”¯æŒä¹ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ·»åŠ æ’ä»¶åˆ°é¡¹ç›®ä¸­"><span class="nav-number">3.</span> <span class="nav-text">æ·»åŠ æ’ä»¶åˆ°é¡¹ç›®ä¸­</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#çƒ­æ›´æ–°ç›¸å…³é…ç½®"><span class="nav-number">4.</span> <span class="nav-text">çƒ­æ›´æ–°ç›¸å…³é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ’ä»¶é…ç½®"><span class="nav-number">4.1.</span> <span class="nav-text">æ’ä»¶é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Application-config"><span class="nav-number">4.1.1.</span> <span class="nav-text">Application config</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Content-manifest"><span class="nav-number">4.1.2.</span> <span class="nav-text">Content manifest</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cordova-config-xml-é…ç½®"><span class="nav-number">4.2.</span> <span class="nav-text">Cordova config.xml é…ç½®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»£ç çƒ­æ›´æ–°åŸç†"><span class="nav-number">5.</span> <span class="nav-text">ä»£ç çƒ­æ›´æ–°åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#çƒ­æ›´æ–°æµç¨‹"><span class="nav-number">5.1.</span> <span class="nav-text">çƒ­æ›´æ–°æµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cordova-web-project-å­˜å‚¨ä¸æ›´æ–°"><span class="nav-number">5.2.</span> <span class="nav-text">Cordova web project å­˜å‚¨ä¸æ›´æ–°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ’ä»¶-JS-æ¥å£"><span class="nav-number">6.</span> <span class="nav-text">æ’ä»¶ JS æ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#äº‹ä»¶ç›‘å¬"><span class="nav-number">6.1.</span> <span class="nav-text">äº‹ä»¶ç›‘å¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·å–-å®‰è£…æ›´æ–°"><span class="nav-number">6.2.</span> <span class="nav-text">è·å–/å®‰è£…æ›´æ–°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·å–ç‰ˆæœ¬ä¿¡æ¯"><span class="nav-number">6.3.</span> <span class="nav-text">è·å–ç‰ˆæœ¬ä¿¡æ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é”™è¯¯ä»£ç "><span class="nav-number">6.4.</span> <span class="nav-text">é”™è¯¯ä»£ç </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è¯·æ±‚åˆ°åº”ç”¨å•†åº—è¿›è¡Œ-APP-å‡çº§"><span class="nav-number">7.</span> <span class="nav-text">è¯·æ±‚åˆ°åº”ç”¨å•†åº—è¿›è¡Œ APP å‡çº§</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Usage-Limitations"><span class="nav-number">8.</span> <span class="nav-text">Usage Limitations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å°†-www-ç›®å½•æ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆ–è€…äº‘å­˜å‚¨ç›®å½•"><span class="nav-number">9.</span> <span class="nav-text">å°† www ç›®å½•æ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆ–è€…äº‘å­˜å‚¨ç›®å½•</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å°é‚“</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'objcer';
      var disqus_identifier = '2017/06/18/cordova-hot-code-push/';
      var disqus_title = "Cordova ä»£ç çƒ­æ›´æ–°";
      var disqus_url = 'http://objcer.com/2017/06/18/cordova-hot-code-push/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      
    </script>
  




  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("UaIz9QT8AVdqAXxUgypgPsTN-gzGzoHsz", "ONQFdHGRNex5wb5Aa64623Dw");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
