<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Deng&#39;s Blog</title>
  <subtitle>Work Smart, Enjoy Life!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://objcer.com/"/>
  <updated>2018-01-22T13:28:45.000Z</updated>
  <id>http://objcer.com/</id>
  
  <author>
    <name>å°é‚“</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å­¦ä¹ æ­£åˆ™è¡¨è¾¾å¼</title>
    <link href="http://objcer.com/2018/01/22/learn-regexp/"/>
    <id>http://objcer.com/2018/01/22/learn-regexp/</id>
    <published>2018-01-22T13:26:08.000Z</published>
    <updated>2018-01-22T13:28:45.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/regex.jpg" alt=""><br>å¯¹æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¹¶ä¸é™Œç”Ÿã€‚åœ¨å¾ˆå¤šåœ°æ–¹éƒ½ä¼šç”¨åˆ°ï¼Œå°¤å…¶æ˜¯å­—ç¬¦ä¸²å¤„ç†ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ›´æ˜¯ä¸€æŠŠåˆ©å™¨ã€‚æœ¬æ–‡é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥å­¦ä¹ æ€»ç»“ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€äº›çŸ¥è¯†å†…å®¹ ğŸ¤“</p>
<a id="more"></a>
<h2 id="é—®é¢˜å¼•å…¥"><a href="#é—®é¢˜å¼•å…¥" class="headerlink" title="é—®é¢˜å¼•å…¥"></a>é—®é¢˜å¼•å…¥</h2><p><code>index.html</code> é¡µé¢ä¸­ï¼Œæœ‰å¦‚ä¸‹ä¸€æ®µä»£ç ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"theme-color"</span> <span class="attr">content</span>=<span class="string">"#000000"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>React SharedPen App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./pace/pace.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./pace/pace-theme-minimal.css"</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="comment">&lt;!-- SharedPen scripts --&gt;</span></div><div class="line">  <span class="comment">&lt;!-- js:./dist/sharedpen.min.js --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://localhost:5000/Utils.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  ...</div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://localhost:5000/SharedPen.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- end --&gt;</span></div><div class="line"></div><div class="line">  <span class="comment">&lt;!-- SharedPen stylesheet --&gt;</span></div><div class="line">  <span class="comment">&lt;!-- css:./dist/SharedPen.css --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"http://localhost:5000/SharedPen.css"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- end --&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>æ³¨æ„è¿™ä¸¤æ®µæ³¨é‡Šæ ‡ç­¾<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- js:./dist/sharedpen.min.js --&gt;</span></div><div class="line">...</div><div class="line"><span class="comment">&lt;!-- end --&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- css:./dist/SharedPen.css --&gt;</span></div><div class="line">...</div><div class="line"><span class="comment">&lt;!-- end --&gt;</span></div></pre></td></tr></table></figure></p>
<p>åœ¨é¡µé¢åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒåŠ è½½çš„æ˜¯æœ¬åœ°æºæ–‡ä»¶ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘å¸Œæœ›å°†å…¶æ›¿æ¢æˆå‹ç¼©æ–‡ä»¶ï¼š<code>./dist/sharedpen.min.js</code> å’Œ <code>./dist/SharedPen.css</code>ã€‚</p>
<p><strong>è§£å†³æ€è·¯æ˜¯ï¼š</strong>ä½¿ç”¨ webpack æ’ä»¶ <a href="https://www.npmjs.com/package/html-replace-webpack-plugin" target="_blank" rel="external">html-replace-webpack-plugin</a> é…ç½®æ­£åˆ™è¡¨è¾¾å¼ï¼Œç„¶åè¿›è¡Œæ›¿æ¢ã€‚æœ€ç»ˆçš„ä»£ç å¦‚ä¸‹:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">const HtmlReplaceWebpackPlugin = require('html-replace-webpack-plugin')</div><div class="line">const tpl = &#123;</div><div class="line">  css: '<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"%s"</span>&gt;</span>',</div><div class="line">  js: '<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"%s"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>'</div><div class="line">&#125;</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  // Definition for Webpack plugins</div><div class="line">  plugin: [</div><div class="line">    // Replace html contents with string or regex patterns</div><div class="line">    new HtmlReplaceWebpackPlugin([&#123;</div><div class="line">      pattern: /(<span class="comment">&lt;!--\s*)(css|js):([\w-\/\.]+)(\s*--&gt;</span>)([\s\S]*?)(<span class="comment">&lt;!--\s*end\s*--&gt;</span>)/,</div><div class="line">      replacement: function (match, $1, type, file) &#123;</div><div class="line">        switch (type) &#123;</div><div class="line">          case 'css':</div><div class="line">          case 'js':</div><div class="line">            return tpl[type].replace('%s', file)</div><div class="line">          default:</div><div class="line">            return ''</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;])</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å…¶ä¸­å…³é”®å°±æ˜¯å†™å‡ºæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å‡ºé‚£ä¸¤æ®µæ³¨é‡Šä»£ç ã€‚æ­£åˆ™è¯­æ³•å¯ä»¥å‚è€ƒæ–‡æœ«é™„å½•äºŒï¼Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <a href="https://regex101.com/" target="_blank" rel="external">https://regex101.com/</a> è¿™ä¸ªç½‘ç«™ä¸Šç¼–å†™æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<h2 id="æ’°å†™æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ’°å†™æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ’°å†™æ­£åˆ™è¡¨è¾¾å¼"></a>æ’°å†™æ­£åˆ™è¡¨è¾¾å¼</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- js:./dist/sharedpen.min.js --&gt;</span></div><div class="line">...</div><div class="line"><span class="comment">&lt;!-- end --&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- css:./dist/SharedPen.css --&gt;</span></div><div class="line">...</div><div class="line"><span class="comment">&lt;!-- end --&gt;</span></div></pre></td></tr></table></figure>
<h3 id="åˆ†æˆä¸‰éƒ¨åˆ†å¤„ç†"><a href="#åˆ†æˆä¸‰éƒ¨åˆ†å¤„ç†" class="headerlink" title="åˆ†æˆä¸‰éƒ¨åˆ†å¤„ç†"></a>åˆ†æˆä¸‰éƒ¨åˆ†å¤„ç†</h3><p>è§‚å¯Ÿè¿™ä¸¤æ®µæ³¨é‡Šï¼Œæ¯ä¸€æ®µå¯ä»¥åˆ†æˆä¸‰éƒ¨åˆ†ï¼Œæ ¹æ®æ­£åˆ™è¯­æ³•ï¼Œå¯ä»¥å†™å‡ºå¦‚ä¸‹ä¸‰éƒ¨åˆ†çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<ul>
<li><p>èµ·å§‹éƒ¨åˆ† åŒ¹é… <code>&lt;!-- js:./dist/sharedpen.min.js --&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--\s*(css|js):[\w\-\/\.]+\s*--&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>ä¸­é—´å†…å®¹éƒ¨åˆ†</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="symbol">\s</span><span class="symbol">\S</span>]*</div></pre></td></tr></table></figure>
</li>
<li><p>ç»“æŸéƒ¨åˆ† åŒ¹é… <code>&lt;!-- end --&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--\s*end\s*--&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å­è¡¨è¾¾å¼"><a href="#å­è¡¨è¾¾å¼" class="headerlink" title="å­è¡¨è¾¾å¼"></a>å­è¡¨è¾¾å¼</h3><p>åœ¨ç¬¬ä¸€éƒ¨åˆ† <code>&lt;!-- js:./dist/sharedpen.min.js --&gt;</code>ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ­£åˆ™è¡¨è¾¾å¼èƒ½åŒ¹é…å‡ºï¼šæ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶è·¯å¾„</p>
<blockquote>
<p>æ³¨æ„åˆ°<br>1ã€<code>(pattern)</code> <strong>åŒ¹é… pattern å¹¶æ•è·è¯¥åŒ¹é…çš„å­è¡¨è¾¾å¼ã€‚å¯ä»¥ä½¿ç”¨ $1â€¦$9 å±æ€§ä»ç»“æœâ€œåŒ¹é…â€é›†åˆä¸­æ£€ç´¢æ•è·çš„åŒ¹é…ã€‚</strong><br>2ã€åœ¨ JavaScript ä¸­ <code>$1â€¦$9</code> å±æ€§æ˜¯åŒ…å«æ‹¬å·å­ä¸²åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼çš„é™æ€åªè¯»å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>RegExp.$1, ..., RegExp.$9</code> æ¥ä½¿ç”¨å®ƒä»¬</p>
</blockquote>
<p>é€šè¿‡æ‹¬å·å†™å‡ºå­è¡¨è¾¾å¼ï¼ŒåŒ¹é…å‡ºæˆ‘ä»¬éœ€è¦çš„å†…å®¹<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--\s*(css|js):([\w\-\/\.]+)\s*--&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var regexp = new RegExp(/<span class="comment">&lt;!--\s*(css|js):([\w\-\/\.]+)\s*--&gt;</span>/)</div><div class="line">var str = '<span class="comment">&lt;!-- js:./dist/sharedpen.min.js --&gt;</span>'</div><div class="line">regexp.exec(str)</div><div class="line">console.log(RegExp.$1) // "js"</div><div class="line">console.log(RegExp.$2) // "./dist/sharedpen.min.js"</div></pre></td></tr></table></figure>
<h3 id="æœ€é•¿åŒ¹é…ï¼ˆè´ªå©ªåŒ¹é…ï¼‰å’Œæœ€çŸ­åŒ¹é…ï¼ˆæ‡’æƒ°åŒ¹é…ï¼‰"><a href="#æœ€é•¿åŒ¹é…ï¼ˆè´ªå©ªåŒ¹é…ï¼‰å’Œæœ€çŸ­åŒ¹é…ï¼ˆæ‡’æƒ°åŒ¹é…ï¼‰" class="headerlink" title="æœ€é•¿åŒ¹é…ï¼ˆè´ªå©ªåŒ¹é…ï¼‰å’Œæœ€çŸ­åŒ¹é…ï¼ˆæ‡’æƒ°åŒ¹é…ï¼‰"></a>æœ€é•¿åŒ¹é…ï¼ˆè´ªå©ªåŒ¹é…ï¼‰å’Œæœ€çŸ­åŒ¹é…ï¼ˆæ‡’æƒ°åŒ¹é…ï¼‰</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„æ­£åˆ™è¡¨è¾¾å¼ä¸ºï¼š<code>&lt;!--\s*(css|js):([\w\-\/\.]+)\s*--&gt;[\s\S]*&lt;!--\s*end\s*--&gt;</code>ï¼Œä½†æ˜¯ä¼šå‘ç°ï¼Œæ­¤æ—¶åŒ¹é…æœ‰ç‚¹é—®é¢˜ï¼š<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/51E1FD12-5B3D-4600-8EEE-C00AE4485F46.png" alt=""></p>
<p>æˆ‘ä»¬æ˜¯å¸Œæœ›é‡åˆ°ç¬¬ä¸€ä¸ª <code>&lt;!-- end --&gt;</code> å°±ç»“æŸåŒ¹é…ï¼Œè€Œç°åœ¨å´æ˜¯åŒ¹é…åˆ°æœ€åä¸€ä¸ªã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦äº†è§£æ­£åˆ™è¡¨è¾¾å¼çš„æœ€é•¿åŒ¹é…ï¼ˆè´ªå©ªåŒ¹é…ï¼‰å’Œæœ€çŸ­åŒ¹é…ï¼ˆæ‡’æƒ°åŒ¹é…ï¼‰<br>ä¾‹å­ä¸€ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> str = <span class="string">'abc123def'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> regexp1 = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/abc[\d]*/</span>) <span class="comment">// æœ€é•¿åŒ¹é…</span></div><div class="line"><span class="keyword">var</span> regexp2 = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/abc[\d]*?/</span>) <span class="comment">// æœ€çŸ­åŒ¹é…</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(regexp1.exec(str)[<span class="number">0</span>]) <span class="comment">// "abc123"</span></div><div class="line"><span class="built_in">console</span>.log(regexp2.exec(str)[<span class="number">0</span>]) <span class="comment">// "abc"</span></div></pre></td></tr></table></figure></p>
<p>ä¾‹å­äºŒï¼š<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> str = '<span class="comment">/*** æ³¨é‡Š1 ****/</span> <span class="keyword">var</span> name = <span class="string">"aty"</span>; <span class="comment">/***æ³¨é‡Š2****/</span>'</div><div class="line"><span class="keyword">var</span> regexp = <span class="keyword">new</span> <span class="type">RegExp</span>(/\/\*([\s\<span class="type">S</span>]*?)\*\<span class="comment">//)</span></div><div class="line"></div><div class="line">console.log(regexp.exec(str)[<span class="number">0</span>]) <span class="comment">// ä½¿ç”¨ `*?` å°±å¯ä»¥æ­£ç¡®çš„åŒ¹é…åˆ°æ³¨é‡Šå†…å®¹</span></div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œæœ€é•¿å’Œæœ€çŸ­åŒ¹é…çš„å·®åˆ«æ˜¯ï¼Œå‰è€…åŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦ï¼Œåè€…åŒ¹é…å°½å¯èƒ½å°‘çš„å­—ç¬¦ã€‚ä¸€èˆ¬æ­£åˆ™è¡¨è¾¾å¼å¼•æ“é»˜è®¤éƒ½æ˜¯æœ€é•¿åŒ¹é…ï¼Œ<strong>å¦‚æœæƒ³è¦æœ€çŸ­åŒ¹é…ï¼Œé‚£ä¹ˆéœ€è¦åœ¨æ•°é‡ä¿®é¥°ç¬¦(ä¾‹å¦‚ï¼š<code>*</code>ï¼Œ<code>+</code>)åé¢æ·»åŠ ä¸€ä¸ª <code>?</code> å˜æˆæœ€çŸ­åŒ¹é…</strong></p>
<p>æ‰€ä»¥æ­¤æ—¶æ‰§è¡Œå¯¹æˆ‘ä»¬çš„æ­£åˆ™è¡¨è¾¾å¼å¢åŠ ä¸€ä¸ª <code>?</code> å³å¯<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--\s*(css|js):([\w\-\/\.]+)\s*--&gt;</span>[\s\S]*?<span class="comment">&lt;!--\s*end\s*--&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="å…¨å±€åŒ¹é…"><a href="#å…¨å±€åŒ¹é…" class="headerlink" title="å…¨å±€åŒ¹é…"></a>å…¨å±€åŒ¹é…</h3><p>JavaScript ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœ‰ä¸¤ç§æ–¹å¼ï¼š<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># ç›´æ¥é‡è¯­æ³•</span></div><div class="line">/pattern/attributes</div><div class="line"></div><div class="line"><span class="meta"># åˆ›å»º RegExp å¯¹è±¡çš„è¯­æ³•</span></div><div class="line"><span class="keyword">new</span> RegExp(pattern, attributes);</div></pre></td></tr></table></figure></p>
<p><strong>å‚æ•°:</strong></p>
<ul>
<li>pattern æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŒ‡å®šäº†æ­£åˆ™è¡¨è¾¾å¼</li>
<li>attributes æ˜¯ä¸€ä¸ªå¯é€‰çš„å­—ç¬¦ä¸²ï¼ŒåŒ…å«å±æ€§: <strong>â€œgâ€ã€â€iâ€ å’Œ â€œmâ€ï¼Œåˆ†åˆ«ç”¨äºæŒ‡å®šå…¨å±€åŒ¹é…ã€åŒºåˆ†å¤§å°å†™çš„åŒ¹é…å’Œå¤šè¡ŒåŒ¹é…</strong>ã€‚</li>
</ul>
<p>å…¶ä¸­ <code>g</code> æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼å…¨å±€åŒ¹é…ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆç‰¹æ®Šä¹‹å¤„å‘¢ï¼Ÿ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> str = <span class="string">'abc123def'</span></div><div class="line"><span class="keyword">var</span> regexp = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/abc[\d]*/</span>, <span class="string">'g'</span>)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(regexp.test(str)) <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(regexp.test(str)) <span class="comment">// false</span></div><div class="line"><span class="built_in">console</span>.log(regexp.test(str)) <span class="comment">// true</span></div></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ç¬¬äºŒæ¬¡ console è¾“å‡ºä¸ºå•¥æ˜¯ <code>false</code> å‘¢ï¼Ÿ</p>
<ul>
<li>åœ¨å…¨å±€åŒ¹é…æ¨¡å¼ä¸‹å¯ä»¥å¯¹æŒ‡å®šè¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²<strong>æ‰§è¡Œå¤šæ¬¡åŒ¹é…</strong>ã€‚</li>
<li>æ¯æ¬¡åŒ¹é…ä½¿ç”¨å½“å‰æ­£åˆ™å¯¹è±¡çš„ <code>lastIndex</code> å±æ€§çš„å€¼ä½œä¸ºåœ¨ç›®æ ‡å­—ç¬¦ä¸²ä¸­å¼€å§‹æŸ¥æ‰¾çš„èµ·å§‹ä½ç½®ã€‚</li>
<li><code>lastIndex</code> å±æ€§çš„åˆå§‹å€¼ä¸º 0ï¼Œæ‰¾åˆ°åŒ¹é…çš„é¡¹åï¼Œ<code>lastIndex</code> çš„å€¼è¢«é‡ç½®ä¸ºåŒ¹é…å†…å®¹çš„ä¸‹ä¸€ä¸ªå­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ç´¢å¼•ï¼Œç”¨æ¥æ ‡è¯†ä¸‹æ¬¡æ‰§è¡ŒåŒ¹é…æ—¶å¼€å§‹æŸ¥æ‰¾çš„ä½ç½®ã€‚</li>
<li>å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„é¡¹ï¼Œ<code>lastIndex</code> çš„å€¼ä¼šè¢«è®¾ç½®ä¸º 0ã€‚</li>
<li>æ²¡æœ‰è®¾ç½®æ­£åˆ™å¯¹è±¡çš„å…¨å±€åŒ¹é…æ ‡å¿—æ—¶ <code>lastIndex</code> å±æ€§çš„å€¼å§‹ç»ˆä¸º0ï¼Œæ¯æ¬¡æ‰§è¡ŒåŒ¹é…ä»…æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…çš„é¡¹ã€‚</li>
</ul>
<p>å¦‚æœæˆ‘ä»¬æ¯æ¬¡æ‰§è¡Œ <code>regexp.test(str)</code> æ–¹æ³•åï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ­£åˆ™å¯¹è±¡çš„ lastIndex å±æ€§çš„å€¼ï¼Œå°±æ¸…æ¥šäº†ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> str = <span class="string">'abc123def'</span></div><div class="line"><span class="keyword">var</span> regexp = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/abc[\d]*/</span>, <span class="string">'g'</span>)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(regexp.test(str)) <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(regexp.lastIndex) <span class="comment">// 6</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(regexp.test(str)) <span class="comment">// false</span></div><div class="line"><span class="built_in">console</span>.log(regexp.lastIndex) <span class="comment">// 0</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(regexp.test(str)) <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(regexp.lastIndex) <span class="comment">// 6</span></div></pre></td></tr></table></figure></p>
<p>ç¬¬ä¸€æ¬¡æ‰§è¡Œ <code>regexp.test(str)</code> å‰ï¼Œæ­£åˆ™å¯¹è±¡çš„ <code>lastIndex</code> å±æ€§å€¼ä¸º 0ï¼ŒåŒ¹é…åˆ°å­—ç¬¦ <code>abc123</code> åï¼Œæ­£åˆ™å¯¹è±¡çš„ <code>lastIndex</code> å±æ€§å€¼å˜æˆ 6ï¼›<br>åœ¨ç¬¬äºŒæ¬¡æ‰§è¡Œ <code>regexp.test(str)</code> æ—¶ï¼Œä»ç¬¬ 7 ä¸ªå­—ç¬¦(ä»0å¼€å§‹)å¼€å§‹è¿›è¡ŒåŒ¹é…ï¼Œå½“ç„¶å°±åŒ¹é…å¤±è´¥å•¦ã€‚</p>
<p>ä¸‹é¢å†æ¥çœ‹çœ‹æ­£åˆ™å¯¹è±¡çš„å¦ä¸€ä¸ªæ–¹æ³• <code>exec</code> åœ¨å…¨å±€æ¨¡å¼ä¸‹çš„ä¾‹å­ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">var str = `</div><div class="line"><span class="comment">&lt;!-- js:./dist/sharedpen.min.js --&gt;</span></div><div class="line">...</div><div class="line"><span class="comment">&lt;!-- end --&gt;</span></div><div class="line"><span class="comment">&lt;!-- css:./dist/SharedPen.css --&gt;</span></div><div class="line">...</div><div class="line"><span class="comment">&lt;!-- end --&gt;</span>`</div><div class="line"></div><div class="line">var regexp = new RegExp(/<span class="comment">&lt;!--\s*(css|js):([\w\-\/\.]+)\s*--&gt;</span>[\s\S]*?<span class="comment">&lt;!--\s*end\s*--&gt;</span>/g)</div><div class="line">var matches</div><div class="line">while((matches = regexp.exec(str)) != null) &#123;</div><div class="line">  str = str.replace(matches[0], '<span class="tag">&lt;<span class="name">div</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span>')</div><div class="line">&#125;</div><div class="line">console.log(str)</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¸Œæœ›ä»£ç æ‰§è¡ŒåŒ¹é…æ›¿æ¢åï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="keyword">div</span>&gt;<span class="keyword">test</span>&lt;/<span class="keyword">div</span>&gt;</div><div class="line">&lt;<span class="keyword">div</span>&gt;<span class="keyword">test</span>&lt;/<span class="keyword">div</span>&gt;</div></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯å®é™…ä¸Šè¾“å‡ºç»“æœæ˜¯ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- css:./dist/SharedPen.css --&gt;</span></div><div class="line">...</div><div class="line"><span class="comment">&lt;!-- end --&gt;</span></div></pre></td></tr></table></figure></p>
<p>æ˜¾ç„¶æ˜¯ç¬¬äºŒæ¬¡åŒ¹é…æ›¿æ¢å‡ºé—®é¢˜äº†ã€‚æœ‰äº†å‰é¢çš„ç»éªŒï¼Œæˆ‘ä»¬å¾ˆå¿«å°±çŸ¥é“ï¼Œæ˜¯å…¨å±€æ¨¡å¼åŒ¹é…çš„é—®é¢˜ï¼Œç¬¬ä¸€æ¬¡å…¨å±€åŒ¹é…åï¼Œæ­£åˆ™å¯¹è±¡çš„ <code>lastIndex</code> å±æ€§å€¼å‘ç”Ÿå˜åŒ–ï¼Œå½±å“äº†ç¬¬äºŒæ¬¡æ­£åˆ™åŒ¹é…ï¼Œæˆ‘ä»¬åªéœ€å»æ‰å…¨å±€åŒ¹é… <code>g</code> å³å¯è§£å†³é—®é¢˜ã€‚</p>
<p>ğŸ— è‡³æ­¤ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/(<span class="comment">&lt;!--\s*)(css|js):([\w-\/\.]+)(\s*--&gt;</span>)([\s\S]*?)(<span class="comment">&lt;!--\s*end\s*--&gt;</span>)/</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="é™„å½•ä¸€-å¸¸ç”¨æ–¹æ³•"><a href="#é™„å½•ä¸€-å¸¸ç”¨æ–¹æ³•" class="headerlink" title="[é™„å½•ä¸€] å¸¸ç”¨æ–¹æ³•"></a>[é™„å½•ä¸€] å¸¸ç”¨æ–¹æ³•</h2><p>RegExp å¯¹è±¡æ–¹æ³•ï¼š<code>test</code>, <code>exec</code></p>
<table>
<thead>
<tr>
<th>ç”¨æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>RegExpObj.test(string)</code></td>
<td>ç”¨äºæ£€æµ‹ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æŸä¸ªæ¨¡å¼</td>
<td>åŒ¹é…è¿”å› trueï¼Œå¦åˆ™è¿”å› false</td>
</tr>
<tr>
<td><code>RegExpObj.exec(string)</code></td>
<td>ç”¨äºæ£€ç´¢å­—ç¬¦ä¸²ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…</td>
<td>è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­å­˜æ”¾åŒ¹é…çš„ç»“æœã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…ï¼Œåˆ™è¿”å›å€¼ä¸º null</td>
</tr>
</tbody>
</table>
<p>String å¯¹è±¡æ–¹æ³•ï¼š<code>match</code>, <code>replace</code></p>
<table>
<thead>
<tr>
<th>ç”¨æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stringObj.match( regexp/substr )</code></td>
<td>åœ¨å­—ç¬¦ä¸²å†…æ£€ç´¢æŒ‡å®šçš„å€¼ï¼Œæˆ–æ‰¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…</td>
<td>è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­å­˜æ”¾åŒ¹é…çš„ç»“æœã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…ï¼Œåˆ™è¿”å›å€¼ä¸º null</td>
</tr>
<tr>
<td><code>stringObj.replace( regexp/substr, replacement )</code></td>
<td>æ ¹æ® regexp/substr è¿›è¡Œæ­£åˆ™åŒ¹é…,æŠŠåŒ¹é…ç»“æœæ›¿æ¢ä¸º replacement</td>
<td>ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²</td>
</tr>
</tbody>
</table>
<h2 id="é™„å½•äºŒ-æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•"><a href="#é™„å½•äºŒ-æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•" class="headerlink" title="[é™„å½•äºŒ] æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•"></a>[é™„å½•äºŒ] æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•</h2><p>å­¦ä¹ æ­£åˆ™è¡¨è¾¾å¼ï¼Œé¦–å…ˆè¦äº†è§£å…¶è¯­æ³•è§„åˆ™ï¼Œä»¥ä¸‹è§„åˆ™æ¥è‡ªï¼š<strong>MSDN æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•:</strong> <a href="https://msdn.microsoft.com/zh-cn/library/ae5bf541(v=vs.90).aspx" target="_blank" rel="external">https://msdn.microsoft.com/zh-cn/library/ae5bf541(v=vs.90).aspx</a></p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\</code></td>
<td><strong>å°†ä¸‹ä¸€å­—ç¬¦æ ‡è®°ä¸ºç‰¹æ®Šå­—ç¬¦ã€æ–‡æœ¬ã€åå‘å¼•ç”¨æˆ–å…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚</strong>ä¾‹å¦‚ï¼Œâ€œnâ€ åŒ¹é…å­—ç¬¦ â€œnâ€ã€‚â€œ\nâ€ åŒ¹é…æ¢è¡Œç¬¦ã€‚åºåˆ— â€œ\â€ åŒ¹é… â€œ\â€ï¼Œâ€œ(â€ åŒ¹é… â€œ(â€ã€‚</td>
</tr>
<tr>
<td><code>^</code></td>
<td><strong>åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²å¼€å§‹çš„ä½ç½®ã€‚</strong>å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ^ è¿˜ä¼šä¸ â€œ\nâ€ æˆ– â€œ\râ€ ä¹‹åçš„ä½ç½®åŒ¹é…ã€‚</td>
</tr>
<tr>
<td><code>$</code></td>
<td><strong>åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²ç»“å°¾çš„ä½ç½®ã€‚</strong>å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ$ è¿˜ä¼šä¸ â€œ\nâ€ æˆ– â€œ\râ€ ä¹‹å‰çš„ä½ç½®åŒ¹é…ã€‚</td>
</tr>
<tr>
<td><code>*</code></td>
<td><strong>é›¶æ¬¡æˆ–å¤šæ¬¡åŒ¹é…å‰é¢çš„å­—ç¬¦æˆ–å­è¡¨è¾¾å¼ã€‚</strong>ä¾‹å¦‚ï¼Œzo<em> åŒ¹é… â€œzâ€ å’Œ â€œzooâ€ã€‚</em> ç­‰æ•ˆäº {0,}ã€‚</td>
</tr>
<tr>
<td><code>+</code></td>
<td><strong>ä¸€æ¬¡æˆ–å¤šæ¬¡åŒ¹é…å‰é¢çš„å­—ç¬¦æˆ–å­è¡¨è¾¾å¼ã€‚</strong>ä¾‹å¦‚ï¼Œâ€œzo+â€ ä¸ â€œzoâ€ å’Œ â€œzooâ€ åŒ¹é…ï¼Œä½†ä¸ â€œzâ€ ä¸åŒ¹é…ã€‚+ ç­‰æ•ˆäº {1,}ã€‚</td>
</tr>
<tr>
<td><code>?</code></td>
<td><strong>é›¶æ¬¡æˆ–ä¸€æ¬¡åŒ¹é…å‰é¢çš„å­—ç¬¦æˆ–å­è¡¨è¾¾å¼ã€‚</strong>ä¾‹å¦‚ï¼Œâ€œdo(es)?â€ åŒ¹é… â€œdoâ€ æˆ– â€œdoesâ€ ä¸­çš„ â€œdoâ€ã€‚? ç­‰æ•ˆäº {0,1}ã€‚</td>
</tr>
<tr>
<td><code>{n}</code></td>
<td><strong>n æ˜¯éè´Ÿæ•´æ•°ã€‚æ­£å¥½åŒ¹é… n æ¬¡ã€‚</strong>ä¾‹å¦‚ï¼Œâ€œo{2}â€ ä¸ â€œBobâ€ ä¸­çš„ â€œoâ€ ä¸åŒ¹é…ï¼Œä½†ä¸ â€œfoodâ€ ä¸­çš„ä¸¤ä¸ªâ€œoâ€åŒ¹é…ã€‚</td>
</tr>
<tr>
<td><code>{n,}</code></td>
<td><strong>n æ˜¯éè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é… n æ¬¡ã€‚</strong>ä¾‹å¦‚ï¼Œâ€œo{2,}â€ ä¸åŒ¹é… â€œBobâ€ ä¸­çš„ â€œoâ€ï¼Œè€ŒåŒ¹é… â€œfooooodâ€ ä¸­çš„æ‰€æœ‰ oã€‚â€œo{1,}â€ ç­‰æ•ˆäº â€œo+â€ã€‚â€œo{0,}â€ ç­‰æ•ˆäº â€œo*â€ã€‚</td>
</tr>
<tr>
<td><code>{n,m}</code></td>
<td>m å’Œ n æ˜¯éè´Ÿæ•´æ•°ï¼Œå…¶ä¸­ n &lt;= mã€‚<strong>åŒ¹é…è‡³å°‘ n æ¬¡ï¼Œè‡³å¤š m æ¬¡ã€‚</strong>ä¾‹å¦‚ï¼Œâ€œo{1,3}â€ åŒ¹é… â€œfoooooodâ€ ä¸­çš„å¤´ä¸‰ä¸ª oã€‚â€™o{0,1}â€™ ç­‰æ•ˆäº â€˜o?â€™ã€‚æ³¨æ„ï¼šæ‚¨ä¸èƒ½å°†ç©ºæ ¼æ’å…¥é€—å·å’Œæ•°å­—ä¹‹é—´ã€‚</td>
</tr>
<tr>
<td><code>?</code></td>
<td><strong>å½“æ­¤å­—ç¬¦ç´§éšä»»ä½•å…¶ä»–é™å®šç¬¦ï¼ˆ*ã€+ã€?ã€{n}ã€{n,}ã€{n,m}ï¼‰ä¹‹åæ—¶ï¼ŒåŒ¹é…æ¨¡å¼æ˜¯â€œéè´ªå¿ƒçš„â€ã€‚â€œéè´ªå¿ƒçš„â€æ¨¡å¼åŒ¹é…æœç´¢åˆ°çš„ã€å°½å¯èƒ½çŸ­çš„å­—ç¬¦ä¸²ï¼Œè€Œé»˜è®¤çš„â€œè´ªå¿ƒçš„â€æ¨¡å¼åŒ¹é…æœç´¢åˆ°çš„ã€å°½å¯èƒ½é•¿çš„å­—ç¬¦ä¸²ã€‚</strong>ä¾‹å¦‚ï¼Œåœ¨å­—ç¬¦ä¸² â€œooooâ€ ä¸­ï¼Œâ€œo+?â€ åªåŒ¹é…å•ä¸ª â€œoâ€ï¼Œè€Œ â€œo+â€ åŒ¹é…æ‰€æœ‰ â€œoâ€ã€‚</td>
</tr>
<tr>
<td><code>.</code></td>
<td><strong>åŒ¹é…é™¤â€œ\nâ€ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚</strong>è‹¥è¦åŒ¹é…åŒ…æ‹¬ â€œ\nâ€ åœ¨å†…çš„ä»»æ„å­—ç¬¦ï¼Œè¯·ä½¿ç”¨è¯¸å¦‚ â€œ[\s\S]â€ ä¹‹ç±»çš„æ¨¡å¼ã€‚</td>
</tr>
<tr>
<td><code>(pattern)</code></td>
<td><strong>åŒ¹é… pattern å¹¶æ•è·è¯¥åŒ¹é…çš„å­è¡¨è¾¾å¼ã€‚å¯ä»¥ä½¿ç”¨ $1â€¦$9 å±æ€§ä»ç»“æœâ€œåŒ¹é…â€é›†åˆä¸­æ£€ç´¢æ•è·çš„åŒ¹é…ã€‚</strong>è‹¥è¦åŒ¹é…æ‹¬å·å­—ç¬¦ ( )ï¼Œè¯·ä½¿ç”¨â€œ(â€æˆ–è€…â€œ)â€ã€‚</td>
</tr>
<tr>
<td><code>(?:pattern)</code></td>
<td>åŒ¹é… pattern ä½†ä¸æ•è·è¯¥åŒ¹é…çš„å­è¡¨è¾¾å¼ï¼Œå³å®ƒæ˜¯ä¸€ä¸ªéæ•è·åŒ¹é…ï¼Œä¸å­˜å‚¨ä¾›ä»¥åä½¿ç”¨çš„åŒ¹é…ã€‚è¿™å¯¹äºç”¨ â€œorâ€ å­—ç¬¦ <code>(â”‚)</code> ç»„åˆæ¨¡å¼éƒ¨ä»¶çš„æƒ…å†µå¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ<code>industr(?:yâ”‚ies)</code> æ˜¯æ¯” <code>industryâ”‚industries</code> æ›´ç»æµçš„è¡¨è¾¾å¼ã€‚</td>
</tr>
<tr>
<td><code>(?=pattern)</code></td>
<td>æ‰§è¡Œæ­£å‘é¢„æµ‹å…ˆè¡Œæœç´¢çš„å­è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼åŒ¹é…å¤„äºåŒ¹é… pattern çš„å­—ç¬¦ä¸²çš„èµ·å§‹ç‚¹çš„å­—ç¬¦ä¸²ã€‚å®ƒæ˜¯ä¸€ä¸ªéæ•è·åŒ¹é…ï¼Œå³ä¸èƒ½æ•è·ä¾›ä»¥åä½¿ç”¨çš„åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œâ€™Windows (?=95â”‚98â”‚NTâ”‚2000)â€™ åŒ¹é…â€œWindows 2000â€ä¸­çš„â€œWindowsâ€ï¼Œä½†ä¸åŒ¹é…â€œWindows 3.1â€ä¸­çš„â€œWindowsâ€ã€‚é¢„æµ‹å…ˆè¡Œä¸å ç”¨å­—ç¬¦ï¼Œå³å‘ç”ŸåŒ¹é…åï¼Œä¸‹ä¸€åŒ¹é…çš„æœç´¢ç´§éšä¸Šä¸€åŒ¹é…ä¹‹åï¼Œè€Œä¸æ˜¯åœ¨ç»„æˆé¢„æµ‹å…ˆè¡Œçš„å­—ç¬¦åã€‚</td>
</tr>
<tr>
<td><code>(?!pattern)</code></td>
<td>æ‰§è¡Œåå‘é¢„æµ‹å…ˆè¡Œæœç´¢çš„å­è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼åŒ¹é…ä¸å¤„äºåŒ¹é… pattern çš„å­—ç¬¦ä¸²çš„èµ·å§‹ç‚¹çš„æœç´¢å­—ç¬¦ä¸²ã€‚å®ƒæ˜¯ä¸€ä¸ªéæ•è·åŒ¹é…ï¼Œå³ä¸èƒ½æ•è·ä¾›ä»¥åä½¿ç”¨çš„åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œâ€™Windows (?!95â”‚98â”‚NTâ”‚2000)â€™ åŒ¹é…â€œWindows 3.1â€ä¸­çš„ â€œWindowsâ€ï¼Œä½†ä¸åŒ¹é…â€œWindows 2000â€ä¸­çš„â€œWindowsâ€ã€‚é¢„æµ‹å…ˆè¡Œä¸å ç”¨å­—ç¬¦ï¼Œå³å‘ç”ŸåŒ¹é…åï¼Œä¸‹ä¸€åŒ¹é…çš„æœç´¢ç´§éšä¸Šä¸€åŒ¹é…ä¹‹åï¼Œè€Œä¸æ˜¯åœ¨ç»„æˆé¢„æµ‹å…ˆè¡Œçš„å­—ç¬¦åã€‚</td>
</tr>
<tr>
<td><code>xâ”‚y</code></td>
<td><strong>åŒ¹é… x æˆ– yã€‚</strong>ä¾‹å¦‚ï¼Œâ€™zâ”‚foodâ€™ åŒ¹é…â€œzâ€æˆ–â€œfoodâ€ã€‚â€™(zâ”‚f)oodâ€™ åŒ¹é…â€œzoodâ€æˆ–â€œfoodâ€ã€‚</td>
</tr>
<tr>
<td><code>[xyz]</code></td>
<td>å­—ç¬¦é›†ã€‚åŒ¹é…åŒ…å«çš„ä»»ä¸€å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œâ€œ[abc]â€åŒ¹é…â€œplainâ€ä¸­çš„â€œaâ€ã€‚</td>
</tr>
<tr>
<td><code>[^xyz]</code></td>
<td>åå‘å­—ç¬¦é›†ã€‚åŒ¹é…æœªåŒ…å«çš„ä»»ä½•å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œâ€œ[^abc]â€åŒ¹é…â€œplainâ€ä¸­çš„â€œpâ€ã€‚</td>
</tr>
<tr>
<td><code>[a-z]</code></td>
<td><strong>å­—ç¬¦èŒƒå›´ã€‚</strong>åŒ¹é…æŒ‡å®šèŒƒå›´å†…çš„ä»»ä½•å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œâ€œ[a-z]â€åŒ¹é…â€œaâ€åˆ°â€œzâ€èŒƒå›´å†…çš„ä»»ä½•å°å†™å­—æ¯ã€‚</td>
</tr>
<tr>
<td><code>[^a-z]</code></td>
<td><strong>åå‘èŒƒå›´å­—ç¬¦ã€‚</strong>åŒ¹é…ä¸åœ¨æŒ‡å®šçš„èŒƒå›´å†…çš„ä»»ä½•å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œâ€œ[^a-z]â€åŒ¹é…ä»»ä½•ä¸åœ¨â€œaâ€åˆ°â€œzâ€èŒƒå›´å†…çš„ä»»ä½•å­—ç¬¦ã€‚</td>
</tr>
<tr>
<td><code>\b</code></td>
<td>åŒ¹é…ä¸€ä¸ªå­—è¾¹ç•Œï¼Œå³å­—ä¸ç©ºæ ¼é—´çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œâ€œer\bâ€åŒ¹é…â€œneverâ€ä¸­çš„â€œerâ€ï¼Œä½†ä¸åŒ¹é…â€œverbâ€ä¸­çš„â€œerâ€ã€‚</td>
</tr>
<tr>
<td><code>\B</code></td>
<td>éå­—è¾¹ç•ŒåŒ¹é…ã€‚â€œer\Bâ€åŒ¹é…â€œverbâ€ä¸­çš„â€œerâ€ï¼Œä½†ä¸åŒ¹é…â€œneverâ€ä¸­çš„â€œerâ€ã€‚</td>
</tr>
<tr>
<td><code>\cx</code></td>
<td>åŒ¹é… x æŒ‡ç¤ºçš„æ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ\cM åŒ¹é… Control-M æˆ–å›è½¦ç¬¦ã€‚x çš„å€¼å¿…é¡»åœ¨ A-Z æˆ– a-z ä¹‹é—´ã€‚å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œåˆ™å‡å®š c å°±æ˜¯â€œcâ€å­—ç¬¦æœ¬èº«ã€‚</td>
</tr>
<tr>
<td><code>\d</code></td>
<td><strong>æ•°å­—å­—ç¬¦åŒ¹é…ã€‚</strong>ç­‰æ•ˆäº [0-9]ã€‚</td>
</tr>
<tr>
<td><code>\D</code></td>
<td><strong>éæ•°å­—å­—ç¬¦åŒ¹é…ã€‚</strong>ç­‰æ•ˆäº [^0-9]ã€‚</td>
</tr>
<tr>
<td><code>\f</code></td>
<td>æ¢é¡µç¬¦åŒ¹é…ã€‚ç­‰æ•ˆäº \x0c å’Œ \cLã€‚</td>
</tr>
<tr>
<td><code>\n</code></td>
<td>æ¢è¡Œç¬¦åŒ¹é…ã€‚ç­‰æ•ˆäº \x0a å’Œ \cJã€‚</td>
</tr>
<tr>
<td><code>\r</code></td>
<td>åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚ç­‰æ•ˆäº \x0d å’Œ \cMã€‚</td>
</tr>
<tr>
<td><code>\s</code></td>
<td><strong>åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ã€‚</strong>ä¸ [ \f\n\r\t\v] ç­‰æ•ˆã€‚</td>
</tr>
<tr>
<td><code>\S</code></td>
<td><strong>åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ã€‚</strong>ä¸ [^ \f\n\r\t\v] ç­‰æ•ˆã€‚</td>
</tr>
<tr>
<td><code>\t</code></td>
<td>åˆ¶è¡¨ç¬¦åŒ¹é…ã€‚ä¸ \x09 å’Œ \cI ç­‰æ•ˆã€‚</td>
</tr>
<tr>
<td><code>\v</code></td>
<td>å‚ç›´åˆ¶è¡¨ç¬¦åŒ¹é…ã€‚ä¸ \x0b å’Œ \cK ç­‰æ•ˆã€‚</td>
</tr>
<tr>
<td><code>\w</code></td>
<td>åŒ¹é…ä»»ä½•å­—ç±»å­—ç¬¦ï¼ŒåŒ…æ‹¬ä¸‹åˆ’çº¿ã€‚ä¸â€œ[A-Za-z0-9_]â€ç­‰æ•ˆã€‚</td>
</tr>
<tr>
<td><code>\W</code></td>
<td>ä¸ä»»ä½•éå•è¯å­—ç¬¦åŒ¹é…ã€‚ä¸â€œ[^A-Za-z0-9_]â€ç­‰æ•ˆã€‚</td>
</tr>
<tr>
<td><code>\xn</code></td>
<td>åŒ¹é… nï¼Œæ­¤å¤„çš„ n æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶è½¬ä¹‰ç ã€‚åå…­è¿›åˆ¶è½¬ä¹‰ç å¿…é¡»æ­£å¥½æ˜¯ä¸¤ä½æ•°é•¿ã€‚ä¾‹å¦‚ï¼Œâ€œ\x41â€åŒ¹é…â€œAâ€ã€‚â€œ\x041â€ä¸â€œ\x04â€&amp;â€œ1â€ç­‰æ•ˆã€‚å…è®¸åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨ ASCII ä»£ç ã€‚</td>
</tr>
<tr>
<td><code>\num</code></td>
<td>åŒ¹é… numï¼Œæ­¤å¤„çš„ num æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚åˆ°æ•è·åŒ¹é…çš„åå‘å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œâ€œ(.)\1â€åŒ¹é…ä¸¤ä¸ªè¿ç»­çš„ç›¸åŒå­—ç¬¦ã€‚</td>
</tr>
<tr>
<td><code>\n</code></td>
<td>æ ‡è¯†ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰ç æˆ–åå‘å¼•ç”¨ã€‚å¦‚æœ \n å‰é¢è‡³å°‘æœ‰ n ä¸ªæ•è·å­è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆ n æ˜¯åå‘å¼•ç”¨ã€‚å¦åˆ™ï¼Œå¦‚æœ n æ˜¯å…«è¿›åˆ¶æ•° (0-7)ï¼Œé‚£ä¹ˆ n æ˜¯å…«è¿›åˆ¶è½¬ä¹‰ç ã€‚</td>
</tr>
<tr>
<td><code>\nm</code></td>
<td>æ ‡è¯†ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰ç æˆ–åå‘å¼•ç”¨ã€‚å¦‚æœ \nm å‰é¢è‡³å°‘æœ‰ nm ä¸ªæ•è·å­è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆ nm æ˜¯åå‘å¼•ç”¨ã€‚å¦‚æœ \nm å‰é¢è‡³å°‘æœ‰ n ä¸ªæ•è·ï¼Œåˆ™ n æ˜¯åå‘å¼•ç”¨ï¼Œåé¢è·Ÿæœ‰å­—ç¬¦ mã€‚å¦‚æœä¸¤ç§å‰é¢çš„æƒ…å†µéƒ½ä¸å­˜åœ¨ï¼Œåˆ™ \nm åŒ¹é…å…«è¿›åˆ¶å€¼ nmï¼Œå…¶ä¸­ n å’Œ m æ˜¯å…«è¿›åˆ¶æ•°å­— (0-7)ã€‚</td>
</tr>
<tr>
<td><code>\nml</code></td>
<td>å½“ n æ˜¯å…«è¿›åˆ¶æ•° (0-3)ï¼Œm å’Œ l æ˜¯å…«è¿›åˆ¶æ•° (0-7) æ—¶ï¼ŒåŒ¹é…å…«è¿›åˆ¶è½¬ä¹‰ç  nmlã€‚</td>
</tr>
<tr>
<td><code>\un</code></td>
<td>åŒ¹é… nï¼Œå…¶ä¸­ n æ˜¯ä»¥å››ä½åå…­è¿›åˆ¶æ•°è¡¨ç¤ºçš„ Unicode å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ\u00A9 åŒ¹é…ç‰ˆæƒç¬¦å· (Â©)ã€‚</td>
</tr>
</tbody>
</table>
<p>æ­£åˆ™è¡¨è¾¾å¼ä»å·¦å¾€å³è¿›è¡Œè®¡ç®—ï¼Œè¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é¡ºåºå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>è¿ç®—ç¬¦</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\</code></td>
<td>è½¬ä¹‰ç¬¦</td>
</tr>
<tr>
<td><code>(), (?:), (?=), []</code></td>
<td>æ‹¬å·å’Œä¸­æ‹¬å·</td>
</tr>
<tr>
<td><code>*, +, ?, {n}, {n,}, {n,m}</code></td>
<td>é™å®šç¬¦</td>
</tr>
<tr>
<td><code>^, $, \ ä»»ä½•å…ƒå­—ç¬¦ã€ä»»ä½•å­—ç¬¦</code></td>
<td>å®šä½ç‚¹å’Œåºåˆ—</td>
</tr>
<tr>
<td>â”‚</td>
<td>æ›¿æ¢</td>
</tr>
</tbody>
</table>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="http://www.w3school.com.cn/jsref/jsref_obj_regexp.asp" target="_blank" rel="external">JavaScript RegExp å¯¹è±¡</a><br><a href="https://segmentfault.com/a/1190000003497780" target="_blank" rel="external">JS è¿›é˜¶ test, exec, match, replace</a><br><a href="https://regex101.com/" target="_blank" rel="external">æ­£åˆ™åŒ¹é…åœ¨çº¿ç½‘ç«™</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/regex.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;å¯¹æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¹¶ä¸é™Œç”Ÿã€‚åœ¨å¾ˆå¤šåœ°æ–¹éƒ½ä¼šç”¨åˆ°ï¼Œå°¤å…¶æ˜¯å­—ç¬¦ä¸²å¤„ç†ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ›´æ˜¯ä¸€æŠŠåˆ©å™¨ã€‚æœ¬æ–‡é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥å­¦ä¹ æ€»ç»“ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€äº›çŸ¥è¯†å†…å®¹ ğŸ¤“&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="æ­£åˆ™è¡¨è¾¾å¼" scheme="http://objcer.com/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Node.js ä¸­çš„ UnhandledPromiseRejectionWarning é—®é¢˜</title>
    <link href="http://objcer.com/2017/12/27/unhandled-promise-rejections-in-node-js/"/>
    <id>http://objcer.com/2017/12/27/unhandled-promise-rejections-in-node-js/</id>
    <published>2017-12-27T09:25:07.000Z</published>
    <updated>2017-12-27T09:27:02.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>é—®é¢˜å¼•å…¥ï¼š</em>ä»Šå¤©åœ¨ Gulp æ„å»ºä»»åŠ¡ä¸­å‡ºç°ä¸€ä¸ª html è§£æé”™è¯¯ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æŠ¥é”™ï¼Œä¹Ÿæ²¡æœ‰ä¸­æ–­ gulp æ„å»ºä»»åŠ¡çš„æ‰§è¡Œï¼Œè€Œæ˜¯å‡ºç° <code>UnhandledPromiseRejectionWarning</code> çš„è­¦å‘Šï¼Œæ‰€ä»¥ä¼šè¯¯ä»¥ä¸ºæ„å»ºæˆåŠŸï¼Œè¿™ç¯‡æ–‡ç« å°†å¯¹æ­¤è¿›è¡Œæ¢ç©¶å¹¶è§£å†³è¯¥é—®é¢˜ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="string">node:</span><span class="number">24866</span>) <span class="string">UnhandledPromiseRejectionWarning:</span> Unhandled promise rejection (rejection <span class="string">id:</span> <span class="number">2</span>): Error <span class="keyword">in</span> plugin <span class="string">'gulp-posthtml'</span></div><div class="line"><span class="string">Message:</span></div><div class="line">  Parse <span class="string">Error:</span> &lt;img id=<span class="string">"titleIcon"</span> <span class="class"><span class="keyword">class</span>$="&#123;</span>&#123;getStypeType_(info.stype)&#125;&#125;<span class="string">" src$="</span>&#123;&#123;getTitleIcon_(<span class="keyword">in</span></div><div class="line">  ...</div><div class="line">(<span class="string">node:</span><span class="number">24866</span>) [DEP0018] <span class="string">DeprecationWarning:</span> Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.</div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="å…³äº-Unhandled-Rejection"><a href="#å…³äº-Unhandled-Rejection" class="headerlink" title="å…³äº Unhandled Rejection"></a>å…³äº Unhandled Rejection</h2><p>ä¸€ä¸ª Promise æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„çŠ¶æ€æœºï¼Œå…¶å¯èƒ½å¤„äºè¿™ä¸‰ç§çŠ¶æ€ä¹‹ä¸€</p>
<ul>
<li><code>pending</code>ï¼šå¼‚æ­¥æ“ä½œè¿˜åœ¨æ‰§è¡Œä¸­</li>
<li><code>fulfilled</code>ï¼šå¼‚æ­¥æ“ä½œå·²ç»å®Œæˆ</li>
<li><code>rejected</code>ï¼šå¼‚æ­¥æ“ä½œæ‰§è¡Œå¤±è´¥</li>
</ul>
<blockquote>
<p>Node.js 6.6.0 added a sporadically useful bug/feature: <strong>logging unhandled promise rejections to the console by default.</strong></p>
</blockquote>
<p>åœ¨ Node.js 6.6.0 ä¸­å¢åŠ äº†ä¸€ä¸ªç‰¹æ€§ï¼šå¯¹ Promise ä¸­æœªå¤„ç†çš„ rejection é»˜è®¤ä¼šè¾“å‡º <code>UnhandledPromiseRejectionWarning</code> æç¤º</p>
<p>ä¾‹å¦‚ï¼š<code>test.js</code> ä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Promise(<span class="function"><span class="params">(resolve, reject)</span> =&gt;</span> &#123;</div><div class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="string">'woops'</span>), <span class="number">500</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><code>node test.js</code> æ‰§è¡Œï¼š<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(<span class="keyword">node</span><span class="title">:47122</span>) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: <span class="number">1</span>): error</div><div class="line">(<span class="keyword">node</span><span class="title">:47122</span>) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. <span class="keyword">In</span> the future, promise rejections that are not handled will terminate the <span class="keyword">Node</span>.<span class="title">js</span> process with a non-zero exit code</div></pre></td></tr></table></figure></p>
<p>å¦ä¸€ç§æƒ…å†µæ˜¯ç›´æ¥åœ¨ Promise ä¸­æŠ›å‡ºå¼‚å¸¸ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'exception!'</span>); &#125;);</div></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œåä¹Ÿä¼šæœ‰ <code>UnhandledPromiseRejectionWarning</code> çš„è­¦å‘Šï¼š<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(<span class="keyword">node</span><span class="title">:47657</span>) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: <span class="number">1</span>): Error: exception!</div><div class="line">(<span class="keyword">node</span><span class="title">:47657</span>) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. <span class="keyword">In</span> the future, promise rejections that are not handled will terminate the <span class="keyword">Node</span>.<span class="title">js</span> process with a non-zero exit code.</div></pre></td></tr></table></figure></p>
<p>Promise API ä¸­æœ‰ <code>.catch()</code> è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†æ•æ‰ rejection è¿›è¡Œå¤„ç†<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="string">'error'</span>), <span class="number">500</span>);</div><div class="line">&#125;)</div><div class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'caught'</span>, error))</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'exception!'</span>); &#125;)</div><div class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'caught'</span>, error.message))</div></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯æ³¨æ„ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'woops'</span>)))</div><div class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'caught'</span>, err.message); &#125;);</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªä¾‹å­ä¸­è™½ç„¶ç”¨ <code>.catch()</code> æ•æ‰å¤„ç†äº† Promise ä¸­çš„ rejectionï¼›ä½†æ˜¯æ³¨æ„åœ¨ <code>err.message</code> ä¸­çš„ <code>err</code> æ˜¯æœªå®šä¹‰çš„ï¼Œä»£ç æ‰§è¡Œæ—¶ä¼šæŠ›å‡ºé”™è¯¯ï¼Œç”±äºæ²¡æœ‰åç»­çš„å¤„ç†ï¼Œæ‰€ä»¥ä¹Ÿä¼šè¾“å‡º <code>UnhandledPromiseRejectionWarning</code> çš„è­¦å‘Š</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(<span class="keyword">node</span><span class="title">:47918</span>) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: <span class="number">2</span>): ReferenceError: err is not <span class="keyword">defined</span></div><div class="line">(<span class="keyword">node</span><span class="title">:47918</span>) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. <span class="keyword">In</span> the future, promise rejections that are not handled will terminate the <span class="keyword">Node</span>.<span class="title">js</span> process with a non-zero exit code.</div></pre></td></tr></table></figure>
<p>æ‰€ä»¥ç¨ä¸æ³¨æ„å°±ä¼šå¼•èµ· Promise ä¸­çš„ <strong>unhandled rejections</strong> ğŸ˜¨</p>
<h2 id="unhandledRejection-äº‹ä»¶"><a href="#unhandledRejection-äº‹ä»¶" class="headerlink" title="unhandledRejection äº‹ä»¶"></a><code>unhandledRejection</code> äº‹ä»¶</h2><p>åœ¨ node <code>process</code> ä¸­æœ‰ä¸€ä¸ª <code>unhandledRejection</code> äº‹ä»¶ï¼Œå½“æ²¡æœ‰å¯¹ Promise çš„ rejection è¿›è¡Œå¤„ç†å°±ä¼šæŠ›å‡ºè¿™ä¸ªäº‹ä»¶ï¼ˆè¿™åªå¯¹åŸç”Ÿ Promise æœ‰æ•ˆï¼‰</p>
<blockquote>
<p>The <strong>unhandledrejection</strong> event is fired when a JavaScript Promise is rejected but there is no rejection handler to deal with the rejection.</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">process.on(<span class="string">'unhandledRejection'</span>, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</div><div class="line">  <span class="comment">// Will print "unhandledRejection err is not defined"</span></div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'unhandledRejection'</span>, error.message);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'woops'</span>)))</div><div class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'caught'</span>, err.message); &#125;);</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶æ‰§è¡Œåï¼Œå°±æ²¡æœ‰ <code>UnhandledPromiseRejectionWarning</code> çš„è­¦å‘Šè¾“å‡ºäº†ï¼Œåªè¾“å‡ºï¼š<code>unhandledRejection err is not defined</code></p>
<p>å¦‚æœæˆ‘ä»¬ä¸æƒ³ç›‘å¬ <code>unhandledRejection</code> äº‹ä»¶ï¼Œä¹Ÿä¸æƒ³çœ‹åˆ° <code>UnhandledPromiseRejectionWarning</code> çš„è­¦å‘Šè¾“å‡ºï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> <span class="type">Promise</span>((<span class="literal">_</span>, reject) =&gt; reject(<span class="keyword">new</span> <span class="type">Error</span>(<span class="string">'woops'</span>)))</div><div class="line">.<span class="keyword">catch</span>(<span class="keyword">new</span> <span class="type">Function</span>());</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>.catch()</code> ä¸­ä¼ å…¥ä¸€ä¸ªç©ºå‡½æ•°ï¼Œå‡è£…å¯¹ rejection è¿›è¡Œäº†å¤„ç†ï¼Œè¿™æ ·ä¹Ÿæ²¡æœ‰è§¦å‘ <code>unhandledRejection</code> äº‹ä»¶</p>
<h2 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async/Await"></a>Async/Await</h2><p>å…³äº Async/Awaitï¼Œå¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a href="https://objcer.com/2017/10/11/Async-Await/">ES7 ä¸­çš„ async await</a>ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»äº† Async/Await å¹¶ä¸”å’Œ Promise è¿›è¡Œäº†å¯¹æ¯”ï¼ŒAsync/Await åœ¨å¤„ç†å¼‚æ­¥æ“ä½œä¸Šçš„ä¼˜åŠ¿æ›´æ˜æ˜¾ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// No unhandled rejection!</span></div><div class="line">  <span class="keyword">await</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'test'</span>));</div><div class="line">&#125;</div><div class="line"></div><div class="line">test();</div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// (node:54358) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: 3): Error: test</span></div><div class="line"><span class="comment">// (node:54358) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.</span></div><div class="line"></div><div class="line">test().catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error.message));</div><div class="line"><span class="comment">// è¾“å‡ºï¼š</span></div><div class="line"><span class="comment">// test</span></div></pre></td></tr></table></figure>
<p>async å¼‚æ­¥å‡½æ•°è¿”å›çš„æ˜¯ Promiseï¼Œæ‰€ä»¥æ‰§è¡Œå¼‚æ­¥å‡½æ•°åï¼Œç»Ÿä¸€éœ€è¦ç”¨ <code>.catch()</code> å¯¹å¯èƒ½å‡ºç°çš„ rejection è¿›è¡Œæ•æ‰å¤„ç†ï¼Œå¦åˆ™ç»Ÿä¸€ä¹Ÿæ˜¯ä¼šå‡ºç° <code>UnhandledPromiseRejectionWarning</code> çš„è­¦å‘Š</p>
<h2 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h2><p>æœ€åè§£å†³ä¸€ä¸‹æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼šæ„å»ºä»»åŠ¡ä¸­ html è§£æé”™è¯¯ï¼Œå‡ºç°äº†ä¸€ä¸ª Unhandled Rejectionï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª <code>unhandledRejection</code> äº‹ä»¶ç›‘å¬ï¼Œç›´æ¥é€€å‡ºï¼š<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">process.on(<span class="string">'unhandledRejection'</span>, error =&gt; &#123;</div><div class="line">  console.error(<span class="string">'unhandledRejection'</span>, error);</div><div class="line">  process.<span class="keyword">exit</span>(<span class="number">1</span>) <span class="regexp">//</span> To <span class="keyword">exit</span> with a <span class="string">'failure'</span> code</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="http://thecodebarbarian.com/unhandled-promise-rejections-in-node.js.html" target="_blank" rel="external">Unhandled Promise Rejections in Node.js</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;é—®é¢˜å¼•å…¥ï¼š&lt;/em&gt;ä»Šå¤©åœ¨ Gulp æ„å»ºä»»åŠ¡ä¸­å‡ºç°ä¸€ä¸ª html è§£æé”™è¯¯ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æŠ¥é”™ï¼Œä¹Ÿæ²¡æœ‰ä¸­æ–­ gulp æ„å»ºä»»åŠ¡çš„æ‰§è¡Œï¼Œè€Œæ˜¯å‡ºç° &lt;code&gt;UnhandledPromiseRejectionWarning&lt;/code&gt; çš„è­¦å‘Šï¼Œæ‰€ä»¥ä¼šè¯¯ä»¥ä¸ºæ„å»ºæˆåŠŸï¼Œè¿™ç¯‡æ–‡ç« å°†å¯¹æ­¤è¿›è¡Œæ¢ç©¶å¹¶è§£å†³è¯¥é—®é¢˜ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;(&lt;span class=&quot;string&quot;&gt;node:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;24866&lt;/span&gt;) &lt;span class=&quot;string&quot;&gt;UnhandledPromiseRejectionWarning:&lt;/span&gt; Unhandled promise rejection (rejection &lt;span class=&quot;string&quot;&gt;id:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;): Error &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; plugin &lt;span class=&quot;string&quot;&gt;&#39;gulp-posthtml&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;Message:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  Parse &lt;span class=&quot;string&quot;&gt;Error:&lt;/span&gt; &amp;lt;img id=&lt;span class=&quot;string&quot;&gt;&quot;titleIcon&quot;&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;$=&quot;&amp;#123;&lt;/span&gt;&amp;#123;getStypeType_(info.stype)&amp;#125;&amp;#125;&lt;span class=&quot;string&quot;&gt;&quot; src$=&quot;&lt;/span&gt;&amp;#123;&amp;#123;getTitleIcon_(&lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;(&lt;span class=&quot;string&quot;&gt;node:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;24866&lt;/span&gt;) [DEP0018] &lt;span class=&quot;string&quot;&gt;DeprecationWarning:&lt;/span&gt; Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="Promise" scheme="http://objcer.com/tags/Promise/"/>
    
  </entry>
  
  <entry>
    <title>æ¢ç©¶æ•°æ®ç»‘å®šï¼ˆ2ï¼‰ES6 Proxy</title>
    <link href="http://objcer.com/2017/10/31/Data-Binding-with-ES6-Proxies/"/>
    <id>http://objcer.com/2017/10/31/Data-Binding-with-ES6-Proxies/</id>
    <published>2017-10-31T07:25:45.000Z</published>
    <updated>2017-10-31T07:27:40.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/data-binding-with-es6-proxy.png" alt=""><br>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ï¼š<a href="https://objcer.com/2017/10/27/Data-binding-introduction/">æ¢ç©¶æ•°æ®ç»‘å®šï¼ˆ1ï¼‰è„æ£€æŸ¥å’Œå­˜å–å™¨æ–¹æ³•</a> ä¸­ï¼Œæ¢ç©¶äº† ES5 ä¸­å®ç°æ•°æ®ç»‘å®šçš„ä¸¤ç§æ–¹å¼ï¼›è€Œåœ¨æœ¬æ–‡ä¸­ï¼Œå°†ä¼šæ¢ç©¶ä½¿ç”¨ ES6 Proxy å®ç°æ•°æ®ç»‘å®šã€‚</p>
<a id="more"></a>
<h2 id="çŸ¥è¯†å‚¨å¤‡"><a href="#çŸ¥è¯†å‚¨å¤‡" class="headerlink" title="çŸ¥è¯†å‚¨å¤‡"></a>çŸ¥è¯†å‚¨å¤‡</h2><p>Proxy æ–¹å¼å®ç°æ•°æ®ç»‘å®šä¸­æ¶‰åŠåˆ° Proxyã€Reflectã€Setã€Map å’Œ WeakMapï¼Œè¿™äº›éƒ½æ˜¯ ES6 çš„æ–°ç‰¹æ€§ã€‚</p>
<h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><p>Proxy å¯¹è±¡ä»£ç†ï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚æ‹¦æˆªï¼Œå¤–éƒ¨å¯¹ç›®æ ‡å¯¹è±¡çš„æ“ä½œï¼Œéƒ½ä¼šé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶æ‹¦æˆªè¡Œä¸ºï¼Œæ¯ä¸€ä¸ªè¢«ä»£ç†çš„æ‹¦æˆªè¡Œä¸ºéƒ½å¯¹åº”ä¸€ä¸ªå¤„ç†å‡½æ•°ã€‚<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let p = <span class="keyword">new</span> Proxy(<span class="keyword">target</span>, <span class="keyword">handler</span>);</div></pre></td></tr></table></figure></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">var</span> handler = &#123;</div><div class="line">  get: (target, name, recevier) =&gt; &#123;</div><div class="line">    return <span class="string">'proxy'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">var</span> <span class="selector-tag">p</span> = new Proxy(&#123;&#125;, handler)</div><div class="line"><span class="selector-tag">p</span><span class="selector-class">.a</span> = <span class="number">1</span></div><div class="line"></div><div class="line">console.log(<span class="selector-tag">p</span><span class="selector-class">.a</span>, <span class="selector-tag">p</span>.c) <span class="comment">// -&gt; proxy proxy</span></div></pre></td></tr></table></figure>
<p>Proxy æ„é€ å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡</li>
<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯é…ç½®å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªè¢«ä»£ç†çš„æ“ä½œéƒ½å¯¹åº”ä¸€ä¸ªå¤„ç†å‡½æ•°</li>
</ul>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç›®æ ‡å¯¹è±¡æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œé…ç½®å¯¹è±¡ä¸­æœ‰ä¸€ä¸ª <code>get</code> å‡½æ•°ï¼Œç”¨æ¥æ‹¦æˆªå¤–éƒ¨å¯¹ç›®æ ‡å¯¹è±¡å±æ€§çš„è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ<code>get</code> å‡½æ•°å§‹ç»ˆè¿”å› <code>proxy</code>ã€‚</p>
<p>Proxy æ”¯æŒæ‹¦æˆªçš„æ“ä½œä¸€å…±æœ‰13ç§ï¼š</p>
<ul>
<li>get(target, propKey, receiver)</li>
<li>set(target, propKey, value, receiver)</li>
<li>has(target, propKey)</li>
<li>deleteProperty(target, propKey)</li>
<li>ownKeys(target)</li>
<li>getOwnPropertyDescriptor(target, propKey)</li>
<li>defineProperty(target, propKey, propDesc)</li>
<li>preventExtensions(target)</li>
<li>getPrototypeOf(target)</li>
<li>isExtensible(target)</li>
<li>setPrototypeOf(target, proto)</li>
<li>apply(target, object, args)</li>
<li>construct(target, args)</li>
</ul>
<blockquote>
<p>ğŸ‘‰ æ›´è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="external">MDNÂ·Proxy</a><br><a href="http://es6.ruanyifeng.com/#docs/proxy" target="_blank" rel="external">Proxy</a></p>
</blockquote>
<h3 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h3><p>Reflect å¯¹è±¡åŒ Proxy å¯¹è±¡ä¸€æ ·ï¼Œä¹Ÿæ˜¯ ES6 ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–°ç‰¹æ€§ã€‚</p>
<p>Reflect å¯¹è±¡çš„æ–¹æ³•ä¸ Proxy å¯¹è±¡çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œåªè¦æ˜¯ Proxy å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±èƒ½åœ¨ Reflect å¯¹è±¡ä¸Šæ‰¾åˆ°å¯¹åº”çš„é™æ€æ–¹æ³•ï¼ˆReflect å¯¹è±¡æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨ new åˆ›å»ºå®ä¾‹ï¼‰ã€‚è¿™å°±è®© Proxy å¯¹è±¡å¯ä»¥æ–¹ä¾¿åœ°è°ƒç”¨å¯¹åº”çš„ Reflect æ–¹æ³•ï¼Œå®Œæˆé»˜è®¤è¡Œä¸ºï¼Œä½œä¸ºä¿®æ”¹è¡Œä¸ºçš„åŸºç¡€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡ Proxy æ€ä¹ˆä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œä½ æ€»å¯ä»¥åœ¨ Reflect ä¸Šè·å–é»˜è®¤è¡Œä¸ºã€‚<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">var</span> handler = &#123;</div><div class="line">  get: (target, name, recevier) =&gt; &#123;</div><div class="line">    console.log(<span class="string">'get: '</span>, name)</div><div class="line">    Reflect.get(target, name)</div><div class="line">  &#125;,</div><div class="line">  set: (target, name, value, recevier) =&gt; &#123;</div><div class="line">    console.log(<span class="string">'set: '</span>, name)</div><div class="line">    Reflect.get(target, name, value)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">var</span> <span class="selector-tag">p</span> = new Proxy(&#123;&#125;, handler)</div><div class="line"><span class="selector-tag">p</span><span class="selector-class">.a</span> = <span class="number">1</span></div><div class="line"></div><div class="line">console.log(<span class="selector-tag">p</span><span class="selector-class">.a</span>, <span class="selector-tag">p</span>.c)</div></pre></td></tr></table></figure></p>
<p>ä»£ç æ‰§è¡Œç»“æœï¼Œè¾“å‡ºï¼š<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">set</span>:  <span class="keyword">a</span></div><div class="line"><span class="built_in">get</span>:  <span class="keyword">a</span></div><div class="line"><span class="built_in">get</span>:  c</div></pre></td></tr></table></figure></p>
<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒProxy æ‹¦æˆªç›®æ ‡å¯¹è±¡çš„ <code>get</code> å’Œ <code>set</code>æ–¹æ³•ï¼Œåœ¨å…¶ä¸­å®šåˆ¶æ‹¦æˆªè¡Œä¸ºï¼Œæœ€åé‡‡ç”¨ <code>Reflect.get</code> å’Œ <code>Reflect.set</code> åˆ†åˆ«å®Œæˆç›®æ ‡å¯¹è±¡é»˜è®¤çš„å±æ€§è·å–å’Œè®¾ç½®è¡Œä¸ºã€‚</p>
<blockquote>
<p>ğŸ‘‰ æ›´è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect" target="_blank" rel="external">MDNÂ·Reflect</a><br><a href="http://es6.ruanyifeng.com/#docs/reflect" target="_blank" rel="external">Reflect</a></p>
</blockquote>
<h3 id="Set-WeakSet-å’Œ-Map-WeakMap"><a href="#Set-WeakSet-å’Œ-Map-WeakMap" class="headerlink" title="Set/WeakSet å’Œ Map/WeakMap"></a>Set/WeakSet å’Œ Map/WeakMap</h3><p><strong>Set</strong></p>
<ul>
<li>ç±»ä¼¼ Array æ•°ç»„</li>
<li>Set å…è®¸ä½ å­˜å‚¨ä»»ä½•ç±»å‹çš„å”¯ä¸€å€¼ï¼Œæ— è®ºæ˜¯åŸå§‹å€¼æˆ–è€…æ˜¯å¯¹è±¡å¼•ç”¨</li>
<li>Set æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤å€¼</li>
</ul>
<p><strong>WeakSet</strong></p>
<ul>
<li>ç±»ä¼¼ Setï¼Œä¹Ÿæ˜¯ä¸é‡å¤å…ƒç´ çš„é›†åˆ</li>
<li>WeakSet å¯¹è±¡ä¸­åªèƒ½å­˜æ”¾å¯¹è±¡å€¼, ä¸èƒ½å­˜æ”¾åŸå§‹å€¼, è€Œ Set å¯¹è±¡éƒ½å¯ä»¥</li>
<li>WeakSet å¯¹è±¡ä¸­å­˜å‚¨çš„<strong>å¯¹è±¡å€¼éƒ½æ˜¯è¢«å¼±å¼•ç”¨çš„</strong>, å¦‚æœæ²¡æœ‰å…¶ä»–çš„å˜é‡æˆ–å±æ€§å¼•ç”¨è¿™ä¸ªå¯¹è±¡å€¼, åˆ™è¿™ä¸ªå¯¹è±¡å€¼ä¼šè¢«å½“æˆåƒåœ¾å›æ”¶æ‰. æ­£å› ä¸ºè¿™æ ·, WeakSet å¯¹è±¡æ˜¯æ— æ³•è¢«æšä¸¾çš„, æ²¡æœ‰åŠæ³•æ‹¿åˆ°å®ƒåŒ…å«çš„æ‰€æœ‰å…ƒç´ </li>
</ul>
<p><strong>Map</strong></p>
<ul>
<li>ç±»ä¼¼ Object å¯¹è±¡ï¼Œä¿å­˜é”®å€¼å¯¹</li>
<li>Map ä»»ä½•å€¼(å¯¹è±¡æˆ–è€…åŸå§‹å€¼) éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªé”®(key)æˆ–ä¸€ä¸ªå€¼(value)ï¼Œè€Œ Object å¯¹è±¡çš„ key é”®å€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²</li>
</ul>
<p><strong>WeakMap</strong></p>
<ul>
<li>ç±»ä¼¼ Mapï¼Œä¹Ÿæ˜¯ä¸€ç»„é”®å€¼å¯¹çš„é›†åˆ</li>
<li>WeakMap å¯¹è±¡ä¸­çš„<strong>é”®æ˜¯å¼±å¼•ç”¨çš„</strong>ã€‚é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼Œå€¼å¯ä»¥æ˜¯ä»»æ„å€¼</li>
<li>ç”±äºè¿™æ ·çš„å¼±å¼•ç”¨ï¼Œåªè¦æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å…¶ä»–å¼•ç”¨éƒ½è¢«æ¸…é™¤ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä¸å†éœ€è¦ï¼ŒWeakMap é‡Œé¢çš„é”®åå¯¹è±¡å’Œæ‰€å¯¹åº”çš„é”®å€¼å¯¹ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œä¸ç”¨æ‰‹åŠ¨åˆ é™¤å¼•ç”¨ï¼ŒåŸç†åŒ WeakSet</li>
<li>WeakMap çš„ key æ˜¯éæšä¸¾çš„</li>
</ul>
<h2 id="Proxy-å®ç°æ•°æ®ç»‘å®š"><a href="#Proxy-å®ç°æ•°æ®ç»‘å®š" class="headerlink" title="Proxy å®ç°æ•°æ®ç»‘å®š"></a>Proxy å®ç°æ•°æ®ç»‘å®š</h2><p>å…ˆä¸Šå®Œæ•´ä»£ç  ğŸ‘‰<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ç›‘å¬å¯¹è±¡é›†åˆ</span></div><div class="line"><span class="keyword">var</span> observers = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</div><div class="line"><span class="comment">// å¾…æ‰§è¡Œç›‘å¬å‡½æ•°é›†åˆï¼ŒSet å¯ä»¥é¿å…é‡å¤</span></div><div class="line"><span class="keyword">var</span> queuedObservers = <span class="keyword">new</span> <span class="built_in">Set</span>()</div><div class="line"><span class="comment">// å½“å‰ç›‘å¬å‡½æ•°</span></div><div class="line"><span class="keyword">var</span> currentObserver</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">observable</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">  observers.set(obj, <span class="keyword">new</span> <span class="built_in">Map</span>())</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123; get, set &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">target, key, receiver</span>) </span>&#123;</div><div class="line">  <span class="comment">// get æ–¹æ³•é»˜è®¤è¡Œä¸º</span></div><div class="line">  <span class="keyword">const</span> result = <span class="built_in">Reflect</span>.get(target, key, receiver)</div><div class="line">  <span class="comment">// å½“å‰ç›‘å¬å‡½æ•°ä¸­ï¼Œç›‘å¬ä½¿ç”¨äº†è¯¥å±æ€§ï¼Œ</span></div><div class="line">  <span class="comment">// é‚£ä¹ˆæŠŠè¯¥ ç›‘å¬å‡½æ•° å­˜æ”¾åˆ°è¯¥å±æ€§å¯¹åº”çš„ å¯¹è±¡å±æ€§ç›‘å¬å‡½æ•°é›†åˆ Set</span></div><div class="line">  <span class="keyword">if</span> (currentObserver) &#123;</div><div class="line">    registerObserver(target, key, currentObserver)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">registerObserver</span>(<span class="params">target, key, observer</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> observersForKey = observers.get(target).get(key)</div><div class="line">  <span class="comment">// ä¸ºæ¯ä¸€ä¸ªå¯¹è±¡å±æ€§éƒ½åˆ›å»ºä¸€ä¸ª Set é›†åˆï¼Œå­˜æ”¾ç›‘å¬äº†è¯¥å±æ€§çš„ç›‘å¬å‡½æ•°</span></div><div class="line">  <span class="keyword">if</span> (!observersForKey) &#123;</div><div class="line">    observersForKey = <span class="keyword">new</span> <span class="built_in">Set</span>()</div><div class="line">    observers.get(target).set(key, observersForKey)</div><div class="line">  &#125;</div><div class="line">  observersForKey.add(observer)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">target, key, value, receiver</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> observersForKey = observers.get(target).get(key)</div><div class="line">  <span class="comment">// ä¿®æ”¹å¯¹è±¡å±æ€§ï¼Œå³å¯¹è±¡å±æ€§å€¼å‘ç”Ÿå˜æ›´æ—¶ï¼Œ</span></div><div class="line">  <span class="comment">// åˆ¤æ–­ å¯¹è±¡å±æ€§ç›‘å¬å‡½æ•°é›†åˆ Set æ˜¯å¦å­˜åœ¨ï¼Œå°†å…¶ä¸­çš„æ‰€æœ‰ç›‘å¬å‡½æ•°éƒ½æ·»åŠ åˆ° å¾…æ‰§è¡Œç›‘å¬å‡½æ•°é›†åˆ</span></div><div class="line">  <span class="keyword">if</span> (observersForKey) &#123;</div><div class="line">    observersForKey.forEach(queueObserver)</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// set æ–¹æ³•é»˜è®¤è¡Œä¸º</span></div><div class="line">  <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, key, value, receiver)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">observe</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">  queueObserver(fn)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å°†ç›‘å¬å‡½æ•°æ·»åŠ åˆ° å¾…æ‰§è¡Œç›‘å¬å‡½æ•°é›†åˆ Set ä¸­</span></div><div class="line"><span class="comment">// å¦‚æœ å¾…æ‰§è¡Œç›‘å¬å‡½æ•°é›†åˆ Set ä¸ºç©ºï¼Œé‚£ä¹ˆåœ¨æ·»åŠ åç«‹å³æ‰§è¡Œ</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">queueObserver</span>(<span class="params">observer</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (queuedObservers.size === <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">// å¼‚æ­¥æ‰§è¡Œ</span></div><div class="line">    <span class="built_in">Promise</span>.resolve().then(runObservers)</div><div class="line">  &#125;</div><div class="line">  queuedObservers.add(observer)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ‰§è¡Œ å¾…æ‰§è¡Œç›‘å¬å‡½æ•°é›†åˆ Set ä¸­çš„ç›‘å¬å‡½æ•°</span></div><div class="line"><span class="comment">// æ‰§è¡Œå®Œæ¯•åï¼Œè¿›è¡Œæ¸…ç†å·¥ä½œ</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">runObservers</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    queuedObservers.forEach(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</div><div class="line">      currentObserver = observer</div><div class="line">      observer()</div><div class="line">    &#125;)</div><div class="line">  &#125; <span class="keyword">finally</span> &#123;</div><div class="line">    currentObserver = <span class="literal">undefined</span></div><div class="line">    queuedObservers.clear()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯¹å¤–æš´éœ²çš„ <code>observable(obj)</code> å’Œ <code>observe(fn)</code> æ–¹æ³•äºŒè€…åˆ†åˆ«ç”¨äºåˆ›å»º observable ç›‘å¬å¯¹è±¡å’Œ observer ç›‘å¬å›è°ƒå‡½æ•°ã€‚å½“ observable ç›‘å¬å¯¹è±¡å‘ç”Ÿå±æ€§å˜åŒ–æ—¶ï¼Œobserver å‡½æ•°å°†è‡ªåŠ¨æ‰§è¡Œã€‚</p>
<p>æµ‹è¯•ç”¨ä¾‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>: <span class="string">'John'</span>, <span class="attr">age</span>: <span class="number">20</span>&#125;</div><div class="line"><span class="comment">// observable object</span></div><div class="line"><span class="keyword">var</span> person = observable(obj)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">`ç›‘å¬å±æ€§å‘ç”Ÿå˜åŒ–ï¼š<span class="subst">$&#123;person.name&#125;</span>, <span class="subst">$&#123;person.age&#125;</span>`</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// observer function</span></div><div class="line">observe(print)</div></pre></td></tr></table></figure></p>
<h3 id="åˆ†ææ¥å£æ–¹æ³•"><a href="#åˆ†ææ¥å£æ–¹æ³•" class="headerlink" title="åˆ†ææ¥å£æ–¹æ³•"></a>åˆ†ææ¥å£æ–¹æ³•</h3><p>å…³äº <code>observable(obj)</code> å’Œ <code>observe(fn)</code>ï¼š<br><strong><code>observable(obj)</code> æ–¹æ³•ä¸­ï¼Œé€šè¿‡ ES6 Proxy ä¸ºç›®æ ‡å¯¹è±¡ <code>obj</code> åˆ›å»ºä»£ç†ï¼Œæ‹¦æˆª <code>get</code> å’Œ <code>set</code> æ“ä½œ</strong></p>
<ul>
<li>å½“å‰ç›‘å¬å‡½æ•°ï¼š<code>currentObserver</code></li>
<li>å¾…æ‰§è¡Œç›‘å¬å‡½æ•°é›†åˆ Setï¼š<code>var queuedObservers = new Set()</code></li>
<li>ç›‘å¬å¯¹è±¡é›†åˆ WeakMapï¼š<code>var observers = new WeakMap()</code> é”®å€¼ä¸ºç›‘å¬å¯¹è±¡</li>
<li>å¯¹è±¡å±æ€§ç›‘å¬å‡½æ•°é›†åˆ Setï¼šç›‘å¬äº†å¯¹è±¡å±æ€§çš„ç›‘å¬å‡½æ•°ï¼Œéƒ½ä¿å­˜åˆ°å¯¹è±¡å±æ€§ç›‘å¬å‡½æ•°é›†åˆ Set ä¸­ï¼Œæ–¹ä¾¿åœ¨å¯¹è±¡å±æ€§å‘ç”Ÿå˜æ›´æ—¶ï¼Œæ‰§è¡Œç›‘å¬å‡½æ•°</li>
<li>æ‹¦æˆªæ–¹æ³• <code>get</code>ï¼šä½¿ç”¨ <code>obj.property</code> è·å–å¯¹è±¡å±æ€§ï¼Œå³ä¼šè¢«æ‹¦æˆªæ–¹æ³• <code>get</code> æ‹¦æˆª<br>ğŸ‘‰ æŸ¥çœ‹ <code>get</code> ä¸­çš„æ³¨é‡Š</li>
<li>æ‹¦æˆªæ–¹æ³• <code>set</code>ï¼šä½¿ç”¨ <code>obj.property = value</code> è®¾ç½®å¯¹è±¡å±æ€§ï¼Œå³ä¼šè¢«æ‹¦æˆªæ–¹æ³• <code>set</code> æ‹¦æˆª<br>ğŸ‘‰ æŸ¥çœ‹ <code>set</code> ä¸­çš„æ³¨é‡Š</li>
</ul>
<p><strong><code>observe(fn)</code> æ–¹æ³•ä¸­ï¼Œæ·»åŠ å¯¹è±¡å±æ€§ç›‘å¬å‡½æ•°</strong><br>  ç›‘å¬å‡½æ•°ä¸­ä½¿ç”¨ <code>obj.property</code> è·å–å¯¹è±¡å±æ€§ï¼Œå³è¡¨æ˜ç›‘å¬å‡½æ•°ç›‘å¬äº†è¯¥å±æ€§ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘æ‹¦æˆªæ–¹æ³• <code>get</code> ä¸­å¯¹ç›‘å¬å±æ€§çš„é€»è¾‘å¤„ç†ï¼Œä¸ºå…¶åˆ›å»ºå¯¹è±¡å±æ€§ç›‘å¬å‡½æ•°é›†åˆ Setï¼Œå¹¶å°†å½“å‰çš„ç›‘å¬å‡½æ•°æ·»åŠ è¿›å…¶ä¸­</p>
<h3 id="åˆ†ææµ‹è¯•ç”¨ä¾‹"><a href="#åˆ†ææµ‹è¯•ç”¨ä¾‹" class="headerlink" title="åˆ†ææµ‹è¯•ç”¨ä¾‹"></a>åˆ†ææµ‹è¯•ç”¨ä¾‹</h3><p>ä¸‹é¢é€šè¿‡æµç¨‹å›¾è®²è§£ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œè¿‡ç¨‹<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/es6-proxy-observables-code.png" alt=""></p>
<ul>
<li>é€šè¿‡ <code>observable</code> æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ <code>person</code></li>
<li><code>observe</code> æ–¹æ³•è®¾ç½®ç›‘å¬å‡½æ•°ï¼Œæ­¤æ—¶å¾…æ‰§è¡Œç›‘å¬å‡½æ•°é›†åˆ Set ä¸ºç©ºï¼Œç›‘å¬å‡½æ•°æ·»åŠ åˆ° Set ä¸­åæ‰§è¡Œå¾…æ‰§è¡Œç›‘å¬å‡½æ•°é›†åˆ Set ä¸­çš„ç›‘å¬å‡½æ•°</li>
<li>åœ¨ <code>runObservers</code> æ–¹æ³•ä¸­å½“å‰ç›‘å¬å‡½æ•° <code>currentObserver</code> è¢«è®¾ä¸º <code>print</code></li>
<li><code>print</code> å¼€å§‹æ‰§è¡Œ</li>
<li>åœ¨ <code>print</code> å†…éƒ¨æ£€ç´¢åˆ° <code>person.name</code></li>
<li>åœ¨ <code>person</code> ä¸Šè§¦å‘æ‹¦æˆªæ–¹æ³• <code>get</code></li>
<li><code>observers.get(person).get(&#39;name&#39;)</code> æ£€ç´¢åˆ° <code>(person, name)</code> ç»„åˆçš„å¯¹è±¡å±æ€§ç›‘å¬å‡½æ•°é›† Set</li>
<li>å½“å‰ç›‘å¬å‡½æ•° <code>print</code> è¢«æ·»åŠ åˆ°å¯¹è±¡å±æ€§ç›‘å¬å‡½æ•°é›† Set ä¸­</li>
<li>å¯¹äº <code>person.age</code>ï¼ŒåŒç†ï¼Œæ‰§è¡Œå‰é¢åœ¨ <code>print</code> å†…éƒ¨æ£€ç´¢åˆ° <code>person.name</code> çš„æµç¨‹</li>
<li><code>${person.name}, ${person.age}</code> æ‰“å°å‡ºæ¥ï¼›</li>
<li><code>print</code> å‡½æ•°æ‰§è¡Œç»“æŸï¼›</li>
<li>å½“å‰ç›‘å¬å‡½æ•° <code>currentObserver</code> å˜ä¸º <code>undefined</code></li>
</ul>
<p>å½“è°ƒç”¨ <code>person.age = 22</code> ä¿®æ”¹å¯¹è±¡å±æ€§æ—¶ï¼š</p>
<ul>
<li><code>person</code> ä¸Šè§¦å‘æ‹¦æˆªæ–¹æ³• <code>set</code></li>
<li><code>observers.get(person).get(&#39;age&#39;)</code> æ£€ç´¢åˆ° <code>(person, age)</code> ç»„åˆçš„å¯¹è±¡å±æ€§ç›‘å¬å‡½æ•°é›† Set</li>
<li>å¯¹è±¡å±æ€§ç›‘å¬å‡½æ•°é›† Set ä¸­çš„ç›‘å¬å‡½æ•°ï¼ˆåŒ…æ‹¬ <code>print</code>ï¼‰å…¥å¾…æ‰§è¡Œç›‘å¬å‡½æ•°é›†åˆï¼Œå‡†å¤‡æ‰§è¡Œ</li>
<li>å†æ¬¡æ‰§è¡Œ <code>print</code></li>
</ul>
<h2 id="é«˜çº§ä¸»é¢˜"><a href="#é«˜çº§ä¸»é¢˜" class="headerlink" title="é«˜çº§ä¸»é¢˜"></a>é«˜çº§ä¸»é¢˜</h2><h3 id="åŠ¨æ€-observable-tree"><a href="#åŠ¨æ€-observable-tree" class="headerlink" title="åŠ¨æ€ observable tree"></a>åŠ¨æ€ observable tree</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">var</span> obj = &#123;</div><div class="line">  name: <span class="string">'John'</span>,</div><div class="line">  age: <span class="number">20</span>,</div><div class="line">  teacher: &#123;</div><div class="line">    name: <span class="string">'Tom'</span>,</div><div class="line">    age: <span class="number">30</span></div><div class="line">&#125;&#125;</div><div class="line"><span class="comment">// observable object</span></div><div class="line"><span class="selector-tag">var</span> person = observable(obj)</div><div class="line"></div><div class="line">function print () &#123;</div><div class="line">  console.log(`ç›‘å¬å±æ€§å‘ç”Ÿå˜åŒ–ï¼š$&#123;person<span class="selector-class">.teacher</span><span class="selector-class">.name</span>&#125;, $&#123;person<span class="selector-class">.teacher</span><span class="selector-class">.age</span>&#125;`)</div><div class="line">&#125;</div><div class="line"><span class="comment">// observer function</span></div><div class="line"><span class="function"><span class="title">observe</span><span class="params">(print)</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="title">setTimeout</span><span class="params">(()</span></span> =&gt; &#123;person<span class="selector-class">.teacher</span><span class="selector-class">.name</span> = <span class="string">'Jack'</span>&#125;)</div></pre></td></tr></table></figure>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå•å±‚å¯¹è±¡çš„æ•°æ®ç»‘å®šç›‘å¬æ˜¯æ­£å¸¸å·¥ä½œçš„ã€‚ä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬çš„å¯¹è±¡å€¼åˆæ˜¯å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™ç›‘å¬å°±å¤±æ•ˆäº†ï¼Œæˆ‘ä»¬éœ€è¦å°†ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">observable</span>(&#123;<span class="attribute">data</span>: &#123;name: <span class="string">'John'</span>&#125;&#125;)</div></pre></td></tr></table></figure></p>
<p>æ›¿æ¢æˆ<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">observable</span>(&#123;<span class="attribute">data</span>: <span class="built_in">observable</span>(&#123;name: <span class="string">'John'</span>&#125;)&#125;)</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·å°±èƒ½æ­£å¸¸è¿è¡Œäº† ğŸ˜‹</p>
<p>æ˜¾ç„¶ï¼Œè¿™æ ·ä½¿ç”¨ä¸æ–¹ä¾¿ï¼Œå¯ä»¥åšæ‹¦æˆªæ–¹æ³• <code>get</code> ä¸­ä¿®æ”¹ä¸€ä¸‹ï¼Œåœ¨è¿”å›å€¼æ˜¯å¯¹è±¡æ—¶ï¼Œå¯¹è¿”å›å€¼å¯¹è±¡ä¹Ÿè°ƒç”¨ <code>observable(obj)</code> ä¸ºå…¶åˆ›å»ºç›‘å¬å¯¹è±¡ã€‚<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function <span class="built_in">get</span>(target, <span class="built_in">key</span>, receiver) &#123;</div><div class="line">  <span class="keyword">const</span> result = Reflect.<span class="built_in">get</span>(target, <span class="built_in">key</span>, receiver)</div><div class="line">  <span class="keyword">if</span> (currentObserver) &#123;</div><div class="line">    registerObserver(target, <span class="built_in">key</span>, currentObserver)</div><div class="line">    <span class="keyword">if</span> (typeof result === <span class="string">'object'</span>) &#123;</div><div class="line">      <span class="keyword">const</span> observableResult = observable(result)</div><div class="line">      Reflect.<span class="built_in">set</span>(target, <span class="built_in">key</span>, observableResult, receiver)</div><div class="line">      <span class="keyword">return</span> observableResult</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h3><p>å¯¹äº Proxy æ‹¦æˆªæ“ä½œä¹Ÿå¯ä»¥åœ¨åŸå‹é“¾ä¸­è¢«ç»§æ‰¿ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">let proto = new Proxy(&#123;&#125;, &#123;</div><div class="line">  get(target, propertyKey, receiver) &#123;</div><div class="line">    console.log('GET ' + propertyKey);</div><div class="line">    return Reflect.get(target, propertyKey, receiver);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">let obj = Object.create(proto);</div><div class="line">obj.foo // <span class="string">"<span class="keyword">GET</span> foo"</span></div></pre></td></tr></table></figure></p>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ‹¦æˆªæ“ä½œ <code>get</code> å®šä¹‰åœ¨åŸå‹å¯¹è±¡ä¸Šé¢ï¼Œæ‰€ä»¥å¦‚æœè¯»å– <code>obj</code> å¯¹è±¡å±æ€§æ—¶ï¼Œæ‹¦æˆªä¼šç”Ÿæ•ˆã€‚</p>
<p>åŒç†ï¼Œé€šè¿‡ Proxy å®ç°çš„æ•°æ®ç»‘å®šä¹Ÿèƒ½ä¸åŸå‹ç»§æ‰¿æ­é…å·¥ä½œï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">const parent = observable(&#123;greeting: <span class="string">'Hello'</span>&#125;)</div><div class="line">const child = observable(&#123;subject: <span class="string">'World!'</span>&#125;)</div><div class="line">Object.setPrototypeOf(child, parent)</div><div class="line"></div><div class="line">function print () &#123;</div><div class="line">  console.log(`$&#123;child.greeting&#125; $&#123;child.subject&#125;`)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ§åˆ¶å°æ‰“å°å‡º 'Hello World!'</span></div><div class="line"><span class="function"><span class="title">observe</span><span class="params">(print)</span></span></div><div class="line"></div><div class="line"><span class="comment">// æ§åˆ¶å°æ‰“å°å‡º 'Hello There!'</span></div><div class="line"><span class="function"><span class="title">setTimeout</span><span class="params">(()</span></span> =&gt; child<span class="selector-class">.subject</span> = <span class="string">'There!'</span>)</div><div class="line"></div><div class="line"><span class="comment">// æ§åˆ¶å°æ‰“å°å‡º 'Hey There!'</span></div><div class="line"><span class="function"><span class="title">setTimeout</span><span class="params">(()</span></span> =&gt; parent<span class="selector-class">.greeting</span> = <span class="string">'Hey'</span>, <span class="number">100</span>)</div><div class="line"></div><div class="line"><span class="comment">// æ§åˆ¶å°æ‰“å°å‡º 'Look There!'</span></div><div class="line"><span class="function"><span class="title">setTimeout</span><span class="params">(()</span></span> =&gt; child<span class="selector-class">.greeting</span> = <span class="string">'Look'</span>, <span class="number">200</span>)</div></pre></td></tr></table></figure></p>
<h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><p>æœ¬æ–‡ä¸­é€šè¿‡ç®€å•çš„ä»£ç å±•ç¤ºäº† Proxy å®ç°æ•°æ®ç»‘å®šï¼Œæ›´åŠ å®Œæ•´çš„å®ç°ï¼Œå‚è€ƒï¼š<a href="https://github.com/nx-js/observer-util" target="_blank" rel="external">nx-js/observer-util</a></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://blog.risingstack.com/writing-a-javascript-framework-data-binding-es6-proxy/" target="_blank" rel="external">Writing a JavaScript Framework - Data Binding with ES6 Proxies</a><br><a href="http://www.zcfy.cc/article/writing-a-javascript-framework-data-binding-with-es6-proxies-risingstack-1655.html" target="_blank" rel="external">ä½¿ç”¨ ES6 Proxy å®ç°æ•°æ®ç»‘å®š</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/data-binding-with-es6-proxy.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;https://objcer.com/2017/10/27/Data-binding-introduction/&quot;&gt;æ¢ç©¶æ•°æ®ç»‘å®šï¼ˆ1ï¼‰è„æ£€æŸ¥å’Œå­˜å–å™¨æ–¹æ³•&lt;/a&gt; ä¸­ï¼Œæ¢ç©¶äº† ES5 ä¸­å®ç°æ•°æ®ç»‘å®šçš„ä¸¤ç§æ–¹å¼ï¼›è€Œåœ¨æœ¬æ–‡ä¸­ï¼Œå°†ä¼šæ¢ç©¶ä½¿ç”¨ ES6 Proxy å®ç°æ•°æ®ç»‘å®šã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="æ•°æ®ç»‘å®š" scheme="http://objcer.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A/"/>
    
      <category term="Proxy" scheme="http://objcer.com/tags/Proxy/"/>
    
  </entry>
  
  <entry>
    <title>æ¢ç©¶æ•°æ®ç»‘å®šï¼ˆ1ï¼‰è„æ£€æŸ¥å’Œå­˜å–å™¨æ–¹æ³•</title>
    <link href="http://objcer.com/2017/10/27/Data-binding-introduction/"/>
    <id>http://objcer.com/2017/10/27/Data-binding-introduction/</id>
    <published>2017-10-27T02:30:21.000Z</published>
    <updated>2017-10-27T02:41:20.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><strong>Data binding is a general technique that binds data sources from the provider and consumer together and synchronizes them.</strong></p>
</blockquote>
<p>åœ¨å‰ç«¯ç»„ä»¶åŒ–æ¡†æ¶ä¸­ï¼ŒåŸºæœ¬éƒ½æœ‰<strong>æ•°æ®ç»‘å®š</strong>è¿™ä¸€ç‰¹æ€§ï¼Œæ•°æ®ç»‘å®šæ˜¯å°†ç”Ÿäº§è€…çš„æ•°æ®æºç»‘å®šåˆ°æ¶ˆè´¹è€…ï¼Œå¹¶è´Ÿè´£æ•°æ®åŒæ­¥ã€‚æœ¬æ–‡å°†æ¢ç©¶æ•°æ®ç»‘å®šçš„ä¸åŒå®ç°æ–¹å¼ã€‚ğŸ¤“</p>
<p>ç›®å‰ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>è„æ£€æŸ¥ï¼ˆdirty checkï¼‰</strong></li>
<li><strong>å­˜å–å™¨æ–¹æ³•ï¼ˆaccessor methodï¼‰</strong>: <code>Object.defineProperty</code> ES5</li>
<li><code>Proxy</code>: ES6 æ”¯æŒè¾ƒå·®ã€Proxies are one of the few non polyfillable additions.ï¼ˆbabelä¸æ”¯æŒè½¬æ¢ï¼‰ã€‘</li>
<li><code>Object.observe</code>: ES7ï¼Œå·²ç»ç§»å‡ºè‰æ¡ˆï¼Œä¸æ”¯æŒ</li>
<li><code>object.watch</code>: ç›®å‰åªæœ‰åŸºäºgeckoçš„æµè§ˆå™¨å¦‚ç«ç‹æ”¯æŒ,å®˜æ–¹å»ºè®®ä»…ä¾›è°ƒè¯•ç”¨</li>
</ul>
<p>å…¶ä¸­å‰ä¸¤ç§æ–¹å¼æ˜¯ä¸»æµï¼Œangularã€Polymer ä½¿ç”¨çš„å°±æ˜¯è„æ£€æŸ¥ï¼ŒVue ä½¿ç”¨çš„å°±æ˜¯å­˜å–å™¨æ–¹æ³•ã€‚</p>
<a id="more"></a>
<h2 id="è„æ£€æŸ¥ï¼ˆdirty-checkï¼‰"><a href="#è„æ£€æŸ¥ï¼ˆdirty-checkï¼‰" class="headerlink" title="è„æ£€æŸ¥ï¼ˆdirty checkï¼‰"></a>è„æ£€æŸ¥ï¼ˆdirty checkï¼‰</h2><p>é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥é˜è¿°è„æ£€æŸ¥çš„åŸç†ï¼š<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> provider = &#123;</div><div class="line">  message: <span class="string">'Hello World'</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> consumer = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>)</div><div class="line"></div><div class="line">observe(provider, <span class="string">'message'</span>, <span class="function"><span class="params">message</span> =&gt;</span> &#123;</div><div class="line">  consumer.innerHTML = message</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>å®šä¹‰ä¸€ä¸ª <code>provider</code> å¯¹è±¡ä½œä¸ºç”Ÿäº§è€…ï¼ŒDOM èŠ‚ç‚¹ <code>consumer</code> ä½œä¸ºæ¶ˆè´¹è€…ï¼Œé€šè¿‡ <code>observe</code> ç›‘å¬ï¼Œç”Ÿäº§è€…æ•°æ®çš„å˜æ›´ä¼šåæ˜ åˆ°æ¶ˆè´¹è€…ä¸Šï¼Œè¿™æ ·ä¹Ÿå°±ç®€å•çš„å®ç°äº†æ•°æ®ç»‘å®šï¼Œå³ç”Ÿäº§è€…æ•°æ®ç»‘å®šåˆ°äº†æ¶ˆè´¹è€…ä¸Šã€‚<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">observe</span> <span class="params">(provider, prop, handler)</span> </span>&#123;</div><div class="line">  provider._handlers[prop] = handler</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è€Œå…¶ä¸­ç›‘å¬å‡½æ•° <code>observe</code> åªæ˜¯å°†å¯¹æŸä¸€ä¸ªå±æ€§çš„ç›‘å¬å›è°ƒ <code>handler</code> ä¿å­˜èµ·æ¥ï¼Œæ–¹ä¾¿åœ¨è¯¥å±æ€§å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰§è¡Œè¯¥å›è°ƒã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ç›‘å¬å˜åŒ–è¿‡ç¨‹äº†ï¼Œè„æ£€æŸ¥ä¹‹æ‰€ä»¥ç§°ä¹‹ä¸º<em>è„</em>ï¼Œæ˜¯å› ä¸ºå…¶ä¸æ˜¯ç›´æ¥ç›‘å¬å±æ€§æ˜¯å¦å‘ç”Ÿäº†å˜æ›´ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå®šæ—¶å™¨è½®è¯¢æ£€æŸ¥ï¼Œä¸æ–­çš„éå†æ£€æŸ¥å¯¹è±¡çš„æ–°å€¼å’Œæ—§å€¼ï¼Œåˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œè‹¥æ˜¯ï¼Œåˆ™è°ƒç”¨ä¼šå›è°ƒå‡½æ•° <code>handler</code> å°†ç”Ÿäº§è€…çš„æ•°æ®åŒæ­¥åˆ°æ¶ˆè´¹è€…ä¸Šã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">digest</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  providers.forEach(digestProvider)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">digestProvider</span> (<span class="params">provider</span>) </span>&#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> provider._handlers) &#123;</div><div class="line">    <span class="keyword">if</span> (provider._prevValues[prop] !== provider[prop]) &#123;</div><div class="line">      provider._prevValues[prop] = provider[prop]</div><div class="line">      handler(provider[prop])</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>æ‰€ä»¥å¯¹äº <code>digest</code> æ–¹æ³•å°±éœ€è¦å¾ªç¯è¿›è¡Œè°ƒç”¨</strong>ï¼Œè­¬å¦‚ä½¿ç”¨ <code>setInterval</code> æˆ–è€… <code>requestAnimationFrame</code> æ–¹æ³•ï¼Œæ˜¾ç„¶è¿™ä¸ªè¿‡ç¨‹ä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ï¼Œå½“ç›‘å¬çš„å¯¹è±¡è¶Šæ¥è¶Šå¤šæ—¶å°¤å…¶æ˜æ˜¾ã€‚</p>
<p>åœ¨ <a href="https://www.polymer-project.org/" target="_blank" rel="external">Polymer</a> 1.0 ç‰ˆæœ¬ä¸­çš„æ•°æ®ç»‘å®šä¹Ÿæ˜¯ä½¿ç”¨è„æ£€æŸ¥çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨å…¶ <code>observe-js-behavior.html</code> æ–‡ä»¶ä¸­æˆ‘ä»¬å°±å‘ç°äº†é€šè¿‡å®šæ—¶å™¨è½®è¯¢è„æ£€æŸ¥çš„ä»£ç ï¼š<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Poll observe-js all the time</span></div><div class="line">setInterval(<span class="keyword">Platform</span>.performMicrotaskCheckpoint, <span class="number">125</span>);</div></pre></td></tr></table></figure></p>
<p>è€Œ angular å°±å¯¹æ­¤ä¹Ÿè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå…¶å¹¶ä¸ä½¿ç”¨å®šæ—¶è½®è¯¢è„æ£€æŸ¥ï¼Œè€Œæ˜¯å¯¹å¸¸ç”¨çš„ DOM äº‹ä»¶ï¼Œ XHR äº‹ä»¶ç­‰è¿›è¡Œå°è£…ï¼Œåœ¨é‡Œé¢è§¦å‘è¿›å…¥è„æ£€æŸ¥ã€‚</p>
<p>è„æ£€æŸ¥åº”è¯¥æ˜¯å®ç°å¯¹è±¡ç›‘å¬æ¯”è¾ƒæˆç†Ÿå’Œå®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚å¯ä»¥å‚è€ƒä»¥ä¸‹ä¸¤ä¸ªé¡¹ç›®:</p>
<ul>
<li><a href="https://github.com/Polymer/observe-js" target="_blank" rel="external">Polymer/observe-js</a></li>
<li><a href="https://github.com/MaxArt2501/object-observe" target="_blank" rel="external">MaxArt2501/object-observe</a></li>
</ul>
<p>è€Œå¯¹äºå‰è€…ï¼Œä¹Ÿæ˜¯ <a href="https://www.polymer-project.org/" target="_blank" rel="external">Polymer</a> æ¡†æ¶ä¸­ä½¿ç”¨çš„ç›‘å¬æ–¹æ¡ˆï¼Œ</p>
<h2 id="å­˜å–å™¨æ–¹æ³•ï¼ˆaccessor-methodï¼‰"><a href="#å­˜å–å™¨æ–¹æ³•ï¼ˆaccessor-methodï¼‰" class="headerlink" title="å­˜å–å™¨æ–¹æ³•ï¼ˆaccessor methodï¼‰"></a>å­˜å–å™¨æ–¹æ³•ï¼ˆaccessor methodï¼‰</h2><p>è¿™ç§æ–¹å¼æ˜¯é€šè¿‡é‡å†™å¯¹è±¡ï¼ˆ<code>Object</code>ç±»å‹ï¼‰å±æ€§çš„ <code>set</code> å’Œ <code>get</code> æ–¹æ³•ï¼Œåœ¨ <code>setter</code> æ–¹æ³•ä¸­æ‰§è¡Œç›¸åº”çš„ç›‘å¬å›è°ƒï¼ˆcallbackï¼‰æ¥å®ç°çš„ã€‚</p>
<p>å¯¹å¯¹è±¡çš„ç›‘å¬éœ€è¦è€ƒè™‘ <code>Object</code> ç±»å‹å’Œ <code>Array</code> ç±»å‹è¿™ä¸¤ç§ç±»å‹<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æƒ…å†µä¸€ï¼šobj1 åªåŒ…å« `Object` ç±»å‹</span></div><div class="line"><span class="selector-tag">var</span> obj1 = &#123;</div><div class="line">  <span class="selector-tag">a</span>: <span class="number">1</span>,</div><div class="line">  <span class="selector-tag">b</span>: <span class="number">2</span>,</div><div class="line">  c: &#123;</div><div class="line">   d: <span class="number">3</span>,</div><div class="line">   e: <span class="number">4</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// æƒ…å†µäºŒï¼šobj2 åŒ…å« `Object` ç±»å‹å’Œ `Array` ç±»å‹</span></div><div class="line"><span class="selector-tag">var</span> obj2 = &#123;</div><div class="line">  <span class="selector-tag">a</span>: <span class="number">1</span>,</div><div class="line">  <span class="selector-tag">b</span>: <span class="number">2</span>,</div><div class="line">  c: [<span class="number">3</span>, <span class="number">4</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><p>é¦–å…ˆæˆ‘ä»¬è€ƒè™‘æƒ…å†µä¸€ï¼Œå¯¹è±¡ä¸­ä¸åŒ…å« <code>Array</code> ç±»å‹<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span> (<span class="params">obj, callback</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> observe = <span class="function"><span class="keyword">function</span> (<span class="params">obj, path</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> type = <span class="built_in">Object</span>.prototype.toString.call(obj);</div><div class="line">    <span class="comment">// Object</span></div><div class="line">    <span class="keyword">if</span>(type === <span class="string">'[object Object]'</span>) &#123;</div><div class="line">     observeObject(obj, path);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">var</span> observeObject = <span class="function"><span class="keyword">function</span> (<span class="params">obj, path</span>) </span>&#123;</div><div class="line">    <span class="comment">// for...in å¯ä»¥éå†å¯¹è±¡çš„å®ä¾‹å±æ€§å’ŒåŸå‹å±æ€§ï¼Œè€Œ Object.keys åªéå†å®ä¾‹å±æ€§</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> obj) &#123;</div><div class="line">      <span class="comment">// æ³¨æ„è¿™é‡Œä¸è¦ç”¨ var</span></div><div class="line">      <span class="keyword">let</span> value = obj[prop],</div><div class="line">        _path = path.slice(); <span class="comment">// ä¸»è¦å¯¹ path æ•°ç»„è¿›è¡Œä¸€æ¬¡æ‹·è´</span></div><div class="line">        _path.push(prop); <span class="comment">// è®°å½•è·¯å¾„</span></div><div class="line">      <span class="built_in">Object</span>.defineProperty(obj, prop, &#123;</div><div class="line">        <span class="attr">set</span>: <span class="function"><span class="keyword">function</span>(<span class="params">newVle</span>) </span>&#123;</div><div class="line">          callback(_path, newVle, value);</div><div class="line">          value = newVle;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">get</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> value;</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">      <span class="comment">// é€’å½’</span></div><div class="line">      observe(value, _path);</div><div class="line">   &#125;</div><div class="line">  &#125;</div><div class="line">  observe(obj, []);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ğŸ“Œæ³¨æ„</strong></p>
<ul>
<li><code>for...in</code> å’Œ <code>Object.keys</code> çš„åŒºåˆ«ï¼Œ<a href="http://objcer.com/2017/02/22/js-enumerable/">å‚è€ƒé“¾æ¥</a></li>
<li><code>for...in</code> å¾ªç¯ä¸­ï¼Œå˜é‡å®šä¹‰ä¸èƒ½ä½¿ç”¨ <code>var</code>ï¼Œéœ€è¦ä½¿ç”¨ <code>let</code> æˆ–è€…ç”¨é—­åŒ…ï¼Œå¦‚ä¸‹<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> obj) &#123;</div><div class="line">  (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> value = obj[prop],</div><div class="line">        _path = path.slice();</div><div class="line">    _path.push(prop); <span class="comment">// è®°å½•è·¯å¾„</span></div><div class="line">    <span class="built_in">Object</span>.defineProperty(obj, prop, &#123;</div><div class="line">      <span class="attribute">set</span>: <span class="function"><span class="keyword">function</span>(<span class="params">newVle</span>) </span>&#123;</div><div class="line">        callback(_path, newVle, value);</div><div class="line">        value = newVle;</div><div class="line">      &#125;,</div><div class="line">      <span class="attribute">get</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="comment">// é€’å½’</span></div><div class="line">    observe(value, _path);</div><div class="line">  &#125;)()</div><div class="line">&#125;</div><div class="line">...</div></pre></td></tr></table></figure>
</li>
</ul>
<p>æµ‹è¯•ä»£ç ï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="string">var</span> <span class="string">obj</span> <span class="string">=</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">  a:</span> <span class="number">1</span><span class="string">,</span></div><div class="line"><span class="attr">  b:</span> <span class="number">2</span><span class="string">,</span></div><div class="line"><span class="attr">  c:</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">   d:</span> <span class="number">3</span><span class="string">,</span></div><div class="line"><span class="attr">   e:</span> <span class="number">4</span></div><div class="line">  <span class="string">&#125;</span></div><div class="line"><span class="string">&#125;;</span></div><div class="line"><span class="string">new</span> <span class="string">Observer(obj,</span> <span class="string">(path,</span> <span class="string">newVle,</span> <span class="string">oldVle)</span> <span class="string">=&gt;</span> <span class="string">&#123;</span></div><div class="line">  <span class="string">console.log(`path:</span> <span class="string">$&#123;path&#125;,</span> <span class="attr">newValue:</span> <span class="string">$&#123;newVle&#125;,</span> <span class="attr">oldValue:</span> <span class="string">$&#123;oldVle&#125;`)</span></div><div class="line"><span class="string">&#125;);</span></div><div class="line"></div><div class="line"><span class="string">obj.a</span> <span class="string">=</span> <span class="number">5</span><span class="string">;</span> <span class="string">//</span> <span class="attr">log:</span> <span class="attr">path:</span> <span class="string">a,</span> <span class="attr">newValue:</span> <span class="number">5</span><span class="string">,</span> <span class="attr">oldValue:</span> <span class="number">1</span></div><div class="line"><span class="string">obj.c.d</span> <span class="string">=</span> <span class="number">6</span><span class="string">;</span> <span class="string">//</span> <span class="attr">log:</span> <span class="attr">path:</span> <span class="string">c,d,</span> <span class="attr">newValue:</span> <span class="number">6</span><span class="string">,</span> <span class="attr">oldValue:</span> <span class="number">3</span></div></pre></td></tr></table></figure></p>
<p><strong>ğŸ’£ å±€é™æ€§</strong><br>é€šè¿‡ <code>Object.defineProperty</code> å®ç°å¯¹å¯¹è±¡çš„ç›‘å¬ï¼Œæˆ‘ä»¬æ˜¯åœ¨ <code>set</code> æ–¹æ³•ä¸­åšæ–‡ç« ï¼Œé‚£ä¹ˆç›‘å¬çš„æƒ…å†µä¹Ÿå°±åªé™äºå¯¹è±¡å±æ€§çš„ä¿®æ”¹ï¼ˆmodifyï¼‰ï¼Œå¦‚æœå¯¹å¯¹è±¡å±æ€§çš„å¢åˆ ï¼ˆadd/deleteï¼‰ï¼Œé‚£ä¹ˆå°±æ— èƒ½ä¸ºåŠ›äº†ã€‚</p>
<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><p>æ¥ç€æˆ‘ä»¬è€ƒè™‘æƒ…å†µäºŒï¼Œå¯¹è±¡ä¸­åŒ…å« <code>Object</code> ç±»å‹å’Œ <code>Array</code> ç±»å‹<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span> (<span class="params">obj, callback</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> observe = <span class="function"><span class="keyword">function</span> (<span class="params">obj, path</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> type = <span class="built_in">Object</span>.prototype.toString.call(obj);</div><div class="line">    <span class="keyword">if</span>(type === <span class="string">'[object Object]'</span> || type== <span class="string">'[object Array]'</span>) &#123;</div><div class="line">      observeObject(obj, path);</div><div class="line">      <span class="keyword">if</span> (type === <span class="string">'[object Array]'</span>) &#123;</div><div class="line">        observeArrayPreparation(obj, path);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">var</span> observeObject = <span class="function"><span class="keyword">function</span> (<span class="params">obj, path</span>) </span>&#123;</div><div class="line">    <span class="comment">// for...in å¯ä»¥éå†å¯¹è±¡çš„å®ä¾‹å±æ€§å’ŒåŸå‹å±æ€§ï¼Œè€Œ Object.keys åªéå†å®ä¾‹å±æ€§</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> obj) &#123;</div><div class="line">      <span class="comment">// æ³¨æ„ï¼šä¸èƒ½ç”¨ var</span></div><div class="line">      <span class="keyword">let</span> value = obj[prop],</div><div class="line">        _path = path.slice(); <span class="comment">// ä¸»è¦å¯¹ path æ•°ç»„è¿›è¡Œä¸€æ¬¡æ‹·è´</span></div><div class="line">        _path.push(prop); <span class="comment">// è®°å½•è·¯å¾„</span></div><div class="line">      <span class="built_in">Object</span>.defineProperty(obj, prop, &#123;</div><div class="line">        <span class="attr">set</span>: <span class="function"><span class="keyword">function</span>(<span class="params">newVle</span>) </span>&#123;</div><div class="line">          callback(_path, newVle, value);</div><div class="line">          value = newVle;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">get</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> value;</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">       <span class="comment">// é€’å½’</span></div><div class="line">       observe(value, _path);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">var</span> observeArrayPreparation = <span class="function"><span class="keyword">function</span> (<span class="params">arr, path</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> _props = [<span class="string">'push'</span>, <span class="string">'pop'</span>, <span class="string">'shift'</span>, <span class="string">'unshift'</span>, <span class="string">'splice'</span>, <span class="string">'sort'</span>, <span class="string">'reverse'</span>];</div><div class="line">    <span class="keyword">var</span> _newProto = <span class="built_in">Object</span>.create(<span class="built_in">Array</span>.prototype);</div><div class="line">    _props.forEach(<span class="function">(<span class="params">prop</span>) =&gt;</span> &#123;</div><div class="line">      <span class="built_in">Object</span>.defineProperty(_newProto, prop, &#123;</div><div class="line">        <span class="attr">value</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// æ³¨æ„ï¼šæ•°ç»„æ–¹æ³•çš„å‚æ•°ä¸ªæ•°ä¸ç¡®å®šï¼Œæ‰€ä»¥æ­¤å¤„æš‚ä¸å¤„ç†</span></div><div class="line">          <span class="keyword">var</span> _path = path.slice();</div><div class="line">          _path.push(prop);</div><div class="line">          <span class="comment">// æ³¨æ„ï¼šæ­¤å¤„åªè¿”å› path</span></div><div class="line">          callback(_path);</div><div class="line">          <span class="built_in">Array</span>.prototype[prop].apply(arr, <span class="built_in">arguments</span>);</div><div class="line">        &#125;</div><div class="line">      &#125;)</div><div class="line">    &#125;);</div><div class="line">    arr.__proto__ = _newProto;</div><div class="line">  &#125;</div><div class="line">  observe(obj, []);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ¶‰åŠåˆ°æ•°ç»„ç±»å‹ï¼Œè§£å†³çš„æ–¹æ³•æ˜¯ï¼Œé‡æ–°å°è£…ä¸€ä¸‹æ•°ç»„çš„æ“ä½œæ–¹æ³• <code>[&#39;push&#39;, &#39;pop&#39;, &#39;shift&#39;, &#39;unshift&#39;, &#39;splice&#39;, &#39;sort&#39;, &#39;reverse&#39;]</code>ï¼Œåœ¨å…¶ä¸­è°ƒç”¨ç›¸åº”çš„ç›‘å¬å›è°ƒ</p>
<p>æµ‹è¯•ä»£ç ï¼š<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">  a: <span class="type">1</span>,</div><div class="line">  b: <span class="type">2</span>,</div><div class="line">  c: <span class="type"></span>[<span class="number">3</span>, <span class="number">4</span>]</div><div class="line">&#125;;</div><div class="line"><span class="keyword">new</span> <span class="type">Observer</span>(obj, (path, <span class="keyword">new</span><span class="type">Vle</span>, oldVle) =&gt; &#123;</div><div class="line">  console.log(`path: <span class="type"></span>$&#123;path&#125;, <span class="keyword">new</span><span class="type">Value</span>: $&#123;<span class="keyword">new</span><span class="type">Vle</span>&#125;, oldValue: <span class="type"></span>$&#123;oldVle&#125;`)</div><div class="line">&#125;);</div><div class="line"></div><div class="line">obj.c[<span class="number">1</span>] = <span class="number">33</span> <span class="comment">// path: c,1, newValue: 33, oldValue: 4</span></div><div class="line"></div><div class="line">obj.c.push(<span class="number">5</span>); <span class="comment">// path: c,push, newValue: undefined, oldValue: undefined</span></div></pre></td></tr></table></figure></p>
<p><strong>ğŸ“Œæ³¨æ„</strong></p>
<ul>
<li>ç”±äºæ•°ç»„ä¸åŒæ“ä½œæ–¹æ³•çš„å‚æ•°ä¸ªæ•°ä¸åŒï¼Œæ‰€ä»¥åœ¨é‡æ–°å®šä¹‰æ—¶éœ€è¦å¯¹æ­¤è¿›è¡Œåˆ¤æ–­å¤„ç†ï¼Œæ­¤å¤„æš‚ä¸å¤„ç†ï¼Œç›‘å¬å›è°ƒä¹Ÿåªè¿”å› path è·¯å¾„</li>
<li>ä¸Šè¿°å¯¹æ•°ç»„çš„å¤„ç†è¿˜å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œè­¬å¦‚æµ‹è¯•ä»£ç ä¸­ï¼Œæ–°æ·»åŠ çš„ <code>5</code> è¿™ä¸ªå€¼å¹¶æ²¡æœ‰è¿›è¡Œç›‘å¬ï¼Œå¦‚æœæ­¤æ—¶å¯¹ <code>obj.c[2]</code> è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆå‘ç°å¹¶æ²¡æœ‰å›è°ƒç›‘å¬å‡½æ•°ï¼›æ‰€ä»¥æ­¤å¤„åªæä¾›ä¸€ä¸ªæ€è·¯ã€‚</li>
</ul>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://blog.risingstack.com/writing-a-javascript-framework-data-binding-dirty-checking/" target="_blank" rel="external">Writing a JavaScript Framework - Introduction to Data Binding, beyond Dirty Checking</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Data binding is a general technique that binds data sources from the provider and consumer together and synchronizes them.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨å‰ç«¯ç»„ä»¶åŒ–æ¡†æ¶ä¸­ï¼ŒåŸºæœ¬éƒ½æœ‰&lt;strong&gt;æ•°æ®ç»‘å®š&lt;/strong&gt;è¿™ä¸€ç‰¹æ€§ï¼Œæ•°æ®ç»‘å®šæ˜¯å°†ç”Ÿäº§è€…çš„æ•°æ®æºç»‘å®šåˆ°æ¶ˆè´¹è€…ï¼Œå¹¶è´Ÿè´£æ•°æ®åŒæ­¥ã€‚æœ¬æ–‡å°†æ¢ç©¶æ•°æ®ç»‘å®šçš„ä¸åŒå®ç°æ–¹å¼ã€‚ğŸ¤“&lt;/p&gt;
&lt;p&gt;ç›®å‰ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è„æ£€æŸ¥ï¼ˆdirty checkï¼‰&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å–å™¨æ–¹æ³•ï¼ˆaccessor methodï¼‰&lt;/strong&gt;: &lt;code&gt;Object.defineProperty&lt;/code&gt; ES5&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Proxy&lt;/code&gt;: ES6 æ”¯æŒè¾ƒå·®ã€Proxies are one of the few non polyfillable additions.ï¼ˆbabelä¸æ”¯æŒè½¬æ¢ï¼‰ã€‘&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Object.observe&lt;/code&gt;: ES7ï¼Œå·²ç»ç§»å‡ºè‰æ¡ˆï¼Œä¸æ”¯æŒ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;object.watch&lt;/code&gt;: ç›®å‰åªæœ‰åŸºäºgeckoçš„æµè§ˆå™¨å¦‚ç«ç‹æ”¯æŒ,å®˜æ–¹å»ºè®®ä»…ä¾›è°ƒè¯•ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä¸­å‰ä¸¤ç§æ–¹å¼æ˜¯ä¸»æµï¼Œangularã€Polymer ä½¿ç”¨çš„å°±æ˜¯è„æ£€æŸ¥ï¼ŒVue ä½¿ç”¨çš„å°±æ˜¯å­˜å–å™¨æ–¹æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="æ•°æ®ç»‘å®š" scheme="http://objcer.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A/"/>
    
      <category term="è„æ£€æŸ¥" scheme="http://objcer.com/tags/%E8%84%8F%E6%A3%80%E6%9F%A5/"/>
    
      <category term="å­˜å–å™¨æ–¹æ³•" scheme="http://objcer.com/tags/%E5%AD%98%E5%8F%96%E5%99%A8%E6%96%B9%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Web Components</title>
    <link href="http://objcer.com/2017/10/20/Web-Components/"/>
    <id>http://objcer.com/2017/10/20/Web-Components/</id>
    <published>2017-10-20T08:35:02.000Z</published>
    <updated>2017-10-20T08:36:08.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/web-components.png" alt=""></p>
<p>ç»„ä»¶æ˜¯æ„å»ºç°ä»£ç½‘é¡µåº”ç”¨çš„åŸºç¡€ã€‚ç»„ä»¶åŒ–ç»™å‰ç«¯å¼€å‘å¸¦æ¥äº†æå¤§çš„æ•ˆç‡æå‡ï¼Œæé«˜äº†ä»£ç çš„é‡ç”¨æ€§ï¼›ç»„ä»¶åŒ–çš„ UI æ¡†æ¶ä¹Ÿå±‚å‡ºä¸ç©·ï¼ŒReact, Vue ç­‰ç­‰ã€‚ä½†æ˜¯è¿™äº›æ¡†æ¶ç¼ºä¹æ ‡å‡†ï¼Œä»£ç å±‚é¢å¯èƒ½å­˜åœ¨å¾ˆå¤§çš„å·®å¼‚ï¼Œå¦‚ä½•å¯¹å‰ç«¯ç»„ä»¶æ ‡å‡†åŒ–å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚<br>Web Components ä½œä¸ºé¢å‘æœªæ¥çš„ Web ç»„ä»¶åŒ–æ ‡å‡†ï¼ŒåŒ…æ‹¬ HTML Templates, Shadow DOM, Custom elements å’Œ HTML Imports å››éƒ¨åˆ†ï¼Œæµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œæ‰€ä»¥ Web Components æ˜¯æœ€å½»åº•çš„ç»„ä»¶åŒ–è§£å†³æ–¹æ¡ˆã€‚</p>
<a id="more"></a>
<h2 id="Web-Components"><a href="#Web-Components" class="headerlink" title="Web Components"></a>Web Components</h2><p>Web Components åŒ…æ‹¬ HTML Templates, Shadow DOM, Custom elements å’Œ HTML Imports å››éƒ¨åˆ†ï¼Œ éœ€è¦æµè§ˆå™¨æ”¯æŒï¼Œä½†æ˜¯ç›®å‰ä¸ºæ­¢ï¼Œæœªè¢«æ‰€æœ‰æµè§ˆå™¨å®Œæ•´å®ç°ã€‚<br>å‚è€ƒ <a href="https://www.webcomponents.org/" target="_blank" rel="external">https://www.webcomponents.org/</a> ç»™å‡ºçš„æµè§ˆå™¨æ”¯æŒæƒ…å†µï¼š</p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/web-component-browser-support.png" alt=""></p>
<p>åŸºäº Web Componentsï¼ŒGoogle æ¨å‡ºäº† <a href="https://www.polymer-project.org/" target="_blank" rel="external">Polymer</a> æ¡†æ¶ï¼Œä½œä¸ºåº”ç”¨å±‚æ¡†æ¶ï¼Œä½¿ç”¨ Polymer ç›¸è¾ƒäºç›´æ¥ä½¿ç”¨ Web Components æ¥å£ï¼Œå¼€å‘ç½‘é¡µåº”ç”¨æ›´åŠ æ–¹ä¾¿ç®€æ´ï¼Œæé«˜æ•ˆç‡ã€‚Polymer åœ¨ä»Šå¹´ 5 æœˆä»½ï¼Œæ¨å‡º <a href="https://www.polymer-project.org/blog/2017-05-15-time-for-two.html" target="_blank" rel="external">Polymer 2.0</a>ï¼Œä½¿ç”¨ Shadow DOM v1 å’Œ Custom elements v1ï¼Œå¯¹äºä¸å…¼å®¹çš„æµè§ˆå™¨ï¼Œä¹Ÿæä¾›äº† polyfillã€‚è€Œåœ¨ä»Šå¹´ Polymer Summit å¤§ä¼šä¸Šï¼Œæ¨å‡ºäº†æœ€æ–° <a href="https://www.polymer-project.org/blog/2017-08-22-npm-modules.html" target="_blank" rel="external">Polymer 3.0 preview</a>ï¼Œä¹ŸæŒ‡æ˜äº† Polymer æœ€æ–°çš„å‘å±•æ–¹å‘ï¼Œå…¶ä¸­ä¸»è¦å˜åŒ–æ˜¯ï¼šâ‘  ä» bower è½¬å‘ npm â‘¡ ä½¿ç”¨ ES6 modulesï¼Œå¼ƒç”¨ HTML Imports</p>
<p><a href="https://developers.google.com/web/fundamentals/web-components/" target="_blank" rel="external">Building Components</a> ç³»åˆ—æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»äº† Custom Elements å’Œ Shadow DOMï¼Œé˜…è¯»åæ•´ç†å¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://objcer.com/2017/10/20/Custom-Elements/">Custom Elements</a></li>
<li><a href="https://objcer.com/2017/10/20/Shadow-DOM/">Shadow DOM</a></li>
</ul>
<p>é€šè¿‡ Web Components å¼€å‘è‡ªå®šä¹‰ç»„ä»¶å°±æ˜¯ç”¨ Custom Elements åšå¤–å£³ï¼Œå…¶ä¸­å»ºç«‹ Shadow DOM æä¾› DOM å°è£…ï¼Œä½œç”¨åŸŸ CSS ç­‰ç‰¹æ€§ï¼Œé€šè¿‡ template æ¨¡æ¿æ„å»º DOMï¼Œæ¯ä¸€ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ª html æ–‡ä»¶ï¼Œä½¿ç”¨æ—¶é€šè¿‡ HTML Importå¼•å…¥ã€‚</p>
<p>å…³äº Web Components ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šè®¨è®ºè´¨ç–‘çš„å£°éŸ³ï¼š<br><a href="https://github.com/dt-fe/weekly/issues/15" target="_blank" rel="external">ç²¾è¯»ã€ŠWeb Components çš„å›°å¢ƒã€‹</a></p>
<h2 id="Polymer"><a href="#Polymer" class="headerlink" title="Polymer"></a>Polymer</h2><p>Polymer æ˜¯åŸºäº Web Components çš„ç»„ä»¶åŒ–æ¡†æ¶ï¼Œäº†è§£ Web Components å¯¹äºç†è§£ä½¿ç”¨ Polymer æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚Polymer å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹å››å¤§éƒ¨åˆ†å†…å®¹ï¼š</p>
<ul>
<li>Custom elements</li>
<li>Shadow DOM</li>
<li>Events</li>
<li>Data system</li>
</ul>
<p>å…³äº Polymer çš„å­¦ä¹ ä¼šé€šè¿‡ä¸‹ä¸€ä¸ªç³»åˆ—æ–‡ç« è¿›è¡Œè®°å½•ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/web-components.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç»„ä»¶æ˜¯æ„å»ºç°ä»£ç½‘é¡µåº”ç”¨çš„åŸºç¡€ã€‚ç»„ä»¶åŒ–ç»™å‰ç«¯å¼€å‘å¸¦æ¥äº†æå¤§çš„æ•ˆç‡æå‡ï¼Œæé«˜äº†ä»£ç çš„é‡ç”¨æ€§ï¼›ç»„ä»¶åŒ–çš„ UI æ¡†æ¶ä¹Ÿå±‚å‡ºä¸ç©·ï¼ŒReact, Vue ç­‰ç­‰ã€‚ä½†æ˜¯è¿™äº›æ¡†æ¶ç¼ºä¹æ ‡å‡†ï¼Œä»£ç å±‚é¢å¯èƒ½å­˜åœ¨å¾ˆå¤§çš„å·®å¼‚ï¼Œå¦‚ä½•å¯¹å‰ç«¯ç»„ä»¶æ ‡å‡†åŒ–å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚&lt;br&gt;Web Components ä½œä¸ºé¢å‘æœªæ¥çš„ Web ç»„ä»¶åŒ–æ ‡å‡†ï¼ŒåŒ…æ‹¬ HTML Templates, Shadow DOM, Custom elements å’Œ HTML Imports å››éƒ¨åˆ†ï¼Œæµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œæ‰€ä»¥ Web Components æ˜¯æœ€å½»åº•çš„ç»„ä»¶åŒ–è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Web Components" scheme="http://objcer.com/categories/Web-Components/"/>
    
    
      <category term="Web Components" scheme="http://objcer.com/tags/Web-Components/"/>
    
  </entry>
  
  <entry>
    <title>Shadow DOM</title>
    <link href="http://objcer.com/2017/10/20/Shadow-DOM/"/>
    <id>http://objcer.com/2017/10/20/Shadow-DOM/</id>
    <published>2017-10-20T08:08:02.000Z</published>
    <updated>2017-10-20T08:11:56.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/shadow-dom.png" alt=""><br>Shadow DOM æ˜¯å››å¤§ç½‘ç»œç»„ä»¶æ ‡å‡†ä¹‹ä¸€ï¼Œæä¾› CSS ä½œç”¨åŸŸã€DOM å°è£…å’Œç»„åˆ(Composition) ç­‰ä¼˜åŠ¿ï¼Œæ„å»ºè‡ªå®šä¹‰å…ƒç´ ã€‚</p>
<a id="more"></a>
<h2 id="ä»€ä¹ˆæ˜¯-Shadow-DOM"><a href="#ä»€ä¹ˆæ˜¯-Shadow-DOM" class="headerlink" title="ä»€ä¹ˆæ˜¯ Shadow DOM"></a>ä»€ä¹ˆæ˜¯ Shadow DOM</h2><p>æµè§ˆå™¨åœ¨è§£æç½‘é¡µæ–‡æ¡£çš„æ—¶å€™ï¼Œä¼šå°† HTML æ ‡ç­¾è½¬æ¢æˆèŠ‚ç‚¹ï¼Œä¸ºäº†ä¿æŒé¡µé¢çš„å±‚æ¬¡ç»“æ„ï¼Œè¿™äº›èŠ‚ç‚¹æ„æˆä¸€ä¸ªèŠ‚ç‚¹æ ‘ï¼Œè¿™ä¸ªç»“æ„å°±æ˜¯ DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰ã€‚DOM å°†æ–‡æ¡£ä½œä¸ºä¸€ä¸ªç»“æ„åŒ–çš„èŠ‚ç‚¹ç»„ä»¥åŠåŒ…å«å±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡ï¼Œæ˜¯ HTML çš„ç¼–ç¨‹æ¥å£ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ JavaScript æ¥è®¿é—®æ“çºµ DOMã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> header = <span class="built_in">document</span>.createElement(<span class="string">'header'</span>);</div><div class="line"><span class="keyword">const</span> h1 = <span class="built_in">document</span>.createElement(<span class="string">'h1'</span>);</div><div class="line">h1.textContent = <span class="string">'Hello world!'</span>;</div><div class="line">header.appendChild(h1);</div><div class="line"><span class="built_in">document</span>.body.appendChild(header);</div></pre></td></tr></table></figure></p>
<p>è¿™æ®µ JavaScript ä»£ç æ‰§è¡Œåä¼šç”Ÿæˆå¦‚ä¸‹çš„ DOM ç»“æ„ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello DOM<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>é‚£ä»€ä¹ˆæ˜¯ Shadow DOM å‘¢â“<br>Shadow DOM ä¸º Web ç»„ä»¶ä¸­çš„ DOM å’Œ CSS æä¾›äº†å°è£…ã€‚Shadow DOM ä½¿å¾—è¿™äº›ä¸œè¥¿ä¸ä¸»æ–‡æ¡£çš„ DOM ä¿æŒåˆ†ç¦»ã€‚Shadow DOM ä¸æ™®é€šçš„ DOM çš„åŒºåˆ«æ˜¯ï¼š<br>ğŸ‘‰ é€šå¸¸åˆ›å»ºæ–°çš„ DOM èŠ‚ç‚¹é™„åŠ åˆ°å…¶ä»– DOM å…ƒç´ ä¸Šï¼Œå°±ä¼šæˆä¸ºå…¶å­èŠ‚ç‚¹ï¼ˆå…ƒç´ ï¼‰ï¼›ä½†å€ŸåŠ© Shadow DOMï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª  DOM æ ‘é™„åŠ åˆ°å…¶ä»–å…ƒç´ ä¸Šï¼Œè¿™ä¸ª DOM æ ‘å¹¶éå…¶å­èŠ‚ç‚¹ï¼ˆå…ƒç´ ï¼‰ï¼Œå…¶æ‹¥æœ‰è‡ªèº«çš„ä½œç”¨åŸŸèŒƒå›´ï¼Œè¿™ä¸ª DOM æ ‘ç§°ä¸ºï¼š<strong><code>shadwo tree</code></strong>ã€‚è¢«é™„åŠ çš„å…ƒç´ ç§°ä¸º <strong><code>shadow host</code></strong>ï¼Œè¿™ä¸ª DOM æ ‘ç§°ä¸º <strong><code>shadow root</code></strong>ã€‚</p>
<blockquote>
<p>You can think of shadow DOM as a scoped subtree inside your element.</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> header = <span class="built_in">document</span>.createElement(<span class="string">'header'</span>);</div><div class="line"><span class="keyword">const</span> shadowRoot = header.attachShadow(&#123;mode: <span class="string">'open'</span>&#125;);</div><div class="line">shadowRoot.innerHTML = <span class="string">'&lt;h1&gt;Hello Shadow DOM&lt;/h1&gt;'</span>; <span class="comment">// Could also use appendChild().</span></div><div class="line"></div><div class="line"><span class="comment">// header.shadowRoot === shadowRoot</span></div><div class="line"><span class="comment">// shadowRoot.host === header</span></div></pre></td></tr></table></figure>
<ul>
<li>ä¸ºå…ƒç´ åˆ›å»º shadow DOMï¼Œè°ƒç”¨ <code>element.attachShadow()</code></li>
<li>é€šè¿‡ <code>shadowRoot</code> å±æ€§è·å–å…ƒç´ é™„åŠ çš„ Shadow DOM</li>
<li>é€šè¿‡ shadow root çš„ <code>host</code> å±æ€§è·å–å…¶é™„å±çš„å…ƒç´ </li>
</ul>
<p>â—ï¸<strong>æ³¨æ„ï¼š</strong>å¹¶éæ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥è°ƒç”¨ <code>element.attachShadow()</code> ä¸ºå…¶åˆ›å»ºæ·»åŠ  Shadow DOMï¼Œå› ä¸ºæœ‰äº›å…ƒç´ æµè§ˆå™¨å·²ç»ä¸ºå…¶æ·»åŠ äº† Shadow DOMï¼Œä¾‹å¦‚ <code>&lt;textarea&gt;</code> <code>&lt;input&gt;</code>ï¼›è€Œè¿˜æœ‰äº›å…ƒç´ ä¸ºå…¶æ·»åŠ  Shadow DOM æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä¾‹å¦‚ <code>&lt;img&gt;</code>ã€‚</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">document</span><span class="selector-class">.createElement</span>(<span class="string">'input'</span>)<span class="selector-class">.attachShadow</span>(&#123;<span class="attribute">mode</span>: <span class="string">'open'</span>&#125;);</div><div class="line"><span class="comment">// Error. `&lt;input&gt;` cannot host shadow dom.</span></div></pre></td></tr></table></figure>
<p>åœ¨åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ æ—¶ï¼ŒShadow DOM å°¤å…¶æœ‰ç”¨ã€‚ä½¿ç”¨ Shadow DOM æ¥åˆ†éš”å…ƒç´ çš„ HTMLã€CSS å’Œ JSï¼Œä»è€Œç”Ÿæˆä¸€ä¸ªç»„ä»¶ã€‚<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">window.customElements.define(<span class="symbol">'x</span>-tag', <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</div><div class="line">  constructor() &#123;</div><div class="line">    <span class="keyword">super</span>()</div><div class="line"></div><div class="line">    let shadowRoot = <span class="keyword">this</span>.attachShadow(&#123;mode: <span class="symbol">'ope</span>n'&#125;)</div><div class="line">    shadowRoot.innerHTML = `</div><div class="line">    &lt;style&gt;</div><div class="line">    b &#123;</div><div class="line">      color: red;</div><div class="line">    &#125;</div><div class="line">    &lt;/style&gt;</div><div class="line">    &lt;b&gt;<span class="type">Hello</span> world&lt;/b&gt;</div><div class="line">    `</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>æ³¨æ„ Shadow DOM ä¸­çš„ CSS è§„åˆ™çš„ä½œç”¨åŸŸä»…é™äº <code>&lt;x-tag&gt;</code>ã€‚</p>
<h2 id="ç»„åˆå’Œ-slot"><a href="#ç»„åˆå’Œ-slot" class="headerlink" title="ç»„åˆå’Œ slot"></a>ç»„åˆå’Œ slot</h2><p>ç»„åˆæ˜¯ shadow DOM æœ€éš¾ç†è§£çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œä½†å¯ä»¥è¯´æ˜¯æœ€é‡è¦çš„åŠŸèƒ½ã€‚</p>
<h3 id="light-DOM-å’Œ-shadow-DOM"><a href="#light-DOM-å’Œ-shadow-DOM" class="headerlink" title="light DOM å’Œ shadow DOM"></a>light DOM å’Œ shadow DOM</h3><p><strong>light DOM</strong><br>ä½¿ç”¨ç»„ä»¶çš„ç”¨æˆ·ç¼–å†™çš„æ ‡è®°ï¼ŒDOM å…ƒç´ çš„å®é™…å­å…ƒç´ ï¼Œè¯¥å­å…ƒç´ ä¸åœ¨ç»„ä»¶çš„ shadow DOM ä¹‹å†…ï¼Œè¿™å°±æ˜¯ light DOMã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">is</span>=<span class="string">"better-button"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- the image and span are better-button's light DOM --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"gear.svg"</span> <span class="attr">slot</span>=<span class="string">"icon"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>Settings<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ <code>image</code> å’Œ <code>span</code> å³æ˜¯ <code>button</code> çš„ light DOMã€‚</p>
<p><strong>shadow DOM</strong><br>ç»„ä»¶ä½œè€…ç¼–å†™çš„æ ‡è®°ï¼Œå®ƒå®šä¹‰ç»„ä»¶çš„å†…éƒ¨ç»“æ„ï¼Œä½œç”¨åŸŸ CSS ç­‰<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#shadow-root</div><div class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined">...</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"icon"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"wrapper"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span>Button<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>Flattened DOM tree</strong><br>æµè§ˆå™¨å°†ç”¨æˆ·çš„ light DOM åˆ†å¸ƒåˆ° shadow DOM ä¸­ï¼Œæ¸²æŸ“æˆä¸€é¢— DOM æ ‘ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <strong><code>flattening the tree</code></strong>ï¼Œè¿™æ£µæ ‘ç§°ä¸ºæ‰å¹³æ ‘ <strong><code>Flattened DOM tree</code></strong>ã€‚ æ‰å¹³æ ‘ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ DevTools ä¸­æœ€ç»ˆçœ‹åˆ°çš„æ ‘ä»¥åŠåœ¨é¡µé¢ä¸Šæ¸²æŸ“çš„ç»“æœã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/FF183E44-E19D-4B24-918B-2DE5067699A4.png" alt=""></p>
<h3 id="å…ƒç´ "><a href="#å…ƒç´ " class="headerlink" title=" å…ƒç´ "></a><slot> å…ƒç´ </slot></h3><p>Shadow DOM ä½¿ç”¨ <code>&lt;slot&gt;</code> å…ƒç´ å°† light DOM æ ‘ç»„åˆåˆ° shadow DOM ä¸­ï¼Œå½¢æˆä¸€é¢— DOM æ ‘ã€‚</p>
<p>Slot ç›¸å½“äºæ˜¯ç»„ä»¶å†…éƒ¨çš„å ä½ç¬¦ï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª <code>&lt;slot&gt;</code>ï¼Œå¯ä»¥å°†å¤–éƒ¨çš„æ ‡è®°å¼•å…¥åˆ°ç»„ä»¶ shadow DOM ä¸­è¿›è¡Œæ¸²æŸ“ï¼Œç›¸å½“äºâ€œè·¨åŸŸâ€äº† shadow DOM çš„è¾¹ç•Œï¼Œè¿™äº›å¼•å…¥åˆ° shadow DOM ä¸­çš„å…ƒç´ è¢«ç§°ä¸ºåˆ†å¸ƒå¼èŠ‚ç‚¹ <strong><code>distributed nodes</code></strong>ã€‚æ³¨æ„ï¼šslot å®é™…ä¸Šå¹¶ä¸ç§»åŠ¨è¿™äº›åˆ†å¸ƒå¼èŠ‚ç‚¹ï¼Œå®ƒä»¬åœ¨ shadow DOM å†…éƒ¨çš„å…¶ä»–ä½ç½®è¿›è¡Œæ¸²æŸ“ã€‚</p>
<p>ç»„ä»¶å¯åœ¨å…¶ shadow DOM ä¸­å®šä¹‰é›¶ä¸ªæˆ–å¤šä¸ª slotã€‚Slot å¯ä»¥ä¸ºç©ºï¼Œæˆ–è€…æä¾›å›é€€å†…å®¹(fallback content)ï¼Œå¦‚æœç”¨æˆ·ä¸æä¾› light DOM å†…å®¹ï¼Œslot ä¼šå°†å¯¹å…¶å¤‡ç”¨å†…å®¹è¿›è¡Œæ¸²æŸ“ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- Default slot. If there's more than one default slot, the first is used. --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">slot</span>&gt;</span>Fancy button<span class="tag">&lt;/<span class="name">slot</span>&gt;</span> <span class="comment">&lt;!-- default slot with fallback content --&gt;</span></div></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥åˆ›å»ºå‘½å slot (named slots)ï¼Œä½¿ç”¨ç»„ä»¶çš„ç”¨æˆ·é€šè¿‡åç§°æ‰¾åˆ°ç‰¹å®šçš„ slotã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">x-tag</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">slot</span>=<span class="string">"title"</span>&gt;</span>Custom Elements<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">x-tag</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">#shadow-root</div><div class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">  <span class="selector-tag">b</span> &#123;</div><div class="line">    <span class="attribute">color</span>: red;</div><div class="line">  &#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">b</span>&gt;</span>Hello world<span class="tag">&lt;/<span class="name">b</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"title"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="è®¾å®šæ ·å¼"><a href="#è®¾å®šæ ·å¼" class="headerlink" title="è®¾å®šæ ·å¼"></a>è®¾å®šæ ·å¼</h2><p>shadow DOM æœ€æœ‰ç”¨çš„åŠŸèƒ½æ˜¯ä½œç”¨åŸŸ CSSï¼š</p>
<ul>
<li>å¤–éƒ¨é¡µé¢ä¸­çš„ CSS é€‰æ‹©å™¨ä¸ä¼šåº”ç”¨äºç»„ä»¶å†…éƒ¨ã€‚</li>
<li>ç»„ä»¶å†…éƒ¨å®šä¹‰çš„æ ·å¼ä¹Ÿä¸ä¼šæ¸—å‡ºï¼Œå®ƒä»¬çš„ä½œç”¨åŸŸä»…é™äºå®¿ä¸»å…ƒç´ (shadow host)</li>
</ul>
<h3 id="é€šè¿‡é€‰æ‹©å™¨è®¾å®šæ ·å¼"><a href="#é€šè¿‡é€‰æ‹©å™¨è®¾å®šæ ·å¼" class="headerlink" title="é€šè¿‡é€‰æ‹©å™¨è®¾å®šæ ·å¼"></a>é€šè¿‡é€‰æ‹©å™¨è®¾å®šæ ·å¼</h3><p><strong>ä½¿ç”¨ <code>:host</code> ä¸ºç»„ä»¶ä¸ºè‡ªèº«è®¾å®šæ ·å¼</strong><br>éœ€è¦æ³¨æ„ï¼šå¤–éƒ¨é¡µé¢ä¸­ä¸ºç»„ä»¶è®¾å®šçš„æ ·å¼æ¯” <code>:host</code> è§„åˆ™å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºç»„ä»¶è‡ªèº«ï¼Œå¤–éƒ¨æ ·å¼ä¼˜å…ˆï¼Œç”¨æˆ·å¯ä»¥åœ¨å¤–éƒ¨è®¾ç½®ç»„ä»¶è‡ªèº«çš„æ ·å¼ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// å¤–éƒ¨æ ·å¼æ¯” :host ä¼˜å…ˆ</div><div class="line">x-tag &#123;</div><div class="line">  border: 1px solid red;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#shadow-root</div><div class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">  <span class="selector-pseudo">:host</span> &#123;</div><div class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid green;</div><div class="line">  &#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>ä½¿ç”¨ <code>:host(&lt;selector&gt;)</code> åŒ¹é…ç»„ä»¶è‡ªèº«ä¸åŒçŠ¶æ€</strong><br>é€šè¿‡ <code>:host(&lt;selector&gt;)</code> åŒ¹é…ä¸åŒçŠ¶æ€ï¼Œå¯¹ç»„ä»¶è‡ªèº«æˆ–è€…å†…éƒ¨èŠ‚ç‚¹è®¾å®šä¸åŒçš„æ ·å¼<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#shadow-root</div><div class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">  <span class="selector-pseudo">:host(</span><span class="selector-pseudo">:hover)</span> &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">  <span class="selector-pseudo">:host(.red_bg)</span> &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">  <span class="selector-pseudo">:host(.green_bg)</span> &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">  <span class="selector-pseudo">:host(.disable)</span> <span class="selector-tag">button</span> &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>ä½¿ç”¨ <code>:host-context(&lt;selector&gt;)</code> åŒ¹é…ä»»æ„çˆ¶çº§</strong><br>ä½¿ç”¨ <code>:host-context(&lt;selector&gt;)</code> ä¸»è¦ç”¨äºæ ¹æ®ç»„ä»¶æ‰€åœ¨çš„ç¯å¢ƒè¿›è¡Œä¸»é¢˜åŒ–ï¼ˆåŸºäºæƒ…å¢ƒè®¾å®šæ ·å¼ï¼‰ï¼Œä¾‹å¦‚è®¾ç½®ç™½å¤©æ¨¡å¼ï¼Œå¤œæ™šæ¨¡å¼ï¼Œæˆ‘ä»¬åœ¨ <code>&lt;html&gt;</code> æˆ–è€… <code>&lt;body&gt;</code> è®¾å®šä¸åŒçš„ classï¼Œè€Œç»„ä»¶é€šè¿‡ <code>:host-context(&lt;selector&gt;)</code> å°±å¯ä»¥åŒ¹é…åˆ°</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="params">&lt;body class="darktheme"&gt;</span></div><div class="line">  <span class="params">&lt;fancy-tabs&gt;</span></div><div class="line">    ...</div><div class="line">  <span class="params">&lt;/fancy-tabs&gt;</span></div><div class="line"><span class="params">&lt;/body&gt;</span></div><div class="line"></div><div class="line"><span class="meta">#shadow-root</span></div><div class="line">  :host-context(.darktheme) &#123;</div><div class="line"><span class="symbol">    color:</span> white;</div><div class="line"><span class="symbol">    background:</span> black;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p><strong>ä½¿ç”¨ <code>::slotted(&lt;compound-selector&gt;)</code> åŒ¹é…åˆ†å¸ƒåˆ° <slot> ä¸­çš„èŠ‚ç‚¹</slot></strong><br>ä½¿ç”¨ <code>::slotted(&lt;compound-selector&gt;)</code> ä¸ºåˆ†å¸ƒå¼èŠ‚ç‚¹è®¾å®šæ ·å¼<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">name-badge</span>&gt;</span></div><div class="line">  #shadow-root</div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Eric Bidelman<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span></div><div class="line">      Digital Jedi, <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"company"</span>&gt;</span>Google<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">name-badge</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>ç»„ä»¶çš„ shadow DOM å¯ä¸ºç”¨æˆ·çš„ <code>&lt;h2&gt;</code> å’Œ <code>.title</code> è®¾å®šæ ·å¼ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">  <span class="selector-pseudo">::slotted(h2)</span> &#123;</div><div class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">font-weight</span>: <span class="number">300</span>;</div><div class="line">    <span class="attribute">color</span>: red;</div><div class="line">  &#125;</div><div class="line">  <span class="selector-pseudo">::slotted(.title)</span> &#123;</div><div class="line">     <span class="attribute">color</span>: orange;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">/* DOESN'T WORK (can only select top-level nodes).</span></div><div class="line">  ::slotted(.company),</div><div class="line">  ::slotted(.title .company) &#123;</div><div class="line">    text-transform: uppercase;</div><div class="line">  &#125;</div><div class="line">  */</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br>â‘  ä½¿ç”¨ <code>::slotted(&lt;compound-selector&gt;)</code> åªèƒ½ä¸ºåˆ†å¸ƒèŠ‚ç‚¹çš„<strong>é¡¶çº§èŠ‚ç‚¹</strong>è®¾ç½®æ ·å¼ã€‚<br>â‘¡ slot å¹¶ä¸ä¼šç§»åŠ¨ light DOMï¼Œlight DOM èŠ‚ç‚¹åˆ†å¸ƒåˆ° shadow DOM ä¸­åï¼Œslot ä¼šå¯¹å…¶ DOM è¿›è¡Œæ¸²æŸ“ï¼Œæ ·å¼è®¾ç½®ï¼Œä½†æ˜¯èŠ‚ç‚¹å®é™…è¿˜æ˜¯ç•™åœ¨åŸå¤„ã€‚å¦‚æœå¤–éƒ¨å¯¹ light DOM è®¾ç½®äº†æ ·å¼ï¼Œé‚£ä¹ˆå¤–éƒ¨æ ·å¼å°†ä¼šè¦†ç›– shadow DOM ä¸­é€šè¿‡ <code>::slotted(&lt;compound-selector&gt;)</code> è®¾ç½®çš„æ ·å¼ï¼Œå…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line">  x-tag p &#123;</div><div class="line">    color: red; // å¤–éƒ¨æ ·å¼ï¼Œå…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§</div><div class="line">  &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">x-tag</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">slot</span>=<span class="string">"title"</span>&gt;</span>Custom Elements<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">x-tag</span>&gt;</span></div><div class="line"></div><div class="line">#shadow-root</div><div class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">  <span class="selector-pseudo">::slotted(p)</span> &#123;</div><div class="line">    <span class="attribute">color</span>: green;</div><div class="line">  &#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="ä»å¤–éƒ¨ä¸ºç»„ä»¶è®¾å®šæ ·å¼"><a href="#ä»å¤–éƒ¨ä¸ºç»„ä»¶è®¾å®šæ ·å¼" class="headerlink" title="ä»å¤–éƒ¨ä¸ºç»„ä»¶è®¾å®šæ ·å¼"></a>ä»å¤–éƒ¨ä¸ºç»„ä»¶è®¾å®šæ ·å¼</h3><p>æœ‰å‡ ç§æ–¹æ³•å¯ä»å¤–éƒ¨ä¸ºç»„ä»¶è®¾å®šæ ·å¼ï¼šæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ ‡è®°åç§°ä½œä¸ºé€‰æ‹©å™¨</p>
<p><strong>ä¸ºç»„ä»¶è‡ªèº«è®¾å®šæ ·å¼</strong><br>ä»å¤–éƒ¨ä¸ºç»„ä»¶è‡ªèº«è®¾å®šæ ·å¼æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ç»„ä»¶æ ‡ç­¾åç§°ä½œä¸ºé€‰æ‹©å™¨ï¼Œè®¾ç½® CSS æ ·å¼ã€‚<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">x-<span class="keyword">tag</span> <span class="title">&#123;</span></div><div class="line"></div><div class="line">&#125;</div><div class="line">x-tag:hover &#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼š<strong>å¤–éƒ¨æ ·å¼æ€»æ˜¯ä¼˜å…ˆäºåœ¨ shadow DOM ä¸­å®šä¹‰çš„æ ·å¼ã€‚</strong>ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·åœ¨ç»„ä»¶å¤–éƒ¨ç¼–å†™ï¼š<code>fancy-tabs { width: 500px; }</code>ï¼Œå®ƒå°†ä¼˜å…ˆäºç»„ä»¶çš„è§„åˆ™ï¼š<code>:host { width: 650px;}</code>ã€‚</p>
<p><strong>ä¸ºç»„ä»¶å†…éƒ¨å…ƒç´ è®¾å®šæ ·å¼</strong><br>åœ¨ç»„ä»¶å¤–éƒ¨ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡é€‰æ‹©å™¨å¯¹ç»„ä»¶å†…çš„å…ƒç´ è®¾ç½®æ ·å¼ã€‚ç»„ä»¶æä¾›è‡ªå®šä¹‰å±æ€§ <strong>custom properties</strong>ï¼Œç›¸å½“äºæ˜¯æ ·å¼å ä½ç¬¦ï¼Œå¤–éƒ¨é€šè¿‡å¯¹è‡ªå®šä¹‰å±æ€§ <strong>custom properties</strong> æ¥è°ƒæ•´ç»„ä»¶å†…éƒ¨å…ƒç´ çš„æ ·å¼ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ<code>&lt;fancy-tabs&gt;</code> å¯è®©ç”¨æˆ·æ›¿æ¢èƒŒæ™¯é¢œè‰²ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- main page --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">  <span class="selector-tag">fancy-tabs</span> &#123;</div><div class="line">    <span class="attribute">margin-bottom</span>: <span class="number">32px</span>;</div><div class="line">    <span class="attribute">--fancy-tabs-bg</span>: black;</div><div class="line">  &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">fancy-tabs</span> <span class="attr">background</span>&gt;</span>...<span class="tag">&lt;/<span class="name">fancy-tabs</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>åœ¨å…¶ shadow DOM å†…éƒ¨ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-pseudo">:host(</span><span class="selector-attr">[background]</span>) &#123;</div><div class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--fancy-tabs-bg, #9E9E9E);</div><div class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</div><div class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥ç»„ä»¶å°†ä½¿ç”¨ <code>black</code> ä½œä¸ºèƒŒæ™¯å€¼ï¼Œå› ä¸ºç”¨æˆ·æŒ‡å®šäº†è¯¥å€¼ã€‚ å¦åˆ™èƒŒæ™¯é¢œè‰²å°†é‡‡ç”¨é»˜è®¤å€¼ <code>#9E9E9E</code>ã€‚</p>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="é¿å…åœ¨ç»„ä»¶ä¸­åˆ›å»º-closed-shadow-root"><a href="#é¿å…åœ¨ç»„ä»¶ä¸­åˆ›å»º-closed-shadow-root" class="headerlink" title="é¿å…åœ¨ç»„ä»¶ä¸­åˆ›å»º closed shadow root"></a>é¿å…åœ¨ç»„ä»¶ä¸­åˆ›å»º closed shadow root</h3><p>shadow DOM çš„å¦ä¸€æƒ…å†µç§°ä¸º<strong>é—­åˆ</strong>æ¨¡å¼ã€‚åˆ›å»ºclosed shadow DOM tree åï¼Œåœ¨å¤–éƒ¨æ— æ³•é€šè¿‡ JavaScript è®¿é—®ç»„ä»¶çš„å†…éƒ¨ DOMã€‚è¿™ä¸ <code>&lt;video&gt;</code> ç­‰åŸç”Ÿå…ƒç´ å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼ŒJavaScript æ— æ³•è®¿é—® <code>&lt;video&gt;</code> çš„ shadow DOMï¼Œå› ä¸ºæµè§ˆå™¨ä½¿ç”¨closed shadow rootæ¥å®ç°ã€‚</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line"><span class="keyword">const</span> shadowRoot = div.attachShadow(&#123;mode: <span class="string">'closed'</span>&#125;); <span class="comment">// close shadow tree</span></div><div class="line"><span class="comment">// div.shadowRoot === null</span></div><div class="line"><span class="comment">// shadowRoot.host === div</span></div></pre></td></tr></table></figure>
<h3 id="å…³äº-slot-çš„-API"><a href="#å…³äº-slot-çš„-API" class="headerlink" title="å…³äº slot çš„ API"></a>å…³äº slot çš„ API</h3><p><strong><code>slotchange</code> äº‹ä»¶</strong></p>
<p>å½“ slot çš„åˆ†å¸ƒå¼èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>slotchange</code> äº‹ä»¶ä¼šè§¦å‘ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ä» light DOM ä¸­æ·»åŠ /ç§»é™¤å­é¡¹æ—¶ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> slot = <span class="keyword">this</span>.shadowRoot.querySelector(<span class="string">'#slot'</span>);</div><div class="line">slot.addEventListener(<span class="string">'slotchange'</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'light dom children changed!'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>æ³¨ï¼šå½“ç»„ä»¶çš„å®ä¾‹é¦–æ¬¡åˆå§‹åŒ–æ—¶ï¼Œ<code>slotchange</code> ä¸è§¦å‘ã€‚</p>
<p><strong>æŸ¥çœ‹ slot ä¸­æ¸²æŸ“çš„å…ƒç´ </strong><br>è°ƒç”¨ <code>slot.assignedNodes()</code> å¯æŸ¥çœ‹ slot æ­£åœ¨æ¸²æŸ“å“ªäº›å…ƒç´ ï¼›è¯¥æ–¹æ³•ä¸­ä¼ å…¥ <code>{flatten: true}</code> é€‰é¡¹å°†è¿”å› slot çš„å¤‡ç”¨å†…å®¹fallbcak contentï¼ˆå‰ææ˜¯æ²¡æœ‰åˆ†å¸ƒä»»ä½•èŠ‚ç‚¹ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>ç”¨æ³•</th>
<th>è°ƒç”¨</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;button is=&quot;better-button&quot;&gt;My button&lt;/button&gt;</code></td>
<td>slot.assignedNodes();</td>
<td>[text]</td>
</tr>
<tr>
<td><code>&lt;button is=&quot;better-button&quot;&gt;&lt;/button&gt;</code></td>
<td>slot.assignedNodes();</td>
<td>[]</td>
</tr>
<tr>
<td><code>&lt;button is=&quot;better-button&quot;&gt;&lt;/button&gt;</code></td>
<td>slot.assignedNodes({flatten: true});</td>
<td>[<b>fallback content</b>]</td>
</tr>
</tbody>
</table>
<p><strong>æŸ¥çœ‹å…ƒç´ æ¸²æŸ“åœ¨å“ªä¸ª slot ä¸­</strong><br><code>element.assignedSlot</code> å°†å‘Šè¯‰æ‚¨å…ƒç´ åˆ†é…åˆ°ç»„ä»¶çš„å“ªä¸ª slotã€‚</p>
<h3 id="Shadow-DOM-äº‹ä»¶æ¨¡å‹"><a href="#Shadow-DOM-äº‹ä»¶æ¨¡å‹" class="headerlink" title="Shadow DOM äº‹ä»¶æ¨¡å‹"></a>Shadow DOM äº‹ä»¶æ¨¡å‹</h3><p>å½“äº‹ä»¶ä» shadow DOM ä¸­è§¦å‘æ—¶ï¼Œå…¶ç›®æ ‡ target ä¸ºç»´æŒ shadow DOM çš„å°è£…ï¼Œä¸æš´éœ² shadow DOM ä¸­çš„å†…å®¹å…ƒç´ ï¼Œä¼šè¿›è¡Œé‡ç½® retargetï¼Œçœ‹èµ·æ¥äº‹ä»¶æ˜¯æ¥è‡ªç»„ä»¶æœ¬èº«ï¼Œè€Œä¸æ˜¯ç»„ä»¶ä¸­ shadow DOM ä¸­çš„å†…å®¹å…ƒç´ ã€‚</p>
<p>å¤§éƒ¨åˆ†äº‹ä»¶éƒ½ä¼šè·¨è¿‡ shadow DOM è¾¹ç•Œï¼Œå‘å¤–ä¼ æ’­ï¼š</p>
<ul>
<li>èšç„¦äº‹ä»¶ï¼šblurã€focusã€focusinã€focusout</li>
<li>é¼ æ ‡äº‹ä»¶ï¼šclickã€dblclickã€mousedownã€mouseenterã€mousemoveï¼Œç­‰ç­‰</li>
<li>æ»šè½®äº‹ä»¶ï¼šwheel</li>
<li>è¾“å…¥äº‹ä»¶ï¼šbeforeinputã€input</li>
<li>é”®ç›˜äº‹ä»¶ï¼škeydownã€keyup</li>
<li>ç»„åˆäº‹ä»¶ï¼šcompositionstartã€compositionupdateã€compositionend</li>
<li>æ‹–æ”¾äº‹ä»¶ï¼šdragstartã€dragã€dragendã€dropï¼Œç­‰ç­‰</li>
</ul>
<p>å¯¹äº <code>mode</code> ä¸º <code>open</code> çš„ shadow DOMï¼Œäº‹ä»¶å›è°ƒä¸­ï¼Œè°ƒç”¨ <code>event.composedPath()</code> å°†è¿”å›äº‹ä»¶å‘ä¸Šä¼ æ’­ç»è¿‡çš„èŠ‚ç‚¹è·¯å¾„ã€‚</p>
<p>å¯¹äºç»„ä»¶å†…çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œä¸ä¼šä¼ æ’­å‡º shadow DOMï¼Œé™¤éäº‹ä»¶åˆ›å»ºæ—¶æŒ‡å®š <code>composed: true</code><br><figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Inside &lt;fancy-tab&gt; custom element class definition:</span></div><div class="line">selectTab() &#123;</div><div class="line">  <span class="keyword">const</span> tabs = <span class="keyword">this</span>.shadowRoot.<span class="built_in">querySelector</span>(<span class="string">'#tabs'</span>);</div><div class="line">  tabs.dispatchEvent(<span class="keyword">new</span> Event(<span class="string">'tab-select'</span>, &#123;bubbles: <span class="keyword">true</span>, composed: <span class="keyword">true</span>&#125;));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¦‚æœ <code>composed: false</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œç”¨æˆ·æ— æ³•åœ¨ç»„ä»¶å¤–éƒ¨ä¾¦å¬åˆ°è¿™ä¸ªè‡ªå®šä¹‰äº‹ä»¶ã€‚<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">fancy-tabs</span>&gt;</span><span class="tag">&lt;/<span class="name">fancy-tabs</span>&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="keyword">const</span> tabs = <span class="built_in">document</span>.querySelector(<span class="string">'fancy-tabs'</span>);</div><div class="line">  tabs.addEventListener(<span class="string">'tab-select'</span>, e =&gt; <span class="template-variable">&#123;</span></div><div class="line">    // won't fire <span class="keyword">if</span> `tab-<span class="keyword">select</span>` wasn't created with `composed: true`.</div><div class="line">  &#125;<span class="xml"><span class="undefined">);</span></span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p>æœ¬æ–‡ä¸»è¦æ˜¯é˜…è¯» <strong>Shadow DOM v1: Self-Contained Web Components</strong> åï¼Œç†è§£æ•´ç†è€Œæ¥ã€‚<br>è‹±æ–‡åŸæ–‡ï¼š<a href="https://developers.google.com/web/fundamentals/web-components/shadowdom" target="_blank" rel="external">Shadow DOM v1: Self-Contained Web Components</a><br>ä¸­æ–‡ç¿»è¯‘ï¼š<a href="https://developers.google.com/web/fundamentals/web-components/best-practices?hl=zh-cn" target="_blank" rel="external">Shadow DOM v1ï¼šç‹¬ç«‹çš„ç½‘ç»œç»„ä»¶</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/shadow-dom.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;Shadow DOM æ˜¯å››å¤§ç½‘ç»œç»„ä»¶æ ‡å‡†ä¹‹ä¸€ï¼Œæä¾› CSS ä½œç”¨åŸŸã€DOM å°è£…å’Œç»„åˆ(Composition) ç­‰ä¼˜åŠ¿ï¼Œæ„å»ºè‡ªå®šä¹‰å…ƒç´ ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Web Components" scheme="http://objcer.com/categories/Web-Components/"/>
    
    
      <category term="Shadow DOM" scheme="http://objcer.com/tags/Shadow-DOM/"/>
    
  </entry>
  
  <entry>
    <title>Custom Elements</title>
    <link href="http://objcer.com/2017/10/20/Custom-Elements/"/>
    <id>http://objcer.com/2017/10/20/Custom-Elements/</id>
    <published>2017-10-20T08:07:56.000Z</published>
    <updated>2017-10-20T08:11:56.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/custom-elements.png" alt=""></p>
<p>Custom Elements ä¸ºå¼€å‘è€…æä¾›äº†åˆ›å»ºæ–° HTML æ ‡è®°ï¼Œæ‰©å±•ç°æœ‰ HTML æ ‡è®°çš„èƒ½åŠ›ï¼Œåˆ›å»ºè‡ªå®šä¹‰æ–°çš„å…ƒç´ ï¼Œå°† JS é€»è¾‘è¡Œä¸ºå’Œå…ƒç´  DOM å…³è”èµ·æ¥ï¼Œä»£ç æ¨¡å—åŒ–ï¼Œæä¾›é‡ç”¨æ€§ã€‚</p>
<a id="more"></a>
<h2 id="è‡ªå®šä¹‰å…ƒç´ "><a href="#è‡ªå®šä¹‰å…ƒç´ " class="headerlink" title="è‡ªå®šä¹‰å…ƒç´ "></a>è‡ªå®šä¹‰å…ƒç´ </h2><p><strong>åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼š</strong></p>
<ul>
<li><p>é€šè¿‡ class <strong>å®šä¹‰</strong>è‡ªå®šä¹‰å…ƒç´ </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDrawer</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</div><div class="line">  constructor() &#123;</div><div class="line">    <span class="comment">// If you define a ctor, always call super() first!</span></div><div class="line">    <span class="keyword">super</span>();</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>å‘æµè§ˆå™¨<strong>æ³¨å†Œ</strong>è¯¥è‡ªå®šä¹‰å…ƒç´ </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDrawer</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;...&#125;</div><div class="line">window.customElements.define(<span class="symbol">'app</span>-drawer', <span class="type">AppDrawer</span>);</div><div class="line"></div><div class="line"><span class="comment">// åŒ¿åç±»</span></div><div class="line">window.customElements.define(<span class="symbol">'app</span>-drawer', <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;...&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ å‡ ç‚¹æ³¨æ„ï¼š</strong></p>
<ul>
<li>è‡ªå®šä¹‰å…ƒç´ å®šä¹‰ç±»ä¸­çš„æ„é€ å‡½æ•°ä¸­ï¼Œæ€»æ˜¯éœ€è¦è°ƒç”¨ <code>super()</code></li>
<li>è‡ªå®šä¹‰å…ƒç´ åç§°å¿…é¡»è¦åŒ…å«ä¸€ä¸ªçŸ­æ¨ªçº¿(-)ï¼Œæµè§ˆå™¨ä»¥æ¬¡æ¥åŒºåˆ†è‡ªå®šä¹‰å…ƒç´ å’Œå¸¸è§„å…ƒç´ ã€‚ä¾‹å¦‚ <code>&lt;x-tags&gt;</code>ã€<code>&lt;my-element&gt;</code> ä¸ºæœ‰æ•ˆåç§°ï¼›è€Œ <code>&lt;tabs&gt;</code> å’Œ <code>&lt;foo_bar&gt;</code> åˆ™ä¸ºæ— æ•ˆåç§°</li>
<li><p>ä¸èƒ½å¤šæ¬¡æ³¨å†ŒåŒä¸€è‡ªå®šä¹‰å…ƒç´ ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>DOMException</code> å¼‚å¸¸</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span></span>&#123;&#125;</div><div class="line">window.customElements.define(<span class="symbol">'app</span>-drawer', <span class="type">A</span>);</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span></span>&#123;&#125;</div><div class="line">window.customElements.define(<span class="symbol">'app</span>-drawer', <span class="type">B</span>); <span class="comment">// â—ï¸DOMException</span></div></pre></td></tr></table></figure>
</li>
<li><p>è‡ªå®šä¹‰å…ƒç´ ä¸èƒ½è‡ªé—­åˆ(self-closing)ï¼Œæ‰€ä»¥éœ€è¦å†™ç»“æŸæ ‡ç­¾ï¼Œä¾‹å¦‚ <code>&lt;x-tags&gt;&lt;/x-tags&gt;</code></p>
</li>
</ul>
<p><strong>å®šä¹‰æ–°çš„è‡ªå®šä¹‰å…ƒç´ ï¼Œclass ç±»ç»§æ‰¿ <code>HTMLElement</code>ï¼›ä¹Ÿå¯ä»¥æ‰©å±•å·²æœ‰çš„å…ƒç´ ï¼ŒåŒ…æ‹¬ï¼š</strong></p>
<ul>
<li><p>æ‰©å±•è‡ªå®šä¹‰å…ƒç´ </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FancyDrawer</span> <span class="keyword">extends</span> <span class="title">AppDrawer</span> </span>&#123;</div><div class="line">  constructor() &#123;</div><div class="line">    <span class="keyword">super</span>();</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>æ‰©å±• HTML åŸç”Ÿå…ƒç´ </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FancyButton</span> <span class="keyword">extends</span> <span class="title">HTMLButtonElement</span> </span>&#123;</div><div class="line">  constructor() &#123;</div><div class="line">    <span class="keyword">super</span>();</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">customElements.define(<span class="symbol">'fancy</span>-button', <span class="type">FancyButton</span>, &#123;<span class="keyword">extends</span>: <span class="symbol">'butto</span>n'&#125;);</div></pre></td></tr></table></figure>
<p>æ‰©å±• HTML åŸç”Ÿå…ƒç´ æ—¶ï¼Œå¯¹ <code>define()</code> çš„è°ƒç”¨ä¼šç¨æœ‰ä¸åŒï¼Œéœ€è¦ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°å‘ŠçŸ¥æµè§ˆå™¨è¦æ‰©å±•çš„æ ‡è®°ã€‚</p>
</li>
</ul>
<p>ä½¿ç”¨è‡ªå®šä¹‰å…ƒç´ ä¸ <code>&lt;div&gt;</code> æˆ–ä»»ä½•å…¶ä»–å…ƒç´ çš„ä½¿ç”¨æ²¡æœ‰åŒºåˆ«ã€‚å¯ä»¥åœ¨é¡µé¢ä¸Šå£°æ˜ï¼Œä¹Ÿå¯ä¹Ÿé€šè¿‡ JavaScript åŠ¨æ€åˆ›å»ºå®ä¾‹ï¼Œä¹Ÿå¯æ·»åŠ äº‹ä»¶ä¾¦å¬å™¨ï¼Œè¯¸å¦‚æ­¤ç±»ã€‚<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;app-drawer&gt;&lt;/app-drawer&gt;</div><div class="line"><span class="keyword">let</span> drawer = <span class="keyword">new</span> AppDrawer()</div><div class="line"></div><div class="line"><span class="comment">// â—ï¸è‡ªå®šä¹‰ HTML åŸç”Ÿå…ƒç´ éœ€è¦åœ¨åŸç”Ÿæ ‡è®°ä¸Šæ·»åŠ  is="" å±æ€§æ¥å£°æ˜</span></div><div class="line">&lt;button <span class="keyword">is</span>=<span class="string">"fancy-button"</span>&gt;Fancy button!&lt;/button&gt;</div><div class="line"><span class="keyword">let</span> button = <span class="keyword">new</span> FancyButton()</div><div class="line"></div><div class="line"><span class="comment">// customElements.get æ–¹æ³•é€šè¿‡ä¼ å…¥è‡ªå®šä¹‰å…ƒç´ æ ‡è®°åç§°ï¼Œè·å–å…ƒç´ çš„æ„é€ å‡½æ•°</span></div><div class="line"><span class="keyword">let</span> Drawer = customElements.<span class="keyword">get</span>(<span class="string">'app-drawer'</span>);</div><div class="line"><span class="keyword">let</span> drawer = <span class="keyword">new</span> Drawer();</div></pre></td></tr></table></figure></p>
<h2 id="è‡ªå®šä¹‰å…ƒç´ çš„å“åº”"><a href="#è‡ªå®šä¹‰å…ƒç´ çš„å“åº”" class="headerlink" title="è‡ªå®šä¹‰å…ƒç´ çš„å“åº”"></a>è‡ªå®šä¹‰å…ƒç´ çš„å“åº”</h2><p>è‡ªå®šä¹‰å…ƒç´ æä¾›äº†ä¸€äº›å“åº”æ–¹æ³•ï¼Œè¡¨å¾å…¶ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒæ—¶åˆ»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›å“åº”æ–¹æ³•ï¼ˆå›è°ƒæ–¹æ³•ï¼‰ä¸­æ‰§è¡Œç›¸å…³çš„é€»è¾‘ã€‚</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>è°ƒç”¨æ—¶æœº</th>
</tr>
</thead>
<tbody>
<tr>
<td>constructor</td>
<td>åˆ›å»ºæˆ–å‡çº§å…ƒç´ çš„ä¸€ä¸ªå®ä¾‹ã€‚ç”¨äºåˆå§‹åŒ–çŠ¶æ€ã€è®¾ç½®äº‹ä»¶ä¾¦å¬å™¨æˆ–åˆ›å»º Shadow DOM</td>
</tr>
<tr>
<td>connectedCallback</td>
<td>å…ƒç´ æ¯æ¬¡æ’å…¥åˆ° DOM æ—¶éƒ½ä¼šè°ƒç”¨</td>
</tr>
<tr>
<td>disconnectedCallback</td>
<td>å…ƒç´ æ¯æ¬¡ä» DOM ä¸­ç§»é™¤æ—¶éƒ½ä¼šè°ƒç”¨</td>
</tr>
<tr>
<td>attributeChangedCallback(attrName, oldVal, newVal)</td>
<td>å±æ€§æ·»åŠ ã€ç§»é™¤ã€æ›´æ–°æˆ–æ›¿æ¢æ—¶è°ƒç”¨ï¼›åˆ›å»ºå…ƒç´ æˆ–è€…å‡çº§æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨å®ƒæ¥è·å–åˆå§‹å€¼</td>
</tr>
<tr>
<td>adoptedCallback</td>
<td>è‡ªå®šä¹‰å…ƒç´ è¢«ç§»å…¥æ–°çš„ document ï¼ˆä¾‹å¦‚ï¼Œæœ‰äººè°ƒç”¨äº† document.adoptNode(el)ï¼‰</td>
</tr>
</tbody>
</table>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDrawer</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</div><div class="line">  constructor() &#123;</div><div class="line">    <span class="keyword">super</span>(); <span class="comment">// always call super() first in the ctor.</span></div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">  connectedCallback() &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">  disconnectedCallback() &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">  attributeChangedCallback(attrName, oldVal, newVal) &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>attributeChangedCallback</code> å“åº”ä»…é’ˆå¯¹ <code>observedAttributes</code> å±æ€§ä¸­åˆ—å‡ºçš„ï¼Œå¯¹äº class, style ç­‰å±æ€§çš„ä¿®æ”¹å¹¶ä¸ä¼šè°ƒç”¨è¯¥å“åº”ï¼Œè¿™ä¹Ÿæ˜¯å¤„äºæ€§èƒ½è€ƒè™‘</li>
<li><code>disconnectedCallback()</code> å“åº”ä¸»è¦ç”¨äºæ¸…ç†å·¥ä½œï¼Œä¾‹å¦‚ç§»é™¤äº‹ä»¶ä¾¦å¬å™¨ç­‰ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·å…³é—­äº†æ ‡ç­¾ï¼Œ<code>disconnectedCallback()</code> å“åº”å°†æ— æ³•è°ƒç”¨</li>
<li><strong>å“åº”æ˜¯åŒæ­¥çš„</strong>ï¼Œä¾‹å¦‚ç§»é™¤è‡ªå®šä¹‰å…ƒç´ åï¼Œä¼šç«‹å³æ”¶åˆ° <code>disconnectedCallback()</code> å“åº”</li>
</ul>
<h2 id="è‡ªå®šä¹‰å…ƒç´ å‡çº§-upgrades"><a href="#è‡ªå®šä¹‰å…ƒç´ å‡çº§-upgrades" class="headerlink" title="è‡ªå®šä¹‰å…ƒç´ å‡çº§(upgrades)"></a>è‡ªå®šä¹‰å…ƒç´ å‡çº§(upgrades)</h2><p><strong>è‡ªå®šä¹‰å…ƒç´ å¯ä»¥åœ¨å…¶å®šä¹‰æ³¨å†Œä¹‹å‰ä½¿ç”¨ã€‚</strong></p>
<p>HTML è§£ææ ‡ç­¾å®¹é”™èƒ½åŠ›å¼ºï¼Œå¯¹äºé¡µé¢ä¸Šå£°æ˜çš„ <code>&lt;asdfasdf&gt;</code> è¿™ç±»æœªçŸ¥çš„æ ‡ç­¾ï¼Œæµè§ˆå™¨ä¹Ÿèƒ½æ¥å—ï¼Œå› ä¸º HTML è§„èŒƒå…è®¸è¿™ç±»æœªçŸ¥æ ‡ç­¾ï¼Œå®ƒæŠŠè¿™ç±»æœªçŸ¥æ ‡ç­¾ç”Ÿæˆçš„å…ƒç´ å½“æˆ <code>HTMLUnknownElement</code> è¿›è¡Œè§£æã€‚è€Œå½“é¡µé¢ä¸­å­˜åœ¨ç¬¦åˆè‡ªå®šä¹‰å…ƒç´ å‘½åè§„åˆ™ï¼ˆåŒ…å«çŸ­æ¨ªçº¿â€™-â€˜ï¼‰çš„æ ‡ç­¾ï¼Œä½†æ˜¯è¿˜æœªå®šä¹‰æ³¨å†Œæ—¶ï¼Œæµè§ˆå™¨å°†å…¶è§†ä¸ºæ½œåœ¨çš„è‡ªå®šä¹‰å…ƒç´ ï¼Œè§£ææˆ <code>HTMLElement</code></p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">//</span> <span class="string">"tabs"</span> <span class="keyword">is</span> <span class="keyword">not</span> a valid custom element name</div><div class="line"><span class="built_in">document</span>.createElement(<span class="string">'tabs'</span>) <span class="keyword">instanceof</span> HTMLUnknownElement === <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="regexp">//</span> <span class="string">"x-tabs"</span> <span class="keyword">is</span> a valid custom element name</div><div class="line"><span class="built_in">document</span>.createElement(<span class="string">'x-tabs'</span>) <span class="keyword">instanceof</span> HTMLElement === <span class="literal">true</span></div></pre></td></tr></table></figure>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ä¸­å…ˆå£°æ˜ä½¿ç”¨è‡ªå®šä¹‰å…ƒç´ ï¼Œå…¶åå†è°ƒç”¨ <code>customElements.define</code> æ³¨å†Œè‡ªå®šä¹‰å…ƒç´ ï¼Œåœ¨è‡ªå®šä¹‰å…ƒç´ æ³¨å†Œå®Œæˆåï¼Œå°†é¡µé¢ä¸­å·²å£°æ˜ä½¿ç”¨çš„å‡çº§ï¼ˆupgradesï¼‰ä¸ºè‡ªå®šä¹‰å…ƒç´ ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºå…ƒç´ å‡çº§ï¼ˆelement upgradesï¼‰</p>
<p>è¦äº†è§£æ ‡è®°åç§°ä½•æ—¶æ³¨å†Œå®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>window.customElements.whenDefined()</code>ã€‚<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">customElements.whenDefined(<span class="string">'app-drawer'</span>).<span class="keyword">then</span>(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'app-drawer defined'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="è‡ªå®šä¹‰å…ƒç´ çš„çŠ¶æ€-state"><a href="#è‡ªå®šä¹‰å…ƒç´ çš„çŠ¶æ€-state" class="headerlink" title="è‡ªå®šä¹‰å…ƒç´ çš„çŠ¶æ€ (state)"></a>è‡ªå®šä¹‰å…ƒç´ çš„çŠ¶æ€ (state)</h2><p>è‡ªå®šä¹‰å…ƒç´ çš„çŠ¶æ€åŒ…æ‹¬ï¼š<strong><code>undefined</code>, <code>failed</code>, <code>uncustomized</code>, <code>custom</code></strong>ï¼Œå…¶ä¸­ <strong><code>uncustomized</code>, <code>custom</code></strong> éƒ½è¡¨å·²å®šä¹‰ <strong><code>defined</code></strong>ï¼›å¯¹äºç±»ä¼¼ <code>div</code> çš„å†…ç½®å…ƒç´ çŠ¶æ€å§‹ç»ˆä¸ºå·²å®šä¹‰ <strong><code>defined</code></strong></p>
<p>åœ¨å…ƒç´ å‡çº§ä¹‹å‰ï¼Œå¤„äºæœªå®šä¹‰çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥è¿‡ <code>:defined</code> ä¼ªç±»é¢„è®¾ç½®æœªæ³¨å†Œå…ƒç´ çš„æ ·å¼ï¼Œé¿å…åœ¨è·å¾—å®šä¹‰æ—¶äº§ç”Ÿå¸ƒå±€è·³åŠ¨æˆ–è€… FOUC</p>
<blockquote>
<p>FOUC: Flash of Unstyled Content æ–‡æ¡£æ ·å¼çŸ­æš‚å¤±æ•ˆï¼ŒæŒ‡ HTML é¡µé¢åœ¨æ‰“å¼€è¿‡ç¨‹ä¸­ï¼Œå†…å®¹å…ˆäºæ ·å¼å±•ç¤ºï¼Œå¯¼è‡´é¡µé¢æ ·å¼åœ¨ç¬é—´å‡ºç°å‰§å˜ï¼Œå¹¶ä¸”äººçœ¼å¯è§</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">app-drawer</span><span class="selector-pseudo">:not(</span><span class="selector-pseudo">:defined)</span> &#123;</div><div class="line">  <span class="comment">/* Pre-style, give layout, replicate app-drawer's eventual styles, etc. */</span></div><div class="line">  <span class="attribute">display</span>: inline-block;</div><div class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</div><div class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">transition</span>: opacity <span class="number">0.3s</span> ease-in-out;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨ <code>&lt;app-drawer&gt;</code> è·å¾—å®šä¹‰åï¼Œé€‰æ‹©å™¨ <code>app-drawer:not(:defined)</code> ä¸å†åŒ¹é…ã€‚</p>
<h2 id="è®¾ç½®è‡ªå®šä¹‰å…ƒç´ çš„å†…å®¹"><a href="#è®¾ç½®è‡ªå®šä¹‰å…ƒç´ çš„å†…å®¹" class="headerlink" title="è®¾ç½®è‡ªå®šä¹‰å…ƒç´ çš„å†…å®¹"></a>è®¾ç½®è‡ªå®šä¹‰å…ƒç´ çš„å†…å®¹</h2><h3 id="é€šè¿‡-innerHTML-è®¾ç½®å…ƒç´ å†…å®¹"><a href="#é€šè¿‡-innerHTML-è®¾ç½®å…ƒç´ å†…å®¹" class="headerlink" title="é€šè¿‡ innerHTML è®¾ç½®å…ƒç´ å†…å®¹"></a>é€šè¿‡ <code>innerHTML</code> è®¾ç½®å…ƒç´ å†…å®¹</h3><p>è‡ªå®šä¹‰å…ƒç´ åœ¨ <code>connectedCallback</code> å“åº”ä¸­ï¼Œä½¿ç”¨ DOM API æ¥è®¾ç½®å…ƒç´ çš„å†…å®¹ï¼Œä½†è¿™ä¸æ˜¯å¥½çš„åšæ³•ï¼Œä¸æ¨èä½¿ç”¨ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨ Shadow DOMã€‚<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">window.customElements.define(<span class="symbol">'x</span>-tag', <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</div><div class="line">  connectedCallback() &#123;</div><div class="line">    <span class="keyword">this</span>.innerHTML = '&lt;b&gt;<span class="type">Hello</span> <span class="type">World</span>!&lt;/b&gt; <span class="type">Custom</span> <span class="type">Element</span>'</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="é€šè¿‡-Shadow-DOM-è®¾ç½®å…ƒç´ å†…å®¹"><a href="#é€šè¿‡-Shadow-DOM-è®¾ç½®å…ƒç´ å†…å®¹" class="headerlink" title="é€šè¿‡ Shadow DOM è®¾ç½®å…ƒç´ å†…å®¹"></a>é€šè¿‡ Shadow DOM è®¾ç½®å…ƒç´ å†…å®¹</h3><blockquote>
<p>å…³äº Shadow DOM çš„è¯¦ç»†ä»‹ç»ï¼Œå‚è€ƒï¼š<a href=""></a></p>
</blockquote>
<p>Shadow DOM æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œå¯è®©è®¾ç½®çš„å…ƒç´ ä»¥ç‹¬ç«‹äºé¡µé¢å…¶ä½™éƒ¨åˆ†çš„æ–¹å¼æ‹¥æœ‰å’Œæ¸²æŸ“ DOM å¹¶è®¾ç½®å…¶æ ·å¼ã€‚<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;x-tag&gt;<span class="type">Custom</span> <span class="type">Element</span>&lt;/x-tag&gt;</div><div class="line"></div><div class="line">window.customElements.define(<span class="symbol">'x</span>-tag', <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</div><div class="line">  constructor() &#123;</div><div class="line">    <span class="keyword">super</span>()</div><div class="line"></div><div class="line">    let shadowRoot = <span class="keyword">this</span>.attachShadow(&#123;mode: <span class="symbol">'ope</span>n'&#125;)</div><div class="line">    shadowRoot.innerHTML = `</div><div class="line">    &lt;b&gt;<span class="type">Hello</span> <span class="type">World</span>!&lt;/b&gt;</div><div class="line">    &lt;slot&gt;&lt;/slot&gt;</div><div class="line">    `</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒShadow DOM æ˜¯é€šè¿‡ <code>innerHTML</code> æ¥åˆ›å»º DOM å…ƒç´ ï¼›æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ <code>&lt;template&gt;</code> å…ƒç´ æ¥åˆ›å»º DOMã€‚<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;x-tag&gt;<span class="type">Custom</span> <span class="type">Element</span>&lt;/x-tag&gt;</div><div class="line">&lt;template id=<span class="string">"tmpl"</span>&gt;</div><div class="line">  &lt;style&gt;</div><div class="line">  <span class="comment">/*scoped styles*/</span></div><div class="line">  &lt;/style&gt;</div><div class="line">  &lt;b&gt;<span class="type">Hello</span> <span class="type">World</span>!&lt;/b&gt;</div><div class="line">  &lt;slot&gt;&lt;/slot&gt;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">window.customElements.define(<span class="symbol">'x</span>-tag', <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</div><div class="line">  constructor() &#123;</div><div class="line">    <span class="keyword">super</span>()</div><div class="line"></div><div class="line">    let shadowRoot = <span class="keyword">this</span>.attachShadow(&#123;mode: <span class="symbol">'ope</span>n'&#125;)</div><div class="line">    let tmpl = document.querySelector('#tmpl')</div><div class="line">    shadowRoot.appendChild(tmpl.content.cloneNode(<span class="literal">true</span>))</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="å±æ€§-property-æ˜ å°„ä¸ºç‰¹æ€§-attribute"><a href="#å±æ€§-property-æ˜ å°„ä¸ºç‰¹æ€§-attribute" class="headerlink" title="å±æ€§ (property) æ˜ å°„ä¸ºç‰¹æ€§ (attribute)"></a>å±æ€§ (property) æ˜ å°„ä¸ºç‰¹æ€§ (attribute)</h2><p>å¯¹ DOM å…ƒç´ å±æ€§ (property) ä¿®æ”¹ï¼Œå…¶å€¼ä¼šä»¥ç‰¹æ€§ (attribute) çš„å½¢å¼æ˜ å°„åˆ° DOMï¼Œä¾‹å¦‚é€šè¿‡ JS ä¿®æ”¹ DOM å…ƒç´ çš„ idï¼Œhidden å±æ€§ï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">div</span>.<span class="built_in">id</span> = '<span class="keyword">my</span>-<span class="built_in">id</span>';</div><div class="line"><span class="keyword">div</span>.hidden = <span class="literal">true</span>;</div></pre></td></tr></table></figure></p>
<p>DOM èŠ‚ç‚¹ä¼šå˜æˆï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"my-id"</span> hidden&gt;</div></pre></td></tr></table></figure></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p>æœ¬æ–‡ä¸»è¦æ˜¯é˜…è¯» <strong>Custom Elements v1: Reusable Web Components</strong> åï¼Œç†è§£æ•´ç†è€Œæ¥ã€‚<br>è‹±æ–‡åŸæ–‡ï¼š<a href="https://developers.google.com/web/fundamentals/web-components/customelements" target="_blank" rel="external">Custom Elements v1: Reusable Web Components</a><br>ä¸­æ–‡ç¿»è¯‘ï¼š<a href="https://developers.google.com/web/fundamentals/web-components/customelements?hl=zh-cn" target="_blank" rel="external">è‡ªå®šä¹‰å…ƒç´  v1ï¼šå¯é‡ç”¨ç½‘ç»œç»„ä»¶</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/custom-elements.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Custom Elements ä¸ºå¼€å‘è€…æä¾›äº†åˆ›å»ºæ–° HTML æ ‡è®°ï¼Œæ‰©å±•ç°æœ‰ HTML æ ‡è®°çš„èƒ½åŠ›ï¼Œåˆ›å»ºè‡ªå®šä¹‰æ–°çš„å…ƒç´ ï¼Œå°† JS é€»è¾‘è¡Œä¸ºå’Œå…ƒç´  DOM å…³è”èµ·æ¥ï¼Œä»£ç æ¨¡å—åŒ–ï¼Œæä¾›é‡ç”¨æ€§ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Web Components" scheme="http://objcer.com/categories/Web-Components/"/>
    
    
      <category term="Custom Elements" scheme="http://objcer.com/tags/Custom-Elements/"/>
    
  </entry>
  
  <entry>
    <title>0.1+0.2=0.30000000000000004â“</title>
    <link href="http://objcer.com/2017/10/16/floating-point-arithmetic/"/>
    <id>http://objcer.com/2017/10/16/floating-point-arithmetic/</id>
    <published>2017-10-16T08:31:42.000Z</published>
    <updated>2017-10-17T01:52:49.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/1-brjYnVlXwM3j_SWXImT0Rg.png" alt=""><br>JavaScriptä¸­æ‰€æœ‰çš„æ•°å­—ï¼Œæ— è®ºæ˜¯æ•´æ•°è¿˜æ˜¯å°æ•°ï¼Œå…¶ç±»å‹éƒ½æ˜¯ Numberï¼Œéµå¾ª <a href="http://grouper.ieee.org/groups/754/" target="_blank" rel="external">IEEE 754</a> ç¨‹åºå†…éƒ¨ç”¨ä¸€ä¸ª 64 ä½å›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶è¿›è¡Œå­˜å‚¨è¡¨ç¤ºã€‚JavaScript ä¸­çš„æµ®ç‚¹æ•°è¿›è¡Œè¿ç®—æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°è®¡ç®—ç²¾åº¦é—®é¢˜ï¼Œä¾‹å¦‚ç»å…¸çš„ <code>0.1+0.2=0.30000000000000004</code>ï¼Œæœ¬æ–‡å°†æ¢ç©¶ JavaScript çš„æµ®ç‚¹æ•°ï¼Œå¹¶è§£é‡Šä¸ºä½• <code>0.1+0.2=0.30000000000000004</code></p>
<a id="more"></a>
<h2 id="æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º"><a href="#æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º" class="headerlink" title="æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º"></a>æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º</h2><p>JavaScript é‡Œçš„æ•°å­—æ˜¯é‡‡ç”¨ <a href="http://grouper.ieee.org/groups/754/" target="_blank" rel="external">IEEE 754</a> æ ‡å‡†çš„ 64 ä½ double åŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆä¸ä¹‹ç›¸å…³çš„è¿˜æœ‰ 32 ä½ float å•ç²¾åº¦æµ®ç‚¹æ•°ï¼‰ã€‚è¯¥è§„èŒƒå®šä¹‰äº†æµ®ç‚¹æ•°çš„æ ¼å¼ã€‚</p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/5F33F675-2DF0-472F-9F2E-98066AE91720.png" alt=""></p>
<p>å¯¹äº 32 ä½çš„æµ®ç‚¹æ•°ï¼Œæœ€é«˜çš„ 1 ä½æ˜¯ç¬¦å·ä½ Sï¼Œæ¥ç€çš„ 8 ä½æ˜¯æŒ‡æ•° Eï¼Œå‰©ä¸‹çš„ 23 ä½ä¸ºå°¾æ•°ä½ M<br>å¯¹äº 64 ä½çš„æµ®ç‚¹æ•°ï¼Œæœ€é«˜çš„ 1 ä½æ˜¯ç¬¦å·ä½ Sï¼Œæ¥ç€çš„ 11 ä½æ˜¯æŒ‡æ•° Eï¼Œå‰©ä¸‹çš„ 52 ä½ä¸ºå°¾æ•°ä½ M</p>
<ul>
<li>ç¬¦å·ä½ Sï¼š0 è¡¨ç¤ºæ­£æ•°ï¼Œ1 è¡¨ç¤ºè´Ÿæ•°</li>
<li>æŒ‡æ•° Eï¼šè¡¨ç¤ºæ¬¡æ–¹</li>
<li>å°¾æ•°ä½ Mï¼šè¡¨ç¤ºæœ‰æ•ˆæ•°å­—ï¼ˆå°æ•°éƒ¨åˆ†ï¼‰</li>
</ul>
<p>å®é™…æ•°å­—çš„è®¡ç®—å…¬å¼ä¸ºï¼š<br><figure class="highlight cos"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">V = (-<span class="number">1</span>)<span class="symbol">^S</span> * M * <span class="number">2</span><span class="symbol">^E</span></div></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥åªå¯¹ 64 ä½æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºè¿›è¡Œåˆ†æï¼š</p>
<p>è¯¥è®¡ç®—å…¬å¼éµå¾ªç§‘å­¦è®¡æ•°æ³•çš„è§„èŒƒï¼Œå¯¹äºåè¿›åˆ¶è¡¨ç¤ºè€Œè¨€ï¼Œå°¾æ•°çš„èŒƒå›´æ˜¯ <code>0&lt;M&lt;10</code>ï¼›å¯¹äºäºŒè¿›åˆ¶è¡¨ç¤ºè€Œè¨€ï¼Œå°¾æ•°çš„èŒƒå›´æ˜¯ <code>0&lt;M&lt;2</code>ã€‚æµ®ç‚¹æ•°äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæ‰€ä»¥æ­¤å¤„å°¾æ•°çš„èŒƒå›´æ˜¯ï¼š<code>0&lt;M&lt;2</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ M çš„æ•´æ•°ä½å§‹ç»ˆæ˜¯ 1ï¼Œæ‰€ä»¥å¯ä»¥èˆå»ï¼Œåªä¿ç•™åé¢çš„å°æ•°éƒ¨åˆ†ï¼Œè¿™æ ·å°±èƒ½è¡¨ç¤º 53 ä½äº†ã€‚</p>
<p>æŒ‡æ•°ä½ E æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œ64 ä½æµ®ç‚¹æ•°ä¸­ï¼ŒæŒ‡æ•°ä½é•¿åº¦æ˜¯ 11 ä½ï¼Œå–å€¼èŒƒå›´æ˜¯ <code>[0~2047]</code>ï¼Œç”±äºç§‘å­¦è®¡æ•°æ³•ä¸­æŒ‡æ•°å¯æ­£å¯è´Ÿï¼Œæ‰€ä»¥ï¼Œä¸­é—´æ•° 1023ï¼Œ<code>[0,1022]</code> è¡¨ç¤ºä¸ºè´Ÿï¼Œ<code>[1024,2047]</code> è¡¨ç¤ºä¸ºæ­£</p>
<p>æœ€ç»ˆçš„å…¬å¼å˜æˆï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">V = (<span class="number">-1</span>)^S * (M + <span class="number">1</span>) * <span class="number">2</span>^(E - <span class="number">1023</span>)</div></pre></td></tr></table></figure></p>
<h3 id="åè¿›åˆ¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶"><a href="#åè¿›åˆ¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶" class="headerlink" title="åè¿›åˆ¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶"></a>åè¿›åˆ¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶</h3><p><strong>åè¿›åˆ¶æ•´æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•´æ•°ï¼š</strong>é‡‡ç”¨â€é™¤2å–ä½™ï¼Œé€†åºæ’åˆ—â€æ³•ã€‚å…·ä½“åšæ³•æ˜¯ï¼šç”¨ 2 å»é™¤åè¿›åˆ¶æ•´æ•°ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªå•†å’Œä½™æ•°ï¼›å†ç”¨ 2 å»é™¤å•†ï¼Œåˆä¼šå¾—åˆ°ä¸€ä¸ªå•†å’Œä½™æ•°ï¼Œå¦‚æ­¤è¿›è¡Œï¼Œç›´åˆ°å•†ä¸ºé›¶æ—¶ä¸ºæ­¢ï¼Œç„¶åæŠŠå…ˆå¾—åˆ°çš„ä½™æ•°ä½œä¸ºäºŒè¿›åˆ¶æ•°çš„ä½ä½æœ‰æ•ˆä½ï¼Œåå¾—åˆ°çš„ä½™æ•°ä½œä¸ºäºŒè¿›åˆ¶æ•°çš„é«˜ä½æœ‰æ•ˆä½ï¼Œä¾æ¬¡æ’åˆ—èµ·æ¥ã€‚</p>
<p><strong>åè¿›åˆ¶å°æ•°è½¬æ¢æˆäºŒè¿›åˆ¶å°æ•°ï¼š</strong>é‡‡ç”¨â€ä¹˜2å–æ•´ï¼Œé¡ºåºæ’åˆ—â€æ³•ã€‚å…·ä½“åšæ³•æ˜¯ï¼šç”¨ 2 ä¹˜åè¿›åˆ¶å°æ•°ï¼Œå¯ä»¥å¾—åˆ°ç§¯ï¼Œå°†ç§¯çš„æ•´æ•°éƒ¨åˆ†å–å‡ºï¼Œå†ç”¨ 2 ä¹˜ä½™ä¸‹çš„å°æ•° éƒ¨åˆ†ï¼Œåˆå¾—åˆ°ä¸€ä¸ªç§¯ï¼Œå†å°†ç§¯çš„æ•´æ•°éƒ¨åˆ†å–å‡ºï¼Œå¦‚æ­¤è¿›è¡Œï¼Œç›´åˆ°ç§¯ä¸­çš„å°æ•°éƒ¨åˆ†ä¸ºé›¶ï¼Œæˆ–è€…è¾¾åˆ°æ‰€è¦æ±‚çš„ç²¾åº¦ä¸ºæ­¢ã€‚ç„¶åæŠŠå–å‡ºçš„æ•´æ•°éƒ¨åˆ†æŒ‰é¡ºåºæ’åˆ—èµ·æ¥ï¼Œå…ˆå–çš„æ•´æ•°ä½œä¸ºäºŒè¿›åˆ¶å°æ•°çš„é«˜ä½æœ‰æ•ˆä½ï¼Œåå–çš„æ•´æ•°ä½œä¸ºä½ä½æœ‰æ•ˆä½ã€‚</p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/58DF62FC-51A3-4F01-A3C6-0E75DF916261.png" alt=""></p>
<p>ï¼ˆ173.8125ï¼‰10ï¼ï¼ˆâ“ï¼‰2</p>
<ul>
<li>ï¼ˆ173ï¼‰10ï¼ï¼ˆ10101101ï¼‰2</li>
<li>ï¼ˆ0.8125ï¼‰10ï¼ï¼ˆ0.1101ï¼‰2</li>
</ul>
<p>æŠŠæ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†åˆå¹¶å¾—ï¼šï¼ˆ173.8125ï¼‰10ï¼ï¼ˆ10101101.1101ï¼‰2</p>
<h3 id="64-ä½æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º"><a href="#64-ä½æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º" class="headerlink" title="64 ä½æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º"></a>64 ä½æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º</h3><blockquote>
<p>åè¿›åˆ¶æ•°å’Œ 64 ä½æµ®ç‚¹æ•°äºŒè¿›åˆ¶ç›¸äº’è½¬æ¢å¯ä»¥è®¿é—®è¯¥ç½‘ç«™è¿›è¡Œï¼š<br><a href="http://www.binaryconvert.com/convert_double.html" target="_blank" rel="external">http://www.binaryconvert.com/convert_double.html</a></p>
</blockquote>
<p>ä¸‹é¢ä»¥ 0.1 ä¸ºä¾‹ï¼Œå¯¹å…¶è¿›è¡Œ 64 ä½äºŒè¿›åˆ¶è¡¨ç¤º</p>
<p>0.1 è½¬æ¢æˆäºŒè¿›åˆ¶ï¼š0.0001100110011001100(1100å¾ªç¯)ï¼Œå³ <code>1.100110011001100x2^-4</code>ï¼Œå¾—åˆ°:</p>
<ul>
<li>æŒ‡æ•°ä½ E = -4 + 1023 = 1019 (<code>1019</code> 11 ä½äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š01111111011)</li>
<li>å°¾æ•°ä½ M = 100110011001100â€¦ (èˆå»é¦–ä½ 1)</li>
</ul>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/000D23FF-1ECD-45D1-9BC3-09908A10787B.png" alt=""></p>
<p>æ‰€ä»¥åè¿›åˆ¶ 0.1 è½¬æ¢æˆ 64 ä½æµ®ç‚¹æ•°äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">0011111110111001100110011001100110011001100110011001100110011010</span></div></pre></td></tr></table></figure></p>
<p>è€Œå°† 64 ä½æµ®ç‚¹æ•°äºŒè¿›åˆ¶çš„ 0.1 è½¬æ¢å›åè¿›åˆ¶æ—¶ï¼Œå¾—åˆ°ï¼š<code>1.00000000000000005551115123126E-1</code>ã€‚</p>
<p>ä½†æ˜¯ï¼šæ­¤æ—¶è¾“å‡º <code>x</code> ä¸ºå•¥èƒ½å¾—åˆ° 0.1 å‘¢ï¼Ÿ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> x = <span class="number">0.1</span></div><div class="line"><span class="built_in">console</span>.log(x) <span class="comment">// -&gt; 0.1</span></div></pre></td></tr></table></figure></p>
<p><strong>åˆ†æï¼š</strong>å°¾æ•°ä½å›ºå®šé•¿åº¦ 52 ä½ï¼ŒåŠ ä¸Šçœç•¥çš„æ•´æ•°ä½ 1ï¼Œå°±å†åŠ ä¸Šä¸€ä½ï¼Œé‚£ä¹ˆå°¾æ•°æœ€å¤šèƒ½è¡¨ç¤ºçš„æ•°ä¸ºï¼š2^53=9007199254740992ï¼Œå¯¹åº”çš„åè¿›åˆ¶ç§‘å­¦è®¡æ•°å°¾æ•°æ˜¯ 9.007199254740992ï¼Œè¿™ä¹Ÿæ˜¯ JavaScript æœ€å¤šèƒ½è¡¨ç¤ºçš„ç²¾åº¦ï¼Œé•¿åº¦æ˜¯ 16ï¼Œæ‰€ä»¥ç”¨ <code>toPrecision(16)</code>  æ¥åšç²¾åº¦è¿ç®—ï¼Œäºæ˜¯ï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">0.10000000000000000555</span>.toPrecision(<span class="number">16</span>) <span class="comment">// -&gt; 0.1</span></div></pre></td></tr></table></figure></p>
<p>å¦‚æœä½¿ç”¨æ›´é«˜ç²¾åº¦ï¼Œé‚£ä¹ˆå¯èƒ½å¾—åˆ°çš„å°±ä¸æ˜¯ 0.1<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> x = <span class="number">0.1</span></div><div class="line"><span class="built_in">console</span>.log(x.toPrecision(<span class="number">21</span>)) <span class="comment">// -&gt; 0.100000000000000005551</span></div></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼š<code>toPrecision</code> æ–¹æ³•æœ€å¤§æŒ‡å®šç²¾åº¦ä¸º 21ã€‚å¯¹äº 0.1 è€Œè¨€ï¼Œ64 ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæœ€å¤šèƒ½è¡¨ç¤ºçš„ç²¾åº¦ä¸º 16 ä½ï¼›è½¬æ¢æˆåè¿›åˆ¶å <code>0.100000000000000005551</code>ï¼Œé»˜è®¤çš„ JavaScript ä½¿ç”¨ 16 ä½è¿›è¡Œæˆªå–ï¼Œæˆ‘ä»¬æœ€å¤šèƒ½ä½¿ç”¨ 21 ä½è¿›è¡Œæˆªå–ï¼Œæ³¨æ„äºŒè€…çš„åŒºåˆ«ã€‚</p>
<h3 id="toPrecision-å’Œ-toFixed"><a href="#toPrecision-å’Œ-toFixed" class="headerlink" title="toPrecision å’Œ toFixed"></a>toPrecision å’Œ toFixed</h3><ul>
<li><code>toPrecision</code> æ–¹æ³•ä»¥æŒ‡å®šçš„ç²¾åº¦è¿”å›è¯¥æ•°å€¼å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œç²¾åº¦æ˜¯ä»å·¦è‡³å³ç¬¬ä¸€ä¸ªä¸ä¸º0çš„æ•°å¼€å§‹æ•°èµ·</li>
<li><code>toFixed</code> æ–¹æ³•ä½¿ç”¨å®šç‚¹è¡¨ç¤ºæ³•æ¥æ ¼å¼åŒ–ä¸€ä¸ªæ•°ï¼Œæ˜¯å°æ•°ç‚¹åæŒ‡å®šä½æ•°å–æ•´ï¼Œä»å°æ•°ç‚¹å¼€å§‹æ•°èµ·</li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var x = <span class="number">0.12345</span></div><div class="line">x.toPrecision(<span class="number">3</span>) <span class="comment">// -&gt; "0.123"</span></div><div class="line"></div><div class="line">var y = <span class="number">1.234</span></div><div class="line">y.toFixed(<span class="number">3</span>) <span class="comment">// -&gt; "1.234"</span></div></pre></td></tr></table></figure>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•åœ¨æˆªå–æ•°å­—æ—¶ï¼Œéƒ½æœ‰è¿›è¡Œå››èˆäº”å…¥å¤„ç†ï¼Œä½†æ˜¯éƒ½å­˜åœ¨ BUGï¼Œä½¿ç”¨è¦è°¨æ…â—ï¸<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var x = <span class="number">0.3456</span></div><div class="line"><span class="function"><span class="title">x</span>.toPrecision(3) // -&gt;</span> <span class="string">"0.346"</span></div><div class="line"><span class="function"><span class="title">x</span>.toFixed(3) // -&gt;</span> <span class="string">"0.346"</span></div><div class="line"></div><div class="line"><span class="comment">// BUG</span></div><div class="line">var y = <span class="number">1.005</span></div><div class="line"><span class="function"><span class="title">y</span>.toPrecision(3) // -&gt;</span> <span class="string">"1.00"</span></div><div class="line"><span class="function"><span class="title">y</span>.toFixed(2) // -&gt;</span> <span class="string">"1.00"</span></div></pre></td></tr></table></figure></p>
<p>åŸå› æ˜¯ï¼š1.005 å®é™…å¯¹åº”çš„æ•°å­—æ˜¯ 1.00499999999999989ï¼Œåœ¨å››èˆäº”å…¥æ—¶å…¨éƒ¨è¢«èˆå»äº†</p>
<h2 id="0-1-0-2-0-30000000000000004"><a href="#0-1-0-2-0-30000000000000004" class="headerlink" title="0.1+0.2=0.30000000000000004"></a>0.1+0.2=0.30000000000000004</h2><p>åœ¨è®¡ç®— <code>0.1+0.2</code> çš„æ—¶å€™ï¼Œç°å°†å…¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯äºŒè¿›åˆ¶ï¼Œç„¶åå†å°†å…¶è½¬æ¢ä¸ºåè¿›åˆ¶<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">0.00011001100110011001100110011001100110011001100110011010</span> +</div><div class="line"><span class="number">0.0011001100110011001100110011001100110011001100110011010</span> =</div><div class="line"><span class="number">0.0100110011001100110011001100110011001100110011001100111</span></div></pre></td></tr></table></figure></p>
<p>è®¡ç®—ç»“æœ <code>0.0100110011001100110011001100110011001100110011001100111</code> è½¬æ¢æˆåè¿›åˆ¶ï¼Œå°±æ˜¯ <code>0.30000000000000004</code>ï¼Œè¿™å°±å¯¼è‡´å‡ºç°äº†è¯¯å·®ã€‚</p>
<p>é‡åˆ°æµ®ç‚¹æ•°è¯¯å·®é—®é¢˜æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨ <a href="https://github.com/dt-fe/number-precision/blob/master/src/index.js" target="_blank" rel="external">dt-fe/number-precision</a> å®Œç¾æ”¯æŒæµ®ç‚¹æ•°çš„åŠ å‡ä¹˜é™¤ã€å››èˆäº”å…¥ç­‰è¿ç®—ã€‚</p>
<h2 id="æ•°å€¼èŒƒå›´"><a href="#æ•°å€¼èŒƒå›´" class="headerlink" title="æ•°å€¼èŒƒå›´"></a>æ•°å€¼èŒƒå›´</h2><p>æ ¹æ®æµ®ç‚¹æ•°ç®—æœ¯æ ‡å‡†ï¼ŒæŒ‡æ•°ä½æœ€å¤§å€¼ä¸º 2047ï¼ŒE = 2047 -1023 = 1024ï¼Œæ‰€ä»¥ <strong>JavaScript èƒ½è¡¨ç¤ºçš„æ•°å€¼èŒƒå›´æ˜¯ï¼š<code>[-(2^1024-1), +(2^1024-1)]</code>ï¼Œå³ï¼šæ­£è´Ÿ1.7976931348623157ä¹˜ä»¥10çš„308æ¬¡æ–¹</strong>ï¼Œæ³¨æ„ï¼š<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Math.pow<span class="function"><span class="params">(<span class="number">2</span>, <span class="number">1023</span>)</span></span></div><div class="line">-&gt; <span class="number">8.98846567431158e+307</span></div><div class="line"></div><div class="line">Math.pow<span class="function"><span class="params">(<span class="number">2</span>, <span class="number">1024</span>)</span></span></div><div class="line">-&gt; Infinity</div></pre></td></tr></table></figure></p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li><code>Number.MIN_VALUE</code> å±æ€§è¡¨ç¤ºåœ¨ JavaScript ä¸­æ‰€èƒ½è¡¨ç¤ºçš„æœ€å°çš„æ­£å€¼<ul>
<li>å€¼ä¸º 5e-324</li>
<li>MIN_VALUE å±æ€§æ˜¯ JavaScript é‡Œæœ€æ¥è¿‘ 0 çš„æ­£å€¼ï¼Œè€Œä¸æ˜¯æœ€å°çš„è´Ÿå€¼</li>
<li>å°äº MIN_VALUE çš„å€¼å°†ä¼šè½¬æ¢ä¸º 0</li>
</ul>
</li>
<li><code>Number.MAX_VALUE</code> å±æ€§è¡¨ç¤ºåœ¨ JavaScript é‡Œæ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§æ•°å€¼<ul>
<li>å€¼ä¸º 1.7976931348623157e+308</li>
<li>å¤§äº MAX_VALUE çš„å€¼ä»£è¡¨ â€œInfinityâ€</li>
</ul>
</li>
</ul>
<p><strong>JavaScript è§„å®šèƒ½å®‰å…¨çš„è¡¨ç¤ºæ•°å­—(è¿›è¡Œç²¾ç¡®ç®—æœ¯è¿ç®—)çš„èŒƒå›´åœ¨ ï¼š<code>[-2^53, +2^53]</code>ï¼Œå³æ­£è´Ÿ2çš„53æ¬¡æ–¹</strong>ï¼›å¯¹äºè¶…è¿‡è¿™ä¸ªèŒƒå›´çš„æ•´æ•°ï¼ŒJavaScript ä¾æ—§å¯ä»¥è¿›è¡Œè¿ç®—ï¼Œä½†å´ä¸ä¿è¯è¿ç®—ç»“æœçš„å‡†ç¡®æ€§ï¼Œè¿™ä¹Ÿæ˜¯ JavaScript ä¸­å®‰å…¨æ•´æ•°çš„ä¸¤ä¸ªè¾¹ç•Œï¼š<code>Number.MIN_SAFE_INTEGER</code> å’Œ <code>Number.MAX_SAFE_INTEGER</code>ã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Number.MIN_SAFE_INTEGER</div><div class="line"><span class="meta">-&gt;</span><span class="bash"> -9007199254740991</span></div><div class="line"></div><div class="line">Number.MAX_SAFE_INTEGER</div><div class="line"><span class="meta">-&gt;</span><span class="bash"> 9007199254740991</span></div></pre></td></tr></table></figure></p>
<p>è¶…è¿‡å®‰å…¨æ•´æ•°èŒƒå›´çš„ï¼Œè®¡ç®—ä¸ä¿è¯æ­£ç¡®ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Math.pow(<span class="number">2</span>, <span class="number">53</span>)</div><div class="line">-&gt; <span class="number">9007199254740992</span></div><div class="line">Math.pow(<span class="number">2</span>, <span class="number">53</span>) + <span class="number">1</span></div><div class="line">-&gt; <span class="number">9007199254740992</span></div><div class="line">Math.pow(<span class="number">2</span>, <span class="number">53</span>) + <span class="number">2</span></div><div class="line">-&gt; <span class="number">9007199254740994</span></div></pre></td></tr></table></figure></p>
<p>å¯¹äºä¸åœ¨ <code>[-2^53, +2^53]</code> èŒƒå›´ä¸­çš„æ•°å­—ï¼Œä¾‹å¦‚ (2^53, 2^63) ä¹‹é—´çš„æ•°ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p>
<ul>
<li>(2^53, 2^54) ä¹‹é—´çš„æ•°ä¼šä¸¤ä¸ªé€‰ä¸€ä¸ªï¼Œåªèƒ½ç²¾ç¡®è¡¨ç¤ºå¶æ•°</li>
<li>(2^54, 2^55) ä¹‹é—´çš„æ•°ä¼šå››ä¸ªé€‰ä¸€ä¸ªï¼Œåªèƒ½ç²¾ç¡®è¡¨ç¤º4çš„å€æ•°</li>
<li>â€¦ ä¾æ¬¡è·³è¿‡æ›´å¤š2çš„å€æ•°</li>
</ul>
<p>ä¸‹é¢è¿™å¼ å›¾èƒ½å¾ˆå¥½çš„è¡¨ç¤º JavaScript ä¸­æµ®ç‚¹æ•°å’Œå®æ•°ï¼ˆReal Numberï¼‰ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ <code>[-2^53, 2^53]</code> åªæ˜¯æœ€ä¸­é—´éå¸¸å°çš„ä¸€éƒ¨åˆ†ï¼Œè¶Šå¾€ä¸¤è¾¹è¶Šç¨€ç–è¶Šä¸ç²¾ç¡®ã€‚</p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/real-numbers-floating-point-numbers.jpeg" alt=""></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://github.com/camsong/blog/issues/9" target="_blank" rel="external">JavaScript æµ®ç‚¹æ•°é™·é˜±åŠè§£æ³•</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/1-brjYnVlXwM3j_SWXImT0Rg.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;JavaScriptä¸­æ‰€æœ‰çš„æ•°å­—ï¼Œæ— è®ºæ˜¯æ•´æ•°è¿˜æ˜¯å°æ•°ï¼Œå…¶ç±»å‹éƒ½æ˜¯ Numberï¼Œéµå¾ª &lt;a href=&quot;http://grouper.ieee.org/groups/754/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;IEEE 754&lt;/a&gt; ç¨‹åºå†…éƒ¨ç”¨ä¸€ä¸ª 64 ä½å›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶è¿›è¡Œå­˜å‚¨è¡¨ç¤ºã€‚JavaScript ä¸­çš„æµ®ç‚¹æ•°è¿›è¡Œè¿ç®—æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°è®¡ç®—ç²¾åº¦é—®é¢˜ï¼Œä¾‹å¦‚ç»å…¸çš„ &lt;code&gt;0.1+0.2=0.30000000000000004&lt;/code&gt;ï¼Œæœ¬æ–‡å°†æ¢ç©¶ JavaScript çš„æµ®ç‚¹æ•°ï¼Œå¹¶è§£é‡Šä¸ºä½• &lt;code&gt;0.1+0.2=0.30000000000000004&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="float-point" scheme="http://objcer.com/tags/float-point/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript ä¸­ä½•æ—¶åŠ åˆ†å·â“</title>
    <link href="http://objcer.com/2017/10/13/hacking-semicolons/"/>
    <id>http://objcer.com/2017/10/13/hacking-semicolons/</id>
    <published>2017-10-13T02:06:47.000Z</published>
    <updated>2017-10-16T09:55:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨é˜…è¯» medium ä¸Šçš„æ–‡ç«  <a href="https://codeburst.io/javascript-async-await-with-foreach-b6ba62bbf404" target="_blank" rel="external">JavaScript: async/await with forEach()</a> æ—¶ï¼Œä½œè€…ç”¨äº†å¦‚ä¸‹ä¸€ä¸ªä¾‹å­æ¥é˜è¿°ï¼šasync/await å’Œ forEach ä¹‹é—´çš„é—®é¢˜ã€‚ä½†æ˜¯ä»”ç»†ç¢ç£¨è¿™æ®µä»£ç ï¼Œå‘ç°ä¸å¯¹åŠ²å•Š ğŸ˜¤ æ˜æ˜¾å’Œæˆ‘ä¹‹å‰çš„è®¤çŸ¥ä¸åŒå•Šã€‚æœ¬æ–‡å°†åˆ†æä¸€ä¸‹å…¶ä¸­çš„è¹Šè··ã€‚</p>
<blockquote>
<p>å…³äº async/await å’Œ forEachï¼Œæˆ‘åœ¨ <a href="https://objcer.com/2017/10/12/async-await-with-forEach/">å½“ async/await é‡ä¸Š forEach</a> æ–‡ä¸­è¿›è¡Œäº†è¯¦ç»†åˆ†æï¼Œè¯»è€…è‹¥å¯¹æ­¤ä¸ç†Ÿæ‚‰ï¼Œè¯·å…ˆå‰å¾€äº†è§£ ğŸ‘‰</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> waitFor = <span class="function">(<span class="params">ms</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span> setTimeout(r, ms))</div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].forEach(<span class="keyword">async</span> (num) =&gt; &#123;</div><div class="line">  <span class="keyword">await</span> waitFor(<span class="number">50</span>)</div><div class="line">  <span class="built_in">console</span>.log(num)</div><div class="line">&#125;)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Done'</span>)</div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>å½“ async/await é‡ä¸Š forEachï¼Œæ— éå°±æ˜¯å°†å›è°ƒçš„å¼‚æ­¥å‡½æ•°ï¼Œå…¨éƒ¨å¹¶è¡Œæ‰§è¡Œäº†ï¼Œè€Œéæˆ‘ä»¬æœŸæœ›çš„ä¸²è¡Œæ‰§è¡Œã€‚é‚£ä¹ˆå¯¹äºè¿™æ®µä»£ç ï¼Œæ­£å¸¸çš„è¾“å‡ºç»“æœæ˜¯ï¼šè¾“å‡ºï¼š<code>Done</code>ï¼Œé—´éš” 50 æ¯«ç§’ï¼Œè¾“å‡ºï¼š1ï¼Œ2ï¼Œ3ï¼›ä½†æ˜¯å®é™…å´åªè¾“å‡ºäº† <code>Done</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ–­å®šè¿™æ®µä»£ç æœ‰é—®é¢˜ã€‚</p>
<h3 id="è€ƒè™‘ç®­å¤´å‡½æ•°çš„é—®é¢˜"><a href="#è€ƒè™‘ç®­å¤´å‡½æ•°çš„é—®é¢˜" class="headerlink" title="è€ƒè™‘ç®­å¤´å‡½æ•°çš„é—®é¢˜"></a>è€ƒè™‘ç®­å¤´å‡½æ•°çš„é—®é¢˜</h3><p>ä¸€å¼€å§‹æˆ‘æŠŠç›®å…‰æ”¾åˆ°ç®­å¤´å‡½æ•°ä¸Šï¼Œç®­å¤´å‡½æ•° <code>waitFor</code> è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œ æŠŠç®­å¤´å‡½æ•°è¿”å›æ”¹é€ æˆå¦‚ä¸‹ï¼Œå‘ç°ï¼Œæ‰§è¡Œç»“æœæ­£ç¡®äº†<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> waitFor = <span class="function">(<span class="params">ms</span>) =&gt;</span> &#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span> setTimeout(r, ms))&#125;</div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].forEach(<span class="keyword">async</span> (num) =&gt; &#123;</div><div class="line">  <span class="keyword">await</span> waitFor(<span class="number">50</span>)</div><div class="line">  <span class="built_in">console</span>.log(num)</div><div class="line">&#125;)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Done'</span>)</div></pre></td></tr></table></figure></p>
<p>ç„¶åï¼Œåœ¨ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="external">MDN - Arrow functions</a> å‘ç°ï¼š<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// Parenthesize the <span class="keyword">body</span> <span class="keyword">of</span> <span class="keyword">function</span> <span class="title">to</span> <span class="keyword">return</span> <span class="type">an</span> object literal expression:</div><div class="line">params =&gt; (&#123;foo: bar&#125;)</div></pre></td></tr></table></figure></p>
<p>æŒ‡ç®­å¤´å‡½æ•°è¿”å›å¯¹è±¡å­—é¢é‡æ—¶ï¼Œéœ€è¦ç”¨æ‹¬å·åŒ…èµ·æ¥ã€‚å¯¹äºå¦‚ä¸‹å‡½æ•°ï¼š<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> square = <span class="function"><span class="keyword">function</span><span class="params">(n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        square: n * n</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥æ”¹å†™æˆç®­å¤´å‡½æ•°å¦‚ä¸‹ï¼š<br><figure class="highlight excel"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> square = <span class="built_in">n</span> =&gt; &#123; squa<span class="symbol">re:</span> <span class="built_in">n</span> * <span class="built_in">n</span> &#125;</div></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶è°ƒç”¨ <code>square</code> å‡½æ•°ï¼Œä¼šå‘ç°ï¼Œæ— è®ºä¼ å…¥ä»€ä¹ˆå‚æ•°éƒ½æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œä¸ºå•¥å‘¢ï¼Ÿ</p>
<p>JavaScript åœ¨è§£æ <code>square</code> å‡½æ•°æ—¶ï¼Œé‡åˆ° <code>{ square: n * n }</code>ï¼Œå¹¶ä¸æ˜¯è®¤ä¸ºå…¶æ˜¯ä¸€ä¸ªå¯¹è±¡å­—é¢é‡ï¼Œè€ŒæŠŠå®ƒè§£ææˆ <code>Labelled Block Statement</code>ï¼Œlabel ä¸º <code>square</code>ï¼Œstatement ä¸º <code>n * n</code>ï¼›ç”±äºæ²¡æœ‰è¿”å›å€¼ï¼Œæ‰§è¡Œ <code>square</code> å‡½æ•°ä¼šä¸€ç›´è¿”å› undefinedï¼Œå¦‚æœè¿”å› <code>n * n</code> é‚£ä¹ˆä»£ç ä¹Ÿå¯æ­£å¸¸æ‰§è¡Œ<br><figure class="highlight excel"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> square = <span class="built_in">n</span> =&gt; &#123; squa<span class="symbol">re:</span> return <span class="built_in">n</span> * <span class="built_in">n</span> &#125;</div></pre></td></tr></table></figure></p>
<p>æ˜¾ç„¶è¿™æ ·çš„ä»£ç å¤ªå¥‡æ€ªäº†ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ç”¨æ‹¬å·å°†å¯¹è±¡å­—é¢é‡åŒ…èµ·æ¥ï¼Œè¿™æ ·ï¼ŒJavaScript åœ¨è§£æçš„æ—¶å€™é‡åˆ°æ‹¬å·ï¼Œå°±ä¸ä¼šå°† <code>{ square: n * n }</code> è®¤ä¸ºæ˜¯ <code>Labelled Block Statement</code> äº†ï¼Œè€Œæ˜¯å¯¹è±¡å­—é¢é‡ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight excel"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> square = <span class="built_in">n</span> =&gt; (&#123; squa<span class="symbol">re:</span> <span class="built_in">n</span> * <span class="built_in">n</span> &#125;)</div></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬åˆ†æçš„è¿™æ®µä»£ç ä¸­ <code>waitFor</code> ç®­å¤´å‡½æ•°è¿”å›çš„æ˜¯ Promise å¯¹è±¡ï¼Œå¹¶éå¯¹è±¡å­—é¢é‡ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯ç®­å¤´å‡½æ•°çš„é”…å•Šã€‚</p>
<h3 id="åˆ†å·"><a href="#åˆ†å·" class="headerlink" title="åˆ†å·"></a>åˆ†å·</h3><p>æˆ‘ä»¬çœ‹åˆ°å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = &#123;<span class="string">'b'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;</div><div class="line">[<span class="string">'b'</span>].forEach(<span class="function"><span class="params">v</span> =&gt;</span> &#123;<span class="built_in">console</span>.log(v)&#125;)  <span class="comment">// è¾“å‡ºï¼š 1, 2, 3</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> a = &#123;<span class="string">'b'</span>: <span class="number">1</span>&#125;</div><div class="line">[<span class="string">'b'</span>].forEach(<span class="function"><span class="params">v</span> =&gt;</span> &#123;<span class="built_in">console</span>.log(v)&#125;) <span class="comment">// å‡ºé”™ï¼šUncaught TypeError: &#123;(intermediate value)&#125;.b.forEach is not a function</span></div></pre></td></tr></table></figure></p>
<p>æ˜¾ç„¶ JavaScript åœ¨ä»£ç è§£æçš„æ—¶å€™ï¼Œç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œæ²¡æœ‰åˆ†å¼€å•Šï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸Šåˆ†å·ï¼Œè¿™æ ·ä»£ç å°±æ­£å¸¸æ‰§è¡Œäº†ã€‚<br>æˆ‘ä»¬åˆ†æçš„è¿™æ®µä»£ç ï¼Œåœ¨ <code>waitFor</code> ç®­å¤´å‡½æ•°ååŠ ä¸Šåˆ†å·ï¼Œä»£ç ä¹Ÿå°±æ­£ç¡®æ‰§è¡Œäº†<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> waitFor = <span class="function">(<span class="params">ms</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span> setTimeout(r, ms));</div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].forEach(<span class="keyword">async</span> (num) =&gt; &#123;</div><div class="line">  <span class="keyword">await</span> waitFor(<span class="number">50</span>)</div><div class="line">  <span class="built_in">console</span>.log(num)</div><div class="line">&#125;)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Done'</span>)</div></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯ä¸ºå•¥å‘¢ï¼Ÿä¼¼ä¹åœ¨æˆ‘ä»¬çš„å°è±¡ä¸­ï¼ŒJavaScript æ˜¯å¯ä»¥å¿½ç•¥åˆ†å·çš„ï¼Œè«éæœ‰ç‰¹æ®Šæƒ…å†µã€‚åœ¨çŸ¥ä¹é—®é¢˜ï¼š <a href="https://www.zhihu.com/question/20298345/answer/49551142" target="_blank" rel="external">JavaScript è¯­å¥ååº”è¯¥åŠ åˆ†å·ä¹ˆï¼Ÿ</a> ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼š</p>
<blockquote>
<p>ğŸ‘‰ <strong>çœŸæ­£ä¼šå¯¼è‡´ä¸Šä¸‹è¡Œè§£æå‡ºé—®é¢˜çš„ token æœ‰ 5 ä¸ªï¼šæ‹¬å·ï¼Œæ–¹æ‹¬å·ï¼Œæ­£åˆ™å¼€å¤´çš„æ–œæ ï¼ŒåŠ å·ï¼Œå‡å·ã€‚</strong>æˆ‘è¿˜ä»æ²¡è§è¿‡å®é™…ä»£ç ä¸­ç”¨æ­£åˆ™ã€åŠ å·ã€å‡å·ä½œä¸ºè¡Œé¦–çš„æƒ…å†µï¼Œæ‰€ä»¥æ€»ç»“ä¸‹æ¥å°±æ˜¯ä¸€å¥è¯ï¼š<strong>ä¸€è¡Œå¼€å¤´æ˜¯æ‹¬å·æˆ–è€…æ–¹æ‹¬å·çš„æ—¶å€™åŠ ä¸Šåˆ†å·å°±å¯ä»¥äº†ï¼Œå…¶ä»–æ—¶å€™å…¨éƒ¨ä¸éœ€è¦ã€‚</strong></p>
</blockquote>
<p>ä¹Ÿå³æ˜¯åœ¨ <code>+ - [ ( /</code> è¿™äº”ä¸ªå­—ç¬¦å¼€å¤´æ—¶ï¼Œéœ€è¦åœ¨ä¸Šä¸€è¡Œæˆ–è€…å½“å‰è¡Œé¦–åŠ ä¸Šåˆ†å·ï¼Œé¿å… JavaScript ä¸Šä¸‹è¡Œè§£æå‡ºé”™ã€‚</p>
<h2 id="é—®é¢˜æ€»ç»“"><a href="#é—®é¢˜æ€»ç»“" class="headerlink" title="é—®é¢˜æ€»ç»“"></a>é—®é¢˜æ€»ç»“</h2><p>medium çš„ä½œè€…ä¸å°å¿ƒè¸©äº†ä¸€ä¸ªå‘ï¼Œå°‘å†™äº†ä¸€ä¸ªåˆ†å·ï¼Œå¯¼è‡´ JavaScript ä¸Šä¸‹æ–‡è§£æå‡ºé”™ï¼Œå†™äº†ä¸€ä¸ªä¸æ°å½“çš„ä¾‹å­ï¼Œé€šè¿‡ä¸€æ­¥æ­¥åˆ†æï¼Œè¿˜æ˜¯æ‰¾åˆ°äº†é—®é¢˜çš„æœ¬è´¨ï¼Œä¹Ÿç®—æ˜¯æ¶¨å§¿åŠ¿äº†ğŸ˜‹</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://blog.mariusschulz.com/2015/06/09/returning-object-literals-from-arrow-functions-in-javascript" target="_blank" rel="external">Returning Object Literals from Arrow Functions in JavaScript</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨é˜…è¯» medium ä¸Šçš„æ–‡ç«  &lt;a href=&quot;https://codeburst.io/javascript-async-await-with-foreach-b6ba62bbf404&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;JavaScript: async/await with forEach()&lt;/a&gt; æ—¶ï¼Œä½œè€…ç”¨äº†å¦‚ä¸‹ä¸€ä¸ªä¾‹å­æ¥é˜è¿°ï¼šasync/await å’Œ forEach ä¹‹é—´çš„é—®é¢˜ã€‚ä½†æ˜¯ä»”ç»†ç¢ç£¨è¿™æ®µä»£ç ï¼Œå‘ç°ä¸å¯¹åŠ²å•Š ğŸ˜¤ æ˜æ˜¾å’Œæˆ‘ä¹‹å‰çš„è®¤çŸ¥ä¸åŒå•Šã€‚æœ¬æ–‡å°†åˆ†æä¸€ä¸‹å…¶ä¸­çš„è¹Šè··ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å…³äº async/await å’Œ forEachï¼Œæˆ‘åœ¨ &lt;a href=&quot;https://objcer.com/2017/10/12/async-await-with-forEach/&quot;&gt;å½“ async/await é‡ä¸Š forEach&lt;/a&gt; æ–‡ä¸­è¿›è¡Œäº†è¯¦ç»†åˆ†æï¼Œè¯»è€…è‹¥å¯¹æ­¤ä¸ç†Ÿæ‚‰ï¼Œè¯·å…ˆå‰å¾€äº†è§£ ğŸ‘‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; waitFor = &lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;ms&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Promise&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;r&lt;/span&gt; =&amp;gt;&lt;/span&gt; setTimeout(r, ms))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;].forEach(&lt;span class=&quot;keyword&quot;&gt;async&lt;/span&gt; (num) =&amp;gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;await&lt;/span&gt; waitFor(&lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(num)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;Done&#39;&lt;/span&gt;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
  </entry>
  
  <entry>
    <title>å½“ async/await é‡ä¸Š forEach</title>
    <link href="http://objcer.com/2017/10/12/async-await-with-forEach/"/>
    <id>http://objcer.com/2017/10/12/async-await-with-forEach/</id>
    <published>2017-10-12T08:28:38.000Z</published>
    <updated>2017-10-12T08:29:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ–‡ç«  <a href="https://objcer.com/2017/10/11/Async-Await/">ES7 ä¸­çš„ async await</a> ä¸­ä»‹ç»äº† async/awaitã€‚æœ¬æ–‡å°†åˆ†æä»‹ç»å½“ async/await é‡ä¸Š <code>forEach</code> å‡ºç°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/1-pWGJIKats-zuumA3RQNEWQ.jpeg" alt=""></p>
<a id="more"></a>
<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> getNumbers = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> multi = <span class="function"><span class="params">num</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">if</span> (num) &#123;</div><div class="line">        resolve(num * num)</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'num not specified'</span>))</div><div class="line">      &#125;</div><div class="line">    &#125;, <span class="number">1000</span>)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> nums = <span class="keyword">await</span> getNumbers()</div><div class="line">  nums.forEach(<span class="keyword">async</span> x =&gt; &#123;</div><div class="line">    <span class="keyword">var</span> res = <span class="keyword">await</span> multi(x)</div><div class="line">    <span class="built_in">console</span>.log(res)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">test()</div></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡ <code>forEach</code> éå†çš„å°†æ¯ä¸€ä¸ªæ•°å­—éƒ½æ‰§è¡Œ <code>multi</code> æ“ä½œã€‚ä»£ç æ‰§è¡Œçš„ç»“æœæ˜¯ï¼š1 ç§’åï¼Œä¸€æ¬¡æ€§è¾“å‡º1ï¼Œ4ï¼Œ9ã€‚è¿™ä¸ªç»“æœå’Œæˆ‘ä»¬çš„é¢„æœŸæœ‰äº›åŒºåˆ«ï¼Œæˆ‘ä»¬æ˜¯å¸Œæœ›æ¯é—´éš” 1 ç§’ï¼Œç„¶åä¾æ¬¡è¾“å‡º 1ï¼Œ4ï¼Œ9ï¼›æ‰€ä»¥å½“å‰ä»£ç åº”è¯¥æ˜¯å¹¶è¡Œæ‰§è¡Œäº†ï¼Œè€Œæˆ‘ä»¬æœŸæœ›çš„åº”è¯¥æ˜¯ä¸²è¡Œæ‰§è¡Œã€‚</p>
<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><h3 id="JavaScript-ä¸­çš„å¾ªç¯æ•°ç»„éå†"><a href="#JavaScript-ä¸­çš„å¾ªç¯æ•°ç»„éå†" class="headerlink" title="JavaScript ä¸­çš„å¾ªç¯æ•°ç»„éå†"></a>JavaScript ä¸­çš„å¾ªç¯æ•°ç»„éå†</h3><p>åœ¨ JavaScript ä¸­æä¾›äº†å¦‚ä¸‹å››ç§å¾ªç¯éå†æ•°ç»„å…ƒç´ çš„æ–¹å¼ï¼š</p>
<ul>
<li><p><code>for</code><br>è¿™æ˜¯å¾ªç¯éå†æ•°ç»„å…ƒç´ æœ€ç®€å•çš„æ–¹å¼</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; arr.<span class="built_in">length</span>; <span class="built_in">i</span>++) &#123;</div><div class="line">  console.log(arr[i]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p><code>for-in</code><br><code>for-in</code> è¯­å¥ä»¥ä»»æ„é¡ºåºéå†ä¸€ä¸ªå¯¹è±¡çš„å¯æšä¸¾å±æ€§ï¼Œå¯¹äºæ•°ç»„å³æ˜¯æ•°ç»„ä¸‹æ ‡ï¼Œå¯¹äºå¯¹è±¡å³æ˜¯å¯¹è±¡çš„ key å€¼ã€‚æ³¨æ„ <code>for-in</code> éå†è¿”å›çš„å¯¹è±¡å±æ€§éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå³ä½¿æ˜¯æ•°ç»„ä¸‹æ ‡ï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸² â€œ0â€, â€œ1â€, â€œ2â€ ç­‰ç­‰ã€‚<em>[ä¸æ¨èä½¿ç”¨ <code>for-in</code> è¯­å¥]</em></p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (var <span class="keyword">index</span> <span class="keyword">in</span> myArray) &#123;</div><div class="line">  console.<span class="built_in">log</span>(myArray[<span class="keyword">index</span>]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p><code>forEach</code><br><code>forEach</code> æ–¹æ³•ç”¨äºè°ƒç”¨æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶å°†å…ƒç´ ä¼ é€’ç»™å›è°ƒå‡½æ•°ï¼›æ³¨æ„åœ¨å›è°ƒå‡½æ•°ä¸­æ— æ³•ä½¿ç”¨ <code>break</code> è·³å‡ºå½“å‰å¾ªç¯ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨ <code>return</code> è¿”å›å€¼</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">myArray.forEach(<span class="function"><span class="keyword">function</span></span> (<span class="keyword">value</span>) &#123;</div><div class="line">  console.<span class="built_in">log</span>(<span class="keyword">value</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p><code>for-of</code><br><code>for-of</code> è¯­å¥ä¸ºå„ç§ collection é›†åˆå¯¹è±¡ä¸“é—¨å®šåˆ¶çš„ï¼Œéå†é›†åˆå¯¹è±¡çš„å±æ€§å€¼ï¼Œæ³¨æ„å’Œ <code>for-in</code> çš„åŒºåˆ«</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (var <span class="keyword">value</span> <span class="keyword">of</span> myArray) &#123;</div><div class="line">  console.log(<span class="keyword">value</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="åˆ†æé—®é¢˜"><a href="#åˆ†æé—®é¢˜" class="headerlink" title="åˆ†æé—®é¢˜"></a>åˆ†æé—®é¢˜</h3><p>åœ¨æœ¬ä¾‹ä¸­ <code>forEach</code> çš„å›è°ƒå‡½æ•°æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå¼‚æ­¥å‡½æ•°ä¸­åŒ…å«ä¸€ä¸ª <code>await</code> ç­‰å¾… Promise è¿”å›ç»“æœï¼Œæˆ‘ä»¬æœŸæœ›æ•°ç»„å…ƒç´ ä¸²è¡Œæ‰§è¡Œè¿™ä¸ªå¼‚æ­¥æ“ä½œï¼Œä½†æ˜¯å®é™…å´æ˜¯å¹¶è¡Œæ‰§è¡Œäº†ã€‚</p>
<p><code>forEach</code> çš„ polyfill å‚è€ƒï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach" target="_blank" rel="external">MDN-Array.prototype.forEach()</a>ï¼Œç®€å•ç‚¹ç†è§£ï¼š</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Array.prototype.forEach = function (callback) &#123;</div><div class="line">  <span class="comment">// this represents our array</span></div><div class="line">  <span class="keyword">for</span> (let <span class="keyword">index</span> = <span class="number">0</span>; <span class="keyword">index</span> &lt; <span class="keyword">this</span>.length; <span class="keyword">index</span>++) &#123;</div><div class="line">    <span class="comment">// We call the callback for each entry</span></div><div class="line">    callback(<span class="keyword">this</span>[<span class="keyword">index</span>], <span class="keyword">index</span>, <span class="keyword">this</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç›¸å½“äº <code>for</code> å¾ªç¯æ‰§è¡Œäº†è¿™ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œæ‰€ä»¥æ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œå¯¼è‡´äº†ä¸€æ¬¡æ€§å…¨éƒ¨è¾“å‡ºç»“æœï¼š1ï¼Œ4ï¼Œ9<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> nums = <span class="keyword">await</span> getNumbers()</div><div class="line"><span class="comment">//   nums.forEach(async x =&gt; &#123;</span></div><div class="line"><span class="comment">//     var res = await multi(x)</span></div><div class="line"><span class="comment">//     console.log(res)</span></div><div class="line"><span class="comment">//   &#125;)</span></div><div class="line"></div><div class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; nums.length; index++) &#123;</div><div class="line">    (<span class="keyword">async</span> x =&gt; &#123;</div><div class="line">      <span class="keyword">var</span> res = <span class="keyword">await</span> multi(x)</div><div class="line">      <span class="built_in">console</span>.log(res)</div><div class="line">    &#125;)(nums[index])</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h2><h3 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h3><p>æˆ‘ä»¬å¯ä»¥æ”¹é€ ä¸€ä¸‹ <code>forEach</code>ï¼Œç¡®ä¿æ¯ä¸€ä¸ªå¼‚æ­¥çš„å›è°ƒæ‰§è¡Œå®Œæˆåï¼Œæ‰æ‰§è¡Œä¸‹ä¸€ä¸ª<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncForEach</span>(<span class="params">array, callback</span>) </span>&#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; array.length; index++) &#123;</div><div class="line">    <span class="keyword">await</span> callback(array[index], index, array)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> nums = <span class="keyword">await</span> getNumbers()</div><div class="line">  asyncForEach(nums, <span class="keyword">async</span> x =&gt; &#123;</div><div class="line">    <span class="keyword">var</span> res = <span class="keyword">await</span> multi(x)</div><div class="line">    <span class="built_in">console</span>.log(res)</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h3><p>ä½¿ç”¨ <code>for-of</code> æ›¿ä»£ <code>for-each</code>ã€‚</p>
<p><code>for-of</code> å¯ä»¥éå†å„ç§é›†åˆå¯¹è±¡çš„å±æ€§å€¼ï¼Œè¦æ±‚è¢«éå†çš„å¯¹è±¡éœ€è¦å®ç°è¿­ä»£å™¨ (iterator) æ–¹æ³•ï¼Œä¾‹å¦‚ <code>myObject[Symbol.iterator]()</code> ç”¨äºå‘ŠçŸ¥ JS å¼•æ“å¦‚ä½•éå†è¯¥å¯¹è±¡ã€‚ä¸€ä¸ªæ‹¥æœ‰ <code>[Symbol.iterator]()</code> æ–¹æ³•çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯å¯éå†çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> zeroesForeverIterator = &#123;</div><div class="line">  [<span class="built_in">Symbol</span>.iterator]: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">next</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;<span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="number">0</span>&#125;;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>å¦‚ä¸Šå°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„è¿­ä»£å™¨å¯¹è±¡ï¼›<code>for-of</code> éå†å¯¹è±¡æ—¶ï¼Œå…ˆè°ƒç”¨éå†å¯¹è±¡çš„è¿­ä»£å™¨æ–¹æ³• <code>[Symbol.iterator]()</code>ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡(è¿­ä»£å™¨å¯¹è±¡ä¸­åŒ…å«ä¸€ä¸ª <code>next</code> æ–¹æ³•)ï¼›ç„¶åè°ƒç”¨è¯¥è¿­ä»£å™¨å¯¹è±¡ä¸Šçš„ <code>next</code> æ–¹æ³•ã€‚</p>
<p>æ¯æ¬¡è°ƒç”¨ <code>next</code> æ–¹æ³•éƒ½è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­ <code>done</code> å’Œ <code>value</code> å±æ€§ç”¨æ¥è¡¨ç¤ºéå†æ˜¯å¦ç»“æŸå’Œå½“å‰éå†çš„å±æ€§å€¼ï¼Œå½“ <code>done</code> çš„å€¼ä¸º <code>true</code> æ—¶ï¼Œéå†å°±åœæ­¢äº†ã€‚</p>
<figure class="highlight cal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">VAR</span> <span class="keyword">of</span> ITERABLE) &#123;</div><div class="line">  STATEMENTS</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç­‰ä»·äºï¼š<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">var</span> <span class="variable">$iterator</span> = ITERABLE[Symbol.iterator]();</div><div class="line"><span class="attribute">var</span> <span class="variable">$result</span> = <span class="variable">$iterator</span>.next();</div><div class="line"><span class="attribute">while</span> (!<span class="variable">$result</span>.done) &#123;</div><div class="line">  <span class="attribute">VAR</span> = <span class="variable">$result</span>.value;</div><div class="line">  <span class="attribute">STATEMENTS</span></div><div class="line">  <span class="variable">$result</span> = <span class="variable">$iterator</span>.next();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç”±æ­¤å¯ä»¥çŸ¥é“ <code>for-of</code> å’Œ <code>forEach</code> éå†å…ƒç´ æ—¶å¤„ç†çš„æ–¹å¼æ˜¯ä¸åŒçš„ã€‚ä½¿ç”¨ <code>for-of</code> æ›¿ä»£ <code>for-each</code> åä»£ç ä¸ºï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> nums = <span class="keyword">await</span> getNumbers()</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> x <span class="keyword">of</span> nums) &#123;</div><div class="line">    <span class="keyword">var</span> res = <span class="keyword">await</span> multi(x)</div><div class="line">    <span class="built_in">console</span>.log(res)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://codeburst.io/understand-async-await-better-7a03aeba60fe" target="_blank" rel="external">Understand async/await better</a><br><a href="https://hacks.mozilla.org/2015/04/es6-in-depth-iterators-and-the-for-of-loop/" target="_blank" rel="external">ES6 In Depth: Iterators and the for-of loop</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨æ–‡ç«  &lt;a href=&quot;https://objcer.com/2017/10/11/Async-Await/&quot;&gt;ES7 ä¸­çš„ async await&lt;/a&gt; ä¸­ä»‹ç»äº† async/awaitã€‚æœ¬æ–‡å°†åˆ†æä»‹ç»å½“ async/await é‡ä¸Š &lt;code&gt;forEach&lt;/code&gt; å‡ºç°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/1-pWGJIKats-zuumA3RQNEWQ.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="async" scheme="http://objcer.com/tags/async/"/>
    
      <category term="await" scheme="http://objcer.com/tags/await/"/>
    
  </entry>
  
  <entry>
    <title>ES7 ä¸­çš„ async await</title>
    <link href="http://objcer.com/2017/10/11/Async-Await/"/>
    <id>http://objcer.com/2017/10/11/Async-Await/</id>
    <published>2017-10-11T06:36:46.000Z</published>
    <updated>2017-10-11T09:37:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ JavaScript ä¸­å¤„ç†å¼‚æ­¥æ“ä½œçš„å›è°ƒ (callback) é€šå¸¸ä¼šå¯¼è‡´å¤šåµŒå¥—çš„ä»£ç å—ï¼Œä¿—ç§°å›è°ƒåœ°ç‹± (callback hell)ï¼Œè¿™æ ·çš„ä»£ç å¤æ‚ï¼Œå¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§éå¸¸ä¸å‹å¥½ï¼›ç›´è¾¾ ES6ï¼ŒPromise å‡ºç°ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ‰å¹³åŒ–å›è°ƒå‡½æ•°ï¼Œå‘Šåˆ«å›è°ƒåœ°ç‹±ï¼Œå†™å‡ºä¼˜é›…çš„ä»£ç ï¼›ä½†æ˜¯åœ¨å®è·µä¸­å‘ç°ï¼ŒPromise å¹¶ä¸å®Œç¾ï¼Œå¦‚æœ Promise çš„å›è°ƒä¸­å‡ºç°åµŒå¥—ï¼Œä¾æ—§ä¼šå‡ºç°å›è°ƒåœ°ç‹±ï¼›è€Œå¦‚ä»Šï¼Œasync await å‡ºç°äº†ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–°çš„ç¼–å†™å¼‚æ­¥ä»£ç æ–¹å¼ï¼Œä½¿å¾—å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒæ˜¯åŒæ­¥ä»£ç ï¼Œè¿™æ­£å¼å®ƒçš„é­”åŠ›æ‰€åœ¨ã€‚</p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/1-ko3KtcVSlzpe3RnTRgJaHw.jpeg" alt=""></p>
<a id="more"></a>
<h2 id="å¼‚æ­¥å‡½æ•°"><a href="#å¼‚æ­¥å‡½æ•°" class="headerlink" title="å¼‚æ­¥å‡½æ•°"></a>å¼‚æ­¥å‡½æ•°</h2><figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// async <span class="function"><span class="keyword">function</span></span> statementï¼šasync <span class="function"><span class="keyword">function</span></span> å£°æ˜è¯­å¥</div><div class="line">async <span class="function"><span class="keyword">function</span></span> <span class="keyword">name</span>([param[, param[, ... param]]]) &#123;</div><div class="line">   statements</div><div class="line">&#125;</div><div class="line"></div><div class="line">// async <span class="function"><span class="keyword">function</span></span> expressionï¼šasync <span class="function"><span class="keyword">function</span></span> è¡¨è¾¾å¼</div><div class="line">async <span class="function"><span class="keyword">function</span></span> [<span class="keyword">name</span>]([param1[, param2[, ..., paramN]]]) &#123;</div><div class="line">   statements</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼Œå¯ä»¥é€šè¿‡ async function å£°æ˜è¯­å¥æˆ–è€…è¡¨è¾¾å¼æ¥å®šä¹‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª <code>AsyncFunction</code> å¯¹è±¡ï¼ŒäºŒè€…çš„åŒºåˆ«åœ¨äºåœ¨äºå‡½æ•°åç§°ï¼Œasync function è¡¨è¾¾å¼å¯ä»¥çœç•¥å‡½æ•°åç§°æ¥åˆ›å»ºä¸€ä¸ªåŒ¿åçš„å‡½æ•°ã€‚</p>
<p><strong>è°ƒç”¨å¼‚æ­¥å‡½æ•°æ—¶ä¼šè¿”å›ä¸€ä¸ª promise å¯¹è±¡</strong></p>
<ul>
<li>å½“è¿™ä¸ªå¼‚æ­¥å‡½æ•°è¿”å›ä¸€ä¸ªå€¼æ—¶ï¼Œpromise çš„ resolve æ–¹æ³•å°†ä¼šå¤„ç†è¿™ä¸ªè¿”å›å€¼</li>
<li>å½“å¼‚æ­¥å‡½æ•°æŠ›å‡ºå¼‚å¸¸æˆ–è€…éæ³•å€¼æ—¶ï¼Œpromise çš„ reject æ–¹æ³•å°†å¤„ç†è¿™ä¸ªå¼‚å¸¸å€¼</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'ok'</span></div><div class="line">  <span class="comment">// throw new Error('error')</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">test().then(<span class="built_in">console</span>.log, <span class="built_in">console</span>.error)</div></pre></td></tr></table></figure>
<h2 id="AsyncFunction"><a href="#AsyncFunction" class="headerlink" title="AsyncFunction"></a><code>AsyncFunction</code></h2><blockquote>
<p>æ³¨æ„ï¼Œ<code>AsyncFunction</code> å¹¶ä¸æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è·å¾— <code>AsyncFunction</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Object</span>.getPrototypeOf(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;).constructor</div></pre></td></tr></table></figure></p>
</blockquote>
<p><code>AsyncFunction</code> æ„é€ å‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ async function å¯¹è±¡ï¼Œåœ¨ JavaScript ä¸­ï¼Œæ¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°éƒ½æ˜¯ä¸€ä¸ª <code>AsyncFunction</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;.constructor)</div><div class="line"><span class="comment">// -&gt; Æ’ AsyncFunction() &#123; [native code] &#125;</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;.__proto__)</div><div class="line"><span class="comment">// -&gt; AsyncFunction &#123;Symbol(Symbol.toStringTag): "AsyncFunction", constructor: Æ’&#125;</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> AsyncFunction = <span class="built_in">Object</span>.getPrototypeOf(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;).constructor</div><div class="line"><span class="keyword">var</span> asyncFun = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(asyncFun <span class="keyword">instanceof</span> AsyncFunction) <span class="comment">// -&gt; true</span></div></pre></td></tr></table></figure></p>
<p>é€šè¿‡ <code>AsyncFunction</code> æ„é€ å‡½æ•°åˆ›å»ºå¼‚æ­¥å‡½æ•°çš„è¯­æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">new AsyncFunction(<span class="comment">[arg1<span class="comment">[, arg2<span class="comment">[, ...argN]</span>]</span>,]</span> functionBody)</div></pre></td></tr></table></figure></p>
<p>æŠŠ <code>AsyncFunction</code> å½“æˆå‡½æ•°è°ƒç”¨ï¼ˆçœç•¥ <code>new</code> æ“ä½œç¬¦ï¼‰ä¹Ÿå¯åˆ›å»ºå¼‚æ­¥å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var AsyncFunction = Object.getPrototypeOf(async function () &#123;&#125;).constructor<span class="comment">;</span></div><div class="line">// var <span class="function"><span class="keyword">func</span> = <span class="title">new</span> <span class="title">AsyncFunction</span><span class="params">(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'return a+b'</span>)</span></span></div><div class="line">var <span class="function"><span class="keyword">func</span> = <span class="title">AsyncFunction</span><span class="params">(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'return a+b'</span>)</span></span></div><div class="line"><span class="function"><span class="keyword">func</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span>.<span class="title">then</span><span class="params">(console.log)</span> // -&gt; 3</span></div></pre></td></tr></table></figure>
<p>ğŸ‘‰ é€šè¿‡ <code>AsyncFunction</code> æ„é€ å‡½æ•°åˆ›å»ºçš„å¼‚æ­¥å‡½æ•° åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸åˆ›å»ºé—­åŒ…ï¼›è€Œæ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸåˆ›å»ºçš„ã€‚è€Œä¸”åªéœ€æ•ˆç‡æ¯”ç”¨ async function å£°æ˜è¯­å¥æˆ–è€…è¡¨è¾¾å¼æ¥å®šä¹‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•°è¦ä½ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä½¿ç”¨ async function å£°æ˜è¯­å¥æˆ–è€…è¡¨è¾¾å¼æ¥å®šä¹‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ã€‚</p>
<h2 id="await"><a href="#await" class="headerlink" title="await"></a><code>await</code></h2><p><code>await</code> æ“ä½œç¬¦ç”¨äºç­‰å¾…ä¸€ä¸ª Promise è¿”å›ç»“æœæˆ–è€…æŸä¸ªç›´æ¥çš„å€¼ï¼Œä¸” <code>await</code> å¿…é¡»åœ¨å¼‚æ­¥å‡½æ•° (async function) ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnPromise</span> (<span class="params">a</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">    resolve(a)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnValue</span> (<span class="params">a</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> a</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line"><span class="comment">// var a = await returnPromise(2)</span></div><div class="line">  <span class="keyword">var</span> a = <span class="keyword">await</span> returnValue(<span class="number">3</span>)</div><div class="line">  <span class="keyword">return</span> a</div><div class="line">&#125;</div><div class="line"></div><div class="line">test().then(<span class="built_in">console</span>.log, <span class="built_in">console</span>.error)</div></pre></td></tr></table></figure></p>
<p>å¼‚æ­¥å‡½æ•°ä¸­æ‰§è¡Œ <code>await</code> è¡¨è¾¾å¼ï¼Œè¿™å°†ä¼šä½¿å¼‚æ­¥å‡½æ•°æš‚åœæ‰§è¡Œå¹¶ç­‰å¾… promise è§£æä¼ å€¼åï¼Œç»§ç»­æ‰§è¡Œå¼‚æ­¥å‡½æ•°å¹¶è¿”å›è§£æå€¼ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span> (<span class="params">second</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">    setTimeout(resolve, second * <span class="number">1000</span>)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>())</div><div class="line">  <span class="keyword">await</span> sleep(<span class="number">3</span>)</div><div class="line">  <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>())</div><div class="line">&#125;</div><div class="line"></div><div class="line">test()</div></pre></td></tr></table></figure></p>
<p>ä»£ç æ‰§è¡Œç»“æœï¼š<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Wed Oct <span class="number">11</span> <span class="number">2017</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">32</span> GMT+<span class="number">0800</span> (CST)</div><div class="line">Promise &#123;<span class="string">[[PromiseStatus]]</span>: <span class="string">"pending"</span>, <span class="string">[[PromiseValue]]</span>: undefined&#125;</div><div class="line">Wed Oct <span class="number">11</span> <span class="number">2017</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">35</span> GMT+<span class="number">0800</span> (CST)</div></pre></td></tr></table></figure></p>
<p><code>await</code> ä¸²è¡Œï¼Œå¹¶è¡Œæ‰§è¡Œ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">multi</span> (<span class="params">a</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">    setTimeout(resolve.bind(<span class="literal">null</span>, a * a), <span class="number">1000</span>)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ä¸²è¡Œæ‰§è¡Œ</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="keyword">var</span> x = <span class="keyword">await</span> multi(<span class="number">2</span>)</div><div class="line">   <span class="keyword">var</span> y = <span class="keyword">await</span> multi(<span class="number">3</span>)</div><div class="line">   <span class="keyword">return</span> [x, y]</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å¹¶è¡Œæ‰§è¡Œ</span></div><div class="line"><span class="comment">// async function test () &#123;</span></div><div class="line"><span class="comment">//    var res = await Promise.all([multi(2), multi(3)])</span></div><div class="line"><span class="comment">//    return res</span></div><div class="line"><span class="comment">// &#125;</span></div><div class="line"></div><div class="line">test().then(<span class="built_in">console</span>.log)</div></pre></td></tr></table></figure></p>
<h2 id="async-await-çš„ä¼˜åŠ¿"><a href="#async-await-çš„ä¼˜åŠ¿" class="headerlink" title="async await çš„ä¼˜åŠ¿"></a>async await çš„ä¼˜åŠ¿</h2><p>Promise æœ‰äº† async await çš„è¾…åŠ©ï¼Œä½¿å…¶å‘æŒ¥æ›´å¤§çš„å¨åŠ›ï¼Œé€šè¿‡ async await ç»ˆäºå¯ä»¥å½»åº•æ‘†è„±å›è°ƒåœ°ç‹±ï¼Œä»¥åŒæ­¥æ–¹å¼ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œä»£ç ç®€æ´ï¼Œååˆ†å‹å¥½ï¼Œä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­ ğŸ‘‡</p>
<h3 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h3><p><code>try-catch</code> å¤„ç†åŒæ­¥ï¼Œå¼‚æ­¥é”™è¯¯ã€‚å¦‚ä¸‹ä»£ç ç‰‡æ®µä¸€ä¸­ï¼Œ<code>try-catch</code> å¹¶ä¸èƒ½æ•æ‰ <code>then</code> æ–¹æ³•ä¸­ <code>JSON.parse</code> å¼‚å¸¸å‡ºé”™ï¼›ä½†æ˜¯åœ¨ä»£ç ç‰‡æ®µäºŒä¸­ï¼Œä½¿ç”¨äº† async awaitï¼Œä½¿å¾— <code>try-catch</code> èƒ½æ•æ‰ <code>JSON.parse</code> å¯èƒ½çš„å¼‚å¸¸å‡ºé”™ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ä»£ç å—ä¸€</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    getJSON().then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(res) <span class="comment">// æ­¤å¤„å¯èƒ½å‡ºé”™</span></div><div class="line">    &#125;)</div><div class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ä»£ç å—äºŒ</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(<span class="keyword">await</span> getJSON())</div><div class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ä¸­é—´å€¼"><a href="#ä¸­é—´å€¼" class="headerlink" title="ä¸­é—´å€¼"></a>ä¸­é—´å€¼</h3><p>æœ‰æ—¶ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å½¢ï¼špromise1 è¿”å›å€¼ value1ï¼›promise2 ä¾èµ– value1ï¼Œè¿”å›value2ï¼›promise3 ä¾èµ– value1 å’Œ value2ã€‚æœ€ç®€å•çš„åšæ³•æ˜¯é€šè¿‡åµŒå¥—è§£å†³ promise é—´çš„ä¾èµ–ï¼š<br><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> test () &#123;</div><div class="line">  <span class="keyword">return</span> promise<span class="number">1</span>()</div><div class="line">      .<span class="keyword">then</span>(<span class="keyword">value</span><span class="number">1</span> =&gt; &#123;</div><div class="line">        <span class="keyword">return</span> promise<span class="number">2</span>(valu<span class="number">1</span>)</div><div class="line">          .<span class="keyword">then</span>(<span class="keyword">value</span><span class="number">2</span> =&gt; &#123;</div><div class="line">              <span class="keyword">return</span> promise<span class="number">3</span>(<span class="keyword">value</span><span class="number">1</span>, <span class="keyword">value</span><span class="number">2</span>)</div><div class="line">          &#125;)</div><div class="line">      &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ˜¾ç„¶ï¼Œè¿™ç§ç®€å•ç²—æš´çš„å¤„ç†æ–¹å¼ä½¿æˆ‘ä»¬åˆæ‰è¿›å›è°ƒåœ°ç‹±äº†ï¼›æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸­é—´å˜é‡æ¥æŠ¹å¹³è¿™ä¸ªå›è°ƒåµŒå¥—ï¼š<br><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> test () &#123;</div><div class="line">  var <span class="keyword">value</span><span class="number">1</span></div><div class="line">  var <span class="keyword">value</span><span class="number">2</span></div><div class="line">  <span class="keyword">return</span> promise<span class="number">1</span>()</div><div class="line">    .<span class="keyword">then</span>(vle =&gt; &#123;</div><div class="line">        <span class="keyword">value</span><span class="number">1</span> = vle</div><div class="line">        <span class="keyword">return</span> promise<span class="number">2</span>(<span class="keyword">value</span><span class="number">1</span>)</div><div class="line">    &#125;)</div><div class="line">    .<span class="keyword">then</span>(vle =&gt; &#123;</div><div class="line">        <span class="keyword">value</span><span class="number">2</span> = vle</div><div class="line">        <span class="keyword">return</span> promise<span class="number">3</span>(<span class="keyword">value</span><span class="number">1</span>, <span class="keyword">value</span><span class="number">2</span>)</div><div class="line">    &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è€Œé€šè¿‡ async awaitï¼Œå¯ä»¥æœ€ä¼˜ï¼Œæœ€ç®€æ´çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> value1 = <span class="keyword">await</span> promise1()</div><div class="line">  <span class="keyword">var</span> value2 = <span class="keyword">await</span> promise2(value1)</div><div class="line">  <span class="keyword">return</span> promise3(value1, value2)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>â—ï¸æ³¨æ„ï¼Œåœ¨ä¸Šé¢ä»£ç çš„è¿”å›è¯­å¥ promise3 å¹¶æ²¡æœ‰ <code>await</code>ï¼Œå› ä¸ºå¼‚æ­¥å‡½æ•°çš„ä¼šå°†å…¶è¿”å›å€¼éšå¼å°è£…åœ¨ <code>Promise.resolve</code> ä¸­ã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncFunction" target="_blank" rel="external">MDN-AsyncFunction</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="external">MDN-async function</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await" target="_blank" rel="external">MDN-await</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ JavaScript ä¸­å¤„ç†å¼‚æ­¥æ“ä½œçš„å›è°ƒ (callback) é€šå¸¸ä¼šå¯¼è‡´å¤šåµŒå¥—çš„ä»£ç å—ï¼Œä¿—ç§°å›è°ƒåœ°ç‹± (callback hell)ï¼Œè¿™æ ·çš„ä»£ç å¤æ‚ï¼Œå¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§éå¸¸ä¸å‹å¥½ï¼›ç›´è¾¾ ES6ï¼ŒPromise å‡ºç°ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ‰å¹³åŒ–å›è°ƒå‡½æ•°ï¼Œå‘Šåˆ«å›è°ƒåœ°ç‹±ï¼Œå†™å‡ºä¼˜é›…çš„ä»£ç ï¼›ä½†æ˜¯åœ¨å®è·µä¸­å‘ç°ï¼ŒPromise å¹¶ä¸å®Œç¾ï¼Œå¦‚æœ Promise çš„å›è°ƒä¸­å‡ºç°åµŒå¥—ï¼Œä¾æ—§ä¼šå‡ºç°å›è°ƒåœ°ç‹±ï¼›è€Œå¦‚ä»Šï¼Œasync await å‡ºç°äº†ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–°çš„ç¼–å†™å¼‚æ­¥ä»£ç æ–¹å¼ï¼Œä½¿å¾—å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒæ˜¯åŒæ­¥ä»£ç ï¼Œè¿™æ­£å¼å®ƒçš„é­”åŠ›æ‰€åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/1-ko3KtcVSlzpe3RnTRgJaHw.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="async" scheme="http://objcer.com/tags/async/"/>
    
      <category term="await" scheme="http://objcer.com/tags/await/"/>
    
  </entry>
  
  <entry>
    <title>iPhone X ç¯ç»•åˆ˜æµ·æ»šåŠ¨åˆ—è¡¨</title>
    <link href="http://objcer.com/2017/10/10/iPhone-X-notch-surround-list/"/>
    <id>http://objcer.com/2017/10/10/iPhone-X-notch-surround-list/</id>
    <published>2017-10-10T07:33:27.000Z</published>
    <updated>2017-10-10T09:14:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>iPhone X é¢å¸‚åï¼Œå…¶å¼‚å½¢å±ç»™äº¤äº’è®¾è®¡æä¾›äº†æ›´å¤šæƒ³è±¡çš„ç©ºé—´ã€‚åœ¨ Twitter ä¸Šï¼Œè¿™ä½æ¨å‹å°±é’ˆå¯¹åˆ˜æµ·è®¾è®¡äº†åˆ—è¡¨ç¯ç»•åˆ˜æµ·æ»šåŠ¨çš„æ•ˆæœã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/4E124A83-5DD5-44C1-AA71-9394E34E8C57.png" alt=""></p>
<p>æœ€è¿‘åœ¨ codepen ä¸Šçœ‹åˆ°å·²ç»æœ‰äººå®ç°äº†è¿™ä¸ª demoï¼š<a href="https://codepen.io/davvidbaker/pen/KXgPyG" target="_blank" rel="external">https://codepen.io/davvidbaker/pen/KXgPyG</a>ï¼Œæœ¬æ–‡å°†å›¾æ–‡ç»“åˆåˆ†æä¸€ä¸‹å®ç°è¿™ä¸ªæ•ˆæœçš„é€»è¾‘ã€‚</p>
<a id="more"></a>
<h2 id="DOM-ç»“æ„"><a href="#DOM-ç»“æ„" class="headerlink" title="DOM ç»“æ„"></a>DOM ç»“æ„</h2><p><img src="http://7vikhl.com1.z0.glb.clouddn.com/D75661B5-C160-4906-826D-E7908AA9B237.png" alt=""><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"outer"</span>&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>åŒ—äº¬<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"notch"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">  &lt;<span class="regexp">/div&gt;</span></div></pre></td></tr></table></figure></p>
<p>DOM ç»“æ„æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŒ…æ‹¬åˆ—è¡¨ <code>ul</code>ï¼Œå…¶æ»šåŠ¨å®¹å™¨ä¸º <code>class=&quot;inner&quot;</code> çš„ DIVï¼›åˆ˜æµ·æ˜¯ <code>class=&quot;notch&quot;</code> çš„ DIVã€‚</p>
<h2 id="æ»šåŠ¨é€»è¾‘"><a href="#æ»šåŠ¨é€»è¾‘" class="headerlink" title="æ»šåŠ¨é€»è¾‘"></a>æ»šåŠ¨é€»è¾‘</h2><p>ä¸ºäº†å®ç°åˆ—è¡¨ç¯ç»•åˆ˜æµ·æ»šåŠ¨ï¼Œéœ€è¦åœ¨æ»šåŠ¨äº‹ä»¶ä¸­ï¼Œè®¡ç®—å¤„ç†æ¯ä¸€è¡Œåˆ—è¡¨ X è½´æ–¹å‘çš„ä½ç½®ç§»åŠ¨ã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/840F60D8-1D25-4B1C-BF50-C9F79DCC2AC9.png" alt=""></p>
<p>å¦‚ä¸Šå›¾åˆ—è¡¨å‘ä¸‹æ»šåŠ¨ï¼Œä¸Šæ–¹çš„åˆ—è¡¨éœ€è¦å‘å³ä½ç§» <code>notch</code> å®½åº¦ï¼›å¯¹åº”çš„ï¼Œä¸‹æ–¹çš„åˆ—è¡¨éœ€è¦å‘å·¦ä½ç§» <code>notch</code> å®½åº¦ã€‚æˆ‘ä»¬éœ€è¦å¯¹ç§»åŠ¨è¿›è¡Œç›¸åº”çš„è®¡ç®—å¤„ç†ï¼Œä½¿ä½ç§»çº¿æ€§å˜åŒ–ï¼Œä»è€Œåœ¨æ»šåŠ¨æ—¶ï¼Œç¯ç»•æ•ˆæœè‡ªç„¶ã€‚</p>
<h3 id="distFromTop-å’Œ-distFromBottom"><a href="#distFromTop-å’Œ-distFromBottom" class="headerlink" title="distFromTop å’Œ distFromBottom"></a><code>distFromTop</code> å’Œ <code>distFromBottom</code></h3><p>åˆ—è¡¨åœ¨ä¸Šä¸‹æ»šåŠ¨è¿‡ç¨‹ä¸­åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<ul>
<li>å‘ä¸‹æ»šåŠ¨ï¼šä¸Šæ–¹åˆ—è¡¨å‘å³ç§»åŠ¨è¿›å…¥åˆ˜æµ·åŒºåŸŸï¼Œä¸‹æ–¹åˆ—è¡¨å‘å·¦ç§»åŠ¨ç¦»å¼€åˆ˜æµ·åŒºåŸŸ</li>
<li>å‘ä¸Šæ»šåŠ¨ï¼šä¸Šæ–¹åˆ—è¡¨å‘å·¦ç§»åŠ¨ç¦»å¼€åˆ˜æµ·åŒºåŸŸï¼Œä¸‹æ–¹åˆ—è¡¨å‘å³ç§»åŠ¨è¿›å…¥åˆ˜æµ·åŒºåŸŸ</li>
</ul>
<p>è¿™ä¸¤éƒ¨åˆ†åˆšå¥½æ˜¯ç›¸å¯¹åº”çš„ï¼Œæ­¤å¤„æˆ‘ä»¬åªåˆ†æ<strong>ä¸Šæ–¹åˆ—è¡¨ç§»åŠ¨è¿›å…¥/ç¦»å¼€åˆ˜æµ·åŒºåŸŸ</strong>ï¼Œå³å¯ä»¥äº†è§£æ»šåŠ¨è¿‡ç¨‹ä¸­çš„é€»è¾‘å¤„ç†ã€‚é¦–å…ˆä»‹ç»ä¸¤ä¸ªå˜é‡ï¼š<code>distFromTop</code> å’Œ <code>distFromBottom</code></p>
<blockquote>
<p><code>Element.getBoundingClientRect()</code> æ–¹æ³•è¿”å›å…ƒç´ çš„å¤§å°åŠå…¶ç›¸å¯¹äºè§†å£çš„ä½ç½®ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ª <code>DOMRect</code> å¯¹è±¡ã€‚<code>DOMRect</code> å¯¹è±¡åŒ…å«äº†ä¸€ç»„ç”¨äºæè¿°è¾¹æ¡†çš„åªè¯»å±æ€§ â€”â€” leftã€topã€right å’Œ bottomï¼Œå•ä½ä¸ºåƒç´ ã€‚é™¤äº† width å’Œ height å¤–çš„å±æ€§éƒ½æ˜¯ç›¸å¯¹äºè§†å£çš„å·¦ä¸Šè§’ä½ç½®è€Œè¨€çš„ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/F772D60E-E17B-434F-A970-053BB77E53BB.png" alt=""></p>
</blockquote>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> notchRect = notch.getBoundingClientRect()</div><div class="line"><span class="keyword">let</span> itemRect = item.getBoundingClientRect()</div><div class="line"><span class="keyword">let</span> distFromTop = itemRect.<span class="built_in">bottom</span> - notchRect.<span class="built_in">top</span></div><div class="line"><span class="keyword">let</span> distFromBottom = itemRect.<span class="built_in">top</span> - notchRect.<span class="built_in">bottom</span></div></pre></td></tr></table></figure>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/CB366BB3-C658-4514-96F7-103F5B712AD6.png" alt=""></p>
<p>è¿™ä¸¤ä¸ªå˜é‡è¡¨å¾å½“å‰è¿™ä¸€è¡Œåˆ—è¡¨è·ç¦»ä¸Šä¸‹åˆ˜æµ·è¾¹ç•Œçš„ä½ç½®ï¼Œåœ¨æ»šåŠ¨è¿‡ç¨‹ä¸­æ ¹æ® <code>distFromTop</code> å’Œ <code>distFromBottom</code> å˜é‡è§¦å‘ä¸åŒçš„ä½ç§»é€»è¾‘ã€‚</p>
<h3 id="ä½ç§»é€»è¾‘"><a href="#ä½ç§»é€»è¾‘" class="headerlink" title="ä½ç§»é€»è¾‘"></a>ä½ç§»é€»è¾‘</h3><p>åˆ†æ<strong>ä¸Šæ–¹åˆ—è¡¨ç§»åŠ¨è¿›å…¥/ç¦»å¼€åˆ˜æµ·åŒºåŸŸ</strong>æ—¶ï¼Œåˆ—è¡¨ä½ç§»çš„é€»è¾‘ã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/7B8867D1-1A5E-4DE6-A6CB-5B64209808F2.png" alt=""><br><img src="http://7vikhl.com1.z0.glb.clouddn.com/E875669C-BEBE-4B6E-A883-EACF4CF29D63.png" alt=""></p>
<p>1ï¸âƒ£ <strong>é˜ˆå€¼ï¼š<code>Threshold</code></strong><br>åœ¨åˆ˜æµ·è¾¹ç•Œä¸Šä¸‹ <code>Threshold</code> åŒºåŸŸå®šä¹‰ä¸ºä½ç§»åŒºåŸŸï¼Œåˆ—è¡¨è¿›å…¥è¿™ä¸€åŒºåŸŸå³éœ€è¦è¿›è¡Œè®¡ç®—ä½ç§»é‡ï¼Œæ£€æµ‹æ˜¯å¦è¿›å…¥è¿™ä¸€åŒºåŸŸçš„é€»è¾‘åˆ¤æ–­ä¸ºï¼š<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Math.<span class="keyword">abs</span>(distFromTop) &lt;= Threshold</div></pre></td></tr></table></figure></p>
<p>2ï¸âƒ£ <strong>è®¡ç®—ä½ç§»é‡</strong><br>è€ƒè™‘ä¸¤ä¸ªè¾¹ç•Œæƒ…å†µï¼š</p>
<ul>
<li>å½“ <code>distFromTop</code> ç­‰äº <code>- Threshold</code>ï¼Œå³åˆ—è¡¨å¼€å§‹è¿›å…¥åˆ˜æµ·åŒºåŸŸ<br>æ­¤æ—¶ä½ç§»é‡ä¸º 0</li>
<li>å½“ <code>distFromTop</code> ç­‰äº <code>+ Threshold</code>ï¼Œå³åˆ—è¡¨å®Œå…¨è¿›å…¥åˆ˜æµ·åŒºåŸŸ<br>æ­¤æ—¶ä½ç§»é‡ä¸ºåˆ˜æµ·å®½åº¦ <code>NotchWidth</code></li>
</ul>
<p>è¿™ä¸ªå˜æ¢è¿‡ç¨‹å¯ä»¥é€šè¿‡çº¿æ€§æ’å€¼æ¥å®Œæˆï¼Œæ ¹æ® <code>distFromTop</code> å˜é‡è®¡ç®—åœ¨ Y è½´æ–¹å‘çš„æ¯”ä¾‹å…³ç³»ï¼Œä»è€Œå¾—åˆ° X è½´æ–¹å‘çš„ä½ç§»é‡ã€‚</p>
<blockquote>
<p>å…³äºçº¿æ€§æ’å€¼å‚è€ƒï¼š<a href="https://zh.wikipedia.org/zh-cn/%E7%BA%BF%E6%80%A7%E6%8F%92%E5%80%BC" target="_blank" rel="external">ç»´åŸºç™¾ç§‘ï¼šçº¿æ€§æ’å€¼</a></p>
</blockquote>
<p>åœ¨æ­¤å¤„ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–ç†è§£ï¼Œå¦‚ä¸‹å›¾<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/94A6750A-B927-4B11-8446-8F92DCFA7747.png" alt=""></p>
<p>è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let lerp = (<span class="name">v0</span>, v1, <span class="literal">t</span>) =&gt; v0 + (<span class="name">v1</span> - v0) * <span class="literal">t</span></div></pre></td></tr></table></figure></p>
<p>åœ¨æˆ‘ä»¬åˆ†æçš„è¿™ä¸ªæƒ…å½¢ï¼šä¸Šæ–¹åˆ—è¡¨å‘å³ç§»åŠ¨è¿›å…¥åˆ˜æµ·åŒºåŸŸï¼Œå¯¹åº”çš„è°ƒç”¨ä¸ºï¼š<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">x = lerp(<span class="number">0</span>, NotchWidth, (<span class="name">distFromTop</span> + Threshold) / (<span class="name">Threshold</span> * 2))</div></pre></td></tr></table></figure></p>
<p>å…¶ä»–æƒ…å†µï¼Œä½ç§»é‡è®¡ç®—åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>åœ¨åˆ˜æµ·åŒºåŸŸå†…æ»šåŠ¨<br>åˆ¤æ–­æ¡ä»¶ï¼š<code>distFromTop &gt; 0 &amp;&amp; distFromBottom &lt; - Threshold</code><br>ä½ç§»é‡å§‹ç»ˆä¸ºï¼šåˆ˜æµ·å®½åº¦ <code>NotchWidth</code></li>
<li>ä¸‹æ–¹åˆ—è¡¨ç§»åŠ¨è¿›å…¥/ç¦»å¼€åˆ˜æµ·åŒºåŸŸ<br>åˆ¤æ–­æ¡ä»¶ï¼š<code>Math.abs(distFromBottom) &lt;= Threshold</code><br>ä½ç§»é‡å§‹ç»ˆä¸ºï¼š<code>x = lerp(NotchWidth, 0, (distFromBottom + Threshold) / (Threshold * 2))</code></li>
<li>å…¶ä»–<br>ä½ç§»é‡å§‹ç»ˆä¸ºï¼š0</li>
</ul>
<h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><p>æœ€ç»ˆå®ç°æ•ˆæœï¼š<a href="https://codepen.io/yingshandeng/pen/JrJRBR?editors=1010" target="_blank" rel="external">https://codepen.io/yingshandeng/pen/JrJRBR?editors=1010</a></p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/iPhone%20X%20list.gif" alt=""></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">  <span class="selector-tag">html</span>,</div><div class="line">  <span class="selector-tag">body</span> &#123;</div><div class="line">      <span class="attribute">display</span>: flex;</div><div class="line">      <span class="attribute">justify-content</span>: center;</div><div class="line">      <span class="attribute">align-items</span>: center;</div><div class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">      <span class="attribute">height</span>: <span class="number">100%</span>;</div><div class="line">      <span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">      <span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line">      <span class="attribute">background</span>: <span class="number">#E3F3FD</span>;</div><div class="line">      <span class="attribute">font-family</span>: <span class="string">"Helvetica Neue"</span>, Helvetica, Arial, sans-serif;</div><div class="line">  &#125;</div><div class="line">  <span class="selector-class">.outer</span> &#123;</div><div class="line">    <span class="attribute">position</span>: relative;</div><div class="line">    <span class="attribute">width</span>: <span class="number">640px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">310px</span>;</div><div class="line">    <span class="attribute">min-width</span>: <span class="number">640px</span>;</div><div class="line">    <span class="attribute">min-height</span>: <span class="number">310px</span>;</div><div class="line">    <span class="attribute">background-color</span>: white;</div><div class="line">    <span class="attribute">border-radius</span>: <span class="number">45px</span>;</div><div class="line">    <span class="attribute">-webkit-box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0.10),</div><div class="line">      inset <span class="number">0</span> -<span class="number">5px</span> <span class="number">20px</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0.08);</div><div class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0.10),</div><div class="line">      inset <span class="number">0</span> -<span class="number">5px</span> <span class="number">20px</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0.08);</div><div class="line">  &#125;</div><div class="line">  <span class="selector-class">.inner</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">width</span>: <span class="number">610px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">280px</span>;</div><div class="line">    <span class="attribute">margin</span>: <span class="number">15px</span>;</div><div class="line">    <span class="attribute">border-radius</span>: <span class="number">30px</span>;</div><div class="line">    <span class="attribute">background-color</span>: <span class="number">#EBEBEB</span>;</div><div class="line">    <span class="attribute">overflow-x</span>: hidden;</div><div class="line">    <span class="attribute">overflow-y</span>: scroll;</div><div class="line">  &#125;</div><div class="line">  <span class="selector-class">.notch</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">left</span>: <span class="number">15px</span>;</div><div class="line">    <span class="attribute">top</span>: <span class="number">79px</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">22px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">152px</span>;</div><div class="line">    <span class="attribute">border-top-right-radius</span>: <span class="number">17px</span>;</div><div class="line">    <span class="attribute">border-bottom-right-radius</span>: <span class="number">17px</span>;</div><div class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="selector-tag">ul</span> &#123;</div><div class="line">    <span class="attribute">list-style</span>: none;</div><div class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</div><div class="line">    <span class="attribute">padding-left</span>: <span class="number">10px</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="selector-tag">li</span> &#123;</div><div class="line">    <span class="attribute">padding</span>: <span class="number">6px</span> <span class="number">5px</span>;</div><div class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#dadada</span>;</div><div class="line">    <span class="attribute">transform-origin</span>: center left;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  *<span class="selector-pseudo">::-webkit-scrollbar</span> &#123;</div><div class="line">    <span class="attribute">visibility</span>: hidden;</div><div class="line">  &#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"outer"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>åŒ—äº¬<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å¤©æ´¥<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ²³åŒ—<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å±±è¥¿<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å†…è’™å¤<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>è¾½å®<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å‰æ—<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>é»‘é¾™æ±Ÿ<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>ä¸Šæµ·<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ±Ÿè‹<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æµ™æ±Ÿçœ<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å®‰å¾½<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>ç¦å»º<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ±Ÿè¥¿<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å±±ä¸œ<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ²³å—<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ¹–åŒ—<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ¹–å—<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å¹¿ä¸œ<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å¹¿è¥¿<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æµ·å—<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>é‡åº†<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å››å·<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>è´µå·<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>äº‘å—<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>è¥¿è—<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>é™•è¥¿<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>ç”˜è‚ƒçœ<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>é’æµ·<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å®å¤<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ–°ç–†<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>å°æ¹¾<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ¾³é—¨<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"notch"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="keyword">let</span> inner = <span class="built_in">document</span>.querySelector(<span class="string">'.inner'</span>)</div><div class="line">  <span class="keyword">let</span> items = <span class="built_in">document</span>.querySelectorAll(<span class="string">'li'</span>)</div><div class="line">  <span class="keyword">let</span> notch = <span class="built_in">document</span>.querySelector(<span class="string">'.notch'</span>)</div><div class="line">  <span class="keyword">let</span> notchRect = notch.getBoundingClientRect()</div><div class="line"></div><div class="line">  inner.addEventListener(<span class="string">'scroll'</span>, () =&gt; &#123;</div><div class="line">    <span class="built_in">window</span>.requestAnimationFrame(scrollDection)</div><div class="line">  &#125;)</div><div class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, () =&gt; &#123;</div><div class="line">    notchRect = notch.getBoundingClientRect()</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  <span class="keyword">const</span> Threshold = <span class="number">10</span></div><div class="line">  <span class="keyword">const</span> NotchWidth = <span class="number">30</span></div><div class="line">  <span class="keyword">let</span> scrollDection = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> item</div><div class="line">    <span class="keyword">for</span> (item <span class="keyword">of</span> items) &#123;</div><div class="line">      <span class="keyword">let</span> itemRect = item.getBoundingClientRect()</div><div class="line">      <span class="keyword">let</span> distFromTop = itemRect.bottom - notchRect.top</div><div class="line">      <span class="keyword">let</span> distFromBottom = itemRect.top - notchRect.bottom</div><div class="line">      <span class="keyword">let</span> x</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (<span class="built_in">Math</span>.abs(distFromTop) &lt;= Threshold) &#123;</div><div class="line">        x = lerp(<span class="number">0</span>, NotchWidth, (distFromTop + Threshold) / (Threshold * <span class="number">2</span>))</div><div class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (distFromTop &gt; <span class="number">0</span> &amp;&amp; distFromBottom &lt; - Threshold) &#123;</div><div class="line">        x = NotchWidth</div><div class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">Math</span>.abs(distFromBottom) &lt;= Threshold) &#123;</div><div class="line">        x = lerp(NotchWidth, <span class="number">0</span>, (distFromBottom + Threshold) / (Threshold * <span class="number">2</span>))</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        x = <span class="number">0</span></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      item.style.transform = <span class="string">`translateX(<span class="subst">$&#123;x&#125;</span>px)`</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">let</span> lerp = <span class="function">(<span class="params">v0, v1, t</span>) =&gt;</span> v0 + (v1 - v0) * t</div><div class="line"></div><div class="line">  scrollDection()</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;iPhone X é¢å¸‚åï¼Œå…¶å¼‚å½¢å±ç»™äº¤äº’è®¾è®¡æä¾›äº†æ›´å¤šæƒ³è±¡çš„ç©ºé—´ã€‚åœ¨ Twitter ä¸Šï¼Œè¿™ä½æ¨å‹å°±é’ˆå¯¹åˆ˜æµ·è®¾è®¡äº†åˆ—è¡¨ç¯ç»•åˆ˜æµ·æ»šåŠ¨çš„æ•ˆæœã€‚&lt;br&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/4E124A83-5DD5-44C1-AA71-9394E34E8C57.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘åœ¨ codepen ä¸Šçœ‹åˆ°å·²ç»æœ‰äººå®ç°äº†è¿™ä¸ª demoï¼š&lt;a href=&quot;https://codepen.io/davvidbaker/pen/KXgPyG&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://codepen.io/davvidbaker/pen/KXgPyG&lt;/a&gt;ï¼Œæœ¬æ–‡å°†å›¾æ–‡ç»“åˆåˆ†æä¸€ä¸‹å®ç°è¿™ä¸ªæ•ˆæœçš„é€»è¾‘ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="DEMO" scheme="http://objcer.com/tags/DEMO/"/>
    
  </entry>
  
  <entry>
    <title>å®ç°ä¸€ä¸ªå­—æ•°é™åˆ¶çš„è¾“å…¥æ¡†</title>
    <link href="http://objcer.com/2017/10/10/implement-a-word-limit-input-box/"/>
    <id>http://objcer.com/2017/10/10/implement-a-word-limit-input-box/</id>
    <published>2017-10-10T07:24:25.000Z</published>
    <updated>2017-10-10T07:29:13.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/twitter-input-box.png" alt=""><br>åœ¨ Twitter å‘æ¨è¾“å…¥æ¡†ä¸­ï¼Œæœ‰ä¸€ä¸ªå­—æ•°é™åˆ¶çš„é€»è¾‘ï¼Œè¶…å‡ºå­—æ•°é™åˆ¶éƒ¨åˆ†çš„æ–‡å­—ä¼šè®¾ç½®èƒŒæ™¯é¢œè‰²æç¤ºï¼Œä»¥ä¾¿ç”¨æˆ·è¿›è¡Œè°ƒæ•´ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„äº¤äº’è®¾è®¡ï¼Œåœ¨ <a href="https://ant.design/docs/spec/feature-cn" target="_blank" rel="external">Ant Design</a> ä¸­ä¹Ÿæœ‰æåˆ°è¿™ä¸€ç‚¹ã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/ant-design-input.png" alt=""></p>
<p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°è¿™ä¸€å­—æ•°é™åˆ¶è¾“å…¥æ¡†ï¼Œæ•ˆæœè®¿é—®ï¼š<a href="https://codepen.io/yingshandeng/pen/boRNLx" target="_blank" rel="external">Codepen</a><br><a id="more"></a></p>
<h2 id="è¶…å‡ºé™åˆ¶æ–‡å­—è®¾ç½®èƒŒæ™¯æç¤º"><a href="#è¶…å‡ºé™åˆ¶æ–‡å­—è®¾ç½®èƒŒæ™¯æç¤º" class="headerlink" title="è¶…å‡ºé™åˆ¶æ–‡å­—è®¾ç½®èƒŒæ™¯æç¤º"></a>è¶…å‡ºé™åˆ¶æ–‡å­—è®¾ç½®èƒŒæ™¯æç¤º</h2><p>å®ç°è¿™ä¸ªè¾“å…¥æ¡†å…³é”®åœ¨äºå¦‚ä½•å®ç°å¯¹è¶…å‡ºå­—æ•°é™åˆ¶éƒ¨åˆ†çš„æ–‡å­—è®¾ç½®èƒŒæ™¯é¢œè‰²ï¼Œå¯¹äºè¾“å…¥æ¡†ä¸€èˆ¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ul>
<li><code>textarea</code> å¤šè¡Œæ–‡æœ¬è¾“å…¥</li>
<li><code>div</code> è®¾ç½® <code>contenteditable=&quot;true&quot;</code></li>
</ul>
<p><code>contenteditable=&quot;true&quot;</code> çš„ DIV èŠ‚ç‚¹å¯ä»¥æ“ä½œå…¶ä¸­çš„ DOM èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›‘å¬è¾“å…¥åŒºåŸŸï¼Œç”¨æˆ·è¾“å…¥æ—¶ï¼Œè·å–å…¶ä¸­çš„ <code>innerText</code>ï¼Œç„¶åè¿›è¡Œå­—æ•°é™åˆ¶åˆ¤æ–­ï¼Œè®¾ç½®å…¶ <code>innerHTML</code>ï¼Œåˆ’åˆ†ä¸¤éƒ¨åˆ†ï¼Œè¶…å‡ºéƒ¨åˆ†è®¾ç½®èƒŒæ™¯é¢œè‰²ï¼Œä»£ç å¤§è‡´å¦‚ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">contenteditable</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">  æ–‡å­—ï¼Œæ–‡å­—...</div><div class="line">  <span class="tag">&lt;<span class="name">em</span>&gt;</span>è¶…å‡ºçš„æ–‡å­—...<span class="tag">&lt;/<span class="name">em</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="keyword">var</span> editorArea = <span class="built_in">document</span>.querySelector(<span class="string">'.editor-area'</span>)</div><div class="line"></div><div class="line">  editorArea.addEventListener(<span class="string">'input'</span>, (evt) =&gt; &#123;</div><div class="line">    <span class="keyword">var</span> normalText;</div><div class="line">    <span class="keyword">var</span> exceedText;</div><div class="line"></div><div class="line">    editorArea.innerHTML = normalText + <span class="string">'&lt;em&gt;'</span> + exceedText + <span class="string">'&lt;/em&gt;'</span></div><div class="line">  &#125;)</div><div class="line">&lt;<span class="regexp">/script</span></div></pre></td></tr></table></figure></p>
<p>åœ¨æ¯æ¬¡è¾“å…¥åï¼Œéƒ½é‡æ–°è®¾ç½® <code>innerHTML</code>ï¼Œä¼šå¯¼è‡´æ¯æ¬¡è¾“å…¥åï¼Œå…‰æ ‡ä½ç½®éƒ½è·‘åˆ°è¾“å…¥æ¡†èµ·å§‹ä½ç½®äº†ï¼Œçœ‹æ¥è¿™ç§æ–¹å¼ä¸å¯è¡Œ ğŸ˜¤</p>
<p>ğŸ‘‰ è§£å†³æ–¹æ¡ˆï¼šç”¨ä¸¤å±‚ DIV é‡å </p>
<ul>
<li>ä¸Šå±‚ DIV èŠ‚ç‚¹ç”¨äºæ–‡å­—è¾“å…¥ï¼ŒèƒŒæ™¯é¢œè‰²é€æ˜</li>
<li>ä¸‹å±‚ DIV èŠ‚ç‚¹ç”¨äºé«˜äº®è¶…å‡ºéƒ¨åˆ†æ–‡å­—ï¼Œæ–‡å­—é¢œè‰²è®¾ç½®ä¸ºé€æ˜ï¼Œè¶…å‡ºéƒ¨åˆ†èŠ‚ç‚¹è®¾ç½®èƒŒæ™¯é¢œè‰²</li>
</ul>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/rich-input.png" alt=""></p>
<h2 id="è¾“å…¥æ¡†-placeholder"><a href="#è¾“å…¥æ¡†-placeholder" class="headerlink" title="è¾“å…¥æ¡† placeholder"></a>è¾“å…¥æ¡† placeholder</h2><p><code>contenteditable=&quot;true&quot;</code> çš„ DIV è®¾ç½® placeholder å¯ä»¥é€šè¿‡ CSS æ¥è§£å†³ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.editor-area</span><span class="selector-attr">[contenteditable=true]</span><span class="selector-pseudo">:empty</span><span class="selector-pseudo">:before</span> &#123;</div><div class="line">  <span class="attribute">content</span>: <span class="built_in">attr</span>(placeholder);</div><div class="line">  <span class="attribute">color</span>: <span class="number">#ccd6dd</span>;</div><div class="line">  <span class="attribute">position</span>: absolute;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>é€šè¿‡é€‰æ‹©å™¨ <code>:empty</code> åˆ¤æ–­è¾“å…¥æ¡†ä¸­å†…å®¹æ˜¯å¦ä¸ºç©ºï¼Œå…¶å®å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚ç‚¹å‡»å›è½¦çš„æ—¶å€™ï¼Œä¼šæ’å…¥ <code>&lt;div&gt;&lt;br&gt;&lt;/div&gt;</code> æˆ–è€… <code>&lt;br&gt;</code>ï¼Œè¿™éƒ¨åˆ†ä¼šå½±å“ <code>:empty</code> çš„åˆ¤æ–­ï¼Œè­¬å¦‚ DIV ä¸­æ²¡æœ‰æ–‡å­—ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªæ¢è¡Œæ—¶ï¼Œè¿™æ · <code>:empty</code> çš„åˆ¤æ–­å°±ä¸ä¼šç”Ÿæ•ˆï¼Œplaceholder ä¹Ÿå°±æ²¡æœ‰æ˜¾ç¤ºï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦ä¸€ç§æ–¹å¼è¿›è¡Œåˆ¤æ–­ï¼Œé€šè¿‡ JS æ‰‹åŠ¨æ·»åŠ ã€ç§»é™¤ class ç±»å¤„ç† placeholder çš„æ˜¾ç¤ºå’Œéšè—ï¼š</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// CSS</span></div><div class="line"><span class="selector-class">.editor-area</span><span class="selector-class">.is-showPlaceholder</span><span class="selector-attr">[contenteditable=true]</span><span class="selector-pseudo">:before</span> &#123;</div><div class="line">  <span class="attribute">content</span>: attr(placeholder);</div><div class="line">  <span class="attribute">color</span>: <span class="number">#ccd6dd</span>;</div><div class="line">  <span class="attribute">position</span>: absolute;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// JS</span></div><div class="line"><span class="selector-tag">editorArea</span><span class="selector-class">.addEventListener</span>(<span class="string">'input'</span>, (evt) =&gt; &#123;</div><div class="line">  <span class="selector-tag">if</span> (editorArea.innerHTML === <span class="string">'&lt;div&gt;&lt;br&gt;&lt;/div&gt;'</span> ||</div><div class="line">    editorArea.innerHTML === <span class="string">'&lt;br&gt;'</span> ||</div><div class="line">    editorArea.innerHTML === <span class="string">''</span>) &#123;</div><div class="line">    <span class="selector-tag">editorArea</span><span class="selector-class">.classList</span><span class="selector-class">.add</span>(<span class="string">'is-showPlaceholder'</span>)</div><div class="line">  &#125; <span class="selector-tag">else</span> &#123;</div><div class="line">    <span class="selector-tag">editorArea</span><span class="selector-class">.classList</span><span class="selector-class">.remove</span>(<span class="string">'is-showPlaceholder'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ç§è§£å†³æ–¹å¼ï¼Œç¬¬ä¸€å±‚è¾“å…¥ DIV èŠ‚ç‚¹ä½¿ç”¨ <code>textarea</code> æ›¿æ¢ï¼Œ<code>textarea</code> ä¸­æœ‰ <code>placeholder</code> å±æ€§</p>
<h2 id="ä¸­æ–‡è¾“å…¥å­—æ•°ç»Ÿè®¡"><a href="#ä¸­æ–‡è¾“å…¥å­—æ•°ç»Ÿè®¡" class="headerlink" title="ä¸­æ–‡è¾“å…¥å­—æ•°ç»Ÿè®¡"></a>ä¸­æ–‡è¾“å…¥å­—æ•°ç»Ÿè®¡</h2><p>åœ¨ä¸­æ–‡è¾“å…¥æ˜¯ï¼Œä¸­æ–‡è¿˜æœªè¾“å…¥åˆ°è¾“å…¥æ¡†ï¼Œå­—æ•°å°±åœ¨ç»Ÿè®¡äº†ï¼›åˆç†çš„æ˜¯ï¼Œä¸­æ–‡è¾“å…¥ composing ç»„åˆè¿‡ç¨‹ä¸­ä¸åº”è¿›è¡Œå­—æ•°ç»Ÿè®¡ï¼Œåœ¨ä¸­æ–‡è¾“å…¥åˆ°è¾“å…¥æ¡†åï¼Œæ‰è¿›è¡Œå­—æ•°ç»Ÿè®¡ã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/CCCDB51D-C8BD-4014-884B-C69A097F35C5.png" alt=""></p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦ç”¨åˆ° <code>compositionstart</code> å’Œ <code>compositionend</code> è¿™ä¸¤ä¸ªäº‹ä»¶ï¼›å‰è€…è¡¨ç¤ºè¾“å…¥ç»„åˆå¼€å§‹ï¼Œåè€…è¡¨ç¤ºè¾“å…¥ç»„åˆç»“æŸï¼Œåœ¨ <code>compositionend</code> äº‹ä»¶ä¸­å°±æ˜¯æˆ‘ä»¬å­—æ•°ç»Ÿè®¡çš„åˆç†æ—¶æœºã€‚<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> isComposing = <span class="literal">false</span></div><div class="line"></div><div class="line">editorArea.addEventListener(<span class="string">'compositionstart'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  isComposing = <span class="literal">true</span></div><div class="line">&#125;)</div><div class="line">editorArea.addEventListener(<span class="string">'compositionend'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  isComposing = <span class="literal">false</span></div><div class="line">  <span class="comment">// å­—æ•°ç»Ÿè®¡</span></div><div class="line">  <span class="keyword">let</span> text = editorArea.innerText</div><div class="line">  setCounter(limitCnt - text.length)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>ğŸ å¦‚éœ€è€ƒè™‘ emoji å­—ç¬¦é•¿åº¦è®¡ç®—çš„è¯ï¼Œå‚è€ƒï¼š<a href="https://objcer.com/2017/07/20/explore-emoji-length/">æ¢ç©¶ emoji å­—ç¬¦é•¿åº¦</a></p>
<h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><p>æ•ˆæœè®¿é—®ï¼š<a href="https://codepen.io/yingshandeng/pen/boRNLx" target="_blank" rel="external">Codepen</a><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">    <span class="selector-tag">html</span>,</div><div class="line">    <span class="selector-tag">body</span> &#123;</div><div class="line">      <span class="attribute">display</span>: flex;</div><div class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">      <span class="attribute">height</span>: <span class="number">100%</span>;</div><div class="line">      <span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">      <span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line">      <span class="attribute">background</span>: <span class="number">#E3F3FD</span>;</div><div class="line">      <span class="attribute">font-family</span>: <span class="string">"Helvetica Neue"</span>,Helvetica,Arial,sans-serif;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="selector-class">.rich-editor</span> &#123;</div><div class="line">      <span class="attribute">width</span>: <span class="number">508px</span>;</div><div class="line">      <span class="attribute">height</span>: auto;</div><div class="line">     <span class="comment">/* max-height: 134px;</span></div><div class="line">      overflow-y: scroll;*/</div><div class="line">      <span class="attribute">margin</span>: auto;</div><div class="line">      <span class="attribute">padding</span>: <span class="number">8px</span>;</div><div class="line">      <span class="attribute">background</span>: <span class="number">#fff</span>;</div><div class="line">      <span class="attribute">border-radius</span>: <span class="number">8px</span>;</div><div class="line">      <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#A4D9F9</span>;</div><div class="line">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">#A4D9F9</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="selector-class">.wrapper</span> &#123;</div><div class="line">      <span class="attribute">position</span>: relative;</div><div class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">      <span class="attribute">min-height</span>: <span class="number">116px</span>;</div><div class="line">      <span class="attribute">z-index</span>: <span class="number">1</span>;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="selector-class">.editor-area</span>, <span class="selector-class">.editor-backer</span> &#123;</div><div class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">      <span class="attribute">height</span>: auto;</div><div class="line">      <span class="attribute">min-height</span>: <span class="number">116px</span>;</div><div class="line"></div><div class="line">      <span class="attribute">font-size</span>: <span class="number">14px</span>;</div><div class="line">      <span class="attribute">line-height</span>: <span class="number">20px</span>;</div><div class="line">      <span class="attribute">word-wrap</span>: break-word;</div><div class="line">      <span class="attribute">background</span>: transparent;</div><div class="line">    &#125;</div><div class="line">    <span class="selector-class">.editor-area</span> &#123;</div><div class="line">      <span class="attribute">outline</span>: none;</div><div class="line">      <span class="attribute">border</span>: none;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="selector-class">.editor-area</span><span class="selector-class">.is-showPlaceholder</span><span class="selector-attr">[contenteditable=true]</span><span class="selector-pseudo">:before</span> &#123;</div><div class="line">      <span class="attribute">content</span>: <span class="built_in">attr</span>(placeholder);</div><div class="line">      <span class="attribute">color</span>: <span class="number">#ccd6dd</span>;</div><div class="line">      <span class="attribute">position</span>: absolute;</div><div class="line">    &#125;</div><div class="line">    <span class="selector-class">.editor-backer</span> &#123;</div><div class="line">      <span class="attribute">position</span>: absolute;</div><div class="line">      <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">      <span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">      <span class="attribute">color</span>: transparent;</div><div class="line">      <span class="attribute">z-index</span>: -<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="selector-class">.editor-backer</span> <span class="selector-tag">em</span> &#123;</div><div class="line">      <span class="attribute">background-color</span>: <span class="number">#ffb8c2</span>;</div><div class="line">      <span class="attribute">font-style</span>: normal;</div><div class="line">      <span class="attribute">font-size</span>: <span class="number">14px</span>;</div><div class="line">      <span class="attribute">line-height</span>: <span class="number">20px</span>;</div><div class="line">      <span class="attribute">white-space</span>: pre-wrap;</div><div class="line">      <span class="attribute">word-wrap</span>: break-word;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="selector-class">.counter</span> &#123;</div><div class="line">      <span class="attribute">float</span>: right;</div><div class="line">      <span class="attribute">color</span>: <span class="number">#657786</span>;</div><div class="line">      <span class="attribute">font-size</span>: <span class="number">14px</span>;</div><div class="line">      <span class="attribute">line-height</span>: <span class="number">20px</span>;</div><div class="line">      <span class="attribute">text-align</span>: right;</div><div class="line">      <span class="attribute">user-select</span>: none;</div><div class="line">    &#125;</div><div class="line">    <span class="selector-class">.counter</span><span class="selector-class">.max-reached</span> &#123;</div><div class="line">      <span class="attribute">color</span>: <span class="number">#e0245e</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"rich-editor"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"editor-area"</span> <span class="attr">contenteditable</span>=<span class="string">"true"</span> <span class="attr">placeholder</span>=<span class="string">"Enter text here..."</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"editor-backer"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"counter"</span>&gt;</span>140<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">      <span class="keyword">var</span> editorArea = <span class="built_in">document</span>.querySelector(<span class="string">'.editor-area'</span>)</div><div class="line">      <span class="keyword">var</span> editorBacker = <span class="built_in">document</span>.querySelector(<span class="string">'.editor-backer'</span>)</div><div class="line">      <span class="keyword">var</span> counter = <span class="built_in">document</span>.querySelector(<span class="string">'.counter'</span>)</div><div class="line">      <span class="keyword">var</span> limitCnt = <span class="number">140</span></div><div class="line">      <span class="keyword">var</span> isComposing = <span class="literal">false</span></div><div class="line"></div><div class="line">      editorArea.addEventListener(<span class="string">'compositionstart'</span>, () =&gt; &#123;</div><div class="line">        isComposing = <span class="literal">true</span></div><div class="line">      &#125;)</div><div class="line">      editorArea.addEventListener(<span class="string">'compositionend'</span>, () =&gt; &#123;</div><div class="line">        isComposing = <span class="literal">false</span></div><div class="line">        <span class="comment">//</span></div><div class="line">        <span class="keyword">let</span> text = editorArea.innerText</div><div class="line">        setCounter(limitCnt - text.length)</div><div class="line">      &#125;)</div><div class="line"></div><div class="line">      <span class="function"><span class="keyword">function</span> <span class="title">setCounter</span> (<span class="params">cnt</span>) </span>&#123;</div><div class="line">        counter.innerHTML = cnt</div><div class="line">        <span class="keyword">if</span> (cnt &lt; <span class="number">0</span>) &#123;</div><div class="line">          counter.classList.add(<span class="string">'max-reached'</span>)</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          counter.classList.remove(<span class="string">'max-reached'</span>)</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">var</span> inputCompose = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (editorArea.innerHTML === <span class="string">'&lt;div&gt;&lt;br&gt;&lt;/div&gt;'</span> ||</div><div class="line">          editorArea.innerHTML === <span class="string">'&lt;br&gt;'</span> ||</div><div class="line">          editorArea.innerHTML === <span class="string">''</span>) &#123;</div><div class="line">          editorArea.classList.add(<span class="string">'is-showPlaceholder'</span>)</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          editorArea.classList.remove(<span class="string">'is-showPlaceholder'</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">let</span> text = editorArea.innerText</div><div class="line">        <span class="keyword">let</span> remainingCnt = limitCnt - text.trim().length</div><div class="line">        <span class="keyword">if</span> (remainingCnt &lt; <span class="number">0</span>) &#123;</div><div class="line">          <span class="keyword">let</span> allowedText = text.substring(<span class="number">0</span>, limitCnt)</div><div class="line">          <span class="keyword">let</span> refusedText = text.substring(limitCnt)</div><div class="line"></div><div class="line">          editorBacker.innerHTML = allowedText + <span class="string">'&lt;em&gt;'</span> + refusedText + <span class="string">'&lt;/em&gt;'</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          editorBacker.innerHTML = <span class="string">''</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!isComposing) &#123;</div><div class="line">          setCounter(remainingCnt)</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      inputCompose();</div><div class="line">      editorArea.oninput = inputCompose</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/twitter-input-box.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;åœ¨ Twitter å‘æ¨è¾“å…¥æ¡†ä¸­ï¼Œæœ‰ä¸€ä¸ªå­—æ•°é™åˆ¶çš„é€»è¾‘ï¼Œè¶…å‡ºå­—æ•°é™åˆ¶éƒ¨åˆ†çš„æ–‡å­—ä¼šè®¾ç½®èƒŒæ™¯é¢œè‰²æç¤ºï¼Œä»¥ä¾¿ç”¨æˆ·è¿›è¡Œè°ƒæ•´ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„äº¤äº’è®¾è®¡ï¼Œåœ¨ &lt;a href=&quot;https://ant.design/docs/spec/feature-cn&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Ant Design&lt;/a&gt; ä¸­ä¹Ÿæœ‰æåˆ°è¿™ä¸€ç‚¹ã€‚&lt;br&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/ant-design-input.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°è¿™ä¸€å­—æ•°é™åˆ¶è¾“å…¥æ¡†ï¼Œæ•ˆæœè®¿é—®ï¼š&lt;a href=&quot;https://codepen.io/yingshandeng/pen/boRNLx&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Codepen&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="DEMO" scheme="http://objcer.com/tags/DEMO/"/>
    
  </entry>
  
  <entry>
    <title>åŠ¨æ€æ–‡æœ¬è‡ªé€‚åº”ç»˜åˆ¶åˆ°æŒ‡å®šå¤§å°çš„ Canvas</title>
    <link href="http://objcer.com/2017/10/10/auto-size-dynamic-text-to-fill-fixed-size-canvas/"/>
    <id>http://objcer.com/2017/10/10/auto-size-dynamic-text-to-fill-fixed-size-canvas/</id>
    <published>2017-10-10T07:15:11.000Z</published>
    <updated>2017-10-10T07:29:13.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/1-UGtq-cSfbuekV8aHalVIAw.png" alt=""><br>æœ¬æ–‡å°†æ¢ç©¶åŠ¨æ€æ–‡æœ¬å¦‚ä½•è‡ªé€‚åº”ç»˜åˆ¶åˆ°æŒ‡å®šå¤§å°çš„ Canvas ğŸ</p>
<a id="more"></a>
<h2 id="CanvasRenderingContext2D-fillText"><a href="#CanvasRenderingContext2D-fillText" class="headerlink" title="CanvasRenderingContext2D.fillText()"></a><code>CanvasRenderingContext2D.fillText()</code></h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> ctx.fillText(<span class="built_in">text</span>, x, y [, maxWidth]);</div></pre></td></tr></table></figure>
<p>åœ¨ (x, y) ä½ç½®å¡«å……æ–‡æœ¬ã€‚å¦‚æœç¬¬å››ä¸ªå‚æ•°æä¾›äº†æœ€å¤§å®½åº¦ï¼Œæ–‡æœ¬ä¼šè¿›è¡Œç¼©æ”¾ä»¥é€‚åº”æœ€å¤§å®½åº¦ã€‚å¦‚æœç»˜åˆ¶çš„æ–‡æœ¬å®é™…å®½åº¦è¶…è¿‡ <code>maxWidth</code>ï¼Œé‚£ä¹ˆä¼šåœ¨æ°´å¹³æ–¹å‘ä¸Šè¿›è¡Œç¼©æ”¾ï¼Œæ–‡å­—å¯èƒ½è¢«å‹ç¼©å˜å½¢ã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/fillText.png" alt=""></p>
<h2 id="é™åˆ¶å®½åº¦"><a href="#é™åˆ¶å®½åº¦" class="headerlink" title="é™åˆ¶å®½åº¦"></a>é™åˆ¶å®½åº¦</h2><figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ctx.measureText(text)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>ä¼ å…¥è¦ç»˜åˆ¶çš„æ–‡æœ¬å†…å®¹ï¼Œè¿”å›ç»˜åˆ¶åˆ°å½“å‰ Canvas æ—¶æ–‡æœ¬çš„å®½åº¦ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„å­—ä½“ï¼Œç„¶åé€’å‡å­—ä½“å¤§å°ï¼Œç›´åˆ°ç»˜åˆ¶çš„æ–‡æœ¬å®½åº¦æ»¡è¶³ Canvas å®½åº¦é™åˆ¶ï¼Œç”±æ­¤å¾—åˆ°æ–‡æœ¬ç»˜åˆ¶åˆ° Canvas ä¸­åˆé€‚çš„å­—ä½“å¤§å°<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">function dynamicFitTextOnCanvas (text, fontface, desiredWidth) &#123;</div><div class="line">  <span class="selector-tag">var</span> <span class="selector-tag">canvas</span> = document.createElement(<span class="string">'canvas'</span>)</div><div class="line">  <span class="selector-tag">var</span> context = <span class="selector-tag">canvas</span>.getContext(<span class="string">'2d'</span>)</div><div class="line">  <span class="comment">// start with a large font size</span></div><div class="line">  <span class="selector-tag">var</span> fontsize = <span class="number">500</span></div><div class="line">  do &#123;</div><div class="line">    context<span class="selector-class">.font</span> = `$&#123;fontsize&#125;px $&#123;fontface&#125;`</div><div class="line">    fontsize --</div><div class="line">  &#125; while (context.measureText(text)<span class="selector-class">.width</span> &gt; desiredWidth)</div><div class="line">  return fontsize</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ˜¾ç„¶å­—ä½“å¤§å° fontsize é€æ¬¡é€’å‡ä¸€ï¼Œæ•ˆç‡ä¸å¤Ÿå¥½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡äºŒåˆ†é€’å‡æ¥ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">function dynamicFitTextOnCanvas (text, fontface, desiredWidth) &#123;</div><div class="line">  <span class="built_in">var</span> canvas = document.createElement('canvas')</div><div class="line">  <span class="built_in">var</span> <span class="built_in">context</span> = canvas.getContext('2d')</div><div class="line">  // start with a large <span class="built_in">font</span> size</div><div class="line">  <span class="built_in">var</span> fontsize = <span class="number">500</span></div><div class="line">  <span class="built_in">return</span> measureTextBinary(<span class="built_in">context</span>, text, <span class="number">0</span>, fontsize, fontface, desiredWidth)</div><div class="line">&#125;</div><div class="line">function measureTextBinary (<span class="built_in">context</span>, text, <span class="built_in">min</span>, <span class="built_in">max</span>, fontface, desiredWidth) &#123;</div><div class="line">  <span class="keyword">if</span> (<span class="built_in">max</span> - <span class="built_in">min</span> &lt; <span class="number">1</span>) &#123;</div><div class="line">    <span class="built_in">return</span> Math.<span class="built_in">floor</span>(<span class="built_in">min</span>)</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">var</span> cur = <span class="built_in">min</span> + (<span class="built_in">max</span> - <span class="built_in">min</span>) / <span class="number">2</span></div><div class="line">  <span class="built_in">context</span>.<span class="built_in">font</span> = `$&#123;cur&#125;px $&#123;fontface&#125;`</div><div class="line">  <span class="built_in">var</span> measureWidth = <span class="built_in">context</span>.measureText(text).<span class="built_in">width</span></div><div class="line">  <span class="keyword">if</span> (measureWidth &gt; desiredWidth) &#123;</div><div class="line">      <span class="built_in">return</span> measureTextBinary(<span class="built_in">context</span>, text, <span class="built_in">min</span>, cur, fontface, desiredWidth)</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="built_in">return</span> measureTextBinary(<span class="built_in">context</span>, text, cur, <span class="built_in">max</span>, fontface, desiredWidth)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="é™åˆ¶å®½åº¦å’Œé«˜åº¦"><a href="#é™åˆ¶å®½åº¦å’Œé«˜åº¦" class="headerlink" title="é™åˆ¶å®½åº¦å’Œé«˜åº¦"></a>é™åˆ¶å®½åº¦å’Œé«˜åº¦</h2><p>æ³¨æ„åˆ° <code>measureText</code> æ–¹æ³•åªèƒ½æµ‹é‡ç»˜åˆ¶æ–‡æœ¬çš„å®½åº¦ï¼Œæ— æ³•å¾—åˆ°é«˜åº¦ä¿¡æ¯ï¼›æˆ‘ä»¬å¯ä»¥å¾€ document ä¸­æ·»åŠ ä¸€ä¸ªè¾…åŠ©çš„ <code>div</code> èŠ‚ç‚¹ï¼Œè®¾ç½®å…¶ <code>innerText</code> ä¸ºè¦ç»˜åˆ¶çš„æ–‡æœ¬ï¼Œå†è®¾ç½®å…¶å­—ä½“å¤§å°ï¼Œé€šè¿‡ <code>getBoundingClientRect</code> æ–¹æ³•æˆ–è€… <code>offsetWidth/offsetHeight</code> å±æ€§å°±å¯ä»¥å¾—åˆ°ç»˜åˆ¶æŒ‡å®šå­—ä½“å¤§å°çš„æ–‡æœ¬å®½é«˜ï¼›åŒç†ï¼Œé€šè¿‡é€’å‡å­—ä½“å¤§å°ï¼Œä½¿å¾—ç»˜åˆ¶çš„æ–‡æœ¬å®½é«˜æ»¡è¶³ Canvas çš„å®½é«˜é™åˆ¶ï¼›ç”±äºæœ‰äº†å‰é¢çš„ç»éªŒï¼Œæˆ‘ä»¬ä¹Ÿç”¨äºŒåˆ†é€’å‡æé«˜æ‰§è¡Œæ•ˆç‡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dynamicFitTextOnCanvas</span> (<span class="params">text, fontface, desiredWidth, desiredHeight</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> tmpDiv = <span class="built_in">document</span>.querySelector(<span class="string">'.tmp-div'</span>)</div><div class="line">  <span class="keyword">if</span> (!tmpDiv) &#123;</div><div class="line">    tmpDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</div><div class="line">    tmpDiv.classList.add(<span class="string">'tmp-div'</span>)</div><div class="line">    tmpDiv.style[<span class="string">'position'</span>] = <span class="string">'absolute'</span></div><div class="line">    tmpDiv.style[<span class="string">'left'</span>] = <span class="string">'-100000px'</span></div><div class="line">    tmpDiv.style[<span class="string">'top'</span>] = <span class="string">'-100000px'</span></div><div class="line">    tmpDiv.style[<span class="string">'visibility'</span>] = <span class="string">'hidden'</span></div><div class="line">    <span class="built_in">document</span>.body.appendChild(tmpDiv)</div><div class="line">    tmpDiv.innerText = text</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// start with a large font size</span></div><div class="line">  <span class="keyword">var</span> fontsize = <span class="number">500</span></div><div class="line">  <span class="keyword">return</span> measureDivBinary(tmpDiv, <span class="number">0</span>, fontsize, fontface, desiredWidth, desiredHeight)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">measureDivBinary</span> (<span class="params">tmpDiv, min, max, fontface, desiredWidth, desiredHeight</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (max - min &lt; <span class="number">1</span>) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.floor(min)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">var</span> cur = min + (max - min) / <span class="number">2</span></div><div class="line">  tmpDiv.style[<span class="string">'font'</span>] = <span class="string">`<span class="subst">$&#123;cur&#125;</span>px <span class="subst">$&#123;fontface&#125;</span>`</span></div><div class="line">  tmpDiv.style[<span class="string">'line-height'</span>] = <span class="string">`<span class="subst">$&#123;cur&#125;</span>px`</span></div><div class="line">  <span class="keyword">var</span> measureRect = tmpDiv.getBoundingClientRect()</div><div class="line">  <span class="keyword">if</span> (measureRect.width &gt; desiredWidth || measureRect.height &gt; desiredHeight) &#123;</div><div class="line">    <span class="keyword">return</span> measureDivBinary(tmpDiv, min, cur, fontface, desiredWidth, desiredHeight)</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> measureDivBinary(tmpDiv, cur, max, fontface, desiredWidth, desiredHeight)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å…³äº-line-height"><a href="#å…³äº-line-height" class="headerlink" title="å…³äº line-height"></a>å…³äº <code>line-height</code></h3><p><img src="http://7vikhl.com1.z0.glb.clouddn.com/2587037021-55bacfa692fb8.png" alt=""><br>é€šè¿‡ä¸Šå›¾æ¥ç†è§£è¡Œé«˜ï¼Œè¡Œè·</p>
<ul>
<li><strong>è¡Œé«˜</strong> (line-height) æ˜¯æŒ‡æ–‡æœ¬è¡ŒåŸºçº¿é—´çš„å‚ç›´è·ç¦»ï¼Œä¸Šå›¾ä¸­ä¸¤æ¡çº¢çº¿ä¹‹é—´çš„è·ç¦»å°±æ˜¯è¡Œé«˜</li>
<li>ä¸Šä¸€è¡Œçš„åº•çº¿å’Œä¸‹ä¸€è¡Œçš„é¡¶çº¿ä¹‹é—´çš„è·ç¦»å°±æ˜¯<strong>è¡Œè·</strong>ï¼Œè€ŒåŒä¸€è¡Œé¡¶çº¿å’Œåº•çº¿ä¹‹é—´çš„è·ç¦»æ˜¯ font-size çš„å¤§å°</li>
<li>è¡Œè·çš„ä¸€åŠæ˜¯åŠè¡Œè·: åŠè¡Œè· = (line-height - font-size) / 2ï¼Œå½“ line-height &lt; font-sizeï¼ŒåŠè¡Œè·ä¸ºè´Ÿå€¼ï¼Œè¿™æ—¶å€™ä¸¤è¡Œä¹‹é—´å°±ä¼šé‡å </li>
</ul>
<p>æˆ‘ä»¬å‘ç°ï¼Œfont-size å¤§å°å³ä¸ºæ–‡å­—ç»˜åˆ¶åçš„å®é™…é«˜åº¦ï¼Œæ‰€ä»¥åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¹è¾…åŠ© <code>div</code> èŠ‚ç‚¹ä¹Ÿè®¾ç½®äº† <code>line-height = font-size</code>ï¼Œä½¿å¾—åˆ°çš„æ–‡å­—é«˜åº¦æ›´åŠ ç²¾ç¡®ï¼ˆå»æ‰äº†ä¸¤ä¸ªåŠè¡Œè·ï¼‰</p>
<h3 id="å­˜åœ¨çš„é—®é¢˜"><a href="#å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h3><p>1ï¸âƒ£ æœ€å°å­—ä½“å¤§å°é™åˆ¶<br>åœ¨ Chrome æµè§ˆå™¨ä¸­ï¼Œè®¾å®š CSS <code>font-size</code> å°äº 12px ï¼Œä¾ç„¶ä¼šä»¥ 12px è¿›è¡Œå±•ç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´ Chrome æµè§ˆå™¨å…è®¸è®¾ç½®çš„æœ€å° <code>font-size</code> ä¸º 12pxï¼ˆSafari ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼‰ã€‚æ‰€ä»¥å¦‚æœé™åˆ¶ç»˜åˆ¶çš„ Canvas çš„å®½é«˜å°äºè¾…åŠ© <code>div</code> èŠ‚ç‚¹è®¾ç½® <code>font-size</code> ä¸º 12px çš„å®½é«˜ï¼Œé‚£ä¹ˆæ— æ³•é€šè¿‡è®¡ç®—å¾—åˆ°åˆé€‚ç»˜åˆ¶çš„ <code>font-size</code></p>
<p><strong>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</strong>åªèƒ½é€šè¿‡è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„ <code>font-size</code>ï¼Œåœ¨ Canvas ä¸Šè¿›è¡Œç»˜åˆ¶ï¼Œç„¶åå¯¹è¿™ä¸ª Canvas ç¼©å°åˆ°é™åˆ¶çš„å®½é«˜</p>
<p>2ï¸âƒ£ é«˜æ¸…å±ç»˜åˆ¶æ–‡å­—æ¨¡ç³Š<br>å…³äºè¿™ä¸ªé—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆå‚è€ƒï¼š<a href="https://objcer.com/2017/10/10/High-DPI-Canvas-Render/">é«˜æ¸…å±ä¸­ Canvas çš„ç»˜åˆ¶</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/1-UGtq-cSfbuekV8aHalVIAw.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;æœ¬æ–‡å°†æ¢ç©¶åŠ¨æ€æ–‡æœ¬å¦‚ä½•è‡ªé€‚åº”ç»˜åˆ¶åˆ°æŒ‡å®šå¤§å°çš„ Canvas ğŸ&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="Canvas" scheme="http://objcer.com/tags/Canvas/"/>
    
  </entry>
  
  <entry>
    <title>é«˜æ¸…å±ä¸­ Canvas çš„ç»˜åˆ¶</title>
    <link href="http://objcer.com/2017/10/10/High-DPI-Canvas-Render/"/>
    <id>http://objcer.com/2017/10/10/High-DPI-Canvas-Render/</id>
    <published>2017-10-10T07:07:41.000Z</published>
    <updated>2017-10-10T07:11:17.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/img_html5-canvas-guide2.jpg" alt=""><br>æœ¬æ–‡å°†å¯¹ Canvas åœ¨é«˜æ¸…å±ä¸­ç»˜åˆ¶å‡ºç°æ¨¡ç³Šé—®é¢˜è¿›è¡Œåˆ†æï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆ ğŸ</p>
<a id="more"></a>
<h2 id="é—®é¢˜å‰–æ"><a href="#é—®é¢˜å‰–æ" class="headerlink" title="é—®é¢˜å‰–æ"></a>é—®é¢˜å‰–æ</h2><blockquote>
<p>æ–‡ç« ï¼š<a href="https://objcer.com/2017/06/19/one-pixel-border/">é«˜æ¸…å±ä¸€åƒç´ è¾¹æ¡†é—®é¢˜</a> ä¸­å¯¹ç‰©ç†åƒç´ (physical pixel) ã€CSS åƒç´ å’Œ devicePixelRatio ç­‰æ¦‚å¿µè¿›è¡Œäº†ä»‹ç»</p>
</blockquote>
<p>åœ¨é«˜æ¸…å±ä¸­ï¼ŒCanvas ç»˜åˆ¶æ—¶ä¼šå‡ºç°æ¨¡ç³Šçš„é—®é¢˜ï¼Œåœ¨æ–‡ç«  <a href="https://www.html5rocks.com/en/tutorials/canvas/hidpi/" target="_blank" rel="external">High DPI Canvas</a> ä¸­å¯¹æ­¤è¿›è¡Œäº†åˆ†æä»‹ç»ã€‚å…¶ä¸­æ¶‰åŠä¸¤ä¸ªæ¦‚å¿µï¼š<strong>webkitBackingStorePixelRatio</strong> å’Œ <strong>devicePixelRatio</strong></p>
<p>æµè§ˆå™¨ç»˜åˆ¶ Canvas æ¸²æŸ“åˆ°å±å¹•ä¸­åˆ†ä¸¤ä¸ªè¿‡ç¨‹ï¼š</p>
<ul>
<li>ç»˜åˆ¶è¿‡ç¨‹ï¼š<strong>webkitBackingStorePixelRatio</strong><br><code>webkitBackingStorePixelRatio</code> è¡¨ç¤ºæµè§ˆå™¨åœ¨ç»˜åˆ¶ Canvas åˆ°ç¼“å­˜åŒºæ—¶çš„ç»˜åˆ¶æ¯”ä¾‹ï¼Œè‹¥å›¾ç‰‡å®½é«˜ä¸º <code>200px</code>ï¼Œ<code>webkitBackingStorePixelRatio</code> ä¸º 2ï¼Œé‚£ä¹ˆ Canvas ç»˜åˆ¶è¿™ä¸ªå›¾ç‰‡åˆ°ç¼“å­˜åŒºæ—¶ï¼Œå®½é«˜å°±ä¸º <code>400px</code></li>
<li>æ¸²æŸ“è¿‡ç¨‹ï¼š<strong>devicePixelRatio</strong><br>Canvas æ˜¾ç¤ºåˆ°å±å¹•ä¸­è¿˜éœ€è¦æ¸²æŸ“è¿‡ç¨‹ï¼Œæ¸²æŸ“è¿‡ç¨‹æ ¹æ® <code>devicePixelRatio</code> å‚æ•°å°†ç¼“å­˜åŒºä¸­çš„ Canvas è¿›è¡Œç¼©æ”¾æ¸²æŸ“åˆ°å±å¹•ä¸­</li>
</ul>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/canvas-backingstore-device.png" alt=""></p>
<p>åˆ†æå›¾ç‰‡åœ¨é«˜æ¸…å±ä¸­ Canvas ç»˜åˆ¶ä¼šæ¨¡ç³Šçš„åŸå› ï¼š<br>1ã€<code>devicePixelRatio = device pixel / CSS pixel</code><br>å¦‚æœ <code>devicePixelRatio = 2</code> é‚£ä¹ˆå¯¹äº <code>200px * 200px</code> çš„å›¾ç‰‡è¦ç»˜åˆ¶åˆ°å±å¹•ä¸­ï¼Œé‚£ä¹ˆå¯¹åº”çš„å±å¹•åƒç´ (ç‰©ç†åƒç´ ) å°±æ˜¯ <code>400px * 400px</code></p>
<p>2ã€åœ¨å¤§éƒ¨åˆ†é«˜æ¸…å±ä¸­ï¼Œä¾‹å¦‚ Macbook Pro ä¸­<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">webkitBackingStorePixelRatio</span> = <span class="number">1</span></div><div class="line"><span class="attr">devicePixelRatio</span> = <span class="number">2</span></div></pre></td></tr></table></figure></p>
<p>å°†ä¸€ä¸ª <code>200px * 200px</code> çš„å›¾ç‰‡ Cavnas ç»˜åˆ¶åˆ°è¯¥å±å¹•ä¸­çš„æµç¨‹ï¼š</p>
<ul>
<li><code>webkitBackingStorePixelRatio = 1</code><br>ç»˜åˆ¶åˆ°ç¼“å­˜åŒºçš„å¤§å°ä¹Ÿä¸ºï¼š<code>200px * 200px</code></li>
<li><code>devicePixelRatio = 2</code><br><code>200px * 200px</code> çš„å›¾ç‰‡å¯¹åº”åˆ°å±å¹•åƒç´ ä¸º <code>400px * 400px</code>ï¼Œ<code>devicePixelRatio = 2</code> æµè§ˆå™¨å°±æŠŠç¼“å­˜åŒºçš„ <code>200px * 200px</code> å®½é«˜åˆ†åˆ«æ”¾å¤§ä¸¤å€æ¸²æŸ“åˆ°å±å¹•ä¸­ï¼Œæ‰€ä»¥å°±å¯¼è‡´æ¨¡ç³Š</li>
</ul>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><ul>
<li><p>å°† Canvas å®½é«˜è¿›è¡Œæ”¾å¤§ï¼Œæ”¾å¤§æ¯”ä¾‹ä¸ºï¼š<code>devicePixelRatio / webkitBackingStorePixelRatio</code></p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> devicePixelRatio = window.devicePixelRatio || <span class="number">1</span></div><div class="line"><span class="built_in">var</span> backingStoreRatio = <span class="built_in">context</span>.webkitBackingStorePixelRatio ||</div><div class="line">                        <span class="built_in">context</span>.mozBackingStorePixelRatio ||</div><div class="line">                        <span class="built_in">context</span>.msBackingStorePixelRatio ||</div><div class="line">                        <span class="built_in">context</span>.oBackingStorePixelRatio ||</div><div class="line">                        <span class="built_in">context</span>.backingStorePixelRatio || <span class="number">1</span></div><div class="line"></div><div class="line"><span class="built_in">var</span> ratio = devicePixelRatio / backingStoreRatio</div></pre></td></tr></table></figure>
</li>
<li><p>é€šè¿‡ CSS è®¾ç½®å°† Canvas ç¼©å°ä¸ºåŸå¤§å°</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> oldWidth = canvas.<span class="built_in">width</span>;</div><div class="line"><span class="built_in">var</span> oldHeight = canvas.<span class="built_in">height</span>;</div><div class="line"></div><div class="line">canvas.<span class="built_in">width</span> = oldWidth * ratio;</div><div class="line">canvas.<span class="built_in">height</span> = oldHeight * ratio;</div><div class="line"></div><div class="line">canvas.<span class="built_in">style</span>.<span class="built_in">width</span> = oldWidth + 'px';</div><div class="line">canvas.<span class="built_in">style</span>.<span class="built_in">height</span> = oldHeight + 'px';</div></pre></td></tr></table></figure>
</li>
</ul>
<p>ä¸¾ä¾‹åˆ†æä¸€ä¸‹ Canvas ç»˜åˆ¶å›¾ç‰‡ï¼Œæ–‡å­—çš„é€‚é…æ–¹æ¡ˆï¼š<br>1ã€å¯¹äºå›¾ç‰‡ç»˜åˆ¶ <code>drawImage</code> æ–¹æ³•ï¼š<br>ç”±äº Canvas æ”¾å¤§åï¼Œç›¸åº”çš„ç»˜åˆ¶å›¾ç‰‡æ—¶ä¹Ÿè¦æ”¾å¤§ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li><p><code>drawImage</code> ç›®æ ‡å®½é«˜åˆ†åˆ«ä¹˜ä»¥ <code>ratio</code></p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">context</span>.drawImage(<span class="built_in">image</span>, srcx, srcy, srcw, srch, desx, desy, desw * ratio, desh * ratio);</div></pre></td></tr></table></figure>
</li>
<li><p><code>context.scale</code> ç¼©æ”¾</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">context</span>.<span class="built_in">scale</span>(ratio, ratio)</div><div class="line">// ç»˜åˆ¶å›¾ç‰‡</div><div class="line"><span class="built_in">context</span>.drawImage(...)</div><div class="line"><span class="built_in">context</span>.<span class="built_in">scale</span>(<span class="number">1</span>/ratio, <span class="number">1</span>/ratio)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>æ­¤ç§æ–¹å¼åœ¨ç»˜åˆ¶å›¾ç‰‡ä¹‹å‰ï¼Œè°ƒç”¨ <code>scale</code> è®¾ç½® Canvas ç¼©æ”¾å˜æ¢ï¼›ç»˜åˆ¶å®Œæˆåï¼Œéœ€è¦é‡ç½® Canvas çš„ç¼©æ”¾å˜æ¢ã€‚æ¨èä½¿ç”¨è¿™ç§æ–¹å¼ ğŸ‘</p>
<p>2ã€å¯¹äºæ–‡å­—ç»˜åˆ¶ <code>fillText</code> æ–¹æ³•<br>ç”±äº Canvas æ”¾å¤§äº†ï¼Œç»˜åˆ¶æ–‡å­—æ—¶ï¼Œå­—ä½“ä¹Ÿè¦æ”¾å¤§ï¼Œç»˜åˆ¶å®Œæˆåï¼Œå­—ä½“å†ç¼©å°å›åŸå¤§å°<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">context</span>.<span class="built_in">font</span> = <span class="built_in">context</span>.<span class="built_in">font</span>.replace(</div><div class="line">  /(\d+)(px|em|<span class="built_in">rem</span>|pt)/g,</div><div class="line">  function(w, m, u) &#123;</div><div class="line">    <span class="built_in">return</span> (m * ratio) + u;</div><div class="line">  &#125;</div><div class="line">);</div><div class="line">// ç»˜åˆ¶æ–‡å­—</div><div class="line"><span class="built_in">context</span>.fillText(...)</div><div class="line"><span class="built_in">context</span>.<span class="built_in">font</span> = <span class="built_in">context</span>.<span class="built_in">font</span>.replace(</div><div class="line">  /(\d+)(px|em|<span class="built_in">rem</span>|pt)/g,</div><div class="line">  function(w, m, u) &#123;</div><div class="line">    <span class="built_in">return</span> (m / ratio) + u;</div><div class="line">  &#125;</div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>å…³äº Canvas åœ¨é«˜æ¸…å±ç»˜åˆ¶çš„å…¼å®¹ï¼Œgithub æœ‰ä¸€ä¸ª polyfill <a href="https://github.com/jondavidjohn/hidpi-canvas-polyfill" target="_blank" rel="external">jondavidjohn/hidpi-canvas-polyfill</a> ä½†æ˜¯è¿™ä»“åº“å¹¶æ²¡æœ‰è€ƒè™‘ <code>drawImage</code>ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨è¿™ä¸ª polyfillï¼Œåœ¨ç»˜åˆ¶å›¾ç‰‡æ—¶ï¼Œå®½é«˜éƒ½ä¼šå˜å°ï¼›æˆ‘ fork äº†è¿™ä¸ªä»“åº“ï¼Œå¹¶å¢åŠ äº† <code>drawImage</code> å¤„ç†ï¼š<a href="https://github.com/YingshanDeng/hidpi-canvas-polyfill" target="_blank" rel="external">YingshanDeng/hidpi-canvas-polyfill</a>ã€‚æ›´å¤š Canvas ç»˜åˆ¶æ–¹æ³•çš„å…¼å®¹å‚è€ƒè¿™ä¸ªä»“åº“çš„æºç ã€‚</p>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>1ï¸âƒ£ <code>webkitBackingStorePixelRatio</code> åœ¨ Chrome ä¸­å·²ç»åºŸå¼ƒï¼Œè¯¦ç»†å‚è€ƒï¼š<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=277205" target="_blank" rel="external">https://bugs.chromium.org/p/chromium/issues/detail?id=277205</a></p>
<p>2ï¸âƒ£ ç°åœ¨é«˜æ¸…å±ä¸­ Canvas ç»˜åˆ¶å›¾ç‰‡ <code>drawImage</code>ï¼Œä¸éœ€è¦ç»è¿‡å¦‚ä¸Šå¤„ç†ä¹Ÿä¸ä¼šå‡ºç°æ¨¡ç³Šçš„æƒ…å†µäº†ï¼ˆåªåœ¨ Mackbook Pro, iPhone 6S ä¸Šåˆ†åˆ«æµ‹è¯•è¿‡ï¼‰ï¼Œè¿™ç‚¹åœ¨ç½‘ä¸Šå¹¶æ²¡æœ‰æ‰¾åˆ°æ›´å¤šçš„ä¿¡æ¯</p>
<p>ä½†æ˜¯ Canvas çš„å…¶ä»–ç»˜åˆ¶æ–¹æ³•ä¾‹å¦‚ç»˜åˆ¶æ–‡å­— <code>fillText</code> ä¸ç»è¿‡å¤„ç†é«˜æ¸…å±ä¸­ç»˜åˆ¶ä»ç„¶ä¼šæ¨¡ç³Šï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦è¿™ä¸ªpolyfillï¼š<a href="https://github.com/YingshanDeng/hidpi-canvas-polyfill" target="_blank" rel="external">YingshanDeng/hidpi-canvas-polyfill</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/img_html5-canvas-guide2.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;æœ¬æ–‡å°†å¯¹ Canvas åœ¨é«˜æ¸…å±ä¸­ç»˜åˆ¶å‡ºç°æ¨¡ç³Šé—®é¢˜è¿›è¡Œåˆ†æï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆ ğŸ&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="Canvas" scheme="http://objcer.com/tags/Canvas/"/>
    
  </entry>
  
  <entry>
    <title>å‰–æ iOS 11 ç½‘é¡µé€‚é…é—®é¢˜</title>
    <link href="http://objcer.com/2017/09/21/Understanding-the-WebView-Viewport-in-iOS-11-iPhone-X/"/>
    <id>http://objcer.com/2017/09/21/Understanding-the-WebView-Viewport-in-iOS-11-iPhone-X/</id>
    <published>2017-09-21T07:55:40.000Z</published>
    <updated>2017-11-05T15:24:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>åŒ—äº¬æ—¶é—´ 9 æœˆ 12 æ—¥å‡Œæ™¨ï¼Œè‹¹æœåœ¨ä¹”å¸ƒæ–¯å‰§é™¢å‘å¸ƒäº† iPhone Xã€‚iPhone X æ­£é¢çš„å…¨é¢å±ä¸Šæ–¹æœ‰ä¸€æ¡åˆ˜æµ·ï¼Œå¯¹äºå¦‚ä½•é€‚é… iPhone Xï¼Œè‹¹æœçš„ <a href="https://developer.apple.com/ios/human-interface-guidelines/overview/iphone-x/" target="_blank" rel="external">Human Interface Guidelines</a> æ–‡æ¡£å·²ç»ç»™å‡ºè¯¦ç»†çš„è¯´æ˜ã€‚</p>
<p>è‹¹æœå¯¹äº iPhone X çš„è®¾è®¡å¸ƒå±€æ„è§å¦‚ä¸‹ï¼š<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/iphone-x-safe-area.png" alt=""><br>æ ¸å¿ƒå†…å®¹åº”è¯¥å¤„äº <strong>Safe area</strong> ç¡®ä¿ä¸ä¼šè¢«è®¾å¤‡åœ†è§’(corners)ï¼Œä¼ æ„Ÿå™¨å¤–å£³(sensor housingï¼Œé½åˆ˜æµ·) ä»¥åŠåº•éƒ¨çš„ Home Indicator é®æŒ¡ã€‚</p>
<p>æœ¬æ–‡å°†å‰–æä¸¤åˆ™åœ¨  iPhone X å¼‚å½¢å±å’Œ iOS 11 ç½‘é¡µé€‚é…ä¸­é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚<br><a id="more"></a></p>
<h2 id="iPhone-X-Safari-æ¨ªå±æ˜¾ç¤ºå·¦å³ç™½è¾¹é—®é¢˜"><a href="#iPhone-X-Safari-æ¨ªå±æ˜¾ç¤ºå·¦å³ç™½è¾¹é—®é¢˜" class="headerlink" title="iPhone X Safari æ¨ªå±æ˜¾ç¤ºå·¦å³ç™½è¾¹é—®é¢˜"></a>iPhone X Safari æ¨ªå±æ˜¾ç¤ºå·¦å³ç™½è¾¹é—®é¢˜</h2><p>iPhone X Safari åœ¨æ¨ªå±çŠ¶æ€ä¸‹ï¼Œç½‘é¡µå·¦å³ä¸¤ä¾§å¯èƒ½ä¼šå‡ºç°ç™½è¾¹ï¼Œå¦‚ä¸‹ï¼š<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/424F6040-3325-4AD5-8683-6D55AE4D9BEA.png" alt=""></p>
<p>å› ä¸º iPhone X ä¼šå°†ç½‘é¡µå†…å®¹æ˜¾ç¤ºåœ¨ Safe area å¯¼è‡´çš„ï¼Œè§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å°†èƒŒæ™¯é¢œè‰²å¡«å……æ•´ä¸ªå±å¹•åŒºåŸŸï¼Œè€Œç½‘é¡µå†…å®¹å¤„äº Safe areaã€‚<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/47C98605-A351-4903-BDC7-C1E6878D0485.png" alt=""></p>
<h3 id="è§£å†³æ–¹æ¡ˆä¸€ï¼šbackground-color"><a href="#è§£å†³æ–¹æ¡ˆä¸€ï¼šbackground-color" class="headerlink" title="è§£å†³æ–¹æ¡ˆä¸€ï¼šbackground-color"></a>è§£å†³æ–¹æ¡ˆä¸€ï¼š<code>background-color</code></h3><p>å¦‚æœç½‘é¡µè®¾ç½®äº†ä¸€ä¸ªèƒŒæ™¯é¢œè‰²ï¼Œé‚£ä¹ˆæœ€ç®€å•è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåœ¨ <code>body</code> èŠ‚ç‚¹è®¾ç½® <code>background-color</code>ï¼Œä½¿èƒŒæ™¯é¢œè‰²å¡«å……æ•´ä¸ªå±å¹•ï¼Œä»è€Œè§£å†³æ¨ªå±æ˜¾ç¤ºå·¦å³ç™½è¾¹çš„é—®é¢˜</p>
<h3 id="è§£å†³æ–¹æ¡ˆäºŒï¼šviewport-fit-safe-area-inset"><a href="#è§£å†³æ–¹æ¡ˆäºŒï¼šviewport-fit-safe-area-inset" class="headerlink" title="è§£å†³æ–¹æ¡ˆäºŒï¼šviewport-fit + safe-area-inset-*"></a>è§£å†³æ–¹æ¡ˆäºŒï¼š<code>viewport-fit</code> + <code>safe-area-inset-*</code></h3><p>åœ¨ iOS 11 ä¸­è‹¹æœä¸º Web æ–°å¢ä¸¤ä¸ªå†…å®¹ <code>viewport-fit</code> + <code>safe-area-inset-*</code></p>
<blockquote>
<p>â—ï¸æ³¨æ„ï¼š<code>viewport-fit</code> å’Œ <code>safe-area-inset-*</code> åªå¯¹äº WKWebView æœ‰æ•ˆï¼Œåœ¨ UIWebView ä¸­æ— æ•ˆ</p>
</blockquote>
<p>1ï¸âƒ£ã€<code>viewport-fit</code> ç”¨äºè®¾ç½®ç½‘é¡µåœ¨å¯è§†çª—å£çš„å¸ƒå±€æ–¹å¼</p>
<blockquote>
<p>æ–‡æ¡£ï¼š<a href="https://drafts.csswg.org/css-round-display/#viewport-fit-descriptor" target="_blank" rel="external">CSS Round Display Spec</a></p>
</blockquote>
<p>è¿™ä¸ªå±æ€§å¯è®¾ç½®ä¸ºï¼š</p>
<ul>
<li><code>contain</code>: The viewport should fully contain the web content. å¯è§†çª—å£å®Œå…¨åŒ…å«ç½‘é¡µå†…å®¹</li>
<li><code>cover</code>: The web content should fully cover the viewport.  ç½‘é¡µå†…å®¹å®Œå…¨è¦†ç›–å¯è§†çª—å£</li>
<li><code>auto</code>: The default value, <code>contain</code></li>
</ul>
<p>å¯¹äº iPhone X ä¹‹å‰çš„ iPhone è®¾å¤‡å±å¹•ä¸ºè§„åˆ™çš„çŸ©å½¢ï¼Œç½‘é¡µå†…å®¹éƒ½å¯ä»¥å®Œæ•´å±•ç¤ºï¼›ä½†æ˜¯å¯¹äº iPhone X æ˜¯å¼‚å½¢å±å¹•ï¼Œé€šè¿‡ <code>viewport-fit</code> å¯ä»¥è®¾ç½®ç½‘é¡µå†…å®¹åœ¨å¯è§†çª—å£ä¸­çš„æ˜¾ç¤ºè§„åˆ™ï¼Œé€šè¿‡ä¸‹å›¾å¯ä»¥è¾…åŠ©ç†è§£<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/viewport-fit.png" alt=""></p>
<p>æˆ‘ä»¬çŸ¥é“é»˜è®¤æƒ…å†µä¸‹ <code>viewport-fit=auto</code> å³ä¸º <code>viewport-fit=contain</code>ï¼Œåœ¨ iPhone X ä¸­ï¼Œç›¸å½“äºç½‘é¡µå†…å®¹å±•ç¤ºåœ¨ Safe areaï¼Œè¿™æ ·ä¹Ÿå°±æ˜¯æ¨ªå±æ˜¾ç¤ºæ—¶å‡ºç°ç™½è¾¹çš„åŸå› äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¾ç½® <code>viewport-fit=cover</code> å³å¯è§£å†³é—®é¢˜<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;meta <span class="attribute">name</span>=<span class="string">"viewport"</span> <span class="attribute">content</span>=<span class="string">"width=device-width, initial-scale=1.0, viewport-fit=cover"</span>&gt;</div></pre></td></tr></table></figure></p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/Screen-Shot-2017-09-14-at-14.19.31.png" alt=""></p>
<p>æ³¨æ„åˆ°åº”ç”¨ <code>viewport-fit=cover</code> ä¹‹åï¼Œç½‘é¡µå³ä¸Šè§’ï¼Œmenu æŒ‰é”®å’Œ in æŒ‰é”®è¢«åœ†è§’ï¼Œä¼ æ„Ÿå™¨å¤–å£³ï¼ˆé½åˆ˜æµ·ï¼‰è£å‰ªæ‰äº† ğŸ˜²</p>
<p>2ï¸âƒ£ã€<code>safe-area-inset-*</code><br><strong>åœ¨è®¾ç½® <code>viewport-fit=cover</code> ä¹‹å</strong>ï¼ŒWeb ä¸­ä¼šæ–°å¢å››ä¸ªå¸¸é‡ï¼š</p>
<ul>
<li>safe-area-inset-top</li>
<li>safe-area-inset-right</li>
<li>safe-area-inset-left</li>
<li>safe-area-inset-bottom</li>
</ul>
<p>åˆ†åˆ«è¡¨ç¤º Safe area å’Œå¯è§†çª—å£ viewport é¡¶éƒ¨ï¼Œå³è¾¹ï¼Œå·¦è¾¹ï¼Œåº•éƒ¨çš„é—´è·ï¼Œå¯ä»¥ç”¨äºè®¾ç½® <code>margin</code>, <code>padding</code>, æˆ–è€…ç»å¯¹å®šä½æ—¶ <code>left</code>, <code>top</code></p>
<blockquote>
<p>â—ï¸æ³¨æ„ï¼šåœ¨æ¨ªå±å’Œç«–å±çŠ¶æ€ä¸‹ï¼Œ<code>safe-area-inset-*</code> çš„å€¼ä¸åŒ</p>
</blockquote>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/0C3B9577-094E-411C-9ED3-AA481FA3A50A.png" alt=""></p>
<p>ä¸ºäº†è§£å†³åº”ç”¨ <code>viewport-fit=cover</code> ä¹‹åï¼Œæœ‰äº›æ˜¾ç¤ºå†…å®¹è¢«è£å‰ªçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ è¾¹è·ä½¿å¾—ç½‘é¡µä¸»è¦å†…å®¹å¤„äº Safe area ä¸­ä¸è¢«è£å‰ªï¼Œè§£å†³æ–¹å¼å¦‚ä¸‹ï¼š<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">padding</span>: constant(safe-<span class="meta">area</span>-inset-top) constant(safe-<span class="meta">area</span>-inset-right) constant(safe-<span class="meta">area</span>-inset-<span class="keyword">bottom) </span>constant(safe-<span class="meta">area</span>-inset-left)<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/Screen-Shot-2017-09-14-at-14.07.11-1.png" alt=""></p>
<h2 id="iOS-11-WebView-ä¸­çŠ¶æ€æ é—®é¢˜"><a href="#iOS-11-WebView-ä¸­çŠ¶æ€æ é—®é¢˜" class="headerlink" title="iOS 11 WebView ä¸­çŠ¶æ€æ é—®é¢˜"></a>iOS 11 WebView ä¸­çŠ¶æ€æ é—®é¢˜</h2><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>åœ¨ iOS 11 ç”±äº safe areaï¼ŒçŠ¶æ€æ çš„è¡¨ç°æœ‰ç‚¹ä¸åŒã€‚å¦‚æœé¡µé¢é¡¶éƒ¨æœ‰ä¸€ä¸ª header barï¼Œè®¾ç½® <code>position: fixed; top: 0px;</code> é‚£ä¹ˆé¡µé¢æ»šåŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºç°å¦‚ä¸‹é—®é¢˜ï¼š<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/iPhone%206s.gif" alt="iPhone 6S"><br><img src="http://7vikhl.com1.z0.glb.clouddn.com/iPhone%20X.gif" alt="iPhone X"></p>
<p>header bar æ²¡æœ‰å›ºå®šåœ¨æœ€é¡¶éƒ¨ï¼Œä¸Šä¸‹æ»šåŠ¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç½‘é¡µå†…å®¹ä» status bar ä¸‹æ–¹ç©¿è¿‡<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/status-bar-problem.png" alt=""></p>
<p><strong>é‡ç°é—®é¢˜ï¼š</strong><br>åˆ›å»ºä¸€ä¸ª iOS é¡¹ç›®ï¼Œè§†å›¾ä¸­æ·»åŠ ä¸€ä¸ª <code>WKWebView</code>ï¼ŒåŠ è½½ç™¾åº¦é¦–é¡µ<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">  [<span class="keyword">super</span> viewDidLoad];</div><div class="line">  <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></div><div class="line">  <span class="built_in">WKWebView</span> *webView = [[<span class="built_in">WKWebView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</div><div class="line">  [webView loadRequest:[<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"https://www.baidu.com"</span>]]];</div><div class="line">  [<span class="keyword">self</span>.view addSubview:webView];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>å‰–æé—®é¢˜ï¼š</strong><br>1ã€è¿™ä¸ªé—®é¢˜åŒæ ·ä¹Ÿæ˜¯ç”±äº safe area å¯¼è‡´ï¼Œè™½ç„¶ header bar ä½ç½®ä¿¡æ¯ä¸º <code>position: fixed; top: 0px;</code>ï¼Œä½†è¿™ä¸ªä½ç½®ä¹Ÿæ˜¯ç›¸å¯¹äº safe area è€Œè¨€çš„ï¼Œæ‰€ä»¥çœ‹åˆ° header bar å¹¶æ²¡æœ‰ä½äºå±å¹•æœ€é¡¶éƒ¨ã€‚ğŸ‘‰ åœ¨ viewport meta æ ‡ç­¾ï¼Œæ·»åŠ  <code>viewport-fit=cover</code> å³å¯è§£å†³æ­¤é—®é¢˜<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/2B17E02C-7C0C-4282-9369-F5E6D1C75836.png" alt=""></p>
<p>2ã€è™½ç„¶ header bar å›ºå®šåˆ°å±å¹•æœ€ä¸Šæ–¹ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾åœ¨ iPhone X ä¸­å´è¢«åœ†è§’å’Œé½åˆ˜æµ·è£å‰ªäº†å†…å®¹ï¼Œè¿™æ€ä¹ˆåŠå‘¢ï¼ŸğŸ‘‰ ä¸º header bar æ·»åŠ  <code>padding-top</code> å³å¯è§£å†³æ­¤é—®é¢˜<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">header</span> &#123;</div><div class="line">  <span class="comment">/* ... */</span></div><div class="line"></div><div class="line">  <span class="comment">/* Status bar height on iOS 10 */</span></div><div class="line">  <span class="attribute">padding-top</span>: <span class="number">20px</span>;</div><div class="line"></div><div class="line">  <span class="comment">/* Status bar height on iOS 11+ */</span></div><div class="line">  <span class="attribute">padding-top</span>: <span class="built_in">constant</span>(safe-area-inset-top);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/FCF9D371-F2B5-44FE-9FFC-DC991E39FD2C.png" alt=""></p>
<h2 id="æ›´æ–°å†…å®¹"><a href="#æ›´æ–°å†…å®¹" class="headerlink" title="æ›´æ–°å†…å®¹"></a>æ›´æ–°å†…å®¹</h2><blockquote>
<p><strong>Webkit æ–‡æ¡£</strong> <a href="https://webkit.org/blog/7929/designing-websites-for-iphone-x/" target="_blank" rel="external">Designing Websites for iPhone X</a></p>
</blockquote>
<h3 id="CSS-function-env"><a href="#CSS-function-env" class="headerlink" title="CSS function env()"></a>CSS function <code>env()</code></h3><blockquote>
<p>The env() function shipped in iOS 11 with the name constant(). Beginning with Safari Technology Preview 41 and the iOS 11.2 beta, constant() has been removed and replaced with env(). You can use the CSS fallback mechanism to support both versions, if necessary, but should prefer env() going forward.</p>
</blockquote>
<p><strong>Webkit åœ¨ iOS 11 ä¸­æ–°å¢ CSS functionï¼š<code>env()</code> æ›¿ä»£ <code>constant()</code></strong>ï¼Œæ–‡æ¡£ä¸­æ¨èä½¿ç”¨ <code>env()</code>ï¼Œè€Œ <code>constant()</code> ä» Safari Technology Preview 41 å’Œ iOS 11.2 beta å¼€å§‹ä¼šè¢«åºŸå¼ƒã€‚<code>env()</code> ç”¨æ³•å¦‚åŒ <code>var()</code>ï¼Œåœ¨ä¸æ”¯æŒçš„ <code>env()</code> çš„æµè§ˆå™¨ä¸­ï¼Œä¼šè‡ªåŠ¨å¿½ç•¥è¿™ä¸€æ ·å¼è§„åˆ™ï¼Œä¸å½±å“ç½‘é¡µæ­£å¸¸å±•ç¤ºï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.post</span> &#123;</div><div class="line">  <span class="attribute">padding</span>: <span class="number">12px</span>;</div><div class="line">  <span class="attribute">padding-left</span>: <span class="built_in">env</span>(safe-area-inset-left);</div><div class="line">  <span class="attribute">padding-right</span>: <span class="built_in">env</span>(safe-area-inset-right);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="CSS-function-min-å’Œ-max"><a href="#CSS-function-min-å’Œ-max" class="headerlink" title="CSS function min() å’Œ max()"></a>CSS function <code>min()</code> å’Œ <code>max()</code></h3><p>åœ¨ iPhone X è®¾å¤‡è®¾ç½®ç½‘é¡µè¾¹è·çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å½¢ï¼šæˆ‘ä»¬é€šè¿‡ <code>env(safe-area-inset-left)</code> å’Œ <code>env(safe-area-inset-right)</code> è®¾ç½®äº†é¡µé¢å±•ç¤ºå·¦å³è¾¹è·ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.post</span> &#123;</div><div class="line">  <span class="attribute">padding-left</span>: <span class="built_in">env</span>(safe-area-inset-left);</div><div class="line">  <span class="attribute">padding-right</span>: <span class="built_in">env</span>(safe-area-inset-right);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨æ¨ªå±çŠ¶æ€ä¸‹æ˜¾ç¤ºæ­£å¸¸ï¼Œä½†æ˜¯åœ¨ç«–å±çŠ¶æ€ä¸‹ï¼Œå¸¸é‡ <code>safe-area-inset-left</code> å’Œ <code>safe-area-inset-right</code> éƒ½ä¸º 0ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´é¡µé¢å±•ç¤ºå·¦å³è¾¹è·ä¸º <code>0px</code>ï¼Œå¦‚ä¸‹å›¾å·¦ï¼Œæ­£å¸¸æƒ…å†µåº”è¯¥æ˜¯å¦‚ä¸‹å›¾å³ï¼Œç«–å±çŠ¶æ€ä¸‹é¡µé¢å·¦å³ä¹Ÿæœ‰è¾¹è·ã€‚</p>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/css-funciton-min-max.png" alt=""></p>
<p>Webkit ä» Safari Technology Preview 41 å’Œ iOS 11.2 beta å¼€å§‹ï¼Œæ–°å¢ CSS functionï¼š<code>min()</code> å’Œ <code>max()</code>ï¼Œè¿™ä¸¤ä¸ªå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚</p>
<blockquote>
<p>Both functions take an arbitrary number of arguments and return the minimum or maximum. They can be used inside of calc(), or nested inside each other, and both functions allow calc()-like math inside of them.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@supports(padding: <span class="built_in">max</span>(0px)) &#123;</div><div class="line">  .post &#123;</div><div class="line">    padding-<span class="keyword">left</span>: <span class="built_in">max</span>(12px, env(safe-area-inset-<span class="keyword">left</span>));</div><div class="line">    padding-<span class="keyword">right</span>: <span class="built_in">max</span>(12px, env(safe-area-inset-<span class="keyword">right</span>));</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>â—ï¸æ­¤å¤„éœ€è¦ä½¿ç”¨ <code>@supports</code> å»æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒ <code>min()</code> å’Œ <code>max()</code></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://developer.apple.com/ios/human-interface-guidelines/overview/iphone-x/" target="_blank" rel="external">Human Interface Guidelines-iPhone X</a><br><a href="http://stephenradford.me/removing-the-white-bars-in-safari-on-iphone-x/" target="_blank" rel="external">Removing the White Bars in Safari on iPhone X</a><br><a href="https://ayogo.com/blog/ios11-viewport/" target="_blank" rel="external">Understanding the WebView Viewport in iOS 11</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åŒ—äº¬æ—¶é—´ 9 æœˆ 12 æ—¥å‡Œæ™¨ï¼Œè‹¹æœåœ¨ä¹”å¸ƒæ–¯å‰§é™¢å‘å¸ƒäº† iPhone Xã€‚iPhone X æ­£é¢çš„å…¨é¢å±ä¸Šæ–¹æœ‰ä¸€æ¡åˆ˜æµ·ï¼Œå¯¹äºå¦‚ä½•é€‚é… iPhone Xï¼Œè‹¹æœçš„ &lt;a href=&quot;https://developer.apple.com/ios/human-interface-guidelines/overview/iphone-x/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Human Interface Guidelines&lt;/a&gt; æ–‡æ¡£å·²ç»ç»™å‡ºè¯¦ç»†çš„è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;è‹¹æœå¯¹äº iPhone X çš„è®¾è®¡å¸ƒå±€æ„è§å¦‚ä¸‹ï¼š&lt;br&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/iphone-x-safe-area.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;æ ¸å¿ƒå†…å®¹åº”è¯¥å¤„äº &lt;strong&gt;Safe area&lt;/strong&gt; ç¡®ä¿ä¸ä¼šè¢«è®¾å¤‡åœ†è§’(corners)ï¼Œä¼ æ„Ÿå™¨å¤–å£³(sensor housingï¼Œé½åˆ˜æµ·) ä»¥åŠåº•éƒ¨çš„ Home Indicator é®æŒ¡ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†å‰–æä¸¤åˆ™åœ¨  iPhone X å¼‚å½¢å±å’Œ iOS 11 ç½‘é¡µé€‚é…ä¸­é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚&lt;br&gt;
    
    </summary>
    
      <category term="CSS" scheme="http://objcer.com/categories/CSS/"/>
    
    
      <category term="viewport-fit" scheme="http://objcer.com/tags/viewport-fit/"/>
    
      <category term="iOS 11" scheme="http://objcer.com/tags/iOS-11/"/>
    
  </entry>
  
  <entry>
    <title>Implementing Promise</title>
    <link href="http://objcer.com/2017/09/06/Implementing-Promise/"/>
    <id>http://objcer.com/2017/09/06/Implementing-Promise/</id>
    <published>2017-09-06T14:10:50.000Z</published>
    <updated>2017-09-06T14:24:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/Promises:A+.png" alt=""></p>
<a id="more"></a>
<p>æœ¬æ–‡å°†å‰–æ Promise çš„å†…éƒ¨ç»“æ„ï¼Œå®ç°ç¬¦åˆ <a href="https://promisesaplus.com/" target="_blank" rel="external">Promises/A+</a> è§„èŒƒçš„ Promiseï¼Œå¹¶ä¸”é€šè¿‡ <a href="https://github.com/promises-aplus/promises-tests#promisesa-compliance-test-suite" target="_blank" rel="external">promises-aplus/promises-tests</a> æµ‹è¯•ã€‚</p>
<h2 id="JavaScript-Promise-æ ‡å‡†è§£è¯»"><a href="#JavaScript-Promise-æ ‡å‡†è§£è¯»" class="headerlink" title="JavaScript Promise æ ‡å‡†è§£è¯»"></a>JavaScript Promise æ ‡å‡†è§£è¯»</h2><p>Promise è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆç»“æœï¼Œä¸ä¹‹è¿›è¡Œäº¤äº’çš„æ–¹å¼ä¸»è¦æ˜¯ <code>then</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ³¨å†Œäº†ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼Œç”¨äºæ¥æ”¶ Promise resolve çš„ç»ˆå€¼æˆ–è€… Promise reject çš„åŸå› ã€‚</p>
<blockquote>
<p>è¯¦ç»† <strong>Promise A+ è§„èŒƒ</strong> å‚è€ƒï¼š<a href="https://promisesaplus.com/" target="_blank" rel="external">è‹±æ–‡</a>  <a href="https://malcolmyu.github.io/2015/06/12/Promises-A-Plus/" target="_blank" rel="external">ä¸­æ–‡</a></p>
</blockquote>
<h3 id="Promise-States"><a href="#Promise-States" class="headerlink" title="Promise States"></a>Promise States</h3><ul>
<li>ä¸€ä¸ª Promise çš„å½“å‰çŠ¶æ€å¿…é¡»ä¸ºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¸­çš„ä¸€ç§:<ul>
<li>PENDING</li>
<li>FULFILLED</li>
<li>REJECTED</li>
</ul>
</li>
<li>Promise çš„åˆå§‹çŠ¶æ€ä¸º PENDINGï¼Œç”±æ­¤çŠ¶æ€å¯è½¬æ¢ä¸º FULFILLED æˆ–è€… REJECTEDï¼Œä¸€æ—¦çŠ¶æ€ç¡®å®šï¼Œå°±ä¸èƒ½å†æ¬¡è½¬æ¢ä¸ºå…¶ä»–çŠ¶æ€ï¼Œæ­¤çŠ¶æ€ç§°ä¹‹ä¸º settle</li>
</ul>
<h3 id="then-æ–¹æ³•"><a href="#then-æ–¹æ³•" class="headerlink" title="then æ–¹æ³•"></a><code>then</code> æ–¹æ³•</h3><ul>
<li><p>ä¸€ä¸ª Promise å¿…é¡»æä¾› <code>then</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight mercury"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">promise</span>.<span class="built_in">then</span>(onFulfilled, onRejected)</div></pre></td></tr></table></figure>
</li>
<li><p><code>then</code> æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ª Promise å¯¹è±¡</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">promise2</span> = promise1.then(<span class="literal">on</span>Fulfilled, <span class="literal">on</span>Rejected)</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="The-Promise-Resolution-Procedure"><a href="#The-Promise-Resolution-Procedure" class="headerlink" title="The Promise Resolution Procedure"></a>The Promise Resolution Procedure</h3><p>ä¸åŒå®ç°çš„ Promise éœ€è¦å¯ä»¥æ— ç¼ç›¸äº’è°ƒç”¨(interoperable)ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">//</span> MyPromise è¡¨ç¤ºè‡ªå·±å®ç°çš„ Promise</div><div class="line"><span class="keyword">new</span> MyPromise(<span class="function"><span class="params">(resolve, reject)</span> =&gt;</span> &#123;</div><div class="line">    resolve(<span class="number">1</span>)</div><div class="line">&#125;).<span class="keyword">then</span>(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> Promise.reject(<span class="number">2</span>) <span class="regexp">//</span> ES6 Promise</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="å®ç°-Promise"><a href="#å®ç°-Promise" class="headerlink" title="å®ç° Promise"></a>å®ç° Promise</h2><h3 id="Promise-æ„é€ å‡½æ•°"><a href="#Promise-æ„é€ å‡½æ•°" class="headerlink" title="Promise æ„é€ å‡½æ•°"></a>Promise æ„é€ å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Promise</span> </span>&#123;</div><div class="line">  <span class="comment">// The constructor function</span></div><div class="line">  <span class="keyword">constructor</span> (executor) &#123;</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>._isFunction(executor)) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Promise argument error:'</span> + executor.toString())</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>._status = PENDING</div><div class="line">    <span class="keyword">this</span>._v = <span class="literal">undefined</span></div><div class="line">    <span class="keyword">this</span>._onResolvedCb = []</div><div class="line">    <span class="keyword">this</span>._onRejectedCb = []</div><div class="line"></div><div class="line">    executor(<span class="keyword">this</span>.resolve.bind(<span class="keyword">this</span>), <span class="keyword">this</span>.reject.bind(<span class="keyword">this</span>))</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">  <span class="comment">// æ‰§è¡Œæ“ä½œ...</span></div><div class="line">  <span class="comment">// æ“ä½œæˆåŠŸï¼šè°ƒç”¨ resolveï¼Œä¼ å…¥ value</span></div><div class="line">  resolve(value)</div><div class="line">  <span class="comment">// æ“ä½œå¤±è´¥: è°ƒç”¨ rejectï¼Œä¼ å…¥ reason</span></div><div class="line">  reject(reason)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<ul>
<li>æ„é€ å‡½æ•°ä¸­ï¼Œ<code>_onResolvedCb</code> å’Œ <code>_onRejectedCb</code> å±æ€§åˆ†åˆ«ä¸º Promise resolved/rejected çš„å›è°ƒå‡½æ•°é›†ï¼Œå› ä¸ºåœ¨ Promise ç»“æŸï¼ˆsettleï¼‰ä¹‹å‰ï¼Œå¯èƒ½æœ‰å¤šä¸ª <code>then</code> æŒ‚åœ¨è¯¥ promise ä¸Šï¼Œå³æœ‰å¤šä¸ªå›è°ƒäº‹ä»¶ï¼›</li>
<li>æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª executor å‡½æ•°ï¼Œå‡½æ•°ä¸­çš„æ“ä½œæ‰§è¡Œç»“æŸåï¼Œè‹¥æˆåŠŸï¼Œè°ƒç”¨ resolve å¹¶ä¼ å…¥ valueï¼›è‹¥å¤±è´¥ï¼Œè°ƒç”¨ reject å¹¶ä¼ å…¥ reason</li>
</ul>
<p>æ¥ä¸‹æ¥å®ç° <code>resolve</code> å’Œ <code>reject</code> è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ç±»ä¼¼ï¼Œé¦–å…ˆåˆ¤æ–­å½“å‰ Promise çŠ¶æ€åï¼Œå˜æ›´å…¶çŠ¶æ€ï¼›å¹¶è®°å½• resolved çš„ç»ˆå€¼å’Œ rejected çš„åŸå› ï¼›æœ€åæ‰§è¡Œå›è°ƒå‡½æ•°<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">resolve (value) &#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>._status !== PENDING) &#123;</div><div class="line">    <span class="keyword">return</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">this</span>._status = FULFILLED</div><div class="line">  <span class="keyword">this</span>._v = value</div><div class="line"></div><div class="line">  let fn</div><div class="line">  <span class="keyword">while</span> ((fn = <span class="keyword">this</span>._onResolvedCb.shift())) &#123;</div><div class="line">    fn.call(<span class="keyword">this</span>, value)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">reject (reason) &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="then-æ–¹æ³•-1"><a href="#then-æ–¹æ³•-1" class="headerlink" title="then æ–¹æ³•"></a><code>then</code> æ–¹æ³•</h3><p>Promise å¯¹è±¡çš„ <code>then</code> æ–¹æ³•ç”¨æ¥æ³¨å†Œ Promise resolved æˆ–è€… rejected åçš„å›è°ƒå‡½æ•°ï¼Œ<code>then</code> æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">then (onResolved, onRejected) &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Promise((resolve, reject) =&gt; &#123;</div><div class="line">    <span class="keyword">switch</span> (<span class="keyword">this</span>._status) &#123;</div><div class="line">      <span class="keyword">case</span> <span class="string">PENDING:</span></div><div class="line">        <span class="comment">// ...</span></div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> <span class="string">FULFILLED:</span></div><div class="line">        <span class="comment">// ...</span></div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> <span class="string">REJECTED:</span></div><div class="line">        <span class="comment">// ...</span></div><div class="line">        <span class="keyword">break</span></div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><code>then</code> æ–¹æ³•è¿”å›çš„æ–° Promise å¯¹è±¡ä¸­ï¼Œéœ€è¦æ ¹æ®å‰ä¸€ä¸ª Promise å¯¹è±¡çš„ä¸åŒçŠ¶æ€æ¥å¤„ç†ï¼š<ul>
<li>è‹¥æ˜¯ FULFILLEDï¼Œåˆ™ç›´æ¥æ‰§è¡Œ <code>onResolved</code> å›è°ƒå‡½æ•°ã€‚å¦‚æœ <code>onResolved</code> çš„è¿”å›å€¼åˆæ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ä¹ˆç»§ç»­é€šè¿‡ <code>then</code> æ–¹æ³•æ„é€  Promise é“¾ï¼›å¦åˆ™ï¼Œè°ƒç”¨ <code>resolve</code> å‡½æ•°ç»“æŸæ–°çš„ Promise å¯¹è±¡</li>
<li>è‹¥æ˜¯ REJECTEDï¼Œå¤„ç†é€»è¾‘åŒ FULFILLED</li>
<li>è‹¥æ˜¯ PENDINGï¼Œåˆ™å°† <code>onResolved</code> å’Œ <code>onRejected</code> å›è°ƒå‡½æ•°æ”¾åˆ°å›è°ƒå‡½æ•°é›†ä¸­</li>
</ul>
</li>
</ul>
<p>æœ€ç»ˆå¾—åˆ°å¦‚ä¸‹ç®€æ˜“ç‰ˆæœ¬çš„ <code>then</code> æ–¹æ³•ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">then (onResolved, onRejected) &#123;</div><div class="line">  <span class="comment">// Promise å€¼ç©¿é€</span></div><div class="line">  onResolved = <span class="keyword">this</span>._isFunction(onResolved) ? onResolved : <span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123; <span class="keyword">return</span> v &#125;</div><div class="line">  onRejected = <span class="keyword">this</span>._isFunction(onRejected) ? onRejected : <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123; <span class="keyword">throw</span> r &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">switch</span> (<span class="keyword">this</span>._status) &#123;</div><div class="line">      <span class="keyword">case</span> PENDING:</div><div class="line">        <span class="keyword">this</span>._onResolvedCb.push(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</div><div class="line">          <span class="comment">// æ‰§è¡Œ onResolved æˆ–è€… onRejected å¯èƒ½å‡ºç°å¼‚å¸¸ï¼Œéœ€è¦ try-catch</span></div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">var</span> x = onResolved(value)</div><div class="line">            <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</div><div class="line">              x.then(resolve, reject)</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">              resolve(x)</div><div class="line">            &#125;</div><div class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">            reject(e)</div><div class="line">          &#125;</div><div class="line">        &#125;)</div><div class="line">        <span class="keyword">this</span>._onRejectedCb.push(<span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">var</span> x = onRejected(reason)</div><div class="line">            <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</div><div class="line">              x.then(resolve, reject)</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">              resolve(x)</div><div class="line">            &#125;</div><div class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">            reject(e)</div><div class="line">          &#125;</div><div class="line">        &#125;)</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> FULFILLED:</div><div class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">var</span> x = onResolved(<span class="keyword">this</span>._v)</div><div class="line">            <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</div><div class="line">              x.then(resolve, reject)</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">              resolve(x)</div><div class="line">            &#125;</div><div class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">            reject(e)</div><div class="line">          &#125;</div><div class="line">        &#125;)</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> REJECTED:</div><div class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">var</span> x = onRejected(<span class="keyword">this</span>._v)</div><div class="line">            <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</div><div class="line">              x.then(resolve, reject)</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">              resolve(x)</div><div class="line">            &#125;</div><div class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">            reject(e)</div><div class="line">          &#125;</div><div class="line">        &#125;)</div><div class="line">        <span class="keyword">break</span></div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  <span class="keyword">return</span> promise2</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ä»£ç å‰–ææ³¨æ„ï¼š</strong><br>1ã€<code>then</code> æ–¹æ³•çš„ä¸¤ä¸ªå›è°ƒå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œæ—¶ï¼Œéœ€è¦ <code>try-catch</code> åŒ…èµ·æ¥<br>2ã€Promise å€¼ç©¿é€<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Promise(<span class="function"><span class="params">(resolve, reject)</span> =&gt;</span> &#123;</div><div class="line">  resolve(<span class="number">1</span>)</div><div class="line">&#125;)</div><div class="line">.<span class="keyword">then</span>()</div><div class="line">.<span class="keyword">then</span>(<span class="function"><span class="params">(value)</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'resolve: '</span>, value)</div><div class="line">&#125;, <span class="function"><span class="params">(reason)</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'reject: '</span>, reason)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>å¦‚ä¸Šä»£ç æ­£ç¡®çš„æ‰§è¡Œç»“æœä¸ºè¾“å‡ºï¼š1ï¼›æ³¨æ„åˆ°ç¬¬ä¸€ä¸ª <code>then</code> æ–¹æ³•å¹¶æ²¡æœ‰ä¼ å…¥å›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæç¤ºï¼š<code>TypeError: onResolved is not a function</code>ï¼›åœ¨æ·»åŠ  <code>try-catch</code> åï¼Œå¯ä»¥æ­£å¸¸æ‰§è¡Œï¼›catch åˆ°å¼‚å¸¸åï¼Œæ‰§è¡Œ <code>reject(e)</code>ï¼Œäºæ˜¯ç¬¬äºŒä¸ª <code>then</code> æ–¹æ³•ä¸­çš„ reject å›è°ƒå‡½æ•°æ‰§è¡Œäº†ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­ <code>then</code> æ–¹æ³•ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°æ˜¯å¦ä¸ºå‡½æ•°ï¼Œè‹¥ä¸æ˜¯ï¼Œç›´æ¥è¿”å› value æˆ–è€…æŠ›å‡º reasonã€‚<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">onResolved = <span class="keyword">this</span>._isFunction(onResolved) ? onResolved : <span class="function"><span class="keyword">function</span> <span class="params">(v)</span> </span>&#123; <span class="keyword">return</span> v &#125;</div><div class="line">onRejected = <span class="keyword">this</span>._isFunction(onRejected) ? onRejected : <span class="function"><span class="keyword">function</span> <span class="params">(r)</span> </span>&#123; <span class="keyword">throw</span> r &#125;</div></pre></td></tr></table></figure></p>
<h3 id="ä¸åŒ-Promise-çš„äº¤äº’"><a href="#ä¸åŒ-Promise-çš„äº¤äº’" class="headerlink" title="ä¸åŒ Promise çš„äº¤äº’"></a>ä¸åŒ Promise çš„äº¤äº’</h3><p><code>then</code> æ–¹æ³•ä¼ å…¥çš„ä¸¤ä¸ªå›è°ƒå‡½æ•° <code>onResolved</code> å’Œ <code>onRejected</code> æ‰§è¡Œåï¼Œè¿”å›å€¼ <code>x</code> å¯èƒ½æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œä¹Ÿå³æ˜¯ <code>thenable</code>ï¼Œä¸ºäº†ç¡®ä¿è°ƒç”¨ <code>x</code> ä¸Šçš„ <code>then</code> æ–¹æ³•æˆåŠŸï¼Œæˆ‘ä»¬éœ€è¦å®ç°æ ‡å‡†ä¸­ <strong><a href="https://promisesaplus.com/#the-promise-resolution-procedure" target="_blank" rel="external">2.3.The Promise Resolution Procedure</a></strong> çš„å†…å®¹ï¼Œè¿™æ ·å³ä½¿å®ç°æ–¹å¼ä¸åŒï¼Œä½†éµå¾ªæ ‡å‡†ï¼Œä¸åŒå®ç°çš„ Promise ä¹‹é—´å°±å¯ä»¥äº¤äº’ä½¿ç”¨äº†ã€‚</p>
<p>æ ‡å‡†å¯¹æ­¤è¯´æ˜çš„éå¸¸è¯¦ç»†ï¼Œå¯¹ç…§ç€æ ‡å‡†é˜…è¯»ä»¥ä¸‹ä»£ç ï¼Œæœ‰åŠ©ç†è§£ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// The Promise Resolution Procedure</span></div><div class="line"><span class="comment">// https://promisesaplus.com/#the-promise-resolution-procedure</span></div><div class="line"><span class="keyword">static</span> resolvePromise (promise2, x, resolve, reject) &#123;</div><div class="line">  <span class="keyword">var</span> then</div><div class="line">  <span class="comment">// multiple calls to the same argument are made, the first call takes precedence, and any further calls are ignored</span></div><div class="line">  <span class="keyword">var</span> hasBeenCalled = <span class="literal">false</span></div><div class="line"></div><div class="line">  <span class="comment">// 2.3.1 If promise and x refer to the same object</span></div><div class="line">  <span class="keyword">if</span> (promise2 === x) &#123;</div><div class="line">    reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Chaining cycle detected for promise!'</span>))</div><div class="line">    <span class="keyword">return</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 2.3.2 If x is a promise</span></div><div class="line">  <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (x._status === PENDING) &#123; <span class="comment">// 2.3.2.1</span></div><div class="line">      x.then(<span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123;</div><div class="line">        <span class="built_in">Promise</span>.resolvePromise(promise2, v, resolve, reject)</div><div class="line">      &#125;, reject)</div><div class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 2.3.2.2  2.3.2.3</span></div><div class="line">      x.then(resolve, reject)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 2.3.3 Otherwise, if x is an object or function</span></div><div class="line">  <span class="keyword">if</span> ((x !== <span class="literal">null</span>) &amp;&amp; ((<span class="keyword">typeof</span> x === <span class="string">'object'</span>) || (<span class="keyword">typeof</span> x === <span class="string">'function'</span>))) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      then = x.then <span class="comment">// 2.3.3.1</span></div><div class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123; <span class="comment">// 2.3.3.3</span></div><div class="line">        then.call(x, <span class="function"><span class="keyword">function</span> <span class="title">rs</span> (<span class="params">y</span>) </span>&#123; <span class="comment">// 2.3.3.3.1</span></div><div class="line">          <span class="keyword">if</span> (hasBeenCalled) <span class="keyword">return</span> <span class="comment">// 2.3.3.3.3</span></div><div class="line">          hasBeenCalled = <span class="literal">true</span></div><div class="line">          <span class="built_in">Promise</span>.resolvePromise(promise2, y, resolve, reject)</div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span> <span class="title">rj</span> (<span class="params">r</span>) </span>&#123; <span class="comment">// 2.3.3.3.2</span></div><div class="line">          <span class="keyword">if</span> (hasBeenCalled) <span class="keyword">return</span> <span class="comment">// 2.3.3.3.3</span></div><div class="line">          hasBeenCalled = <span class="literal">true</span></div><div class="line">          reject(r)</div><div class="line">        &#125;)</div><div class="line">      &#125; <span class="keyword">else</span> &#123; <span class="comment">// 2.3.3.4</span></div><div class="line">        resolve(x)</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">catch</span> (e) &#123; <span class="comment">// 2.3.3.2</span></div><div class="line">      <span class="keyword">if</span> (hasBeenCalled) <span class="keyword">return</span> <span class="comment">// 2.3.3.3.4.1</span></div><div class="line">      hasBeenCalled = <span class="literal">true</span></div><div class="line">      reject(e) <span class="comment">// 2.3.3.3.4.2</span></div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 2.3.4</span></div><div class="line">    resolve(x)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨ <code>then</code> æ–¹æ³•ä¸­éœ€è¦ä¿®æ”¹ï¼Œ<code>onResolved</code> å’Œ <code>onRejected</code> æ‰§è¡Œåï¼Œè°ƒç”¨å¦‚ä¸Šçš„ <code>resolvePromise (promise2, x, resolve, reject)</code> æ–¹æ³•<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="keyword">case</span> FULFILLED:</div><div class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      <span class="keyword">var</span> x = onResolved(<span class="keyword">this</span>._v)</div><div class="line">      <span class="built_in">Promise</span>.resolvePromise(promise2, x, resolve, reject)</div><div class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">      reject(e)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  <span class="keyword">break</span></div><div class="line"><span class="keyword">case</span> REJECTED:</div><div class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      <span class="keyword">var</span> x = onRejected(<span class="keyword">this</span>._v)</div><div class="line">      <span class="built_in">Promise</span>.resolvePromise(promise2, x, resolve, reject)</div><div class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">      reject(e)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  <span class="keyword">break</span></div><div class="line">...</div></pre></td></tr></table></figure></p>
<h2 id="Promises-A-test"><a href="#Promises-A-test" class="headerlink" title="Promises/A+ test"></a>Promises/A+ test</h2><p>Promises/A+ è§„èŒƒæä¾›äº†ä¸€ä¸ªæµ‹è¯•è§„èŒƒï¼š <a href="https://github.com/promises-aplus/promises-tests#promisesa-compliance-test-suite" target="_blank" rel="external">promises-aplus/promises-tests</a><br>æµ‹è¯•éœ€è¦æä¾›ä¸€ä¸ª adapter æ–¹æ³• <code>Promise.deferred</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="built_in">Promise</span> <span class="keyword">from</span> <span class="string">'./promise.js'</span></div><div class="line"></div><div class="line"><span class="built_in">Promise</span>.deferred = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> dfd = &#123;&#125;</div><div class="line">  dfd.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">    dfd.resolve = resolve</div><div class="line">    dfd.reject = reject</div><div class="line">  &#125;)</div><div class="line">  <span class="keyword">return</span> dfd</div><div class="line">&#125;</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="built_in">Promise</span></div></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œï¼š<br><figure class="highlight mercury"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">promises-aplus-tests dist/<span class="keyword">promise</span>-adapter.js</div></pre></td></tr></table></figure></p>
<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><ul>
<li>ç®€æ˜“ç‰ˆ(æ²¡æœ‰å®ç° Promises/A+ æ ‡å‡† 2.3.The Promise Resolution Procedure)<br><a href="https://gist.github.com/YingshanDeng/21ef2abab6cede0ae2bcd00986f762fd" target="_blank" rel="external">YingshanDeng / simple-promise.js</a></li>
<li>å®Œæ•´ç‰ˆ(å®Œå…¨é€šè¿‡ Promises/A+ æµ‹è¯•è§„èŒƒ)<br><a href="https://github.com/YingshanDeng/Promise" target="_blank" rel="external">YingshanDeng/Promise</a></li>
</ul>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://github.com/xieranmaya/blog/issues/3" target="_blank" rel="external">å‰–æPromiseå†…éƒ¨ç»“æ„ï¼Œä¸€æ­¥ä¸€æ­¥å®ç°ä¸€ä¸ªå®Œæ•´çš„ã€èƒ½é€šè¿‡æ‰€æœ‰Test caseçš„Promiseç±»</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/Promises:A+.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="Promise" scheme="http://objcer.com/tags/Promise/"/>
    
  </entry>
  
  <entry>
    <title>Javascript DOM äº‹ä»¶æ¨¡å‹</title>
    <link href="http://objcer.com/2017/08/14/Introduction-into-Events/"/>
    <id>http://objcer.com/2017/08/14/Introduction-into-Events/</id>
    <published>2017-08-14T11:39:01.000Z</published>
    <updated>2017-08-14T11:41:13.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/js-event.jpg" alt=""><br><a id="more"></a></p>
<h2 id="Bubbling-and-capturing"><a href="#Bubbling-and-capturing" class="headerlink" title="Bubbling and capturing"></a>Bubbling and capturing</h2><p>Javascript DOM äº‹ä»¶æµå­˜åœ¨å¦‚ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>äº‹ä»¶æ•è·é˜¶æ®µ Capturing phase â€“ <strong>the event goes down to the element.</strong></li>
<li>å¤„äºç›®æ ‡é˜¶æ®µ Target phase â€“ the event reached the target element.</li>
<li>äº‹ä»¶å†’æ³¡é˜¶æ®µ Bubbling phase â€“ <strong>the event bubbles up from the element.</strong></li>
</ul>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/eventflow@2x.png" alt=""></p>
<p><strong>Javascript DOM æ ‡å‡†äº‹ä»¶æµçš„è§¦å‘çš„å…ˆåé¡ºåºä¸ºï¼šå…ˆæ•è·å†å†’æ³¡ã€‚</strong>ç‚¹å‡» <code>&lt;td&gt;</code> DOM èŠ‚ç‚¹æ—¶ï¼Œäº‹ä»¶ä¼ æ’­é¡ºåºï¼šé¦–å…ˆæ˜¯äº‹ä»¶æ•è·é˜¶æ®µï¼Œä»ä¸Šå‘ä¸‹ä¼ æ’­ï¼›ç„¶ååˆ°è¾¾ç‚¹å‡»äº‹ä»¶ç›®æ ‡èŠ‚ç‚¹ï¼›æœ€åæ˜¯å†’æ³¡é˜¶æ®µï¼Œä»ä¸‹å‘ä¸Šä¼ æ’­ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">addEventListener(<span class="string">type:</span> DOMString, <span class="string">callback:</span> EventListener, capture?: <span class="keyword">boolean</span>)</div></pre></td></tr></table></figure>
<p>DOM èŠ‚ç‚¹æ·»åŠ äº‹ä»¶ç›‘å¬æ–¹æ³• <code>addEventListener</code> ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šæ˜¯è¯¥ç›‘å¬æ˜¯æ·»åŠ åœ¨äº‹ä»¶æ•è·é˜¶æ®µæˆ–è€…æ˜¯äº‹ä»¶å†’æ³¡é˜¶æ®µï¼Œé»˜è®¤ä¸º <code>false</code>ï¼Œå³äº‹ä»¶å†’æ³¡é˜¶æ®µï¼›æ˜¾å¼æŒ‡å®šä¸º <code>true</code>ï¼Œå³äº‹ä»¶æ•è·é˜¶æ®µã€‚</p>
<p>å®é™…åº”ç”¨ä¸­ï¼Œä¸º DOM å…ƒç´ æ·»åŠ äº‹ä»¶ç›‘å¬ç»å¤§å¤šæ•°éƒ½æ˜¯æ·»åŠ åˆ°äº‹ä»¶å†’æ³¡é˜¶æ®µï¼Œå¾ˆå°‘ä¼šç”¨åˆ°äº‹ä»¶æ•è·ã€‚æˆ‘ä»¬é€šè¿‡ <code>on&lt;event&gt;-property</code> HTML å±æ€§æ·»åŠ çš„äº‹ä»¶ç›‘å¬é»˜è®¤ä¹Ÿæ˜¯æ·»åŠ åˆ°äº‹ä»¶å†’æ³¡é˜¶æ®µ</p>
<p>æ³¨æ„åˆ°äº‹ä»¶æµå¤„ç†æœ‰ä¸‰ä¸ªé˜¶æ®µï¼Œå…¶ä¸­ç¬¬äºŒä¸ªé˜¶æ®µï¼šå¤„äºç›®æ ‡é˜¶æ®µï¼Œå¹¶ä¸å•ç‹¬å¤„ç†ï¼Œäº‹ä»¶æ•è·é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µçš„æ·»åŠ çš„ç›‘å¬å¤„ç†å°±åŒ…å«äº†è¿™ä¸ªé˜¶æ®µã€‚</p>
<h3 id="å¹¶éæ‰€æœ‰çš„äº‹ä»¶éƒ½æ”¯æŒå†’æ³¡"><a href="#å¹¶éæ‰€æœ‰çš„äº‹ä»¶éƒ½æ”¯æŒå†’æ³¡" class="headerlink" title="å¹¶éæ‰€æœ‰çš„äº‹ä»¶éƒ½æ”¯æŒå†’æ³¡"></a>å¹¶éæ‰€æœ‰çš„äº‹ä»¶éƒ½æ”¯æŒå†’æ³¡</h3><blockquote>
<p>â— <strong>Almost</strong> all events bubble.</p>
</blockquote>
<p>æ³¨æ„å…³é”®å­— â€œalmostâ€ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æ‰€æœ‰çš„äº‹ä»¶éƒ½æ”¯æŒå†’æ³¡ã€‚åœ¨ wiki <a href="https://en.wikipedia.org/wiki/DOM_events#Events" target="_blank" rel="external">DOM_events</a> ä¸­æˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°ä¸€äº›ä¸æ”¯æŒå†’æ³¡çš„äº‹ä»¶ï¼Œä¾‹å¦‚ <code>focus</code>ã€<code>blur</code> ç­‰ç­‰<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">a.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="params">(event)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(event.bubbles) <span class="regexp">//</span> &gt; <span class="literal">true</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line">a.addEventListener(<span class="string">'focus'</span>, <span class="function"><span class="params">(event)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(event.bubbles) <span class="regexp">//</span> &gt; <span class="literal">false</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>event.bubbles</code> æ¥åˆ¤æ–­æ˜¯å¦æ”¯æŒäº‹ä»¶å†’æ³¡</p>
<h3 id="ä¸‰ä¸ªå¸¸ç”¨æ–¹æ³•"><a href="#ä¸‰ä¸ªå¸¸ç”¨æ–¹æ³•" class="headerlink" title="ä¸‰ä¸ªå¸¸ç”¨æ–¹æ³•"></a>ä¸‰ä¸ªå¸¸ç”¨æ–¹æ³•</h3><ul>
<li><p><code>event.stopPropagation</code> é˜»æ­¢æ•è·å’Œå†’æ³¡é˜¶æ®µä¸­å½“å‰äº‹ä»¶çš„è¿›ä¸€æ­¥ä¼ æ’­<br>åœ¨äº‹ä»¶ç›‘å¬å›è°ƒä¸­è°ƒç”¨æ­¤æ–¹æ³•ï¼Œè‹¥æ˜¯æ•è·é˜¶æ®µï¼Œåˆ™åœæ­¢å‘ä¸‹ä¼ é€’äº‹ä»¶ï¼›è‹¥æ˜¯å†’æ³¡é˜¶æ®µï¼Œåˆ™åœæ­¢å‘ä¸Šä¼ é€’äº‹ä»¶ã€‚</p>
</li>
<li><p><code>event.stopImmediatePropagation</code> é˜»æ­¢è°ƒç”¨ç›¸åŒäº‹ä»¶çš„å…¶ä»–ä¾¦å¬å™¨<br>å¦‚æœæŸä¸ªå…ƒç´ æœ‰å¤šä¸ªç›¸åŒç±»å‹äº‹ä»¶çš„äº‹ä»¶ç›‘å¬å‡½æ•°, åˆ™å½“è¯¥ç±»å‹çš„äº‹ä»¶è§¦å‘æ—¶, å¤šä¸ªäº‹ä»¶ç›‘å¬å‡½æ•°å°†æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œ. å¦‚æœæŸä¸ªç›‘å¬å‡½æ•°æ‰§è¡Œäº† <code>event.stopImmediatePropagation()</code> æ–¹æ³•, åˆ™é™¤äº†è¯¥äº‹ä»¶çš„å†’æ³¡è¡Œä¸ºè¢«é˜»æ­¢ä¹‹å¤–(event.stopPropagationæ–¹æ³•çš„ä½œç”¨), è¯¥å…ƒç´ ç»‘å®šçš„ååºç›¸åŒç±»å‹äº‹ä»¶çš„ç›‘å¬å‡½æ•°çš„æ‰§è¡Œä¹Ÿå°†è¢«é˜»æ­¢ã€‚ä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">document</span>.querySelector(<span class="string">"p"</span>).addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span></div><div class="line">    &#123;</div><div class="line">        alert(<span class="string">"æˆ‘æ˜¯på…ƒç´ ä¸Šè¢«ç»‘å®šçš„ç¬¬ä¸€ä¸ªç›‘å¬å‡½æ•°"</span>);</div><div class="line">    &#125;, <span class="literal">false</span>);</div><div class="line">    <span class="built_in">document</span>.querySelector(<span class="string">"p"</span>).addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span></div><div class="line">    &#123;</div><div class="line">        alert(<span class="string">"æˆ‘æ˜¯på…ƒç´ ä¸Šè¢«ç»‘å®šçš„ç¬¬äºŒä¸ªç›‘å¬å‡½æ•°"</span>);</div><div class="line">        event.stopImmediatePropagation();</div><div class="line">        <span class="comment">//æ‰§è¡ŒstopImmediatePropagationæ–¹æ³•,é˜»æ­¢clickäº‹ä»¶å†’æ³¡,å¹¶ä¸”é˜»æ­¢på…ƒç´ ä¸Šç»‘å®šçš„å…¶ä»–clickäº‹ä»¶çš„äº‹ä»¶ç›‘å¬å‡½æ•°çš„æ‰§è¡Œ.</span></div><div class="line">    &#125;, <span class="literal">false</span>);</div><div class="line">    <span class="built_in">document</span>.querySelector(<span class="string">"p"</span>).addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span></div><div class="line">    &#123;</div><div class="line">        alert(<span class="string">"æˆ‘æ˜¯på…ƒç´ ä¸Šè¢«ç»‘å®šçš„ç¬¬ä¸‰ä¸ªç›‘å¬å‡½æ•°"</span>);</div><div class="line">        <span class="comment">//è¯¥ç›‘å¬å‡½æ•°æ’åœ¨ä¸Šä¸ªå‡½æ•°åé¢,è¯¥å‡½æ•°ä¸ä¼šè¢«æ‰§è¡Œ.</span></div><div class="line">    &#125;, <span class="literal">false</span>);</div><div class="line">    <span class="built_in">document</span>.querySelector(<span class="string">"div"</span>).addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span></div><div class="line">    &#123;</div><div class="line">        alert(<span class="string">"æˆ‘æ˜¯divå…ƒç´ ,æˆ‘æ˜¯på…ƒç´ çš„ä¸Šå±‚å…ƒç´ "</span>);</div><div class="line">        <span class="comment">//på…ƒç´ çš„clickäº‹ä»¶æ²¡æœ‰å‘ä¸Šå†’æ³¡,è¯¥å‡½æ•°ä¸ä¼šè¢«æ‰§è¡Œ.</span></div><div class="line">    &#125;, <span class="literal">false</span>);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p><code>event.preventDefault</code> å¦‚æœäº‹ä»¶å¯å–æ¶ˆï¼Œåˆ™å–æ¶ˆè¯¥äº‹ä»¶ï¼Œè€Œä¸åœæ­¢äº‹ä»¶çš„è¿›ä¸€æ­¥ä¼ æ’­ã€‚</p>
<ul>
<li>åœ¨äº‹ä»¶è§¦å‘åçš„ä»»ä½•é˜¶æ®µè°ƒç”¨ <code>preventDefault</code> æ–¹æ³•æ¥å–æ¶ˆè¯¥äº‹ä»¶, <strong>æ„å‘³ç€è¯¥äº‹ä»¶çš„æ‰€æœ‰é»˜è®¤åŠ¨ä½œéƒ½ä¸ä¼šå‘ç”Ÿ.</strong> ä¾‹å¦‚å¯ä»¥åˆ©ç”¨ <code>preventDefault()</code> æ–¹æ³•æ¥é˜»æ­¢ä¸€ä¸ª <code>input</code> å…ƒç´ å†…éæ³•å­—ç¬¦çš„è¾“å…¥ç­‰ç­‰</li>
<li>è°ƒç”¨äº‹ä»¶çš„ <code>preventDefault()</code> æ–¹æ³•å,ä¼šå¼•èµ·è¯¥äº‹ä»¶çš„ <code>event.defaultPrevented</code> å±æ€§å€¼å˜ä¸º <code>true</code></li>
<li>å¯ä»¥æŸ¥çœ‹ <code>event.cancelable</code> å±æ€§æ¥åˆ¤æ–­ä¸€ä¸ªäº‹ä»¶çš„é»˜è®¤åŠ¨ä½œæ˜¯å¦å¯ä»¥è¢«å–æ¶ˆ. åœ¨ <code>cancelable</code> å±æ€§ä¸º <code>false</code> çš„äº‹ä»¶ä¸Šè°ƒç”¨ <code>preventDefault</code> æ–¹æ³•æ²¡æœ‰ä»»ä½•æ•ˆæœ</li>
<li><code>preventDefault</code> æ–¹æ³•<strong>ä¸ä¼šé˜»æ­¢è¯¥äº‹ä»¶çš„è¿›ä¸€æ­¥å†’æ³¡</strong>. <code>event.stopPropagation</code> æ–¹æ³•æ‰æœ‰è¿™æ ·çš„åŠŸèƒ½</li>
</ul>
</li>
</ul>
<h3 id="event-target-å’Œ-event-currentTarget"><a href="#event-target-å’Œ-event-currentTarget" class="headerlink" title="event.target å’Œ event.currentTarget"></a><code>event.target</code> å’Œ <code>event.currentTarget</code></h3><blockquote>
<p>The most deeply nested element that caused the event is called a target element, accessible as event.target.<br>Note the differences from this (=event.currentTarget):</p>
<ul>
<li>event.target â€“ is the â€œtargetâ€ element that initiated the event, it doesnâ€™t change through the bubbling process.</li>
<li>this â€“ is the â€œcurrentâ€ element, the one that has a currently running handler on it.</li>
</ul>
</blockquote>
<ul>
<li><code>event.target</code> â€“ æŒ‡å‘è§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼Œåœ¨äº‹ä»¶å†’æ³¡è¿‡ç¨‹ä¸­è¯¥å€¼ä¸å˜</li>
<li><code>event.currentTarget</code> = this â€“ äº‹ä»¶ç»‘å®šçš„å½“å‰å…ƒç´ </li>
</ul>
<p>åªæœ‰è¢«ç‚¹å‡»çš„é‚£ä¸ªç›®æ ‡å…ƒç´ çš„ <code>event.target</code> æ‰ä¼šç­‰äº <code>event.currentTarget</code>ï¼Œçœ‹å¦‚ä¸‹ä¾‹å­<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"outer"</span>&gt;</span></div><div class="line">  outer</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>inner<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="keyword">var</span> outerEl = <span class="built_in">document</span>.querySelector(<span class="string">'.outer'</span>);</div><div class="line">  <span class="keyword">var</span> innerEl = <span class="built_in">document</span>.querySelector(<span class="string">'.inner'</span>);</div><div class="line"></div><div class="line">  innerEl.addEventListener(<span class="string">'click'</span>, (event) =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'inner'</span>, event.target, event.currentTarget)</div><div class="line">  &#125;);</div><div class="line">  outerEl.addEventListener(<span class="string">'click'</span>, (event) =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'outer'</span>, event.target, event.currentTarget)</div><div class="line">  &#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>ç‚¹å‡» inner èŠ‚ç‚¹ï¼Œæ‰§è¡Œç»“æœï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">inner &lt;<span class="keyword">div</span> <span class="built_in">class</span>=â€‹<span class="string">"inner"</span>&gt;â€‹innerâ€‹&lt;/<span class="keyword">div</span>&gt;â€‹ &lt;<span class="keyword">div</span> <span class="built_in">class</span>=â€‹<span class="string">"inner"</span>&gt;â€‹innerâ€‹&lt;/<span class="keyword">div</span>&gt;â€‹</div><div class="line">outer &lt;<span class="keyword">div</span> <span class="built_in">class</span>=â€‹<span class="string">"inner"</span>&gt;â€‹innerâ€‹&lt;/<span class="keyword">div</span>&gt;â€‹ &lt;<span class="keyword">div</span> <span class="built_in">class</span>=â€‹<span class="string">"outer"</span>&gt;â€‹â€¦â€‹&lt;/<span class="keyword">div</span>&gt;â€‹</div></pre></td></tr></table></figure></p>
<h2 id="æ‰§è¡Œé¡ºåºçš„é—®é¢˜"><a href="#æ‰§è¡Œé¡ºåºçš„é—®é¢˜" class="headerlink" title="æ‰§è¡Œé¡ºåºçš„é—®é¢˜"></a>æ‰§è¡Œé¡ºåºçš„é—®é¢˜</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒJavascript DOM æ ‡å‡†äº‹ä»¶æµçš„è§¦å‘çš„å…ˆåé¡ºåºä¸ºï¼šå…ˆæ•è·å†å†’æ³¡ã€‚å¦‚æœ DOM èŠ‚ç‚¹åŒæ—¶ç»‘å®šä¸¤ä¸ªäº‹ä»¶ç›‘å¬ï¼Œä¸€ä¸ªç”¨äºæ•è·é˜¶æ®µï¼Œä¸€ä¸ªç”¨äºå†’æ³¡é˜¶æ®µï¼Œä¸¤ä¸ªäº‹ä»¶çš„æ‰§è¡Œé¡ºåºçœŸçš„å¦‚æ­¤ä¹ˆï¼Ÿ<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"outer"</span>&gt;</div><div class="line">  element1</div><div class="line">  &lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"inner"</span>&gt;element2&lt;/<span class="keyword">div</span>&gt;</div><div class="line">&lt;/<span class="keyword">div</span>&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-----------------------------------</div><div class="line">|<span class="string"> element1                        </span>|</div><div class="line">|<span class="string">   -------------------------     </span>|</div><div class="line">|<span class="string">   </span>|<span class="string">element2               </span>|<span class="string">     </span>|</div><div class="line">|<span class="string">   -------------------------     </span>|</div><div class="line">|<span class="string">                                 </span>|</div><div class="line">-----------------------------------</div></pre></td></tr></table></figure>
<p>åˆ†åˆ«ä¸ºå†…å¤–ä¸¤ä¸ªå…ƒç´ æ·»åŠ ä¸¤ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œä¸€ä¸ªç”¨äºæ•è·é˜¶æ®µï¼Œä¸€ä¸ªç”¨äºå†’æ³¡é˜¶æ®µ<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">  var outerEl = <span class="built_in">document</span>.querySelector(<span class="string">'.outer'</span>);</div><div class="line">  var innerEl = <span class="built_in">document</span>.querySelector(<span class="string">'.inner'</span>);</div><div class="line"></div><div class="line">  innerEl.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="params">(event)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'child bubble'</span>)</div><div class="line">  &#125;, <span class="literal">false</span>);</div><div class="line">  innerEl.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="params">(event)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'child capture'</span>)</div><div class="line">  &#125;, <span class="literal">true</span>);</div><div class="line"></div><div class="line">  outerEl.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="params">(event)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'parent bubble'</span>)</div><div class="line">  &#125;, <span class="literal">false</span>);</div><div class="line">  outerEl.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="params">(event)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'parent capture'</span>)</div><div class="line">  &#125;, <span class="literal">true</span>);</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>æ ¹æ®å‰é¢çš„çŸ¥è¯†ï¼Œå½“ç‚¹å‡» element2 å…ƒç´ å’Œ element1 å…ƒç´ çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥ä¼šå¾—åˆ°ï¼š<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ç‚¹å‡» element2 å…ƒç´ </span></div><div class="line"><span class="keyword">parent</span> capture</div><div class="line">child capture</div><div class="line">child bubble</div><div class="line"><span class="keyword">parent</span> bubble</div><div class="line"></div><div class="line"><span class="comment">#ç‚¹å‡» element1 å…ƒç´ </span></div><div class="line"><span class="keyword">parent</span> capture</div><div class="line"><span class="keyword">parent</span> bubble</div></pre></td></tr></table></figure></p>
<p><strong>â—ï¸ä½†æ˜¯ï¼Œ</strong>å®é™…ä¸Šæˆ‘ä»¬ç‚¹å‡» element2 å’Œç‚¹å‡» element1 çš„æ—¶å€™ï¼Œå¾—åˆ°çš„ç»“æœå´æ˜¯ï¼ˆå…¶ä¸­éƒ½å‡ºç°äº†å…ˆ bubble å captureï¼‰ï¼š<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ç‚¹å‡» element2</span></div><div class="line"><span class="keyword">parent</span> capture</div><div class="line">child bubble</div><div class="line">child capture</div><div class="line"><span class="keyword">parent</span> bubble</div><div class="line"></div><div class="line"><span class="comment"># ç‚¹å‡» element1</span></div><div class="line"><span class="keyword">parent</span> bubble</div><div class="line"><span class="keyword">parent</span> capture</div></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™è·Ÿå‰é¢çš„ç»“è®ºä¸ç¬¦å•Š ğŸ¤” é€šè¿‡è§‚å¯Ÿæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š<br>â‘  DOM å…ƒç´ å…ˆæ·»åŠ äº†ç”¨äºå†’æ³¡é˜¶æ®µçš„äº‹ä»¶ç›‘å¬ï¼Œåæ·»åŠ äº†ç”¨äºæ•è·é˜¶æ®µçš„äº‹ä»¶ç›‘å¬<br>â‘¡ è¢«ç‚¹å‡»å…ƒç´ å…ˆæ‰§è¡Œäº†å†’æ³¡é˜¶æ®µçš„äº‹ä»¶ç›‘å¬ï¼Œåæ‰§è¡Œæ•è·é˜¶æ®µçš„äº‹ä»¶ç›‘å¬ï¼›è€Œç‚¹å‡»äº‹ä»¶çš„çˆ¶èŠ‚ç‚¹äº‹ä»¶ç›‘å¬æ‰§è¡Œé¡ºåºæ­£å¸¸<br>â‘¢ æˆ‘ä»¬çŒœæµ‹æ˜¯å¦è·Ÿäº‹ä»¶ç›‘å¬æ·»åŠ é¡ºåºæœ‰å…³ç³»ï¼Œæˆ‘ä»¬è°ƒæ¢ä¸€ä¸‹æ·»åŠ é¡ºåºï¼š<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">  var outerEl = <span class="built_in">document</span>.querySelector(<span class="string">'.outer'</span>);</div><div class="line">  var innerEl = <span class="built_in">document</span>.querySelector(<span class="string">'.inner'</span>);</div><div class="line"></div><div class="line">  innerEl.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="params">(event)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'child bubble'</span>)</div><div class="line">  &#125;, <span class="literal">true</span>);</div><div class="line">  innerEl.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="params">(event)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'child capture'</span>)</div><div class="line">  &#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line">  outerEl.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="params">(event)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'parent bubble'</span>)</div><div class="line">  &#125;, <span class="literal">true</span>);</div><div class="line">  outerEl.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="params">(event)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'parent capture'</span>)</div><div class="line">  &#125;, <span class="literal">false</span>);</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>å‘ç°æ‰§è¡Œå¾—åˆ°çš„ç»“æœæ­£å¸¸</p>
<p><strong>â—ï¸ç»™å‡ºç»“è®ºï¼š</strong></p>
<ul>
<li>ç»‘å®šåœ¨è¢«ç‚¹å‡»å…ƒç´ çš„äº‹ä»¶æ˜¯æŒ‰ç…§ä»£ç æ·»åŠ é¡ºåºæ‰§è¡Œï¼Œå…¶ä»–å…ƒç´ å…ˆæ•è·åå†’æ³¡</li>
<li><strong>æ‰€ä»¥äº‹ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼šçˆ¶å…ƒç´ çš„æ•è·é˜¶æ®µäº‹ä»¶ -&gt; è§¦å‘äº‹ä»¶å…ƒç´ æŒ‰ä»£ç æ·»åŠ é¡ºåºçš„äº‹ä»¶ -&gt; çˆ¶å…ƒç´ çš„å†’æ³¡é˜¶æ®µäº‹ä»¶</strong></li>
</ul>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://javascript.info/bubbling-and-capturing" target="_blank" rel="external">Bubbling and capturing</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/js-event.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="JS" scheme="http://objcer.com/categories/JS/"/>
    
    
      <category term="äº‹ä»¶æ•è·" scheme="http://objcer.com/tags/%E4%BA%8B%E4%BB%B6%E6%8D%95%E8%8E%B7/"/>
    
      <category term="äº‹ä»¶å†’æ³¡" scheme="http://objcer.com/tags/%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1/"/>
    
  </entry>
  
  <entry>
    <title>æ¢ç©¶ emoji å­—ç¬¦é•¿åº¦</title>
    <link href="http://objcer.com/2017/07/20/explore-emoji-length/"/>
    <id>http://objcer.com/2017/07/20/explore-emoji-length/</id>
    <published>2017-07-20T11:41:38.000Z</published>
    <updated>2017-07-20T11:46:24.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/C0E1DEF1-900B-4372-B8CB-B166A1ABBA57.png" alt=""><br>æˆ‘ä»¬æ³¨æ„åˆ°åœ¨ Twitterï¼Œå¾®åšï¼Œè°·æ­Œç¿»è¯‘çš„è¾“å…¥æ¡†ä¸­è¾“å…¥ emoji å­—ç¬¦ï¼Œéƒ½ä¸èƒ½æ­£ç¡®çš„åˆ¤æ–­å­—ç¬¦ä¸ªæ•°ã€‚ğŸ¤·â€<br>åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œéœ€è¦å…ˆå¯¹ Unicode ç¼–ç æœ‰æ‰€äº†è§£ï¼Œå‚è€ƒ: <a href="http://objcer.com/2017/05/21/JavaScript-Unicode/">JavaScript Unicode ç¼–ç é‚£äº›äº‹</a></p>
<a id="more"></a>
<h2 id="String-length-Char-count"><a href="#String-length-Char-count" class="headerlink" title="String length != Char count"></a>String length != Char count</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="string">'ğŸ˜‚'</span><span class="selector-class">.length</span> <span class="comment">// 2</span></div><div class="line"><span class="string">'1ï¸âƒ£'</span><span class="selector-class">.length</span> <span class="comment">// 3</span></div><div class="line"><span class="string">'ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦'</span><span class="selector-class">.length</span> <span class="comment">// 8</span></div><div class="line"><span class="string">'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦'</span><span class="selector-class">.length</span> <span class="comment">// 11</span></div></pre></td></tr></table></figure>
<h2 id="å…³äº-Unicode"><a href="#å…³äº-Unicode" class="headerlink" title="å…³äº Unicode"></a>å…³äº Unicode</h2><p>Unicode ç¼–ç èŒƒå›´æ˜¯ä» U+0000 åˆ° U+10FFFFï¼Œæ¯ä¸€ä¸ªç¼–ç ï¼ˆä¹Ÿç§°ä¹‹ä¸ºç ä½ code pointï¼‰è¡¨ç¤ºä¸€ä¸ª Unicode å­—ç¬¦ï¼›è€Œè¿™ä¹ˆå¤šç ä½æœ‰åˆ’åˆ†æˆ 17 ä¸ªå¹³é¢ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå¹³é¢(U+0000 ~ U+FFFF): åŸºæœ¬å¹³é¢(Basic Multilingual Plane - <em>BMP</em>)</li>
<li>å…¶ä»– 16 ä¸ªå¹³é¢(U+100000 ~ U+10FFFF): è¡¥å……å¹³é¢(Supplementary Planes)</li>
</ul>
<p>å…¶ä¸­ emoji ä½œä¸ºä¸€ç§ç‰¹æ®Šç¼–ç åœ¨è¡¥å……å¹³é¢ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">'ğŸ˜€'<span class="string">.codePointAt</span><span class="params">(0)</span><span class="string">.toString</span><span class="params">(16)</span> <span class="string">//</span> 0x1f600</div><div class="line">'ğŸ˜‚'<span class="string">.codePointAt</span><span class="params">(0)</span><span class="string">.toString</span><span class="params">(16)</span> <span class="string">//</span> 0x1f602</div></pre></td></tr></table></figure></p>
<h2 id="å…³äº-emoji"><a href="#å…³äº-emoji" class="headerlink" title="å…³äº emoji"></a>å…³äº emoji</h2><blockquote>
<p>An Emoji as we know it today <strong>is defined by at least one code point</strong> in the Unicode range. This means that there are also several Emoji out there being a combination of several different Emoji and code points. These combinations are called <strong>sequences</strong>.</p>
</blockquote>
<p>ä¸€ä¸ª emoji å­—ç¬¦è‡³å°‘ç”±ä¸€ä¸ªç ä½è¡¨ç¤ºï¼Œä¸€ä¸ª emoji æœ‰å¤šä¸ªç ä½è¡¨ç¤ºçš„æˆ‘ä»¬ç§°ä¹‹ä¸ºåºåˆ—(sequences)ã€‚å¯ä»¥åœ¨ <a href="http://unicode.org/emoji/charts/full-emoji-list.html" target="_blank" rel="external">Full Emoji List</a> é¡µé¢æŸ¥çœ‹åˆ°æ‰€æœ‰ emoji çš„ç¼–ç ä¿¡æ¯<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/5E88BF15-66B7-4A32-9125-B3E019C52E9C.png" alt=""></p>
<p>åœ¨ JavaScript ä¸­ <code>String.length</code> è®¡ç®—å­—ç¬¦é•¿åº¦æ—¶ï¼Œè®¤ä¸ºä¸¤ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ä¸€ä¸ªåŸºæœ¬å¹³é¢ä¸Šçš„å­—ç¬¦é•¿åº¦éƒ½ä¸º 1ï¼›è€Œä¸€ä¸ªè¡¥å……å¹³é¢ä¸Šçš„å­—ç¬¦ä½¿ç”¨ä»£ç†å¯¹ï¼Œç”±å››ä¸ªå­—ç¬¦è¡¨ç¤ºï¼Œæ‰€ä»¥é•¿åº¦ä¸º 2ï¼›<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// a: 0x61</span></div><div class="line"><span class="string">'a'</span><span class="selector-class">.lenght</span> <span class="comment">// 1</span></div><div class="line"></div><div class="line"><span class="comment">//ğŸ’©: U+d83d U+dca9</span></div><div class="line"><span class="string">'ğŸ’©'</span><span class="selector-class">.length</span> <span class="comment">// 2</span></div><div class="line"></div><div class="line"><span class="comment">// '1ï¸âƒ£': U+0031 U+FE0F U+20E3</span></div><div class="line"><span class="string">'1ï¸âƒ£'</span><span class="selector-class">.length</span> <span class="comment">// 3</span></div></pre></td></tr></table></figure></p>
<h3 id="Modifier-sequences"><a href="#Modifier-sequences" class="headerlink" title="Modifier sequences"></a>Modifier sequences</h3><p><img src="http://7vikhl.com1.z0.glb.clouddn.com/480D3F20-0262-40E4-B7C6-E068A9958692.png" alt=""><br>æˆ‘ä»¬æ³¨æ„éƒ¨åˆ†äººç±»ç›¸å…³çš„ <strong>Human emoji</strong> å¯ä»¥é€‰æ‹©å…¶ä»– 5 ç§ä¸åŒçš„è‚¤è‰²(<strong>Skin color</strong>)ï¼Œé»˜è®¤é¢œè‰²çš„ emoji ç§°ä¹‹ä¸º <strong>neutral emoji</strong>ï¼Œä¸åŒè‚¤è‰²ç§°ä¹‹ä¸º <strong>modifier</strong>ï¼Œè¿™äº›ä¸åŒè‚¤è‰²çš„ emoji æˆ‘ä»¬ç§°ä¹‹ä¸º <strong>Modifier sequences</strong>ã€‚</p>
<blockquote>
<p>These modifiers are called EMOJI MODIFIER FITZPATRICK TYPE-1-2, -3, -4, -5, and -6 (U+1F3FBâ€“U+1F3FF): ğŸ» ğŸ¼ ğŸ½ ğŸ¾ ğŸ¿</p>
</blockquote>
<table>
<thead>
<tr>
<th>Code point</th>
<th>default</th>
<th>FITZ-1-2(U+1F3FB)</th>
<th>FITZ-3(U+1F3FC)</th>
<th>FITZ-4(U+1F3FD)</th>
<th>FITZ-5(U+1F3FE)</th>
<th>FITZ-6(U+1F3FF)</th>
</tr>
</thead>
<tbody>
<tr>
<td>U+1F466: BOY</td>
<td>ğŸ‘¦</td>
<td>ğŸ‘¦ğŸ»</td>
<td>ğŸ‘¦ğŸ¼</td>
<td>ğŸ‘¦ğŸ½</td>
<td>ğŸ‘¦ğŸ¾</td>
<td>ğŸ‘¦ğŸ¿</td>
</tr>
<tr>
<td>U+1F467: GIRL</td>
<td>ğŸ‘§</td>
<td>ğŸ‘§ğŸ»</td>
<td>ğŸ‘§ğŸ¼</td>
<td>ğŸ‘§ğŸ½</td>
<td>ğŸ‘§ğŸ¾</td>
<td>ğŸ‘§ğŸ¿</td>
</tr>
<tr>
<td>U+1F468: MAN</td>
<td>ğŸ‘¨</td>
<td>ğŸ‘¨ğŸ»</td>
<td>ğŸ‘¨ğŸ¼</td>
<td>ğŸ‘¨ğŸ½</td>
<td>ğŸ‘¨ğŸ¾</td>
<td>ğŸ‘¨ğŸ¿</td>
</tr>
<tr>
<td>U+1F469: WOMAN</td>
<td>ğŸ‘©</td>
<td>ğŸ‘©ğŸ»</td>
<td>ğŸ‘©ğŸ¼</td>
<td>ğŸ‘©ğŸ½</td>
<td>ğŸ‘©ğŸ¾</td>
<td>ğŸ‘©ğŸ¿</td>
</tr>
</tbody>
</table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// U+1F467 + U+1F3FD</div><div class="line">ğŸ‘§ + ğŸ½</div><div class="line"><span class="meta">&gt;</span><span class="bash"> ğŸ‘§ğŸ½</span></div></pre></td></tr></table></figure>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/E3F5C223-E3E9-4ECC-AD67-DF09D6D62DD6.png" alt=""></p>
<p>æ˜æ˜¾çš„ï¼Œè¿™ç±» emoji çš„é€šè¿‡ <code>String.length</code> è·å–é•¿åº¦ä¸º <strong>4</strong></p>
<h3 id="ZWJ-sequences"><a href="#ZWJ-sequences" class="headerlink" title="ZWJ sequences"></a>ZWJ sequences</h3><p>æ¥ä¸‹æ¥é‡Œäº†è§£ä¸€ä¸‹ <strong>family emoji</strong>ï¼Œè­¬å¦‚æˆ‘ä»¬å¸¸è§çš„ï¼šä¸‰å£ä¹‹å®¶ï¼šğŸ‘ªï¼Œå››å£ä¹‹å®¶ï¼šğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ï¼Œç­‰ç­‰ï¼›å…¶ä¸­å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>æœ‰ä¸€ä¸ª neutral family emoji (U+1F46A - â€ğŸ‘ª) ç”±ä¸€ä¸ªç ä½è¡¨ç¤º</li>
<li>è€Œå…¶ä»– family emoji éƒ½æ˜¯ <strong>Zero-Width-Joiner sequence</strong>ï¼›å®ƒä»¬ç”±å¤šä¸ª emoji å’Œ zero-width-joiner (U+200D) ç»„åˆè€Œæˆ</li>
</ul>
<p>æ³¨ï¼šzero-width-joiner (U+200D) è¿™ä¸ªç ä½å°±å¦‚åŒèƒ¶æ°´ä¸€èˆ¬å°†ä¸åŒçš„ emoji ç»„åˆæˆä¸€ä¸ª emojiï¼›zero-width-joiner (U+200D) åªå ä¸€ä¸ªé•¿åº¦<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// neutral family</div><div class="line">// U<span class="string">+1</span>F46A</div><div class="line">// length: 2</div><div class="line">&gt; ğŸ‘ª</div><div class="line"></div><div class="line">// ZWJ sequence: family (man, woman, boy)</div><div class="line">// U<span class="string">+1</span>F468 + U<span class="string">+200</span>D + U<span class="string">+1</span>F469 + U<span class="string">+200</span>D + U<span class="string">+1</span>F466</div><div class="line">// ğŸ‘¨â€ + U<span class="string">+200</span>D + ğŸ‘©â€ + U<span class="string">+200</span>D + ğŸ‘¦</div><div class="line">// length: 8</div><div class="line">&gt; â€ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦</div><div class="line"></div><div class="line">// ZWJ sequence: family (woman, woman, girl)</div><div class="line">// U<span class="string">+1</span>F469 + U<span class="string">+200</span>D + U<span class="string">+1</span>F469 + U<span class="string">+200</span>D + U<span class="string">+1</span>F467</div><div class="line">// ğŸ‘©â€ + U<span class="string">+200</span>D + ğŸ‘©â€ U<span class="string">+200</span>D + ğŸ‘§</div><div class="line">// length: 8</div><div class="line">&gt; â€ğŸ‘©â€ğŸ‘©â€ğŸ‘§</div><div class="line"></div><div class="line">// ZWJ sequence: family (woman, woman, girl, girl)</div><div class="line">// U<span class="string">+1</span>F469 + U<span class="string">+200</span>D + U<span class="string">+1</span>F469 + U<span class="string">+200</span>D + U<span class="string">+1</span>F467 + U<span class="string">+200</span>D + U<span class="string">+1</span>F467</div><div class="line">// ğŸ‘©â€ + U<span class="string">+200</span>D + ğŸ‘©â€ + U<span class="string">+200</span>D + ğŸ‘§â€ + U<span class="string">+200</span>D + ğŸ‘§</div><div class="line">// length: 11</div><div class="line">&gt; â€ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§</div></pre></td></tr></table></figure></p>
<p>æ‹†åˆ†ï¼Œç»„åˆ family emojiï¼š<br><figure class="highlight prolog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[...<span class="string">'ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦'</span>]</div><div class="line">&gt;  [<span class="string">"ğŸ‘¨"</span>, <span class="string">"â€"</span>, <span class="string">"ğŸ‘©"</span>, <span class="string">"â€"</span>, <span class="string">"ğŸ‘¦"</span>]</div><div class="line"></div><div class="line">var family =  [<span class="string">"ğŸ‘¨"</span>, <span class="string">"â€"</span>, <span class="string">"ğŸ‘©"</span>, <span class="string">"â€"</span>, <span class="string">"ğŸ‘¦"</span>]</div><div class="line">console.log(family.join(<span class="string">''</span>))</div><div class="line">&gt; <span class="string">"ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦"</span></div></pre></td></tr></table></figure></p>
<h2 id="è§£å†³å­—ç¬¦é•¿åº¦ç»ˆæè§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³å­—ç¬¦é•¿åº¦ç»ˆæè§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³å­—ç¬¦é•¿åº¦ç»ˆæè§£å†³æ–¹æ¡ˆ"></a>è§£å†³å­—ç¬¦é•¿åº¦ç»ˆæè§£å†³æ–¹æ¡ˆ</h2><p>æˆ‘ä»¬æ‰¾åˆ°ä¸€æ®µæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥ç”¨äºåŒ¹é… Unicode å­—ç¬¦ï¼›ç„¶åå°è£…æˆ <a href="https://github.com/YingshanDeng/EmojiCharString" target="_blank" rel="external">EmojiCharString</a> ç±»åº“ï¼Œè¯¦ç»†ä»‹ç»å‚è€ƒè¯¥ä»“åº“ README ğŸ‘‰</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://mathiasbynens.be/notes/javascript-unicode" target="_blank" rel="external">JavaScript has a Unicode problem</a><br><a href="https://www.contentful.com/blog/2016/12/06/unicode-javascript-and-the-emoji-family/" target="_blank" rel="external">Emoji.prototype.length â€” a tale of characters in Unicode</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/C0E1DEF1-900B-4372-B8CB-B166A1ABBA57.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;æˆ‘ä»¬æ³¨æ„åˆ°åœ¨ Twitterï¼Œå¾®åšï¼Œè°·æ­Œç¿»è¯‘çš„è¾“å…¥æ¡†ä¸­è¾“å…¥ emoji å­—ç¬¦ï¼Œéƒ½ä¸èƒ½æ­£ç¡®çš„åˆ¤æ–­å­—ç¬¦ä¸ªæ•°ã€‚ğŸ¤·â€&lt;br&gt;åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œéœ€è¦å…ˆå¯¹ Unicode ç¼–ç æœ‰æ‰€äº†è§£ï¼Œå‚è€ƒ: &lt;a href=&quot;http://objcer.com/2017/05/21/JavaScript-Unicode/&quot;&gt;JavaScript Unicode ç¼–ç é‚£äº›äº‹&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Unicode" scheme="http://objcer.com/categories/Unicode/"/>
    
    
      <category term="unicode-emoji" scheme="http://objcer.com/tags/unicode-emoji/"/>
    
  </entry>
  
  <entry>
    <title>Cordova å¼€å‘ç¯å¢ƒ - Android ç¯‡</title>
    <link href="http://objcer.com/2017/07/03/cordova-android-development-environment/"/>
    <id>http://objcer.com/2017/07/03/cordova-android-development-environment/</id>
    <published>2017-07-03T14:14:19.000Z</published>
    <updated>2017-07-20T11:46:24.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/android-banner.jpg" alt=""><br><a id="more"></a></p>
<h2 id="å®‰è£…-IDE-Android-Studio"><a href="#å®‰è£…-IDE-Android-Studio" class="headerlink" title="å®‰è£… IDE (Android Studio)"></a>å®‰è£… IDE (Android Studio)</h2><p>å®‰è£… Android Studio, SDK, Android Virtual Device (AVDï¼Œå®‰å“æ¨¡æ‹Ÿå™¨)</p>
<ul>
<li>ä¸‹è½½é“¾æ¥ï¼š<a href="https://developer.android.com/studio/index.html?hl=zh-cn" target="_blank" rel="external">Android Studio</a></li>
<li>ä¸‹è½½å®‰è£…å…¨ç¨‹éœ€è¦<strong>ç¿»å¢™</strong></li>
<li>å®‰è£… Android Studio å®Œæˆåï¼Œåˆ›å»ºä¸€ä¸ª HelloWorld ç¨‹åºåˆ°æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒæŒ‰ç…§æç¤ºè¿›è¡Œä¸‹è½½å®‰è£…å³å¯</li>
</ul>
<h2 id="çœŸæœºè¿è¡Œ"><a href="#çœŸæœºè¿è¡Œ" class="headerlink" title="çœŸæœºè¿è¡Œ"></a>çœŸæœºè¿è¡Œ</h2><p>æ‰‹æœºé€šè¿‡ USB è¿æ¥ç”µè„‘åï¼Œè¿è¡Œæ—¶ï¼Œé€‰æ‹©å¯¹åº”çš„è®¾å¤‡å³å¯è¿è¡Œï¼Œä»¥ä¸‹ç½—åˆ—å‡ ç‚¹çœŸæœºè¿è¡Œä¸­é‡åˆ°çš„é—®é¢˜å’ŒæŠ€å·§</p>
<h3 id="è§£å†³ï¼šDELETE-FAILED-INTERNAL-ERROR-Error-while-Installing-APK"><a href="#è§£å†³ï¼šDELETE-FAILED-INTERNAL-ERROR-Error-while-Installing-APK" class="headerlink" title="è§£å†³ï¼šDELETE_FAILED_INTERNAL_ERROR Error while Installing APK"></a>è§£å†³ï¼š<em>DELETE_FAILED_INTERNAL_ERROR Error while Installing APK</em></h3><p>å®‰å“çœŸæœºï¼ˆå°ç±³4Cï¼‰é€šè¿‡ USB è¿æ¥ç”µè„‘åï¼Œè¿è¡Œï¼Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹é—®é¢˜ï¼š<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/3B19ED97-CE3F-45A9-8518-C08D779F7FA3.png" alt=""><br>ç‚¹å‡» OK ç»§ç»­ï¼Œä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">DELETE_FAILED_INTERNAL_ERROR</div><div class="line"><span class="keyword">Error </span>while Installing APKs</div></pre></td></tr></table></figure></p>
<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://stackoverflow.com/questions/38892270/delete-failed-internal-error-error-while-installing-apk" target="_blank" rel="external">DELETE_FAILED_INTERNAL_ERROR Error while Installing APK</a> å¤§è‡´æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>æ“ä½œæ­¥éª¤ï¼šAndroid Studio &gt; Preferences &gt;  Build, Execution, Deployment &gt; Instant Run &gt; <strong>Uncheck : Enable Instant Run</strong>ï¼ˆæ­¤å¤„ç†æ–¹å¼ä¼šç¦ç”¨ Instant Run åŠŸèƒ½ï¼‰<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/03E0830C-F5BB-4EC5-AC41-50A604A3E532.png" alt=""></li>
<li>ç”±äºè°ƒè¯•è®¾å¤‡æ˜¯å°ç±³ï¼Œæ‰€ä»¥è¿˜å¯ä»¥ï¼šè®¾ç½® &gt; æ›´å¤šè®¾ç½® &gt; å¼€å‘è€…é€‰é¡¹ &gt; <strong>å»æ‰ï¼šå¯åŠ¨ MIUI ä¼˜åŒ–</strong> &gt; å…³é—­å¹¶é‡å¯</li>
</ul>
<h3 id="ADB-æ— çº¿è°ƒè¯•"><a href="#ADB-æ— çº¿è°ƒè¯•" class="headerlink" title="ADB æ— çº¿è°ƒè¯•"></a>ADB æ— çº¿è°ƒè¯•</h3><p>Android ADB æä¾›äº†æ— çº¿è°ƒè¯•çš„åŠŸèƒ½</p>
<blockquote>
<p><a href="https://developer.android.com/studio/command-line/adb.html?hl=zh-cn#Enabling" target="_blank" rel="external">Android è°ƒè¯•æ¡¥</a></p>
</blockquote>
<h4 id="è§£å†³ï¼šzsh-command-not-found-adb"><a href="#è§£å†³ï¼šzsh-command-not-found-adb" class="headerlink" title="è§£å†³ï¼šzsh: command not found: adb"></a>è§£å†³ï¼š<code>zsh: command not found: adb</code></h4><p>è§£å†³æ­¥éª¤ï¼š<br>1ï¸âƒ£ æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¾€ .bash_profile æ·»åŠ ä¸¤ä¸ªè·¯å¾„<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"export PATH=\$PATH:/Users/<span class="variable">$&#123;USER&#125;</span>/Library/Android/sdk/platform-tools/"</span> &gt;&gt; ~/.bash_profile</div><div class="line"><span class="built_in">echo</span> <span class="string">"export PATH=\$PATH:/Users/<span class="variable">$&#123;USER&#125;</span>/Library/Android/sdk/tools/"</span> &gt;&gt; ~/.bash_profile</div></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œå <code>.bash_profile</code> æ–‡ä»¶ï¼š<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export PATH=<span class="variable">$PATH</span><span class="symbol">:/Users/YingshanDeng/Library/Android/sdk/platform-tools/</span></div><div class="line">export PATH=<span class="variable">$PATH</span><span class="symbol">:/Users/YingshanDeng/Library/Android/sdk/tools/</span></div></pre></td></tr></table></figure></p>
<p>2ï¸âƒ£ æ‰§è¡Œ <code>source .bash_profile</code> ä½¿å…¶ç”Ÿæ•ˆï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­è¾“å…¥ <code>adb</code> ä¼šå‘ç°è¯¥å‘½ä»¤ç”Ÿæ•ˆäº†<br>3ï¸âƒ£ ç”±äºæˆ‘çš„ç»ˆç«¯ä½¿ç”¨çš„æ˜¯ zshï¼Œæ‰€ä»¥éœ€è¦å†å¤„ç†ä¸€ä¸‹ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> æ‰“å¼€ .zshrc</span></div><div class="line">open .zshrc</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ </span></div><div class="line">source ~/.bash_profile</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> ä¿å­˜ï¼Œé‡å¯ç»ˆç«¯å³å¯</span></div></pre></td></tr></table></figure></p>
<h4 id="AndroidWiFiADB-æ’ä»¶"><a href="#AndroidWiFiADB-æ’ä»¶" class="headerlink" title="AndroidWiFiADB æ’ä»¶"></a>AndroidWiFiADB æ’ä»¶</h4><p>ç›´æ¥ä½¿ç”¨è¿˜æ˜¯ä¸å¤Ÿæ–¹ä¾¿ï¼Œæ¨èä½¿ç”¨ <strong>AndroidWiFiADB æ’ä»¶</strong>ï¼Œé¡¹ç›®åœ°å€ï¼š<a href="https://github.com/pedrovgs/AndroidWiFiADB" target="_blank" rel="external">AndroidWiFiADB</a></p>
<p>å®‰è£…æ–¹å¼ï¼š</p>
<ul>
<li>Preferences -&gt; Settings -&gt; Plugins-&gt; Browse Repositories</li>
<li>è¾“å…¥: Android WiFi ADB è¿›è¡Œæœç´¢ï¼Œå®‰è£…åé‡å¯</li>
</ul>
<p>å¦‚ä½•ä½¿ç”¨ï¼š</p>
<ul>
<li>å…ˆå°†æ‰‹æœºé€šè¿‡ USB è¿æ¥ç”µè„‘ï¼Œè€Œä¸”ä¿è¯æ‰‹æœºå’Œç”µè„‘è¿æ¥åŒä¸€ WiFiï¼Œç‚¹å‡» AndroidWiFiADB æ’ä»¶æŒ‰é”®ï¼Œä¼šåœ¨å³ä¸‹è§’å¼¹æ°”æ³¡æç¤ºæ˜¯å¦è¿æ¥æˆåŠŸï¼Œè¿æ¥æˆåŠŸåå³å¯æ–­å¼€ USB è¿æ¥çº¿ï¼Œäº«å—æ— çº¿æç¤º</li>
<li>åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œè¦ç¡®ä¿æ‰‹æœºå’Œç”µè„‘è¿æ¥çš„åŒä¸€ WiFi</li>
<li>å¯ä»¥é€šè¿‡ AndroidWiFiADB è®¾å¤‡é¢æ¿æŸ¥çœ‹è®¾å¤‡åŠè®¾ç½®è¿æ¥çŠ¶æ€</li>
</ul>
<p><img src="http://7vikhl.com1.z0.glb.clouddn.com/36CDAE13-BEBC-42D2-9226-A53DF0CEE4B1.png" alt=""></p>
<h2 id="Chrome-è¿œç¨‹è°ƒè¯•æ¨¡æ‹Ÿå™¨-çœŸæœº"><a href="#Chrome-è¿œç¨‹è°ƒè¯•æ¨¡æ‹Ÿå™¨-çœŸæœº" class="headerlink" title="Chrome è¿œç¨‹è°ƒè¯•æ¨¡æ‹Ÿå™¨/çœŸæœº"></a>Chrome è¿œç¨‹è°ƒè¯•æ¨¡æ‹Ÿå™¨/çœŸæœº</h2><blockquote>
<p><a href="https://developers.google.com/web/tools/chrome-devtools/remote-debugging/?hl=zh-cn" target="_blank" rel="external">è¿œç¨‹è°ƒè¯• Android è®¾å¤‡ä½¿ç”¨å…¥é—¨</a></p>
</blockquote>
<p>æ“ä½œæ­¥éª¤ï¼š</p>
<ul>
<li>éšä¾¿åœ¨æŸä¸ªé¡µé¢æ‰“å¼€è°ƒè¯•é¡µé¢ï¼Œå¦‚ä¸‹å›¾æ‰¾åˆ° <strong>Remote devices</strong><br><img src="http://7vikhl.com1.z0.glb.clouddn.com/8FA1EB72-12AE-4984-AA64-2C7022B1F00E.png" alt=""></li>
<li>ç¡®ä¿å·²å‹¾é€‰ <strong>Discover USB devices</strong><br><img src="http://7vikhl.com1.z0.glb.clouddn.com/B378E60C-01E5-43AE-8EA1-02999501F241.png" alt=""></li>
<li>å¦‚ä¸‹å›¾æ‰¾åˆ°å¯¹åº”çš„æ¨¡æ‹Ÿå™¨æˆ–è€…çœŸæœºï¼Œç‚¹å‡» <strong>Inspect</strong> æŒ‰é”®å°±å¯ä»¥æ‰“å¼€è°ƒè¯•ç•Œé¢<br><img src="http://7vikhl.com1.z0.glb.clouddn.com/917006D3-5881-4A6F-814F-0B3BB54383D7.png" alt=""></li>
</ul>
<h2 id="å…¶ä»–é—®é¢˜è®°å½•"><a href="#å…¶ä»–é—®é¢˜è®°å½•" class="headerlink" title="å…¶ä»–é—®é¢˜è®°å½•"></a>å…¶ä»–é—®é¢˜è®°å½•</h2><p>1ã€Android Studio å¯¼å…¥é¡¹ç›®å¡åœ¨ <em>Building gradle project info</em> çš„è§£å†³æ–¹æ³•ï¼š</p>
<ul>
<li><a href="http://www.jianshu.com/p/1311562bbfd4" target="_blank" rel="external">ä¿®æ”¹é¡¹ç›®ä¸­gradle-wrapper.propertiesæ–‡ä»¶ä¸­çš„distributionUrl</a></li>
<li>ä»ä¸€ä¸ªèƒ½æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•æ‹·è´ <code>gradle</code> æ–‡ä»¶å¤¹è¦†ç›–å½“å‰é¡¹ç›®æ ¹ç›®å½•ä¸­çš„ <code>gradle</code> æ–‡ä»¶å¤¹</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7vikhl.com1.z0.glb.clouddn.com/android-banner.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Cordova" scheme="http://objcer.com/categories/Cordova/"/>
    
    
  </entry>
  
</feed>
